set -e
export DEBUG=1

cleanup() {
    echo "🧹 Cleaning up..."
    docker compose -f docker-compose.dev.yml -p evals down -v --remove-orphans || true
}
trap cleanup EXIT INT TERM

echo "127.0.0.1 kafka clickhouse" >> /etc/hosts

echo "🚀 Starting services..."
docker compose -f docker-compose.dev.yml -p evals up -d db

echo "⏳ Waiting for services..."
bin/check_postgres_up

echo "✅ Services ready! Migrating database..."
python manage.py migrate

echo "🌱 Seeding database..."
$EVAL_SCRIPT

echo "🎉 Done."
