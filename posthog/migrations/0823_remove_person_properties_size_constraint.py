# Generated by Django 4.2.22 on 2025-08-12 16:11

from django.db import migrations


class Migration(migrations.Migration):
    dependencies = [
        ("posthog", "0822_person_properties_size_constraint"),
    ]

    operations = [
        migrations.RunSQL(
            sql="""
            ALTER TABLE posthog_person
            DROP CONSTRAINT IF EXISTS check_properties_size;
            """,
            reverse_sql="""
            DO $$
            BEGIN
                IF NOT EXISTS (
                    SELECT 1
                    FROM pg_constraint c
                    WHERE c.conname = 'check_properties_size'
                      AND c.conrelid = 'posthog_person'::regclass
                ) THEN
                    ALTER TABLE posthog_person
                    ADD CONSTRAINT check_properties_size
                    CHECK (pg_column_size(properties) <= 655360) NOT VALID;
                END IF;
            END
            $$ LANGUAGE plpgsql;
            """,
        ),
    ]
