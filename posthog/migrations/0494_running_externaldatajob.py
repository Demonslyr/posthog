# Generated by Django 4.2.15 on 2024-10-18 15:40

from datetime import date, timedelta
from django.db import migrations, connection


def update_old_runnng_jobs(apps, schema_editor):
    created_at_date = date.today() - timedelta(days=1)

    with connection.cursor() as cursor:
        cursor.execute(
            """
UPDATE posthog_externaldatajob
SET status = 'Failed'
WHERE status = 'Running' and created_at <= %s;
            """,
            (created_at_date.strftime("%Y%m%d"),),
        )


def reverse(apps, _):
    pass


class Migration(migrations.Migration):
    dependencies = [
        ("posthog", "0493_insightvariable_values"),
    ]

    operations = [
        migrations.RunPython(update_old_runnng_jobs, reverse),
    ]
