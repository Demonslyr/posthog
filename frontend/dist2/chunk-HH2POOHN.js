import{a as L}from"/static/chunk-EWYESSII.js";import{a as te}from"/static/chunk-QNYERZG7.js";import{o as Z,s as ee}from"/static/chunk-MOVKLCV5.js";import{a as Y}from"/static/chunk-FT4MFWRB.js";import{b as q,d as Q}from"/static/chunk-Y35PDO57.js";import{Ae as M,Cg as G,Dl as J,Do as g,Eo as ae,Fe as V,Ng as T,Og as b,Pg as j,Sa as _,Sd as F,Vd as B,a as pe,de as W,ee as N,f as me,fe as f,hg as K,ie as P,ig as O,kc as R,ng as z,pe as w,r as I,sh as H,ve as U,vo as X,ze as D}from"/static/chunk-TW5IU73S.js";import{d as v,e as S,g as E,j as $}from"/static/chunk-SJXEOBQC.js";S();$();E();var s=v(pe()),A=v(me());var e=v(I()),ut={component:ge,logic:b};function fe({flagPrefix:u="",searchPlaceholder:y="Search for feature flags",nouns:d=["feature flag","feature flags"]}){let{currentProjectId:p}=(0,s.useValues)(K),{aggregationLabel:c}=(0,s.useValues)(O),l=b({flagPrefix:u}),{featureFlagsLoading:m,featureFlags:re,count:h,pagination:oe,filters:o,shouldShowEmptyState:le}=(0,s.useValues)(l),{updateFeatureFlag:ne,loadFeatureFlags:se,setFeatureFlagsFilters:i}=(0,s.useActions)(l),{hasAvailableFeature:ie}=(0,s.useValues)(ae),k=o.page||1,C=(k-1)*T+1,x=k*T<h?k*T:h,ue=a=>{let r={kind:"InsightVizNode",source:{kind:"TrendsQuery",series:[{event:"$pageview",name:"$pageview",kind:"EventsNode",math:"dau"}],breakdownFilter:{breakdown_type:"event",breakdown:`$feature/${a.key}`}}};return g.insightNew({query:r})},ce=[{title:"Key",dataIndex:"key",className:"ph-no-capture",sticky:!0,width:"40%",sorter:(a,r)=>(a.key||"").localeCompare(r.key||""),render:function(r,t){return(0,e.jsx)(j,{to:t.id?g.featureFlag(t.id):void 0,title:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("span",{children:J(t.key,17)}),!t.can_edit&&(0,e.jsx)(_,{title:"You don't have edit permissions for this feature flag.",children:(0,e.jsx)(R,{style:{marginLeft:6,verticalAlign:"-0.125em",display:"inline"}})})]}),description:t.name})}},...ie("tagging")?[{title:"Tags",dataIndex:"tags",render:function(r){return r?(0,e.jsx)(G,{tags:r,staticOnly:!0}):null}}]:[],Q(),q(),{title:"Release conditions",width:100,render:function(r,t){let n=ye(t.filters,void 0,c);return typeof n=="string"&&n.startsWith("100% of")?(0,e.jsx)(f,{type:"highlight",children:n}):n}},{title:"Status",dataIndex:"active",sorter:(a,r)=>Number(a.active)-Number(r.active),width:100,render:function(r,t){return(0,e.jsxs)("div",{className:"flex justify-start gap-1",children:[t.performed_rollback?(0,e.jsx)(f,{type:"warning",className:"uppercase",children:"Rolled Back"}):t.active?(0,e.jsx)(f,{type:"success",className:"uppercase",children:"Enabled"}):(0,e.jsx)(f,{type:"default",className:"uppercase",children:"Disabled"}),t.status==="STALE"&&(0,e.jsx)(_,{title:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:"text-sm",children:"Flag at least 30 days old and fully rolled out"}),(0,e.jsx)("div",{className:"text-xs",children:"Make sure to remove any references to this flag in your code before deleting it."})]}),placement:"left",children:(0,e.jsx)("span",{children:(0,e.jsx)(f,{type:"warning",className:"uppercase cursor-default",children:"Stale"})})})]})}},{width:0,render:function(r,t){return(0,e.jsx)(U,{overlay:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(F,{onClick:()=>{V(t.key,"feature flag key")},fullWidth:!0,children:"Copy feature flag key"}),(0,e.jsxs)(L,{userAccessLevel:t.user_access_level,minAccessLevel:"editor",resourceType:"feature_flag","data-attr":`feature-flag-${t.key}-switch`,onClick:()=>{let n=!t.active;W.open({title:`${n===!0?"Enable":"Disable"} this flag?`,description:`This flag will be immediately ${n===!0?"rolled out to":"rolled back from"} the users matching the release conditions.`,primaryButton:{children:"Confirm",type:"primary",onClick:()=>{t.id&&ne({id:t.id,payload:{active:n}})},size:"small"},secondaryButton:{children:"Cancel",type:"tertiary",size:"small"}})},id:`feature-flag-${t.id}-switch`,fullWidth:!0,children:[t.active?"Disable":"Enable"," feature flag"]}),t.id&&(0,e.jsx)(L,{userAccessLevel:t.user_access_level,minAccessLevel:"editor",resourceType:"feature_flag",fullWidth:!0,disabled:!t.can_edit,onClick:()=>t.id&&A.router.actions.push(g.featureFlag(t.id)),children:"Edit"}),(0,e.jsx)(F,{to:ue(t),"data-attr":"usage",fullWidth:!0,children:"Try out in Insights"}),(0,e.jsx)(N,{}),t.id&&(0,e.jsx)(L,{userAccessLevel:t.user_access_level,minAccessLevel:"editor",resourceType:"feature_flag",status:"danger",onClick:()=>{z({endpoint:`projects/${p}/feature_flags`,object:{name:t.key,id:t.id},callback:se}).catch(n=>{B.error(`Failed to delete feature flag: ${n.detail}`)})},disabledReason:t.can_edit?(t.features?.length||0)>0?"This feature flag is in use with an early access feature. Delete the early access feature to delete this flag":(t.experiment_set?.length||0)>0?"This feature flag is linked to an experiment. Delete the experiment to delete this flag":null:"You have only 'View' access for this feature flag. To make changes, please contact the flag's creator.",fullWidth:!0,children:"Delete feature flag"})]})})}}],de=(0,e.jsxs)("div",{className:"flex justify-between mb-4 gap-2 flex-wrap",children:[(0,e.jsx)(P,{className:"w-60",type:"search",placeholder:y||"",onChange:a=>i({search:a,page:1}),value:o.search||"","data-attr":"feature-flag-search"}),(0,e.jsxs)("div",{className:"flex items-center gap-2",children:[(0,e.jsx)("span",{children:(0,e.jsx)("b",{children:"Type"})}),(0,e.jsx)(w,{dropdownMatchSelectWidth:!1,size:"small",onChange:a=>{if(a)if(a==="all"){if(o){let{type:r,...t}=o;i({...t,page:1},!0)}}else i({type:a,page:1})},options:[{label:"All",value:"all"},{label:"Boolean",value:"boolean"},{label:"Multiple variants",value:"multivariant","data-attr":"feature-flag-select-type-option-multiple-variants"},{label:"Experiment",value:"experiment"},{label:"Remote config",value:"remote_config"}],value:o.type??"all","data-attr":"feature-flag-select-type"}),(0,e.jsx)("span",{children:(0,e.jsx)("b",{children:"Status"})}),(0,e.jsx)(w,{dropdownMatchSelectWidth:!1,size:"small",onChange:a=>{if(a==="all"){if(o){let{active:r,...t}=o;i({...t,page:1},!0)}}else i({active:a,page:1})},options:[{label:"All",value:"all","data-attr":"feature-flag-select-status-all"},{label:"Enabled",value:"true"},{label:"Disabled",value:"false","data-attr":"feature-flag-select-status-disabled"}],value:o.active??"all","data-attr":"feature-flag-select-status"}),(0,e.jsx)("span",{className:"ml-1",children:(0,e.jsx)("b",{children:"Created by"})}),(0,e.jsx)(te,{defaultLabel:"Any user",value:o.created_by_id??null,onChange:a=>{if(a)i({created_by_id:a.id,page:1});else if(o){let{created_by_id:r,...t}=o;i({...t,page:1},!0)}},"data-attr":"feature-flag-select-created-by"})]})]});return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(Y,{productName:"Feature flags",productKey:"feature_flags",thingName:"feature flag",description:"Use feature flags to safely deploy and roll back new features in an easy-to-manage way. Roll variants out to certain groups, a percentage of users, or everyone all at once.",docsURL:"https://posthog.com/docs/feature-flags/manual",action:()=>A.router.actions.push(g.featureFlag("new")),isEmpty:le,customHog:H}),(0,e.jsx)("div",{children:de}),(0,e.jsx)(N,{className:"my-4"}),(0,e.jsx)("div",{className:"mb-4",children:(0,e.jsx)("span",{className:"text-secondary ",children:h?`${C}${x-C>1?"-"+x:""} of ${h} flag${h===1?"":"s"}`:null})}),(0,e.jsx)(D,{dataSource:re.results,columns:ce,rowKey:"key",defaultSorting:{columnKey:"created_at",order:-1},noSortingCancellation:!0,loading:m,pagination:oe,nouns:d,"data-attr":"feature-flag-table",emptyState:"No results for this filter, change filter or create a new flag.",onSort:a=>i({order:a?`${a.order===-1?"-":""}${a.columnKey}`:void 0,page:1})})]})}function ge(){let{activeTab:u}=(0,s.useValues)(b),{setActiveTab:y}=(0,s.useActions)(b);return(0,e.jsxs)("div",{className:"feature_flags",children:[(0,e.jsx)(X,{buttons:(0,e.jsx)(F,{type:"primary",to:g.featureFlag("new"),"data-attr":"new-feature-flag",children:"New feature flag"})}),(0,e.jsx)(M,{activeKey:u,onChange:d=>y(d),tabs:[{key:"overview",label:"Overview",content:(0,e.jsx)(fe,{})},{key:"history",label:"History",content:(0,e.jsx)(ee,{scope:"FeatureFlag"})}],"data-attr":"feature-flags-tab-navigation"})]})}function ye(u,y,d){let p=d&&u.aggregation_group_type_index!=null?d(u.aggregation_group_type_index).plural:"users",c=u.groups||[];if(c.length===0||!c.some(l=>l.rollout_percentage!==0))return`No ${p}`;if(c.some(l=>!l.properties?.length&&[null,void 0,100].includes(l.rollout_percentage)))return`100% of all ${p}`;if(c.length===1){let{properties:l,rollout_percentage:m=null}=c[0];return(l?.length||0)>0?y?`${m??100}% of one group`:(0,e.jsxs)("div",{className:"flex items-center",children:[(0,e.jsxs)("span",{className:"shrink-0 mr-2",children:[m??100,"% of"]}),(0,e.jsx)(Z,{filters:l})]}):m!==null?`${m}% of all ${p}`:(console.error("A group with full rollout was not detected early"),`100% of all ${p}`)}return"Multiple groups"}export{ut as a,fe as b,ge as c,ye as d};
//# sourceMappingURL=/static/chunk-HH2POOHN.js.map
