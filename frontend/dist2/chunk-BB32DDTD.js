import{d as Me,f as Qe}from"/static/chunk-QB3AUFV2.js";import{Do as j,Eh as Ce,Hl as Ee,Il as _e,Io as Ae,Mi as De,Nd as ue,Ne as Te,No as B,Po as I,Qd as fe,Qo as K,Sa as ce,Sd as U,So as Oe,Ta as F,To as ee,Vd as ge,Wh as E,Xo as _,Za as Ke,Zo as $e,_g as be,a as v,ch as q,dj as Ne,f as Ue,fe as he,fj as Le,h as je,io as M,mp as x,r as h,td as de,tp as Fe,wg as R,wk as xe,wp as Ie,xp as We,ye,yk as we,ze as Pe,zk as Se}from"/static/chunk-TW5IU73S.js";import{Da as le,a as ae,dc as k,qb as pe,ub as me}from"/static/chunk-3UDJFOQH.js";import{d as p,e as u,g as f,j as g}from"/static/chunk-SJXEOBQC.js";u();g();f();var N=p(v()),Je=p(Ke());var W=p(h()),Ve=(0,N.kea)([(0,N.path)(["scenes","persons","personDeleteModalLogic"]),(0,N.props)({}),(0,N.actions)({showPersonDeleteModal:(r,e)=>({person:r,callback:e}),deletePerson:(r,e)=>({person:r,deleteEvents:e})}),(0,N.reducers)({personDeleteModal:[null,{showPersonDeleteModal:(r,{person:e})=>e}],personDeleteCallback:[null,{showPersonDeleteModal:(r,{callback:e})=>e??null}]}),(0,Je.loaders)(({actions:r,values:e})=>({deletedPerson:[null,{deletePerson:async({person:t,deleteEvents:s})=>{let o=s?{delete_events:!0}:{};return await Ae.delete(`api/person/${t.id}?${le(o)}`),ge.success((0,W.jsxs)(W.Fragment,{children:["The person ",(0,W.jsx)("strong",{children:Ce(t)})," was removed from the project.",s?" Corresponding events will be deleted on a set schedule during non-peak usage times.":" Their ID(s) will be usable again in an hour or so."]})),e.personDeleteCallback?.(t,s),r.showPersonDeleteModal(null),t}}]}))]);u();g();f();var G=p(je()),ve=p(v());var re=p(ae());var y=p(h());function Ge({timings:r,elapsedTime:e}){return(0,y.jsxs)("div",{className:"space-y-2 p-2",children:[r.map(({k:t,t:s})=>(0,y.jsxs)("div",{className:(0,G.default)("flex justify-between items-start space-x-2",s>r[r.length-1].t*.5?"font-bold":""),children:[(0,y.jsx)("div",{children:t=="."?"Query total":t}),(0,y.jsxs)("div",{children:[s.toFixed(3),"s"]})]},t)),e!==void 0&&r.length>0?(0,y.jsxs)("div",{className:(0,G.default)("flex justify-between items-start space-x-2"),children:[(0,y.jsx)("div",{children:"+ HTTP overhead"}),(0,y.jsxs)("div",{children:[(e/1e3-r[r.length-1].t).toFixed(3),"s"]})]}):null]})}function Ze({elapsedTime:r,hasError:e,timings:t}){let[s,o]=(0,re.useState)(!1);return(0,y.jsx)(ue,{onClickOutside:()=>o(!1),visible:s,placement:"bottom",overlay:(0,y.jsx)(Ge,{timings:t,elapsedTime:r}),children:(0,y.jsxs)("div",{onClick:()=>o(m=>!m),className:(0,G.default)(e?"text-danger":"","cursor-help"),children:[(r/1e3).toFixed(r<1e3?2:1),"s"]})})}function lr({showTimings:r}){let{elapsedTime:e,loadingStart:t,responseError:s,isShowingCachedResults:o,timings:m,query:d}=(0,ve.useValues)(E),[,c]=(0,re.useState)(0);if("query"in d&&d.query==="")return null;let a=e;return o&&(a=0),!o&&t&&!e&&(a=performance.now()-t,window.requestAnimationFrame(()=>{c(n=>n+1)})),a?e&&m&&r?(0,y.jsx)(Ze,{elapsedTime:e,timings:m,hasError:!!s}):(0,y.jsxs)("div",{className:s?"text-danger":"",children:[(a/1e3).toFixed(a<1e3?2:1),"s"]}):null}u();g();f();var L=p(Ue());u();g();f();var oe=p(h());function J({value:r}){let e,t;return typeof r=="object"?e=t=JSON.stringify(r):pe(r)?(e=r,t=(0,oe.jsx)(F,{to:e,target:"_blank",children:r})):e=t=String(r),(0,oe.jsx)("span",{title:e,children:t})}u();g();f();var te=p(v());var ne=p(h());function Re({person:r}){let{showPersonDeleteModal:e}=(0,te.useActions)(Ve),{loadData:t}=(0,te.useActions)(E);return(0,ne.jsx)(U,{onClick:()=>e(r,()=>t()),icon:(0,ne.jsx)(de,{}),status:"danger",size:"small","data-attr":"delete-person"})}var l=p(h());function Be(r,e,t,s,o,m,d){let c=r.startsWith("context.columns.")?x(r.substring(16)):void 0,a=c?d?.columns?.[c]:void 0;if(e===we)return(0,l.jsx)(fe,{});if(e===Se)return(0,l.jsx)(he,{className:"text-danger",children:"Error"});if(c&&a?.render){let n=a?.render;return(0,l.jsx)(n,{record:t,columnName:c,value:e,query:o,recordIndex:s})}else if(d?.columns?.[r]&&d?.columns?.[r].render){let n=d?.columns?.[r]?.render;return n?(0,l.jsx)(n,{record:t,columnName:r,value:e,query:o,recordIndex:s}):String(e)}else{if(typeof e=="object"&&Array.isArray(e)&&e[0]==="__hx_tag")return Qe(e);if(e===null)return(0,l.jsx)(ce,{title:"NULL",placement:"right",delayMs:0,children:(0,l.jsx)("span",{className:"cursor-default","aria-hidden":!0,children:"\u2014"})});if(_(o.source)){if(typeof e=="string"){try{if(e.startsWith("{")&&e.endsWith("}"))return(0,l.jsx)(M,{src:JSON.parse(e),name:r,collapsed:Object.keys(JSON.stringify(e)).length>10?0:1});if(e.startsWith("[")&&e.endsWith("]"))return(0,l.jsx)(M,{src:JSON.parse(e),name:r,collapsed:JSON.stringify(e).length>10?0:1})}catch{}if(e.match(/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(?:\.\d{3,6})?(?:Z|[+-]\d{2}:\d{2})?$/))return(0,l.jsx)(q,{time:e,showSeconds:!0})}return typeof e=="object"?Array.isArray(e)?(0,l.jsx)(M,{src:e,name:r,collapsed:e.length>10?0:1}):(0,l.jsx)(M,{src:e,name:r,collapsed:Object.keys(e).length>10?0:1}):(0,l.jsx)(J,{value:e})}else if(r==="event"&&B(o.source)){let n=t,i=o.source.select.includes("*")?n[o.source.select.indexOf("*")]:null;if(e==="$autocapture"&&i)return me(i);let P=(0,l.jsx)(R,{value:e,type:"events"}),T=i?.properties?.$sentry_url;return T?(0,l.jsx)(F,{to:T,target:"_blank",children:P}):P}else{if(r==="timestamp"||r==="created_at"||r==="session_start"||r==="session_end")return(0,l.jsx)(q,{time:e,showSeconds:!0});if(!Array.isArray(t)&&r.startsWith("properties.")){let n=x(r.substring(11));if(m&&(B(o.source)||I(o.source))&&o.showPropertyFilter){let i={key:n,value:t.properties[n],operator:"exact",type:I(o.source)?"person":"event"},P=(o.source.properties||[]).find(D=>D.key===i.key&&D.type===i.type),T=P?(o.source.properties||[]).filter(D=>D!==P):[...o.source.properties||[],i],$=o.propertiesViaUrl?(0,L.combineUrl)(L.router.values.location.pathname,{...L.router.values.searchParams,properties:T},L.router.values.hashParams).url:"#";return(0,l.jsx)(F,{className:"ph-no-capture",to:$,onClick:D=>{D.preventDefault(),m({...o,source:{...o.source,properties:T}})},children:(0,l.jsx)(J,{value:t.properties[n]})})}return(0,l.jsx)(J,{value:t.properties[n]})}else if(!Array.isArray(t)&&r.startsWith("person.properties.")){let n=t,i=x(r.substring(18));if(m&&B(o.source)){let P={key:i,value:n.person?.properties[i],operator:"exact",type:"person"},T=(o.source.properties||[]).find(S=>S.key===P.key&&S.type===P.type),$=T?(o.source.properties||[]).filter(S=>S!==T):[...o.source.properties||[],P],D=o.propertiesViaUrl?(0,L.combineUrl)(L.router.values.location.pathname,{...L.router.values.searchParams,properties:$},L.router.values.hashParams).url:"#";return(0,l.jsx)(F,{className:"ph-no-capture",to:D,onClick:S=>{S.preventDefault(),m({...o,source:{...o.source,properties:$}})},children:(0,l.jsx)(J,{value:n.person?.properties?.[i]})})}return(0,l.jsx)(J,{value:n.person?.properties?.[i]})}else if(r==="person"){let n=t,i={withIcon:!0,person:t,noPopover:!0};return B(o.source)&&(i.person=(e.distinct_id,e),i.noPopover=!1),I(o.source)&&n.distinct_ids&&(i.href=j.personByDistinctId(n.distinct_ids[0])),K(o.source)&&e&&(i.person=e,i.href=e.distinct_ids?.[0]?j.personByDistinctId(e.distinct_ids[0]):j.personByUUID(e.id)),$e(o.source)&&(i.person=(e.distinct_id,e),i.noPopover=!1),(0,l.jsx)(xe,{...i})}else{if(r==="group"&&typeof e=="object")return(0,l.jsx)(be,{actor:e});if(r==="person.$delete"&&(I(o.source)||K(o.source))){if(!Array.isArray(t))return console.error("Expected record to be an array for person.$delete column"),"";let n=t[0];return(0,l.jsx)(Re,{person:n})}else if(r.startsWith("context.columns.")){let n=x(r.substring(16)),i=d?.columns?.[n]?.render;return i?(0,l.jsx)(i,{record:t,columnName:n,value:e,query:o,recordIndex:s}):String(e)}else if(r==="id"&&(I(o.source)||K(o.source)))return(0,l.jsx)(De,{explicitValue:String(e),iconStyle:{color:"var(--accent-primary)"},description:"person id",children:String(e)})}}}if(typeof e=="object")return(0,l.jsx)(M,{src:e,name:null,collapsed:Object.keys(e).length>10?0:1});if(typeof e=="string"&&(e.startsWith("{")&&e.endsWith("}")||e.startsWith("[")&&e.endsWith("]")))try{return(0,l.jsx)(M,{src:JSON.parse(e),name:null,collapsed:Object.keys(e).length>10?0:1})}catch{}return String(e)}u();g();f();var C=p(h());function Xe(r,e,t){let s,o,m=Fe(e.source),d,c=r.startsWith("context.columns.")?x(r.substring(16)):void 0,a=(c?t?.columns?.[c]:void 0)??t?.columns?.[r];if(c&&a&&(a.title||a.renderTitle)){let n=a.renderTitle;o=n?(0,C.jsx)(n,{columnName:c,query:e}):a.title}else if(_(e.source)){if(o=r,o.startsWith("`")&&o.endsWith("`")&&(o=o.substring(1,o.length-1)),o.startsWith("tuple('__hx_tag', '")){let n=o.substring(19,o.indexOf("'",19));o=n==="__hx_obj"?"Object":n==="RecordingButton"?"Recording":"<"+n+" />"}}else r==="timestamp"?o="Time":r==="created_at"?o="First seen":r==="event"?o="Event":r==="person"?o="Person":r.startsWith("properties.")?o=(0,C.jsx)(R,{value:x(We(r.substring(11))),type:"event_properties",disableIcon:!0}):r==="person.$delete"?(o="",s=0):r.startsWith("person.properties.")?o=(0,C.jsx)(R,{value:x(r.substring(18)),type:"person_properties",disableIcon:!0}):c?o=c.replace("_"," "):o=m.has(10)?Ie(r):r;if(a?.align&&(d=a.align),a?.width?s=a.width:t?.columns?.[r]?.width&&(s=t.columns[r].width),c&&a&&(a.title||a.renderTitle)){let n=a.renderTitle;o=n?(0,C.jsx)(n,{columnName:c,query:e}):a.title}else if(t?.columns?.[r]?.title||t?.columns?.[r]?.renderTitle){let n=t?.columns?.[r]?.renderTitle;o=n?(0,C.jsx)(n,{columnName:r,query:e}):t?.columns?.[r]?.title}if(m.has(10)&&Oe(e)&&!e.allowSorting){let n=m.has(10)?e.source?.orderBy?.[0]:null,i=r===n?1:`-${r}`===n?-1:void 0;i&&(o=(0,C.jsxs)(C.Fragment,{children:[o,(0,C.jsx)(ye,{order:i})]}))}return{title:o,...typeof s<"u"?{width:s}:{},...d?{align:d}:{}}}u();g();f();var H=p(v());var ze=p(ae());u();g();f();var se=p(v());var X=p(h()),Z=500,_o=r=>{let{isDarkModeOn:e}=(0,se.useValues)(Te),{tabularData:t,tabularColumns:s,conditionalFormattingRules:o,responseLoading:m,responseError:d,queryCancelled:c,response:a}=(0,se.useValues)(_e),n=s.map(({column:i,settings:P},T)=>{let{title:$,...D}=Xe(i.name,r.query,r.context);return{...D,title:P?.display?.label||$||i.name,render:(S,z,ie)=>Be(i.name,z[T].formattedValue,z,ie,{kind:"DataTableNode",source:r.query.source}),style:(S,z)=>{let Y=o.filter(b=>b.columnName===i.name).map(b=>{let V=Me(b.bytecode,{globals:{value:z[T].value,input:Ee(b.input,i.type.name)},functions:{},maxAsyncSteps:0});return{rule:b,result:V.result}}).find(b=>!!b.result);if(Y){let b=Y.rule.color,V=Y.rule.colorMode??"light";return V==="dark"&&e||V==="light"&&!e?{backgroundColor:b}:V==="dark"&&!e?{backgroundColor:k(b,30)}:{backgroundColor:k(b,-30)}}}}});return(0,X.jsx)(Pe,{dataSource:t,columns:n,loading:m,pagination:{pageSize:Z},emptyState:d?(0,X.jsx)(Le,{query:r.query,excludeDetail:!0,title:c?"The query was cancelled":a&&"error"in a?a.error:d}):(0,X.jsx)(Ne,{heading:"There are no matching rows for this query",detail:""}),footer:t.length>0?(0,X.jsx)(He,{query:r.query}):null,rowClassName:"DataVizRow"})};var w=p(h());function He({query:r}){let{canLoadNextData:e,nextDataLoading:t,numberOfRows:s,hasMoreData:o,dataLimit:m}=(0,H.useValues)(E),{loadNextData:d}=(0,H.useActions)(E),c=(0,ze.useMemo)(()=>{if(ee(r)&&_(r.source))return m?s&&s<m?`Showing ${s===1?"":"all"} ${s===1?"one":s} ${s===1?"entry":"entries"}`:`Default limit of ${m} rows reached`:s&&s<=Z?`Showing ${s===1?"":"all"} ${s===1?"one":s} ${s===1?"entry":"entries"}`:"";if(_(r)&&!e&&o&&m)return`Default limit of ${m} rows reached. Try adding a LIMIT clause to adjust.`;let a=`Showing ${o&&(s??0)>1?"first ":e||s===1?"":"all "}${s===1?"one":s} ${s===1?"entry":"entries"}`;return e?a+=". Click to load more.":o&&(a+=". Reached the end of results."),a},[r,m,s,e,o]);return ee(r)&&_(r.source)&&!m&&(!s||s>Z)?(0,w.jsx)(w.Fragment,{}):(0,w.jsx)("div",{className:"m-2 flex items-center",children:(0,w.jsx)(U,{onClick:d,loading:t,fullWidth:!0,center:!0,disabled:!e,children:c})})}function Jo(){let{numberOfRows:r,hasMoreData:e}=(0,H.useValues)(E);return(0,w.jsxs)(w.Fragment,{children:["Showing ",e&&(r??0)>1?"first ":" ",r===1?"one":r," ",r===1?"entry":"entries"]})}export{Ge as a,lr as b,Ve as c,Be as d,Xe as e,_o as f,He as g,Jo as h};
//# sourceMappingURL=/static/chunk-BB32DDTD.js.map
