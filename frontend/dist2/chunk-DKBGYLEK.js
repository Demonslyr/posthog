import{e as u}from"/static/chunk-TIKFJXRT.js";import{Io as c,Ip as g,Vd as t,Za as v,a as L}from"/static/chunk-TW5IU73S.js";import{d as m,e as p,g as R,j as d}from"/static/chunk-SJXEOBQC.js";p();d();R();var r=m(L()),z=m(v());var P={"feature flags":"Feature Flags"},x={37:"View & Edit",21:"View Only"},f={"feature flags":"feature_flags_access_level"},D=(0,r.kea)([(0,r.path)(["scenes","organization","Settings","Permissions","permissionsLogic"]),(0,r.connect)({values:[u,["roles"]],actions:[u,["updateRole"]]}),(0,r.actions)({updatePermission:(e,s,o,i)=>({checked:e,role:s,resourceId:o,resourceType:i})}),(0,z.loaders)(({values:e})=>({organizationResourcePermissions:[[],{loadOrganizationResourcePermissions:async()=>(await c.resourcePermissions.list())?.results||[],updateOrganizationResourcePermission:async({id:s,resource:o,access_level:i})=>{if(s){let n=await c.resourcePermissions.update(s,{access_level:i});return e.organizationResourcePermissions.map(a=>a.id==n.id?n:a)}else{let n=await c.resourcePermissions.create({resource:o,access_level:i});return[...e.organizationResourcePermissions,n]}}}]})),(0,r.listeners)(({actions:e})=>({updatePermission:async({checked:s,role:o,resourceId:i,resourceType:n})=>{let a=s?37:21;if(o.id){let l=await c.roles.update(o.id,{[f[n]]:a});l&&(e.updateRole(l),t.success(`${o.name} role ${n} edit access updated`))}else e.updateOrganizationResourcePermission({id:i,resource:n,access_level:a});g.actions.reportResourceAccessLevelUpdated(n,o.name,a)},updateOrganizationResourcePermissionSuccess:()=>{t.success("Organizational edit access updated")}})),(0,r.selectors)({organizationResourcePermissionsMap:[e=>[e.organizationResourcePermissions],e=>e.reduce((s,o)=>({...s,[o.resource]:o}),{})],allPermissions:[e=>[e.organizationResourcePermissionsMap],e=>Object.keys(P).map(s=>({id:e[s]?.id||null,resource:s,name:P[s],access_level:e[s]?.access_level||37}))],resourceRolesAccess:[e=>[e.allPermissions,e.roles],(e,s)=>{let o=e.map(i=>({[i.resource]:{organization_default:i.access_level,id:i.id}}));for(let i of s)for(let n of o){let a=Object.keys(n)[0];n[a][`${i.name}`]=i[f[a]]}return o}]}),(0,r.afterMount)(({actions:e})=>{e.loadOrganizationResourcePermissions()})]);export{D as a};
//# sourceMappingURL=/static/chunk-DKBGYLEK.js.map
