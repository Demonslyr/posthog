import{a as v}from"/static/chunk-XY7F5WGW.js";import{a as Ae}from"/static/chunk-FQ666B2X.js";import{a as it}from"/static/chunk-LYVLXNIU.js";import{a as ea,b as ta}from"/static/chunk-ZRP64K7H.js";import{a as qt,b as ae,e as z,g as Kt,h as De}from"/static/chunk-F4VW2WHG.js";import{a as $t}from"/static/chunk-XW2JOKCQ.js";import{a as _e}from"/static/chunk-Z3ZSBYIV.js";import{i as Me}from"/static/chunk-VVSLW35Y.js";import{a as Ht}from"/static/chunk-OYAHDROG.js";import{s as jt}from"/static/chunk-44P5EQSU.js";import{j as nt}from"/static/chunk-CBJ7RAUW.js";import{a as Pe,b as ve,c as oe,d as st,e as ye}from"/static/chunk-HRNZBUVG.js";import{$a as bt,$d as me,Ae as Ie,Bi as Ut,Ce as Be,Do as ot,Ek as Yt,Fk as Zt,Gm as zt,Hg as et,If as Qt,Ik as at,J as gt,Lh as At,Ml as Jt,Nd as Ct,Nl as Ot,Oe as Bt,Of as Wt,Pe as Vt,Pf as Pt,Qd as Ft,Rf as Mt,Sa as pe,Sc as he,Sd as L,Ta as te,Tc as qe,Tf as N,Wd as kt,Xl as xe,Ya as we,Yb as ht,Yd as wt,Yh as Dt,a as ee,ae as Ke,b as mt,cc as le,ch as tt,de as X,dl as Xt,ee as Y,f as Ia,fe as ue,fl as Qe,h as Ba,ie as I,kc as Te,ki as Ee,m as $e,ma as ft,mc as St,nd as Nt,od as xt,pd as Rt,pe as M,pg as _t,qd as Lt,r as T,se as Ne,td as Se,te as Tt,ug as Ve,ve as It,vo as We,wk as Gt,yf as Et,ze as ce}from"/static/chunk-RFJTZKD6.js";import{F as re,Ha as vt,Ma as W,Tb as ke,a as Le,fb as Ce,na as q,sb as Fe,vb as yt}from"/static/chunk-3UDJFOQH.js";import{d as x,e as F,g as k,j as w}from"/static/chunk-SJXEOBQC.js";F();w();k();var se=x(ee()),Ra=x(bt()),La=x(Ia());var Ca=x(Le());F();w();k();var J=x(ee());var va=x(Le());F();w();k();var de=x(ee());var B=x(T());function Ea(){let{showSurveyRepeatSchedule:e,survey:t}=(0,de.useValues)(v),{setSurveyValue:o}=(0,de.useActions)(v),{surveysRecurringScheduleAvailable:i}=(0,de.useValues)(ae),d=i?void 0:"Upgrade your plan to use repeating surveys";return(0,B.jsxs)(B.Fragment,{children:[(0,B.jsx)(N.Pure,{info:"Showing a survey all the time requires at least version 1.220.0 of posthog-js",label:(0,B.jsx)("h3",{className:"mb-0",children:"How often should we show this survey?"}),children:(0,B.jsx)(Ee,{value:t.schedule??"once",onChange:r=>{o("schedule",r),r==="once"||r==="always"?(o("iteration_count",0),o("iteration_frequency_days",0)):r==="recurring"&&(o("iteration_count",1),o("iteration_frequency_days",90))},options:[{value:"once",label:"Once","data-attr":"survey-iteration-frequency-days"},{value:"recurring",label:"Repeat on a schedule","data-attr":"survey-iteration-frequency-days",disabledReason:d},{value:"always",label:"All the time","data-attr":"survey-iteration-frequency-days",disabledReason:t.type!=="widget"?"Only available for widget surveys":void 0}]})}),e&&(0,B.jsxs)("div",{className:"flex flex-row gap-2 items-center mt-2 ml-5",children:["Repeat this survey"," ",(0,B.jsx)(N,{name:"iteration_count",children:({onChange:r,value:l})=>(0,B.jsx)(I,{type:"number","data-attr":"survey-iteration-count",size:"small",min:1,max:500,value:l||1,onChange:c=>{c&&c>0?r(c):r(null)},className:"w-16"})})," ","times, once every",(0,B.jsx)(N,{name:"iteration_frequency_days",children:({onChange:r,value:l})=>(0,B.jsx)(I,{type:"number","data-attr":"survey-iteration-frequency-days",size:"small",min:1,value:l||90,onChange:c=>{c&&c>0?r(c):r(null)},className:"w-16"})})," ","days"]})]})}function sa(){let{survey:e}=(0,de.useValues)(v),{setSelectedSection:t}=(0,de.useActions)(v),o=!!(e.conditions?.events?.repeatedActivation&&e.conditions?.events?.values?.length>0);return(0,B.jsx)("div",{className:"mt-4",children:o?(0,B.jsxs)("span",{className:"font-medium",children:[(0,B.jsx)("h3",{className:"mb-0",children:"How often should we show this survey?"}),(0,B.jsx)(le,{className:"mr-0.5"})," This survey is displayed whenever the"," ",(0,B.jsx)(Tt,{children:e.conditions?.events?.values.map(i=>i.name).join(", ")})," ",(0,B.jsx)("span",{children:e.conditions?.events?.values.length===1?"event is":"events are"})," triggered. So these settings are not applicable. If you want, remove the event targeting in the"," ",(0,B.jsx)(te,{onClick:()=>t("DisplayConditions"),children:"display conditions section"}),"."]}):(0,B.jsx)(Ea,{})})}F();w();k();var na=x(T());function ge({survey:e}){let t={id:e.id,name:e.name,description:e.description,type:"api",linked_flag_key:e.linked_flag?e.linked_flag.key:null,targeting_flag_key:e.targeting_flag?e.targeting_flag.key:null,questions:e.questions,conditions:e.conditions,start_date:e.start_date,end_date:e.end_date};return(0,na.jsx)(Bt,{wrap:!0,language:"json",children:JSON.stringify(t,null,2)})}F();w();k();var oa=x(Ba()),ia=x(ee());var V=x(T());function Ge({title:e,description:t,children:o,onClick:i,value:d,active:r}){return(0,V.jsxs)("div",{className:(0,oa.default)("border rounded relative px-4 py-2 overflow-hidden h-[180px] w-[200px]",r?"border-accent-primary":"border-border"),children:[(0,V.jsx)("p",{className:"font-semibold m-0",children:e}),t&&(0,V.jsx)("p",{className:"m-0 text-xs",children:t}),(0,V.jsx)("div",{className:"relative mt-2 presentation-preview",children:o}),(0,V.jsx)("input",{onClick:i,className:"opacity-0 absolute inset-0 h-full w-full cursor-pointer",name:"type",value:d,type:"radio"})]})}function Ye({value:e,onChange:t,onTabChange:o,activeTab:i,textPlaceholder:d}){let{surveysHTMLAvailable:r}=(0,ia.useValues)(ae);return(0,V.jsxs)(V.Fragment,{children:[(0,V.jsx)(Ie,{activeKey:i,onChange:o,tabs:[{key:"text",label:(0,V.jsx)("span",{className:"text-sm",children:"Text"}),content:(0,V.jsx)(Be,{minRows:2,value:e,onChange:l=>t(l),placeholder:d})},{key:"html",label:(0,V.jsxs)("div",{children:[(0,V.jsx)("span",{className:"text-sm",children:"HTML"}),!r&&(0,V.jsx)(Te,{className:"ml-2"})]}),content:(0,V.jsx)("div",{children:r?(0,V.jsx)(et,{className:"border",language:"html",value:e,onChange:l=>t(l??""),height:150,options:{minimap:{enabled:!1},scrollbar:{alwaysConsumeMouseWheel:!1},wordWrap:"on",scrollBeyondLastLine:!1,automaticLayout:!0,fixedOverflowWidgets:!0,lineNumbers:"off",glyphMargin:!1,folding:!1}}):(0,V.jsx)(Ut,{feature:"surveys_text_html",children:(0,V.jsx)(et,{className:"border",language:"html",value:e,onChange:l=>t(l??""),height:150,options:{minimap:{enabled:!1},scrollbar:{alwaysConsumeMouseWheel:!1},wordWrap:"on",scrollBeyondLastLine:!1,automaticLayout:!0,fixedOverflowWidgets:!0,lineNumbers:"off",glyphMargin:!1,folding:!1}})})})}]}),e&&e?.toLowerCase().includes("<script")&&(0,V.jsx)(kt,{type:"warning",children:"Scripts won't run in the survey popover and we'll remove these on save. Use the API question mode to run your own scripts in surveys."})]})}F();w();k();var be=x(ee()),ua=x(bt());F();w();k();var fe=x(ee());var A=x(T());function ra({questionIndex:e,question:t}){let{survey:o,getBranchingDropdownValue:i}=(0,fe.useValues)(v),{setQuestionBranchingType:d,setSurveyValue:r}=(0,fe.useActions)(v),l=o.questions.map((f,p)=>({...f,questionIndex:p})).filter((f,p)=>e!==p),c=i(e,t),m=t.type==="rating"||t.type==="single_choice";return(0,A.jsxs)(A.Fragment,{children:[(0,A.jsx)(N,{name:"branching",label:"After this question, go to:",className:"max-w-80",children:(0,A.jsx)(M,{className:"max-w-80 whitespace-nowrap",value:c,"data-attr":`survey-question-${e}-branching-select`,onSelect:f=>{let p=()=>{let y;f.startsWith("specific_question")&&(y=parseInt(f.split(":")[1]),f="specific_question"),d(e,f,y)};o.appearance&&o.appearance.shuffleQuestions?X.open({title:"Your survey has question shuffling enabled",description:(0,A.jsx)("p",{className:"py-2",children:"Adding branching logic will disable shuffling of questions. Are you sure you want to continue?"}),primaryButton:{children:"Continue",status:"danger",onClick:()=>{r("appearance",{...o.appearance,shuffleQuestions:!1}),p()}},secondaryButton:{children:"Cancel"}}):p()},options:[...e<o.questions.length-1?[{label:"Next question",value:"next_question"}]:[],{label:o.appearance?.displayThankYouMessage?"Confirmation message":"End",value:"end"},...m?[{label:"Specific question based on answer",value:"response_based"}]:[],...l.map(f=>({label:Fe(`${f.questionIndex+1}. ${f.question}`,40),value:`specific_question:${f.questionIndex}`}))]})}),c==="response_based"&&(0,A.jsx)(Wa,{question:t,questionIndex:e})]})}function Wa({questionIndex:e,question:t}){let{survey:o,getResponseBasedBranchingDropdownValue:i}=(0,fe.useValues)(v),{setResponseBasedBranchingForQuestion:d}=(0,fe.useActions)(v),r=o.questions.map((c,m)=>({...c,questionIndex:m})).filter((c,m)=>e!==m),l=[];return t.type==="rating"&&t.scale===3?l=[{value:"negative",label:"1 (Negative)"},{value:"neutral",label:"2 (Neutral)"},{value:"positive",label:"3 (Positive)"}]:t.type==="rating"&&t.scale===5?l=[{value:"negative",label:"1 to 2 (Negative)"},{value:"neutral",label:"3 (Neutral)"},{value:"positive",label:"4 to 5 (Positive)"}]:t.type==="rating"&&t.scale===7?l=[{value:"negative",label:"1 to 3 (Negative)"},{value:"neutral",label:"4 (Neutral)"},{value:"positive",label:"5 to 7 (Positive)"}]:t.type==="rating"&&t.scale===10?l=[{value:"detractors",label:"0 to 6 (Detractors)"},{value:"passives",label:"7 to 8 (Passives)"},{value:"promoters",label:"9 to 10 (Promoters)"}]:t.type==="single_choice"&&(l=t.choices.map((c,m)=>({value:m,label:`Option ${m+1} ("${Fe(c,15)}")`}))),(0,A.jsx)("div",{className:"mt-2 space-y-2",children:l.map(({value:c,label:m},f)=>(0,A.jsxs)("div",{className:"flex",children:[(0,A.jsx)("div",{className:"w-2/3 flex items-center",children:(0,A.jsxs)("div",{children:["If the answer is",(0,A.jsxs)("span",{className:"font-bold",children:["\xA0",m]}),", go to:"]})}),(0,A.jsx)("div",{className:"w-1/3 flex justify-end",children:(0,A.jsx)(M,{className:"w-full whitespace-nowrap",value:i(e,t,c),"data-attr":`survey-question-${e}-branching-response_based-select-${f}`,onSelect:p=>{let y;p.startsWith("specific_question")&&(y=parseInt(p.split(":")[1]),p="specific_question"),d(e,c,p,y)},options:[...e<o.questions.length-1?[{label:"Next question",value:"next_question"}]:[],{label:"Confirmation message",value:"end"},...r.map(p=>({label:Fe(`${p.questionIndex+1}. ${p.question}`,28),value:`specific_question:${p.questionIndex}`}))]})})]},f))})}F();w();k();var Ze=x(T()),Pa=({listeners:e})=>(0,Ze.jsx)("span",{className:"SurveyQuestionDragHandle",...e,"data-testid":"survey-question-drag-handle",children:(0,Ze.jsx)(gt,{})});function la({listeners:e,isDraftSurvey:t,hasMultipleQuestions:o}){return!t||!o?null:(0,Ze.jsx)(Pa,{listeners:e})}var g=x(T()),Ma=15;function ca({index:e,survey:t,setSelectedPageIndex:o,setSurveyValue:i}){let{hasBranchingLogic:d}=(0,be.useValues)(v),{deleteBranchingLogic:r}=(0,be.useActions)(v),{setNodeRef:l,attributes:c,transform:m,transition:f,listeners:p,isDragging:y}=Mt({id:e.toString()});return(0,g.jsxs)("div",{className:"flex flex-row w-full items-center justify-between relative",ref:l,...c,style:{zIndex:y?1:void 0,transform:Et.Translate.toString(m),transition:f},children:[(0,g.jsxs)("div",{className:"flex flex-row gap-2 items-center",children:[(0,g.jsx)(la,{listeners:p,isDraftSurvey:qt(t)==="draft",hasMultipleQuestions:t.questions.length>1}),(0,g.jsxs)("b",{children:["Question ",e+1,". ",t.questions[e].question]})]}),t.questions.length>1&&(0,g.jsx)(L,{icon:(0,g.jsx)(Se,{}),"data-attr":`delete-survey-question-${e}`,onClick:b=>{let C=()=>{b.stopPropagation(),o(e<=0?0:e-1),i("questions",t.questions.filter((Q,D)=>D!==e))};d?X.open({title:"Your survey has active branching logic",description:(0,g.jsx)("p",{className:"py-2",children:"Deleting the question will remove your branching logic. Are you sure you want to continue?"}),primaryButton:{children:"Continue",status:"danger",onClick:()=>{r(),C()}},secondaryButton:{children:"Cancel"}}):C()},tooltipPlacement:"top-end"})]})}function da({index:e,question:t}){let{survey:o,descriptionContentType:i}=(0,be.useValues)(v),{setDefaultForQuestionType:d,setSurveyValue:r,resetBranchingForQuestion:l}=(0,be.useActions)(v),c=i(e)??"text",m=(p,y)=>{let b=o.questions.map((C,Q)=>e===Q?{...C,[p]:y}:C);r("questions",b)},f=p=>{m("descriptionContentType",p)};return(0,g.jsx)(ua.Group,{name:`questions.${e}`,children:(0,g.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,g.jsx)(N,{name:"type",label:"Question type",className:"max-w-60",children:(0,g.jsx)(M,{"data-attr":`survey-question-type-${e}`,onSelect:p=>{let y=ye[t.type].questions[0].question!==t.question,b=ye[t.type].questions[0].description!==t.description,C=ye[t.type].appearance.thankYouMessageHeader!==o.appearance?.thankYouMessageHeader;d(e,p,y,b,C),l(e)},options:[{label:ve.open,value:"open","data-attr":`survey-question-type-${e}-open`},{label:"Link/Notification",value:"link","data-attr":`survey-question-type-${e}-link`},{label:"Rating",value:"rating","data-attr":`survey-question-type-${e}-rating`},{label:"Single choice select",value:"single_choice","data-attr":`survey-question-type-${e}-single_choice`},{label:"Multiple choice select",value:"multiple_choice","data-attr":`survey-question-type-${e}-multiple_choice`}]})}),(0,g.jsx)(N,{name:"question",label:"Label",children:(0,g.jsx)(I,{"data-attr":`survey-question-label-${e}`,value:t.question})}),(0,g.jsx)(N,{name:"description",label:"Description (optional)",children:({value:p,onChange:y})=>(0,g.jsx)(Ye,{value:p,onChange:b=>{y(b),m("description",b)},onTabChange:f,activeTab:c})}),o.questions.length>1&&(0,g.jsx)(N,{name:"optional",className:"my-2",children:(0,g.jsx)(me,{label:"Optional",checked:!!t.optional})}),t.type==="link"&&(0,g.jsx)(N,{name:"link",label:"Link",info:"Only https:// or mailto: links are supported.",children:(0,g.jsx)(I,{value:t.link||"",placeholder:"https://posthog.com"})}),t.type==="rating"&&(0,g.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,g.jsxs)("div",{className:"flex flex-row gap-4",children:[(0,g.jsx)(N,{name:"display",label:"Display type",className:"w-1/2",children:(0,g.jsx)(M,{options:[{label:"Number",value:"number"},{label:"Emoji",value:"emoji"}],onChange:p=>{let y={...o.questions[e],display:p,scale:5},b=[...o.questions];b[e]=y,r("questions",b),r("appearance.ratingButtonColor",p==="emoji"?"#939393":"white"),l(e)}})}),(0,g.jsx)(N,{name:"scale",label:"Scale",className:"w-1/2",children:(0,g.jsx)(M,{options:[...t.display==="emoji"?[{label:"1 - 3",value:3}]:[],{label:"1 - 5",value:5},...t.display==="number"?[{label:"1 - 7 (7 Point Likert Scale)",value:7},{label:"0 - 10 (Net Promoter Score)",value:10}]:[]],onChange:p=>{let y={...o.questions[e],scale:p},b=[...o.questions];b[e]=y,r("questions",b),l(e)}})})]}),(0,g.jsxs)("div",{className:"flex flex-row gap-4",children:[(0,g.jsx)(N,{name:"lowerBoundLabel",label:"Lower bound label",className:"w-1/2",children:(0,g.jsx)(I,{value:t.lowerBoundLabel||""})}),(0,g.jsx)(N,{name:"upperBoundLabel",label:"Upper bound label",className:"w-1/2",children:(0,g.jsx)(I,{value:t.upperBoundLabel||""})})]})]}),(t.type==="single_choice"||t.type==="multiple_choice")&&(0,g.jsx)("div",{className:"flex flex-col gap-2",children:(0,g.jsx)(N,{name:"hasOpenChoice",children:({value:p,onChange:y})=>(0,g.jsx)(N,{name:"choices",label:"Choices",children:({value:b,onChange:C})=>(0,g.jsxs)("div",{className:"flex flex-col gap-2",children:[(b||[]).map((Q,D)=>{let Z=p&&D===b?.length-1;return(0,g.jsxs)("div",{className:"flex flex-row gap-2 relative",children:[(0,g.jsx)(I,{value:Q,fullWidth:!0,onChange:G=>{let ne=[...b];ne[D]=G,C(ne)}}),Z&&(0,g.jsx)("span",{className:"question-choice-open-ended-footer",children:"open-ended"}),(0,g.jsx)(L,{icon:(0,g.jsx)(Se,{}),size:"small",noPadding:!0,onClick:()=>{let G=[...b];G.splice(D,1),C(G),Z&&y(!1)}})]},D)}),(0,g.jsx)("div",{className:"w-fit flex flex-row flex-wrap gap-2",children:((b||[]).length<Ma||o.type!="popover")&&(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(L,{icon:(0,g.jsx)(qe,{}),type:"secondary",fullWidth:!1,onClick:()=>{if(!b)C([""]);else if(p){let Q=b.slice(0,-1);Q.push(""),Q.push(b[b.length-1]),C(Q)}else C([...b,""])},children:"Add choice"}),!p&&(0,g.jsx)(L,{icon:(0,g.jsx)(qe,{}),type:"secondary",fullWidth:!1,onClick:()=>{C(b?[...b,"Other"]:["Other"]),y(!0)},children:"Add open-ended choice"}),(0,g.jsx)(N,{name:"shuffleOptions",className:"mt-2",children:({value:Q,onChange:D})=>(0,g.jsx)(me,{checked:!!Q,label:"Shuffle options",onChange:Z=>D(Z)})})]})})]})})})}),(0,g.jsx)(N,{name:"buttonText",label:"Button text",children:(0,g.jsx)(I,{value:t.buttonText===void 0?o.appearance?.submitButtonText??"Submit":t.buttonText})}),(0,g.jsx)(ra,{questionIndex:e,question:t})]})},e)}F();w();k();var ie=x(T());function Xe({previewPageIndex:e,survey:t,handleSetSelectedPageIndex:o}){return t.type!=="api"?(0,ie.jsxs)("div",{className:"survey-view max-w-72",children:[(0,ie.jsx)(De,{survey:t,previewPageIndex:e,onPreviewSubmit:i=>{let d=Kt(t,e,i);o(d==="end"?t.questions.length:d)}}),(0,ie.jsx)(M,{onChange:i=>o(i),className:"mt-4 whitespace-nowrap",fullWidth:!0,value:e,options:[...t.questions.map((i,d)=>({label:`${d+1}. ${i.question??""}`,value:d})),...t.appearance?.displayThankYouMessage?[{label:`${t.questions.length+1}. Confirmation message`,value:t.questions.length}]:[]]})]}):(0,ie.jsxs)("div",{className:"flex flex-col",children:[(0,ie.jsx)("h4",{className:"text-center",children:"API survey response"}),(0,ie.jsx)(ge,{survey:t})]})}var a=x(T());function Da(){let{featureFlags:e}=(0,J.useValues)($e),{survey:t,dataCollectionType:o}=(0,J.useValues)(v),{setSurveyValue:i,resetSurveyResponseLimits:d,resetSurveyAdaptiveSampling:r,setDataCollectionType:l}=(0,J.useActions)(v),{surveysRecurringScheduleAvailable:c}=(0,J.useValues)(ae),[m,f]=(0,va.useState)(!1),p=[{value:"until_stopped",label:"Keep collecting responses until the survey is stopped","data-attr":"survey-collection-until-stopped"},{value:"until_limit",label:"Stop displaying the survey after reaching a certain number of completed surveys","data-attr":"survey-collection-until-limit"}];return e[re.SURVEYS_ADAPTIVE_LIMITS]&&p.push({value:"until_adaptive_limit",label:"Collect a certain number of surveys per day, week or month","data-attr":"survey-collection-until-adaptive-limit",disabledReason:c?void 0:"Upgrade your plan to use an adaptive limit on survey responses"}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{children:"How long would you like to collect survey responses? "}),(0,a.jsx)(N.Pure,{children:(0,a.jsx)(Ee,{value:o,onChange:b=>{b==="until_limit"?(r(),i("responses_limit",t.responses_limit||100)):b==="until_adaptive_limit"?(d(),i("response_sampling_interval",t.response_sampling_interval||1),i("response_sampling_interval_type",t.response_sampling_interval_type||"month"),i("response_sampling_limit",t.response_sampling_limit||100),i("response_sampling_start_date",t.response_sampling_start_date||(0,q.default)())):(d(),r()),l(b)},options:p})})]}),o=="until_adaptive_limit"&&(0,a.jsx)(N.Pure,{children:(0,a.jsxs)("div",{className:"flex flex-row gap-2 items-center ml-5",children:["Starting on"," ",(0,a.jsx)(Ct,{actionable:!0,overlay:(0,a.jsx)(wt,{value:(0,q.default)(t.response_sampling_start_date),onChange:b=>{i("response_sampling_start_date",b),f(!1)},showTimeToggle:!1,onClose:()=>f(!1)}),visible:m,onClickOutside:()=>f(!1),children:(0,a.jsx)(L,{type:"secondary",onClick:()=>f(!m),children:yt((0,q.default)(t.response_sampling_start_date||""))})}),", capture up to",(0,a.jsx)(I,{type:"number",size:"small",min:1,onChange:b=>{i("response_sampling_limit",b)},value:t.response_sampling_limit||0}),"responses, every",(0,a.jsx)(I,{type:"number",size:"small",min:1,onChange:b=>{i("response_sampling_interval",b)},value:t.response_sampling_interval||0}),(0,a.jsx)(M,{value:t.response_sampling_interval_type,size:"small",onChange:b=>{i("response_sampling_interval_type",b)},options:[{value:"day",label:"Day(s)"},{value:"week",label:"Week(s)"},{value:"month",label:"Month(s)"}]}),(0,a.jsx)(pe,{title:"This is a rough guideline, not an absolute one, so the survey might receive slightly more responses than the limit specifies.",children:(0,a.jsx)(le,{})})]})}),o=="until_limit"&&(0,a.jsx)(N,{name:"responses_limit",className:"ml-5",children:({onChange:b,value:C})=>(0,a.jsxs)("div",{className:"flex flex-row gap-2 items-center",children:["Stop the survey once",(0,a.jsx)(I,{type:"number","data-attr":"survey-responses-limit-input",size:"small",min:1,value:C||NaN,onChange:Q=>{Q&&Q>0?b(Q):b(null)},className:"w-16"})," ","responses are received.",(0,a.jsx)(pe,{title:"This is a rough guideline, not an absolute one, so the survey might receive slightly more responses than the limit specifies.",children:(0,a.jsx)(le,{})})]})}),(0,a.jsx)(sa,{})]})}function rt(){let{survey:e,urlMatchTypeValidationError:t,hasTargetingSet:o,selectedPageIndex:i,selectedSection:d,isEditingSurvey:r,targetingFlagFilters:l,hasBranchingLogic:c,surveyRepeatedActivationAvailable:m,surveyErrors:f,deviceTypesMatchTypeValidationError:p}=(0,J.useValues)(v),{setSurveyValue:y,resetTargeting:b,setSelectedPageIndex:C,setSelectedSection:Q,setFlagPropertyErrors:D,deleteBranchingLogic:Z}=(0,J.useActions)(v),{surveysMultipleQuestionsAvailable:G,surveysEventsAvailable:ne,surveysActionsAvailable:U}=(0,J.useValues)(ae),{featureFlags:_}=(0,J.useValues)($e),ze=e.questions.map((u,h)=>h.toString()),{thankYouMessageDescriptionContentType:ct=null}=e.appearance??{};function Fa({oldIndex:u,newIndex:h}){function R(pt,He,ka){let je=[...pt],[wa]=je.splice(He,1);return je.splice(ka,0,wa),je.map(Ta=>({...Ta}))}y("questions",R(e.questions,u,h)),C(h)}function dt(){y("targeting_flag_filters",null),y("targeting_flag",null),y("remove_targeting_flag",!0),D(null)}return(0,a.jsxs)("div",{className:"flex flex-row gap-4",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-2 flex-1 SurveyForm",children:[(0,a.jsx)(N,{name:"name",label:"Name",children:(0,a.jsx)(I,{"data-attr":"survey-name"})}),(0,a.jsx)(N,{name:"description",label:"Description (optional)",children:(0,a.jsx)(Be,{"data-attr":"survey-description",minRows:2})}),(0,a.jsx)(Ke,{activeKey:d||void 0,onChange:u=>{Q(u)},className:"bg-surface-primary",panels:[{key:"presentation",header:"Presentation",content:(0,a.jsx)(N,{name:"type",children:({onChange:u,value:h})=>(0,a.jsxs)("div",{className:"flex gap-4",children:[(0,a.jsx)(Ge,{active:h==="popover",onClick:()=>{u("popover"),e.schedule==="always"&&y("schedule","once")},title:"Popover",description:"Automatically appears when PostHog JS is installed",value:"popover",children:(0,a.jsx)("div",{className:"scale-[0.8] absolute -top-4 -left-4",children:(0,a.jsx)(De,{survey:e,previewPageIndex:0})})}),(0,a.jsx)(Ge,{active:h==="api",onClick:()=>{u("api"),e.schedule==="always"&&y("schedule","once")},title:"API",description:"Use the PostHog API to show/hide your survey programmatically",value:"api",children:(0,a.jsx)("div",{className:"absolute left-4 w-[350px]",children:(0,a.jsx)(ge,{survey:e})})}),(0,a.jsx)(Ge,{active:h==="widget",onClick:()=>u("widget"),title:"Feedback button",description:"Set up a survey based on your own custom button or our prebuilt feedback tab",value:"widget",children:(0,a.jsx)(ue,{type:"warning",className:"uppercase",children:"Beta"})})]})})},{key:"steps",header:"Steps",content:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(Qt,{onDragEnd:({active:u,over:h})=>{if(h&&u.id!==h.id){let R=()=>Fa({oldIndex:ze.indexOf(u.id.toString()),newIndex:ze.indexOf(h.id.toString())});c?X.open({title:"Your survey has active branching logic",description:(0,a.jsx)("p",{className:"py-2",children:"Rearranging questions will remove your branching logic. Are you sure you want to continue?"}),primaryButton:{children:"Continue",status:"danger",onClick:()=>{Z(),R()}},secondaryButton:{children:"Cancel"}}):R()}},children:(0,a.jsx)(Pt,{disabled:e.questions.length<=1,items:ze,strategy:Wt,children:(0,a.jsx)(Ke,{activeKey:i===null?void 0:i,onChange:u=>{C(u)},panels:[...e.questions.map((u,h)=>({key:h,dataAttr:`survey-question-panel-${h}`,header:(0,a.jsx)(ca,{index:h,survey:e,setSelectedPageIndex:C,setSurveyValue:y}),content:(0,a.jsx)(da,{index:h,question:u},h)})),...e.appearance?.displayThankYouMessage?[{key:e.questions.length,header:(0,a.jsxs)("div",{className:"flex flex-row w-full items-center justify-between",children:[(0,a.jsx)("b",{children:"Confirmation message"}),(0,a.jsx)(L,{icon:(0,a.jsx)(Se,{}),"data-attr":"delete-survey-confirmation",onClick:u=>{let h=()=>{u.stopPropagation(),C(e.questions.length-1),y("appearance",{...e.appearance,displayThankYouMessage:!1})};c?X.open({title:"Your survey has active branching logic",description:(0,a.jsx)("p",{className:"py-2",children:"Deleting the confirmation message will remove your branching logic. Are you sure you want to continue?"}),primaryButton:{children:"Continue",status:"danger",onClick:()=>{Z(),h()}},secondaryButton:{children:"Cancel"}}):h()},tooltipPlacement:"top-end"})]}),content:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(N.Pure,{label:"Thank you header",children:(0,a.jsx)(I,{value:e.appearance.thankYouMessageHeader,onChange:u=>y("appearance",{...e.appearance,thankYouMessageHeader:u}),placeholder:"ex: Thank you for your feedback!"})}),(0,a.jsx)(N.Pure,{label:"Thank you description",className:"mt-3",children:(0,a.jsx)(Ye,{value:e.appearance.thankYouMessageDescription,onChange:u=>y("appearance",{...e.appearance,thankYouMessageDescription:u,thankYouMessageDescriptionContentType:ct}),onTabChange:u=>{let h={...e.appearance,thankYouMessageDescriptionContentType:u==="html"?"html":"text"};y("appearance",h)},activeTab:ct??"text",textPlaceholder:"ex: We really appreciate it."})}),(0,a.jsx)(N.Pure,{className:"mt-2",label:"Button text",children:(0,a.jsx)(I,{value:e.appearance.thankYouMessageCloseButtonText,onChange:u=>y("appearance",{...e.appearance,thankYouMessageCloseButtonText:u}),placeholder:"example: Close"})}),(0,a.jsx)(N.Pure,{className:"mt-2",children:(0,a.jsx)(me,{checked:!!e.appearance.autoDisappear,label:"Auto disappear",onChange:u=>y("appearance",{...e.appearance,autoDisappear:u})})})]})}]:[]]})})}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mt-2",children:[(0,a.jsx)(L,{"data-attr":"add-question",type:"secondary",className:"w-max",icon:(0,a.jsx)(he,{}),sideIcon:G?null:(0,a.jsx)(Te,{className:"ml-1 text-base text-secondary"}),disabledReason:G?null:"Upgrade your plan to get multiple questions",onClick:()=>{y("questions",[...e.questions,{...ye.open.questions[0]}]),C(e.questions.length)},children:"Add question"}),!G&&(0,a.jsx)(te,{to:"/organization/billing",target:"_blank",targetBlankIcon:!0,children:"Upgrade"})]}),!e.appearance?.displayThankYouMessage&&(0,a.jsx)(L,{type:"secondary",className:"w-max mt-2",icon:(0,a.jsx)(he,{}),onClick:()=>{y("appearance",{...e.appearance,displayThankYouMessage:!0}),C(e.questions.length)},children:"Add confirmation message"})]})]})},...e.type!=="api"?[{key:"customization",header:"Customization",content:(0,a.jsx)(N,{name:"appearance",label:"",children:({value:u,onChange:h})=>(0,a.jsxs)(a.Fragment,{children:[e.type==="widget"&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"font-bold",children:"Feedback button customization"}),(0,a.jsx)(ta,{hasBranchingLogic:c,deleteBranchingLogic:Z,customizeRatingButtons:e.questions[0].type==="rating",customizePlaceholderText:e.questions[0].type==="open",appearance:u||st,onAppearanceChange:R=>{h(R)}}),(0,a.jsx)(Y,{className:"mt-4"}),(0,a.jsx)("div",{className:"font-bold",children:"Survey customization"})]}),(0,a.jsx)(ea,{appearance:u||st,hasBranchingLogic:c,deleteBranchingLogic:Z,customizeRatingButtons:e.questions.some(R=>R.type==="rating"),customizePlaceholderText:e.questions.some(R=>R.type==="open"),onAppearanceChange:R=>{h(R)},isCustomFontsEnabled:!!_[re.SURVEYS_CUSTOM_FONTS],validationErrors:f?.appearance})]})})}]:[],{key:"DisplayConditions",header:"Display conditions",dataAttr:"survey-display-conditions",content:(0,a.jsxs)(N.Pure,{children:[(0,a.jsx)(M,{onChange:u=>{u?b():y("conditions",{url:""})},value:!o,options:[{label:"All users",value:!0},{label:"Users who match all of the following...",value:!1,"data-attr":"survey-display-conditions-select-users"}],"data-attr":"survey-display-conditions-select"}),o?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(N,{name:"linked_flag_id",label:"Link feature flag (optional)",info:(0,a.jsx)(a.Fragment,{children:"Connecting to a feature flag will automatically enable this survey for everyone in the feature flag."}),children:({value:u,onChange:h})=>(0,a.jsxs)("div",{className:"flex","data-attr":"survey-display-conditions-linked-flag",children:[(0,a.jsx)(_e,{value:u,onChange:h}),u&&(0,a.jsx)(L,{className:"ml-2",icon:(0,a.jsx)(ft,{}),size:"small",onClick:()=>h(null),"aria-label":"close"})]})}),(0,a.jsx)(N,{name:"conditions",children:({value:u,onChange:h})=>(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(N.Pure,{label:"URL targeting",error:t,info:"Targeting by regex or exact match requires at least version 1.82 of posthog-js",children:(0,a.jsxs)("div",{className:"flex flex-row gap-2 items-center",children:["URL",(0,a.jsx)(M,{value:u?.urlMatchType||"icontains",onChange:R=>{h({...u,urlMatchType:R})},"data-attr":"survey-url-matching-type",options:Object.keys(oe).map(R=>({label:oe[R],value:R}))}),(0,a.jsx)(I,{value:u?.url,onChange:R=>h({...u,url:R}),placeholder:"ex: https://app.posthog.com",fullWidth:!0})]})}),(0,a.jsx)(N.Pure,{label:"Device Types",error:p,info:(0,a.jsxs)(a.Fragment,{children:["Add the device types to show the survey on. Possible values: 'Desktop', 'Mobile', 'Tablet'. For the full list and caveats,"," ",(0,a.jsx)(te,{to:"https://posthog.com/docs/surveys/creating-surveys#display-conditions",children:"check the documentation here"}),". Requires at least version 1.214 of posthog-js"]}),children:(0,a.jsxs)("div",{className:"flex flex-row gap-2 items-center",children:["Device Types",(0,a.jsx)(M,{value:u?.deviceTypesMatchType||"icontains",onChange:R=>{h({...u,deviceTypesMatchType:R})},"data-attr":"survey-device-types-matching-type",options:Object.keys(oe).map(R=>({label:oe[R],value:R}))}),["regex","not_regex"].includes(u?.deviceTypesMatchType||"icontains")?(0,a.jsx)(I,{value:u?.deviceTypes?.join("|"),onChange:R=>h({...u,deviceTypes:[R]}),className:"flex-1",placeholder:"ex: Desktop|Mobile"}):(0,a.jsx)(Ve,{propertyKey:we("Device Type","event_properties"),type:"event",onSet:R=>{h({...u,deviceTypes:Array.isArray(R)?R:[R]})},operator:"exact",value:u?.deviceTypes,inputClassName:"flex-1"})]})}),(0,a.jsx)(N.Pure,{label:"CSS selector matches:",children:(0,a.jsx)(I,{value:u?.selector,onChange:R=>h({...u,selector:R}),placeholder:"ex: .className or #id"})}),(0,a.jsx)(N.Pure,{label:"Survey wait period",info:"Note that this condition will only apply reliably for identified users within a single browser session. Anonymous users or users who switch browsers, use incognito sessions, or log out and log back in may see the survey again. Additionally, responses submitted while a user is anonymous may be associated with their account if they log in during the same session.",children:(0,a.jsxs)("div",{className:"flex flex-row gap-2 items-center",children:[(0,a.jsx)(me,{checked:!!u?.seenSurveyWaitPeriodInDays,onChange:R=>{if(R)h({...u,seenSurveyWaitPeriodInDays:u?.seenSurveyWaitPeriodInDays||30});else{let{seenSurveyWaitPeriodInDays:pt,...He}=u||{};h(He)}}}),"Don't show to users who saw any survey in the last",(0,a.jsx)(I,{type:"number",size:"xsmall",min:0,value:u?.seenSurveyWaitPeriodInDays||NaN,onChange:R=>{R!==void 0&&R>0?h({...u,seenSurveyWaitPeriodInDays:R}):h({...u,seenSurveyWaitPeriodInDays:null})},className:"w-12"})," ",u?.seenSurveyWaitPeriodInDays===1?"day":"days","."]})})]})}),(0,a.jsx)(N.Pure,{label:"Properties",children:(0,a.jsxs)(J.BindLogic,{logic:Me,props:{id:e.targeting_flag?.id||"new"},children:[!l&&(0,a.jsx)(L,{type:"secondary",className:"w-max",onClick:()=>{y("targeting_flag_filters",{groups:[{properties:[],rollout_percentage:100,variant:null}],multivariate:null,payloads:{}}),y("remove_targeting_flag",!1)},children:"Add property targeting"}),l&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"mt-2",children:(0,a.jsx)(Ae,{id:String(e.targeting_flag?.id)||"new",excludeTitle:!0,filters:l,onChange:(u,h)=>{D(h),y("targeting_flag_filters",u)},showTrashIconWithOneCondition:!0,removedLastConditionCallback:dt})}),(0,a.jsx)(L,{type:"secondary",status:"danger",className:"w-max",onClick:dt,children:"Remove all property targeting"})]})]})}),ne&&(0,a.jsx)(N.Pure,{label:"User sends events",info:"Note that these events are only observed, and activate this survey, in the current user session.",children:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(it,{filterGroupTypes:["custom_events"],onChange:u=>{y("conditions",{...e.conditions,events:{values:u.map(h=>({name:h}))}})},selectedEvents:e.conditions?.events?.values?.length!=null&&e.conditions?.events?.values?.length>0?e.conditions?.events?.values.map(u=>u.name):[],addElement:(0,a.jsx)(L,{size:"small",type:"secondary",icon:(0,a.jsx)(he,{}),sideIcon:null,children:"Add event"})}),m&&(0,a.jsxs)("div",{className:"flex flex-row gap-2 items-center",children:["Survey display frequency",(0,a.jsx)(M,{onChange:u=>{y("conditions",{...e.conditions,events:{...e.conditions?.events,repeatedActivation:u}})},value:e.conditions?.events?.repeatedActivation||!1,options:[{label:"Just once",value:!1},{label:"Every time any of the above events are captured",value:!0}]})]})]})}),_[re.SURVEYS_ACTIONS]&&U&&(0,a.jsx)(N.Pure,{label:"User performs actions",info:"Note that these actions are only observed, and activate this survey, in the current user session.",children:(0,a.jsx)(it,{filterGroupTypes:["actions"],onItemChange:u=>{y("conditions",{...e.conditions,actions:{values:u.map(h=>({id:h.id,name:h.name}))}})},selectedItems:e.conditions?.actions?.values&&e.conditions?.actions?.values.length>0?e.conditions?.actions?.values:[],selectedEvents:e.conditions?.actions?.values?.map(u=>u.name)??[],addElement:(0,a.jsx)(L,{size:"small",type:"secondary",icon:(0,a.jsx)(he,{}),sideIcon:null,children:"Add action"})})})]}):(0,a.jsxs)("span",{className:"text-secondary",children:["Survey ",(0,a.jsx)("b",{children:"will be released to everyone"})]})]})},{key:"CompletionConditions",header:"Completion conditions",content:(0,a.jsx)(Da,{})}]})]}),(0,a.jsx)(Y,{vertical:!0}),(0,a.jsx)("div",{className:"max-w-80 mx-4 flex flex-col items-center h-full w-full sticky top-0 pt-16",children:(0,a.jsx)(Xe,{previewPageIndex:i||0,survey:e,handleSetSelectedPageIndex:u=>C(u),isEditingSurvey:r})})]})}F();w();k();var O=x(ee());var Oe=x(Le());F();w();k();var Je=x(ee());var P=x(T()),Ua={open:[{label:W.icontains,value:"icontains"},{label:W.not_icontains,value:"not_icontains"},{label:W.regex,value:"regex"},{label:W.not_regex,value:"not_regex"},{label:W.exact,value:"exact"}],rating:[{label:W.exact,value:"exact"},{label:W.is_not,value:"is_not"},{label:W.regex,value:"regex"},{label:W.not_regex,value:"not_regex"}],single_choice:[{label:W.icontains,value:"icontains"},{label:W.not_icontains,value:"not_icontains"},{label:W.regex,value:"regex"},{label:W.not_regex,value:"not_regex"},{label:W.exact,value:"exact"}],multiple_choice:[{label:W.icontains,value:"icontains"},{label:W.not_icontains,value:"not_icontains"},{label:W.regex,value:"regex"},{label:W.not_regex,value:"not_regex"}],link:[]};function ya(){let{survey:e,answerFilters:t}=(0,Je.useValues)(v),{setAnswerFilters:o}=(0,Je.useActions)(v),i=(r,l,c)=>{let m=[...t],f=m.findIndex(p=>p.key===z(r));if(f>=0){let p=m[f];m[f]={...p,[l]:c,type:"event"}}else m.push({key:z(r),type:"event",operator:"exact",[l]:c});o(m)},d=r=>t.find(c=>c.key===z(r));return(0,P.jsx)(P.Fragment,{children:(0,P.jsxs)("div",{className:"border rounded-t",children:[(0,P.jsxs)("div",{className:"grid grid-cols-6 gap-2 px-2 py-2 border-b bg-bg-light",children:[(0,P.jsx)("div",{className:"col-span-3 font-semibold",children:"Question"}),(0,P.jsx)("div",{className:"font-semibold",children:"Filter type"}),(0,P.jsx)("div",{className:"col-span-2 font-semibold",children:"Value"})]}),(0,P.jsx)("div",{children:e.questions.map((r,l)=>{let c=d(l),m=Ua[r.type]||[];return m.length===0?null:(0,P.jsxs)("div",{className:"grid grid-cols-6 gap-2 px-2 py-2 items-center border-b last:border-b-0 hover:bg-bg-light transition-all",children:[(0,P.jsxs)("div",{className:"col-span-3",children:[(0,P.jsx)("span",{className:"font-medium",children:r.question}),(0,P.jsx)("div",{className:"text-muted text-xs",children:ve[r.type]})]}),(0,P.jsx)("div",{children:(0,P.jsx)(M,{value:c?.operator,onChange:f=>i(l,"operator",f),options:m,className:"w-full"})}),(0,P.jsx)("div",{className:"col-span-2",children:c?.operator&&!["is_set","is_not_set"].includes(c.operator)&&(0,P.jsx)(Ve,{propertyKey:z(l),type:"event",operator:c.operator,value:c.value||[],onSet:f=>i(l,"value",f),placeholder:r.type==="rating"?"Enter a number":"Enter text to match",eventNames:["survey sent"],additionalPropertiesFilter:[{key:we("$survey_id","events"),values:e.id}]})})]},l)})})]})})}F();w();k();var E=x(ee());var K=x(Le());var n=x(T()),lt={dashboardItemId:"new-survey"},Ga={dashboardItemId:"new-survey-recurring-nps"},Ya=(e,t)=>e/t*100<3?"":`${Ce(e)}`;function Za({surveyUserStats:e}){let{seen:t,dismissed:o,sent:i}=e,d=t+o+i,r=d===1?"Unique user shown":"Unique users shown",l=i===1?"Response sent":"Responses sent";return(0,n.jsxs)("div",{className:"inline-flex mb-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"text-4xl font-bold",children:Ce(d)}),(0,n.jsx)("div",{className:"font-semibold text-secondary",children:r})]}),i>0&&(0,n.jsxs)("div",{className:"ml-10",children:[(0,n.jsx)("div",{className:"text-4xl font-bold",children:Ce(i)}),(0,n.jsx)("div",{className:"font-semibold text-secondary",children:l})]})]})}function Xa({surveyUserStats:e}){let{seen:t,dismissed:o,sent:i}=e,d=t+o+i,r=t/d*100,l=o/d*100,c=i/d*100;return(0,n.jsx)(n.Fragment,{children:d>0&&(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"relative w-full mx-auto h-10 mb-4",children:[{count:t,label:"Unanswered",classes:`rounded-l ${o===0&&i===0?"rounded-r":""}`,style:{backgroundColor:"#1D4AFF",width:`${r}%`}},{count:o,label:"Dismissed",classes:`${t===0?"rounded-l":""} ${i===0?"rounded-r":""}`,style:{backgroundColor:"#E3A506",width:`${l}%`,left:`${r}%`}},{count:i,label:"Sent",classes:`rounded-r ${t===0&&o===0?"rounded-l":""}`,style:{backgroundColor:"#529B08",width:`${c}%`,left:`${r+l}%`}}].map(({count:m,label:f,classes:p,style:y})=>(0,n.jsx)(pe,{title:`${f} surveys: ${m}`,delayMs:0,placement:"top",children:(0,n.jsx)("div",{className:`h-10 text-white text-center absolute cursor-pointer ${p}`,style:y,children:(0,n.jsx)("span",{className:"inline-flex font-semibold max-w-full px-1 truncate leading-10",children:Ya(m,d)})})},`survey-summary-chart-${f}`))}),(0,n.jsx)("div",{className:"w-full flex justify-center",children:(0,n.jsx)("div",{className:"flex items-center",children:[{count:t,label:"Unanswered",style:{backgroundColor:"#1D4AFF"}},{count:o,label:"Dismissed",style:{backgroundColor:"#E3A506"}},{count:i,label:"Submitted",style:{backgroundColor:"#529B08"}}].map(({count:m,label:f,style:p})=>m>0&&(0,n.jsxs)("div",{className:"flex items-center mr-6",children:[(0,n.jsx)("div",{className:"w-3 h-3 rounded-full mr-2",style:p}),(0,n.jsx)("span",{className:"font-semibold text-secondary",children:`${f} (${(m/d*100).toFixed(1)}%)`})]},`survey-summary-legend-${f}`))})})]})})}function ga({surveyUserStats:e,surveyUserStatsLoading:t}){return(0,n.jsx)("div",{children:t?(0,n.jsx)(ce,{dataSource:[],columns:[],loading:!0}):(0,n.jsx)(n.Fragment,{children:e?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(Za,{surveyUserStats:e}),(0,n.jsx)(Xa,{surveyUserStats:e})]}):null})})}function fa({questionIndex:e,surveyRatingResults:t,surveyRatingResultsReady:o}){let{loadSurveyRatingResults:i}=(0,E.useActions)(v),{survey:d}=(0,E.useValues)(v),r="#1d4aff",l=d.questions[e];if((0,K.useEffect)(()=>{i({questionIndex:e})},[e,i]),l.type!=="rating")throw new Error("Question type must be rating");return(0,n.jsx)("div",{children:o[e]?t[e]?.total?(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"font-semibold text-secondary",children:`${l.scale===10?"0 - 10":l.scale===7?"1 - 7":l.scale===5?"1 - 5":"1 - 3"} rating`}),(0,n.jsx)("div",{className:"text-xl font-bold mb-2",children:l.question}),(0,n.jsx)("div",{className:" h-50 border rounded pt-8",children:(0,n.jsx)("div",{className:"relative h-full w-full",children:(0,n.jsx)(E.BindLogic,{logic:xe,props:lt,children:(0,n.jsx)(Qe,{inSurveyView:!0,hideYAxis:!0,showValuesOnSeries:!0,labelGroupType:1,"data-attr":"survey-rating",type:"bar",hideAnnotations:!0,formula:"-",tooltip:{showHeader:!1,hideColorCol:!0},datasets:[{id:1,label:"Number of responses",barPercentage:.8,minBarLength:2,data:t[e].data,backgroundColor:r,borderColor:r,hoverBackgroundColor:r}],labels:l.scale===10?["0","1","2","3","4","5","6","7","8","9","10"]:l.scale===7?["1","2","3","4","5","6","7"]:l.scale===5?["1","2","3","4","5"]:["1","2","3"]})})})}),(0,n.jsxs)("div",{className:"flex flex-row justify-between mt-1",children:[(0,n.jsx)("div",{className:"text-secondary pl-10",children:l.lowerBoundLabel}),(0,n.jsx)("div",{className:"text-secondary pr-10",children:l.upperBoundLabel})]})]}):(0,n.jsx)(n.Fragment,{}):(0,n.jsx)(ce,{dataSource:[],columns:[],loading:!0})})}function ba({questionIndex:e,surveyRecurringNPSResults:t,surveyRecurringNPSResultsReady:o,iterationStartDates:i,currentIteration:d}){let{loadSurveyRecurringNPSResults:r}=(0,E.useActions)(v),{survey:l}=(0,E.useValues)(v),c="#1d4aff",m=l.questions[e];if(m.type!=="rating")throw new Error("Question type must be rating");return(0,K.useEffect)(()=>{r({questionIndex:e})},[e]),(0,n.jsx)("div",{children:o[e]?t[e]?.total?(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"font-semibold text-secondary",children:`${m.scale===10?"0 - 10":"1 - 5"} rating`}),(0,n.jsxs)("div",{className:"text-xl font-bold mb-2",children:['NPS Scores over time for "',m.question,'"']}),(0,n.jsx)("div",{className:" h-50 border rounded pt-8",children:(0,n.jsx)("div",{className:"relative h-full w-full",children:(0,n.jsx)(E.BindLogic,{logic:xe,props:Ga,children:(0,n.jsx)(Qe,{inSurveyView:!0,hideYAxis:!0,showValuesOnSeries:!0,labelGroupType:"none","data-attr":"survey-rating",type:"line",hideAnnotations:!1,formula:"-",tooltip:{showHeader:!0,hideColorCol:!0},trendsFilter:{showLegend:!0},datasets:[{id:1,label:"NPS Score",barPercentage:.8,minBarLength:2,data:t[e].data,backgroundColor:c,borderColor:c,hoverBackgroundColor:c}],labels:i.slice(0,d).map(f=>(0,q.default)(f).format("YYYY-MM-DD"))})})})})]}):(0,n.jsx)(n.Fragment,{}):(0,n.jsx)(ce,{dataSource:[],columns:[],loading:!0})})}function ha({questionIndex:e,surveySingleChoiceResults:t,surveySingleChoiceResultsReady:o}){let{loadSurveySingleChoiceResults:i}=(0,E.useActions)(v),{survey:d}=(0,E.useValues)(v),r=d.questions[e];if(r.type!=="single_choice")throw new Error("Question type must be single_choice");let l=["#1D4BFF","#CD0F74","#43827E","#621DA6","#F04F58","#539B0A","#E3A605","#0476FB","#36416B","#41CBC3","#A46FFF","#FE729E","#CE1175","#B64B01"];return(0,K.useEffect)(()=>{i({questionIndex:e})},[e]),(0,n.jsx)("div",{children:o[e]?t[e]?.data.length?(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"font-semibold text-secondary",children:"Single choice"}),(0,n.jsx)("div",{className:"text-xl font-bold mb-2",children:r.question}),(0,n.jsxs)("div",{className:"h-80 overflow-y-auto border rounded pt-4 pb-2 flex",children:[(0,n.jsx)("div",{className:"relative h-full w-80",children:(0,n.jsx)(E.BindLogic,{logic:xe,props:lt,children:(0,n.jsx)(Xt,{labelGroupType:1,"data-attr":"survey-rating",type:"doughnut",hideAnnotations:!0,formula:"-",tooltip:{showHeader:!1,hideColorCol:!0},datasets:[{id:1,data:t[e].data,labels:t[e].labels,backgroundColor:t[e].labels.map((c,m)=>l[m%l.length])}],labels:t[e].labels})})}),(0,n.jsx)("div",{className:`grid h-full pl-4 ${(()=>{let c=t[e].data.length;return c<5?"py-20":c<7?"py-15":c<10?"py-10":"py-5"})()} grid-cols-${Math.ceil(t[e].data.length/10)}`,children:t[e].data.map((c,m)=>{let{total:f,labels:p}=t[e],y=(c/f*100).toFixed(1);return(0,n.jsxs)("div",{className:"flex items-center mr-6",children:[(0,n.jsx)("div",{className:"w-3 h-3 rounded-full mr-2",style:{backgroundColor:l[m%l.length]}}),(0,n.jsx)("span",{className:"font-semibold text-secondary max-w-48 truncate",children:`${p[m]}`}),(0,n.jsx)("span",{className:"font-bold ml-1 truncate",children:` ${y}% `}),(0,n.jsx)("span",{className:"font-semibold text-secondary ml-1 truncate",children:`(${c})`})]},`single-choice-legend-${e}-${m}`)})})]})]}):(0,n.jsx)(n.Fragment,{}):(0,n.jsx)(ce,{dataSource:[],columns:[],loading:!0})})}function Sa({questionIndex:e,surveyMultipleChoiceResults:t,surveyMultipleChoiceResultsReady:o}){let{loadSurveyMultipleChoiceResults:i}=(0,E.useActions)(v),{survey:d}=(0,E.useValues)(v),[r,l]=(0,K.useState)(200),c="#1d4aff",m=d.questions[e];if(m.type!=="multiple_choice")throw new Error("Question type must be multiple_choice");return(0,K.useEffect)(()=>{i({questionIndex:e})},[e]),(0,K.useEffect)(()=>{t?.[e]?.data?.length&&l(100+20*t[e].data.length)},[t]),(0,n.jsx)("div",{children:o[e]?t[e]?.data.length?(0,n.jsxs)("div",{className:"mb-8",children:[(0,n.jsx)("div",{className:"font-semibold text-secondary",children:"Multiple choice"}),(0,n.jsx)("div",{className:"text-xl font-bold mb-2",children:m.question}),(0,n.jsx)("div",{className:"border rounded pt-8 pr-10 overflow-y-scroll",style:{height:Math.min(r,600)},children:(0,n.jsx)(E.BindLogic,{logic:xe,props:lt,children:(0,n.jsx)(Qe,{inSurveyView:!0,hideYAxis:!0,hideXAxis:!0,showValuesOnSeries:!0,labelGroupType:1,"data-attr":"survey-multiple-choice",type:"horizontalBar",formula:"-",tooltip:{showHeader:!1,hideColorCol:!0},datasets:[{id:1,label:"Number of responses",barPercentage:.9,minBarLength:2,data:t[e].data,labels:t[e].labels,breakdownValues:t[e].labels,backgroundColor:c,borderColor:c,hoverBackgroundColor:c}],labels:t[e].labels})})})]}):(0,n.jsx)(n.Fragment,{}):(0,n.jsx)(ce,{dataSource:[],columns:[],loading:!0})})}function Na({questionIndex:e,surveyOpenTextResults:t,surveyOpenTextResultsReady:o}){let{loadSurveyOpenTextResults:i}=(0,E.useActions)(v),{survey:d}=(0,E.useValues)(v),r=z(e),l=d.questions[e];if(l.type!=="open")throw new Error("Question type must be open");return(0,K.useEffect)(()=>{i({questionIndex:e})},[e]),(0,n.jsx)("div",{children:o[e]?t[e]?.events.length?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"flex flex-row justify-between items-center",children:[(0,n.jsx)(pe,{title:"See all Open Text responses in the Events table at the bottom.",children:(0,n.jsxs)("div",{className:"inline-flex gap-1",children:[(0,n.jsx)("div",{className:"font-semibold text-secondary",children:"Open text"}),(0,n.jsx)(Y,{vertical:!0,className:"my-1 mx-1"}),(0,n.jsx)("div",{className:"font-semibold text-secondary",children:"random selection"}),(0,n.jsx)(le,{className:"text-lg text-secondary shrink-0 ml-0.5 mt-0.5"})]})}),(0,n.jsx)(Ja,{questionIndex:e})]}),(0,n.jsx)("div",{className:"text-xl font-bold mb-4",children:l.question}),(0,n.jsx)(Oa,{}),(0,n.jsx)("div",{className:"mt-4 mb-8 masonry-container",children:t[e].events.map((c,m)=>{let f={distinct_id:c.distinct_id,properties:c.personProperties};return(0,n.jsxs)("div",{className:"masonry-item border rounded",children:[(0,n.jsx)("div",{className:"max-h-80 overflow-y-auto text-center italic font-semibold px-5 py-4",children:typeof c.properties[r]!="string"?JSON.stringify(c.properties[r]):c.properties[r]}),(0,n.jsx)("div",{className:"bg-surface-primary items-center px-5 py-4 border-t rounded-b truncate w-full",children:(0,n.jsx)(Gt,{person:f,withIcon:!0,noEllipsis:!1,isCentered:!0})})]},`open-text-${e}-${m}`)})})]}):(0,n.jsx)(n.Fragment,{}):(0,n.jsx)(ce,{dataSource:[],columns:[],loading:!0})})}function Ja({questionIndex:e}){let{summarize:t}=(0,E.useActions)(v),{responseSummary:o,responseSummaryLoading:i}=(0,E.useValues)(v),{dataProcessingAccepted:d,dataProcessingApprovalDisabledReason:r}=(0,E.useValues)(Yt);return(0,n.jsx)(at,{flag:re.AI_SURVEY_RESPONSE_SUMMARY,match:!0,children:(0,n.jsx)(Zt,{showArrow:!0,children:(0,n.jsx)(L,{type:"secondary","data-attr":"summarize-survey",onClick:()=>t({questionIndex:e}),disabledReason:d?i?"Let me think...":o?"Already summarized":void 0:r||"Data processing not accepted",icon:(0,n.jsx)(St,{}),loading:i,children:i?"Let me think...":"Summarize responses"})})})}function Oa(){let{survey:e,responseSummary:t}=(0,E.useValues)(v);return(0,n.jsx)(at,{flag:re.AI_SURVEY_RESPONSE_SUMMARY,match:!0,children:t?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("h1",{children:"Responses summary"}),(0,n.jsx)(Vt,{children:t.content}),(0,n.jsx)(Y,{dashed:!0}),(0,n.jsx)(za,{surveyId:e.id})]}):null})}function za({surveyId:e}){let[t,o]=(0,K.useState)(null);function i(d){t||(o(d),mt.capture("ai_survey_summary_rated",{survey_id:e,answer_rating:d}))}return(0,n.jsxs)("div",{className:"flex items-center justify-end",children:[t===null?(0,n.jsx)(n.Fragment,{children:"Summaries are generated by AI. What did you think?"}):null,t!=="bad"&&(0,n.jsx)(L,{icon:t==="good"?(0,n.jsx)(Lt,{}):(0,n.jsx)(Rt,{}),type:"tertiary",size:"small",tooltip:"Good summary",onClick:()=>i("good")}),t!=="good"&&(0,n.jsx)(L,{icon:t==="bad"?(0,n.jsx)(xt,{}):(0,n.jsx)(Nt,{}),type:"tertiary",size:"small",tooltip:"Bad summary",onClick:()=>i("bad")})]})}var s=x(T());function Ha(){let{propertyFilters:e}=(0,O.useValues)(v),{setPropertyFilters:t}=(0,O.useActions)(v);return(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("h3",{className:"text-base",children:"Filter survey results"}),(0,s.jsx)(ya,{}),(0,s.jsx)("div",{className:"w-fit",children:(0,s.jsx)(At,{propertyFilters:e,onChange:t,pageKey:"survey-results",buttonText:"More filters"})})]})}function ja(){let{survey:e}=(0,O.useValues)(v);return e.schedule==="recurring"&&e.iteration_count&&e.iteration_frequency_days?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("span",{className:"card-secondary",children:"Schedule"}),(0,s.jsxs)("span",{children:["Repeats every ",e.iteration_frequency_days," ",ke(e.iteration_frequency_days,"day","days",!1),", ",e.iteration_count," ",ke(e.iteration_count,"time","times",!1)]})]}):e.schedule==="always"?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("span",{className:"card-secondary",children:"Schedule"}),(0,s.jsx)("span",{children:"Always"})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("span",{className:"card-secondary",children:"Schedule"}),(0,s.jsx)("span",{children:"Once"})]})}function xa({id:e}){let{survey:t,surveyLoading:o,selectedPageIndex:i,targetingFlagFilters:d}=(0,O.useValues)(v),{editingSurvey:r,updateSurvey:l,launchSurvey:c,stopSurvey:m,archiveSurvey:f,resumeSurvey:p,setSelectedPageIndex:y,duplicateSurvey:b}=(0,O.useActions)(v),{surveyUsesLimit:C,surveyUsesAdaptiveLimit:Q}=(0,O.useValues)(v),{deleteSurvey:D}=(0,O.useActions)(ae),[Z,G]=(0,Oe.useState)(t.start_date?"results":"overview"),ne=Dt("HOG_FUNCTIONS_LINKED");return(0,Oe.useEffect)(()=>{t.start_date?G("results"):G("overview")},[t.start_date]),(0,s.jsx)("div",{children:o?(0,s.jsx)(Ne,{}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(We,{buttons:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(It,{overlay:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(L,{"data-attr":"edit-survey",fullWidth:!0,onClick:()=>r(!0),children:"Edit"}),(0,s.jsx)(L,{"data-attr":"duplicate-survey",fullWidth:!0,onClick:b,children:"Duplicate"}),(0,s.jsx)(Y,{})]}),t.end_date&&!t.archived&&(0,s.jsx)(L,{"data-attr":"archive-survey",onClick:()=>{X.open({title:"Archive this survey?",content:(0,s.jsx)("div",{className:"text-sm text-secondary",children:"This action will remove the survey from your active surveys list. It can be restored at any time."}),primaryButton:{children:"Archive",type:"primary",onClick:()=>f(),size:"small"},secondaryButton:{children:"Cancel",type:"tertiary",size:"small"}})},fullWidth:!0,children:"Archive"}),(0,s.jsx)(L,{status:"danger","data-attr":"delete-survey",fullWidth:!0,onClick:()=>{X.open({title:"Delete this survey?",content:(0,s.jsx)("div",{className:"text-sm text-secondary",children:"This action cannot be undone. All survey data will be permanently removed."}),primaryButton:{children:"Delete",type:"primary",onClick:()=>D(e),size:"small"},secondaryButton:{children:"Cancel",type:"tertiary",size:"small"}})},children:"Delete survey"})]})}),(0,s.jsx)(Y,{vertical:!0}),t.start_date?t.end_date&&!t.archived?(0,s.jsx)(L,{type:"secondary",onClick:()=>{X.open({title:"Resume this survey?",content:(0,s.jsx)("div",{className:"text-sm text-secondary",children:"Once resumed, the survey will be visible to your users again."}),primaryButton:{children:"Resume",type:"primary",onClick:()=>p(),size:"small"},secondaryButton:{children:"Cancel",type:"tertiary",size:"small"}})},children:"Resume"}):!t.archived&&(0,s.jsx)(L,{"data-attr":"stop-survey",type:"secondary",status:"danger",onClick:()=>{X.open({title:"Stop this survey?",content:(0,s.jsx)("div",{className:"text-sm text-secondary",children:"The survey will no longer be displayed to users."}),primaryButton:{children:"Stop",type:"primary",onClick:()=>m(),size:"small"},secondaryButton:{children:"Cancel",type:"tertiary",size:"small"}})},children:"Stop"}):(0,s.jsx)(L,{type:"primary","data-attr":"launch-survey",onClick:()=>{X.open({title:"Launch this survey?",content:(0,s.jsx)("div",{className:"text-sm text-secondary",children:"The survey will immediately start displaying to users matching the display conditions."}),primaryButton:{children:"Launch",type:"primary",onClick:()=>c(),size:"small"},secondaryButton:{children:"Cancel",type:"tertiary",size:"small"}})},children:"Launch"})]}),caption:(0,s.jsx)(s.Fragment,{children:t&&!!t.description&&(0,s.jsx)($t,{multiline:!0,name:"description",markdown:!0,value:t.description||"",placeholder:"Description (optional)",onSave:U=>l({id:e,description:U}),saveOnBlur:!0,compactButtons:!0})})}),(0,s.jsx)(Ie,{activeKey:Z,onChange:U=>G(U),tabs:[t.start_date?{content:(0,s.jsx)("div",{children:(0,s.jsx)($a,{})}),key:"results",label:"Results"}:null,{content:(0,s.jsxs)("div",{className:"flex flex-row",children:[(0,s.jsxs)("div",{className:"flex flex-col w-full",children:[(0,s.jsx)("span",{className:"mt-4 card-secondary",children:"Display mode"}),(0,s.jsx)("span",{children:t.type==="api"?t.type.toUpperCase():vt(t.type)}),t.questions[0].question&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("span",{className:"mt-4 card-secondary",children:"Type"}),(0,s.jsx)("span",{children:ve[t.questions[0].type]}),(0,s.jsx)("span",{className:"mt-4 card-secondary",children:ke(t.questions.length,"Question","Questions",!1)}),t.questions.map((U,_)=>(0,s.jsx)("li",{children:U.question},_))]}),t.questions[0].type==="link"&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("span",{className:"mt-4 card-secondary",children:"Link url"}),(0,s.jsx)("span",{children:t.questions[0].link})]}),(0,s.jsxs)("div",{className:"flex flex-row gap-8",children:[t.start_date&&(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("span",{className:"mt-4 card-secondary",children:"Start date"}),(0,s.jsx)(tt,{time:t.start_date})]}),t.end_date&&(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("span",{className:"mt-4 card-secondary",children:"End date"}),(0,s.jsx)(tt,{time:t.end_date})]})]}),(0,s.jsx)("div",{className:"flex flex-row gap-8",children:(0,s.jsx)("div",{className:"flex flex-col mt-4",children:(0,s.jsx)(ja,{})})}),C&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("span",{className:"mt-4 card-secondary",children:"Completion conditions"}),(0,s.jsxs)("span",{children:["The survey will be stopped once ",(0,s.jsx)("b",{children:t.responses_limit})," ","responses are received."]})]}),Q&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("span",{className:"mt-4 card-secondary",children:"Completion conditions"}),(0,s.jsxs)("span",{children:["Survey response collection is limited to receive"," ",(0,s.jsx)("b",{children:t.response_sampling_limit})," responses every"," ",t.response_sampling_interval," ",t.response_sampling_interval_type,"(s)."]})]}),(0,s.jsx)(Y,{}),(0,s.jsx)(ut,{id:e,survey:t,targetingFlagFilters:d})]}),(0,s.jsxs)("div",{className:"flex flex-col items-center w-full",children:[t.type==="api"&&(0,s.jsx)("div",{className:"p-4 border rounded",children:(0,s.jsxs)("div",{className:"flex flex-row items-center w-full gap-1",children:["Learn how to set up API surveys"," ",(0,s.jsx)(te,{"data-attr":"survey-doc-link",target:"_blank",to:"https://posthog.com/docs/surveys/implementing-custom-surveys",targetBlankIcon:!0,children:"in the docs"})]})}),t.type!=="api"?(0,s.jsx)("div",{className:"mt-6 max-w-72",children:(0,s.jsx)(Xe,{previewPageIndex:i||0,survey:t,handleSetSelectedPageIndex:U=>y(U)})}):(0,s.jsx)("div",{className:"mt-2",children:(0,s.jsx)(ge,{survey:t})})]})]}),key:"overview",label:"Overview"},ne?{key:"notifications",label:"Notifications",content:(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{children:"Get notified whenever a survey result is submitted"}),(0,s.jsx)(Ht,{logicKey:"survey",type:"destination",subTemplateId:"survey-response",filters:{events:[{id:"survey sent",type:"events",order:0,properties:[{key:"$survey_id",type:"event",value:e,operator:"exact"}]}]}})]})}:null,{label:"History",key:"History",content:(0,s.jsx)(jt,{scope:"Survey",id:t.id})}]})]})})}function $a({disableEventsTable:e}){let{survey:t,dataTableQuery:o,surveyLoading:i,surveyUserStats:d,surveyUserStatsLoading:r,surveyRatingResults:l,surveyRatingResultsReady:c,surveyRecurringNPSResults:m,surveyRecurringNPSResultsReady:f,surveySingleChoiceResults:p,surveySingleChoiceResultsReady:y,surveyMultipleChoiceResults:b,surveyMultipleChoiceResultsReady:C,surveyOpenTextResults:Q,surveyOpenTextResultsReady:D,surveyNPSScore:Z,surveyAsInsightURL:G,isAnyResultsLoading:ne}=(0,O.useValues)(v);return(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)(Ha,{}),ne&&(0,s.jsxs)("div",{className:"flex gap-1",children:[(0,s.jsx)("span",{className:"text-sm text-secondary",children:"Loading results..."}),(0,s.jsx)(Ft,{})]}),(0,s.jsx)(ga,{surveyUserStatsLoading:r,surveyUserStats:d}),t.questions.map((U,_)=>{if(U.type==="rating")return(0,s.jsxs)("div",{className:"space-y-2",children:[U.scale===10&&(0,s.jsx)(qa,{survey:t,surveyNPSScore:Z,questionIndex:_}),(0,s.jsx)(fa,{surveyRatingResults:l,surveyRatingResultsReady:c,questionIndex:_}),t.iteration_count&&t.iteration_count>0&&t.current_iteration&&t.current_iteration>1&&t.iteration_start_dates&&t.iteration_start_dates.length>0&&(0,s.jsx)(ba,{surveyRecurringNPSResults:m,surveyRecurringNPSResultsReady:f,iterationStartDates:t.iteration_start_dates,currentIteration:t.current_iteration,questionIndex:_},`nps-survey-results-q-${_}`)]},`survey-q-${_}`);if(U.type==="single_choice")return(0,s.jsx)(ha,{surveySingleChoiceResults:p,surveySingleChoiceResultsReady:y,questionIndex:_},`survey-q-${_}`);if(U.type==="multiple_choice")return(0,s.jsx)(Sa,{surveyMultipleChoiceResults:b,surveyMultipleChoiceResultsReady:C,questionIndex:_},`survey-q-${_}`);if(U.type==="open")return(0,s.jsx)(Na,{surveyOpenTextResults:Q,surveyOpenTextResultsReady:D,questionIndex:_},`survey-q-${_}`)}),(0,s.jsx)("div",{className:"max-w-40",children:(0,s.jsx)(L,{type:"primary","data-attr":"survey-results-explore",icon:(0,s.jsx)(ht,{}),to:G,children:"Explore results"})}),!e&&(i?(0,s.jsx)(Ne,{}):(0,s.jsx)(nt,{query:o}))]})}function qa({survey:e,surveyNPSScore:t,questionIndex:o}){let{dateRange:i,interval:d,compareFilter:r,defaultInterval:l}=(0,O.useValues)(v),{setDateRange:c,setInterval:m,setCompareFilter:f}=(0,O.useActions)(v);return(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-4xl font-bold",children:t}),(0,s.jsx)("div",{className:"mb-2 font-semibold text-secondary",children:"Latest NPS Score"}),(0,s.jsxs)("div",{className:"space-y-2 bg-surface-primary p-2 rounded",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,s.jsx)("h4",{className:"text-lg font-semibold",children:"NPS Trend"}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(_t,{dateFrom:i?.date_from??void 0,dateTo:i?.date_to??void 0,onChange:(p,y)=>c({date_from:p,date_to:y})}),(0,s.jsx)("span",{children:"grouped by"}),(0,s.jsx)(Ot,{interval:d??l,onIntervalChange:m,options:[{value:"hour",label:"Hour"},{value:"day",label:"Day"},{value:"week",label:"Week"},{value:"month",label:"Month"}]}),(0,s.jsx)(Jt,{compareFilter:r,updateCompareFilter:p=>f(p)})]})]}),(0,s.jsx)(nt,{query:{kind:"InsightVizNode",source:{kind:"TrendsQuery",interval:d??l,compareFilter:r,dateRange:i??{date_from:(0,q.default)(e.created_at).format("YYYY-MM-DD"),date_to:e.end_date?(0,q.default)(e.end_date).format("YYYY-MM-DD"):(0,q.default)().add(1,"day").format("YYYY-MM-DD")},series:[{event:Pe,kind:"EventsNode",custom_name:"Promoters",properties:[{type:"event",key:z(o),operator:"exact",value:["9","10"]}]},{event:Pe,kind:"EventsNode",custom_name:"Passives",properties:[{type:"event",key:z(o),operator:"exact",value:["7","8"]}]},{event:Pe,kind:"EventsNode",custom_name:"Detractors",properties:[{type:"event",key:z(o),operator:"exact",value:["0","1","2","3","4","5","6"]}]}],properties:[{type:"event",key:"$survey_id",operator:"exact",value:e.id}],trendsFilter:{formula:"(A / (A+B+C) * 100) - (C / (A+B+C) * 100)",display:"ActionsBar"}}}})]})]})}var S=x(T()),cr={component:Ka,logic:v,paramsToProps:({params:{id:e}})=>({id:e})};function Ka({id:e}={}){let{editingSurvey:t,setSelectedPageIndex:o,setPropertyFilters:i}=(0,se.useActions)(v),{isEditingSurvey:d,surveyMissing:r}=(0,se.useValues)(v);return(0,Ca.useEffect)(()=>()=>{t(!1),o(0),i([])},[t,o,i]),r?(0,S.jsx)(zt,{object:"survey"}):(0,S.jsx)("div",{children:e?(0,S.jsx)(se.BindLogic,{logic:v,props:{id:e},children:d?(0,S.jsx)(es,{id:e}):(0,S.jsx)(xa,{id:e})}):(0,S.jsx)(Ne,{})})}function es({id:e}){let{survey:t,surveyLoading:o,targetingFlagFilters:i}=(0,se.useValues)(v),{loadSurvey:d,editingSurvey:r}=(0,se.useActions)(v);return(0,S.jsxs)(Ra.Form,{id:"survey",formKey:"survey",logic:v,props:{id:e},className:"space-y-4",enableFormOnSubmit:!0,children:[(0,S.jsx)(We,{buttons:(0,S.jsxs)("div",{className:"flex items-center gap-2",children:[(0,S.jsx)(L,{"data-attr":"cancel-survey",type:"secondary",loading:o,onClick:()=>{r(!1),e==="new"?La.router.actions.push(ot.surveys()):d()},children:"Cancel"}),(0,S.jsx)(L,{type:"primary","data-attr":"save-survey",htmlType:"submit",loading:o,form:"survey",children:e==="new"?"Save as draft":"Save"})]})}),(0,S.jsx)(Y,{}),(0,S.jsx)(rt,{}),(0,S.jsx)(Y,{}),(0,S.jsx)(ut,{id:e,survey:t,targetingFlagFilters:i}),(0,S.jsx)(Y,{})]})}function ut({id:e,survey:t,targetingFlagFilters:o}){let i=t.conditions?.url||t.conditions?.selector||t.conditions?.seenSurveyWaitPeriodInDays,d=t.linked_flag_id||o;return(0,S.jsxs)("div",{className:"flex flex-col mt-2 gap-2",children:[(0,S.jsx)("div",{className:"font-semibold",children:"Display conditions summary"}),(0,S.jsx)("span",{className:"text-secondary",children:i||d?"Surveys will be displayed to users that match the following conditions:":"Surveys will be displayed to everyone."}),t.conditions?.url&&(0,S.jsx)("div",{className:"flex flex-col font-medium gap-1",children:(0,S.jsxs)("div",{className:"flex-row",children:[(0,S.jsxs)("span",{children:["URL"," ",oe[t.conditions?.urlMatchType||"icontains"].slice(2),":"]})," ",(0,S.jsx)(ue,{children:t.conditions.url})]})}),t.conditions?.deviceTypes&&(0,S.jsxs)("div",{className:"flex font-medium gap-1 items-center",children:[(0,S.jsxs)("span",{children:["Device Types"," ",oe[t.conditions?.deviceTypesMatchType||"icontains"].slice(2),":"]})," ",t.conditions.deviceTypes.map(r=>(0,S.jsx)(ue,{children:r},r))]}),t.conditions?.selector&&(0,S.jsx)("div",{className:"flex flex-col font-medium gap-1",children:(0,S.jsxs)("div",{className:"flex-row",children:[(0,S.jsx)("span",{children:"Selector matches:"})," ",(0,S.jsx)(ue,{children:t.conditions.selector})]})}),t.linked_flag_id&&(0,S.jsxs)("div",{className:"flex flex-row font-medium gap-1",children:[(0,S.jsx)("span",{children:"Feature flag enabled for:"})," ",e!=="new"?t.linked_flag?.id?(0,S.jsx)(te,{to:ot.featureFlag(t.linked_flag?.id),children:t.linked_flag?.key}):null:(0,S.jsx)(_e,{value:t.linked_flag_id,readOnly:!0,onChange:()=>{}})]}),t.conditions?.seenSurveyWaitPeriodInDays&&(0,S.jsx)("div",{className:"flex flex-col font-medium gap-1",children:(0,S.jsxs)("div",{className:"flex-row",children:[(0,S.jsx)("span",{children:"Wait period after seeing survey:"})," ",(0,S.jsxs)(ue,{children:[t.conditions.seenSurveyWaitPeriodInDays," ",t.conditions.seenSurveyWaitPeriodInDays===1?"day":"days"]})]})}),o&&(0,S.jsx)("div",{children:(0,S.jsxs)(se.BindLogic,{logic:Me,props:{id:t.targeting_flag?.id||"new"},children:[(0,S.jsx)("span",{className:"font-medium",children:"User properties:"})," ",(0,S.jsx)(Ae,{readOnly:!0,excludeTitle:!0,filters:o})]})})]})}export{cr as a,Ka as b,es as c,ut as d,$a as e};
//# sourceMappingURL=/static/chunk-HXWIHI4I.js.map
