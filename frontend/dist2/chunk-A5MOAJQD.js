import{Io as P,Sd as b,Ta as L,Wd as I,Za as E,a as S,af as $,r as C,ue as T,va as y}from"/static/chunk-RFJTZKD6.js";import{a as B}from"/static/chunk-3UDJFOQH.js";import{d as l,e as h,g as k,j as d}from"/static/chunk-SJXEOBQC.js";h();d();k();var g=l(S());var c=l(B());h();d();k();var a=l(S()),O=l(E());var u=(0,a.kea)([(0,a.props)({}),(0,a.key)(e=>e.id),(0,a.path)(e=>["lib","integrations","slackIntegrationLogic",e]),(0,a.connect)({values:[$,["siteUrlMisconfigured","preflight"]]}),(0,a.actions)({loadSlackChannels:!0}),(0,O.loaders)(({props:e})=>({slackChannels:[null,{loadSlackChannels:async()=>(await P.integrations.slackChannels(e.id)).channels}]})),(0,a.selectors)({isMemberOfSlackChannel:[e=>[e.slackChannels],e=>n=>{if(!e)return null;let[p]=n.split("|");return e.find(i=>i.id===p)?.is_member??!1}]})]);var o=l(C()),D=e=>e?e.map(n=>({key:`${n.id}|#${n.name}`,labelComponent:(0,o.jsxs)("span",{className:"flex items-center",children:[n.is_private?`\u{1F512}${n.name}`:`#${n.name}`,n.is_ext_shared?(0,o.jsx)(y,{className:"ml-2"}):null]}),label:`${n.id} #${n.name}`})):null;function Q({onChange:e,value:n,integration:p,disabled:i}){let{slackChannels:s,slackChannelsLoading:f,isMemberOfSlackChannel:w}=(0,g.useValues)(u({id:p.id})),{loadSlackChannels:m}=(0,g.useActions)(u({id:p.id})),M=(0,c.useMemo)(()=>D(s),[s]),_=n&&w(n)===!1,t=(0,c.useMemo)(()=>{if(n?.split("|").length===1){let r=s?.find(v=>v.id===n);if(r)return`${r.id}|#${r.name}`}return n},[n,s]);return(0,c.useEffect)(()=>{i||m()},[m,i]),(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(T,{onChange:r=>e?.(r[0]??null),value:t?[t]:[],onFocus:()=>!s&&!f&&m(),disabled:i,mode:"single","data-attr":"select-slack-channel",placeholder:"Select a channel...",options:M??(t?[{key:t,label:t?.split("|")[1]??t}]:[]),loading:f}),_?(0,o.jsx)(I,{type:"info",children:(0,o.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,o.jsxs)("span",{children:["The PostHog Slack App is not in this channel. Please add it to the channel otherwise Subscriptions will fail to be delivered."," ",(0,o.jsx)(L,{to:"https://posthog.com/docs/webhooks/slack",target:"_blank",children:"See the Docs for more information"})]}),(0,o.jsx)(b,{type:"secondary",onClick:m,loading:f,children:"Check again"})]})}):null]})}export{Q as a};
//# sourceMappingURL=/static/chunk-A5MOAJQD.js.map
