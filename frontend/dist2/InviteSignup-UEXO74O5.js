import{a as I}from"/static/chunk-YZBUF2ID.js";import{a as X}from"/static/chunk-W2T4G2OH.js";import{a as _}from"/static/chunk-R6SH42VN.js";import{a as O,b as W}from"/static/chunk-YLWX37ZH.js";import"/static/chunk-DXU2OWVA.js";import{$a as T,Do as J,Eo as w,Io as b,Mp as L,Q as f,R as B,Rd as H,Sd as l,Ta as p,Tf as y,Yi as F,Za as q,a as N,af as A,ee as R,f as D,h as K,ie as h,r as C,ym as z,zm as P}from"/static/chunk-RFJTZKD6.js";import"/static/chunk-XPJ4MQJV.js";import{a as Q}from"/static/chunk-3UDJFOQH.js";import"/static/chunk-HHT4SG7V.js";import"/static/chunk-K7LQKAJG.js";import"/static/chunk-QQTK3LZH.js";import"/static/chunk-IJQNM355.js";import"/static/chunk-4CN6THWS.js";import"/static/chunk-272RTCFX.js";import"/static/chunk-2ROB4QWU.js";import"/static/chunk-ALT2ZZSO.js";import"/static/chunk-UE6SLBBN.js";import"/static/chunk-GINZUAUY.js";import"/static/chunk-SQELCOUW.js";import"/static/chunk-IGYUTZ65.js";import"/static/chunk-YM6UBNGD.js";import"/static/chunk-C6TQ5FFZ.js";import"/static/chunk-GXGA523B.js";import"/static/chunk-N4MMWRNK.js";import"/static/chunk-NRLAI7OY.js";import"/static/chunk-LVVHNICT.js";import"/static/chunk-2AXSSSSX.js";import"/static/chunk-DGXQI7RB.js";import"/static/chunk-HUCRWDLX.js";import"/static/chunk-RFEQG3YN.js";import"/static/chunk-PUISI233.js";import{d,e as u,g as v,j as g}from"/static/chunk-SJXEOBQC.js";u();g();v();var U=d(K()),r=d(N()),V=d(T());var G=d(Q());u();g();v();var s=d(N()),Y=d(T()),$=d(q()),M=d(D());var S=(o=>(o.InvalidInvite="invalid_invite",o.InvalidRecipient="invalid_recipient",o.Unknown="unknown",o))(S||{}),c=(0,s.kea)([(0,s.path)(["scenes","authentication","inviteSignupLogic"]),(0,s.actions)({setError:t=>({payload:t})}),(0,s.reducers)({error:[null,{setError:(t,{payload:i})=>i}]}),(0,$.loaders)(({actions:t,values:i})=>({invite:[null,{prevalidateInvite:async(n,o)=>{o();try{return await b.get(`api/signup/${n}/`)}catch(a){return a.status===400?a.code==="invalid_recipient"?t.setError({code:"invalid_recipient",detail:a.detail}):a.code==="account_exists"?location.href=a.detail:t.setError({code:"invalid_invite",detail:a.detail}):t.setError({code:"unknown"}),null}}}],acceptedInvite:[null,{acceptInvite:async(n,o)=>(o(),i.invite?await b.create(`api/signup/${i.invite.id}/`,n):null)}]})),(0,Y.forms)(({actions:t,values:i})=>({signup:{defaults:{role_at_organization:""},errors:({password:n,first_name:o,role_at_organization:a})=>({password:n?i.validatedPassword.feedback||void 0:"Please enter your password to continue",first_name:o?void 0:"Please enter your name",role_at_organization:a?void 0:"Please select your role to continue"}),submit:async(n,o)=>{if(o(),!!i.invite)try{let a=await b.create(`api/signup/${i.invite.id}/`,n);location.href=a.redirect_url||"/"}catch(a){throw t.setSignupManualErrors({generic:{code:a.code,detail:a.detail}}),a}}}})),(0,s.selectors)({validatedPassword:[t=>[t.signup],({password:t})=>O(t)]}),(0,s.listeners)(({actions:t})=>({prevalidateInviteSuccess:({invite:i})=>{i?.first_name&&t.setSignupValue("first_name",i.first_name)}})),(0,M.urlToAction)(({actions:t})=>({"/signup/*":({_:i},{error_code:n,error_detail:o})=>{n?Object.values(S).includes(n)?t.setError({code:n,detail:o}):t.setError({code:"unknown",detail:o}):i&&t.prevalidateInvite(i)}}))]);var e=d(C()),Ce={component:re,logic:c},ie="utm_medium=in-product&utm_campaign=invite-signup";function x(){return(0,e.jsxs)("div",{className:"font-bold text-center",children:[(0,e.jsx)(p,{to:"/",children:"App Home"}),(0,e.jsx)("span",{className:"mx-2",children:"|"}),(0,e.jsx)(p,{to:`https://posthog.com?${ie}&utm_message=invalid-invite`,children:"PostHog Website"})]})}function E(){return(0,e.jsx)(l,{type:"secondary",icon:(0,e.jsx)(f,{}),center:!0,fullWidth:!0,to:J.default(),children:"Go back to PostHog"})}function ne(){let{error:t}=(0,r.useValues)(c),{user:i}=(0,r.useValues)(w),n={invalid_invite:{title:"Oops! This invite link is invalid or has expired",detail:(0,e.jsxs)(e.Fragment,{children:[t?.detail," If you believe this is a mistake, please contact whoever created this invite and"," ",(0,e.jsx)("b",{children:"ask them for a new invite"}),"."]}),actions:i?(0,e.jsx)(E,{}):(0,e.jsx)(x,{})},invalid_recipient:{title:"Oops! This invite link can't be used",detail:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{children:t?.detail}),(0,e.jsx)("div",{className:"mt-4",children:i?(0,e.jsxs)("span",{children:["You can either log out and create a new account under the new email address or ask the organization admin to send a"," ",(0,e.jsxs)("b",{children:["new invite to the email address on your account, ",i?.email]}),"."]}):(0,e.jsxs)("div",{children:["You need to log in with the email address above, or create your own password.",(0,e.jsx)("div",{className:"mt-4",children:(0,e.jsx)(l,{icon:(0,e.jsx)(f,{}),to:window.location.pathname,disableClientSideRouting:!0,children:"Try again"})})]})})]}),actions:i?(0,e.jsx)(E,{}):(0,e.jsx)(x,{})},unknown:{title:"Oops! We could not validate this invite link",detail:`${t?.detail||""} There was an issue with your invite link, please try again in a few seconds. If the problem persists, contact us.`,actions:i?(0,e.jsx)(E,{}):(0,e.jsx)(x,{})}};return t?(0,e.jsxs)(_,{view:"signup-error",hedgehog:!0,message:"Oops!",footer:(0,e.jsx)(I,{}),children:[(0,e.jsx)("h2",{children:n[t.code].title}),(0,e.jsx)("div",{className:"error-message",children:n[t.code].detail}),(0,e.jsx)(R,{dashed:!0,className:"my-4"}),(0,e.jsx)("div",{children:n[t.code].actions})]}):null}function oe({invite:t}){let{user:i}=(0,r.useValues)(w),{acceptInvite:n}=(0,r.useActions)(c),{acceptedInviteLoading:o,acceptedInvite:a}=(0,r.useValues)(c);return(0,e.jsx)(_,{view:"accept-invite",hedgehog:!0,message:i?.first_name?`Hey ${i?.first_name}!`:"Hello!",footer:(0,e.jsx)(I,{name:i?.first_name,email:i?.email}),children:(0,e.jsxs)("div",{className:"space-y-2",children:[(0,e.jsxs)("h2",{children:["You have been invited to join ",t.organization_name]}),(0,e.jsxs)("div",{children:["You will accept the invite under your ",(0,e.jsx)("b",{children:"existing PostHog account"})," (",i?.email,")"]}),i&&(0,e.jsxs)("div",{className:"border rounded-lg border-dashed flex items-center gap-2 px-2 py-1","data-attr":"top-navigation-whoami",children:[(0,e.jsx)(F,{user:i}),(0,e.jsxs)("div",{className:"",children:[(0,e.jsx)("div",{className:"font-bold",children:i.first_name}),(0,e.jsx)("div",{children:i.organization?.name})]})]}),(0,e.jsx)("div",{children:"You can change organizations at any time by clicking on the dropdown at the top right corner of the navigation bar."}),(0,e.jsx)("div",{children:a?(0,e.jsx)(l,{type:"secondary",center:!0,fullWidth:!0,sideIcon:(0,e.jsx)(B,{}),onClick:()=>window.location.href="/",children:"Go to PostHog"}):(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(l,{type:"primary",center:!0,fullWidth:!0,onClick:()=>n(),loading:o,children:"Accept invite"}),(0,e.jsx)("div",{className:"mt-2",children:(0,e.jsx)(l,{type:"secondary",center:!0,fullWidth:!0,icon:(0,e.jsx)(f,{}),to:"/",children:"Go back to PostHog"})})]})})]})})}function ae({invite:t}){let{isSignupSubmitting:i,validatedPassword:n}=(0,r.useValues)(c),{preflight:o}=(0,r.useValues)(A),{precheck:a}=(0,r.useActions)(L),{precheckResponse:m,precheckResponseLoading:j}=(0,r.useValues)(L),k=m.sso_enforcement;return(0,G.useEffect)(()=>{a({email:t.target_email})},[t.target_email]),(0,e.jsxs)(_,{view:"invites-signup",hedgehog:!0,message:(0,e.jsxs)(e.Fragment,{children:["Welcome to",(0,e.jsx)("br",{})," PostHog",o?.cloud?" Cloud":"","!"]}),leftContainerContent:(0,e.jsx)("div",{className:"mb-8 text-secondary",children:(0,e.jsxs)("div",{className:"font-semibold flex flex-col gap-2 text-center items-center text-lg",children:[(0,e.jsx)("span",{children:"You've been invited to join"}),(0,e.jsx)("span",{className:"text-4xl font-bold border-b border-dashed pb-2",children:t?.organization_name||"us"}),(0,e.jsx)("span",{children:"on PostHog"})]})}),footer:(0,e.jsx)(I,{name:t.first_name,email:t.target_email}),children:[(0,e.jsx)("h2",{className:"text-center",children:"Create your PostHog account"}),(0,e.jsxs)(V.Form,{logic:c,formKey:"signup",className:"space-y-4",enableFormOnSubmit:!0,children:[(0,e.jsx)(y.Pure,{label:"Email",children:(0,e.jsx)(h,{type:"email",disabled:!0,value:t?.target_email})}),!k&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(y,{name:"password",label:(0,e.jsxs)("div",{className:"flex flex-1 items-center justify-between",children:[(0,e.jsx)("span",{children:"Password"}),(0,e.jsx)(W,{validatedPassword:n})]}),children:(0,e.jsx)(h,{type:"password",className:"ph-ignore-input","data-attr":"password",placeholder:"\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022",autoComplete:"new-password",autoFocus:window.screen.width>=768,disabled:i})}),(0,e.jsx)(y,{name:"first_name",label:"First Name",help:t?.first_name?"Your name was provided in the invite, feel free to change it.":void 0,children:(0,e.jsx)(h,{"data-attr":"first_name",placeholder:"Jane"})}),(0,e.jsx)(X,{})]}),!m.sso_enforcement&&(0,e.jsx)(l,{type:"primary",status:"alt",htmlType:"submit","data-attr":"password-signup",fullWidth:!0,center:!0,loading:i||j,size:"large",children:"Continue"}),m.sso_enforcement&&(0,e.jsx)(P,{provider:m.sso_enforcement,email:t?.target_email,actionText:"Continue",extraQueryParams:t?{invite_id:t.id}:void 0}),m.saml_available&&!m.sso_enforcement&&(0,e.jsx)(P,{provider:"saml",email:t?.target_email,actionText:"Continue",extraQueryParams:t?{invite_id:t.id}:void 0})]}),(0,e.jsxs)("div",{className:"mt-4 text-center text-secondary",children:["Already have an account? ",(0,e.jsx)(p,{to:"/login",children:"Log in"})]}),(0,e.jsxs)("div",{className:"mt-4 text-center text-secondary",children:["By clicking continue you agree to our"," ",(0,e.jsx)(p,{to:"https://posthog.com/terms",target:"_blank",children:"Terms of Service"})," ","and"," ",(0,e.jsx)(p,{to:"https://posthog.com/privacy",target:"_blank",children:"Privacy Policy"}),"."]}),!k&&(0,e.jsx)(z,{className:"mb-4",title:"Or sign in with",caption:`Remember to log in with ${t?.target_email}`,captionLocation:"bottom",topDivider:!0,extraQueryParams:t?{invite_id:t.id}:void 0})]})}function re(){let{invite:t,inviteLoading:i}=(0,r.useValues)(c),{user:n}=(0,r.useValues)(w);return i?(0,e.jsx)(H,{sceneLevel:!0}):(0,e.jsxs)("div",{className:(0,U.default)("InviteSignup",!!n&&"InviteSignup--authenticated"),children:[(0,e.jsx)(ne,{}),t&&(n?(0,e.jsx)(oe,{invite:t}):(0,e.jsx)(ae,{invite:t}))]})}export{re as InviteSignup,Ce as scene};
//# sourceMappingURL=/static/InviteSignup-UEXO74O5.js.map
