import{a as f}from"/static/chunk-TBIQSJ6Q.js";import{c as z,e as G}from"/static/chunk-B2IEXZN7.js";import"/static/chunk-EIH6KTHG.js";import"/static/chunk-NEPY3GOZ.js";import"/static/chunk-TUL3J7MM.js";import"/static/chunk-MOVKLCV5.js";import"/static/chunk-FT4MFWRB.js";import"/static/chunk-HRNZBUVG.js";import"/static/chunk-Y35PDO57.js";import"/static/chunk-PWG7LMNW.js";import"/static/chunk-CEZSENEJ.js";import{$a as B,Ce as A,Cg as R,Do as m,Gm as $,Io as P,Sd as h,Tf as v,Vd as k,Wa as C,Xa as S,Za as Z,a as F,dh as I,ef as b,f as Q,fe as V,g as W,pe as _,r as x,se as L,sg as M,vo as j}from"/static/chunk-TW5IU73S.js";import"/static/chunk-XPJ4MQJV.js";import{Ha as w}from"/static/chunk-3UDJFOQH.js";import"/static/chunk-HHT4SG7V.js";import"/static/chunk-K7LQKAJG.js";import"/static/chunk-QQTK3LZH.js";import"/static/chunk-IJQNM355.js";import"/static/chunk-4CN6THWS.js";import"/static/chunk-272RTCFX.js";import"/static/chunk-2ROB4QWU.js";import"/static/chunk-ALT2ZZSO.js";import"/static/chunk-UE6SLBBN.js";import"/static/chunk-GINZUAUY.js";import"/static/chunk-SQELCOUW.js";import"/static/chunk-IGYUTZ65.js";import"/static/chunk-YM6UBNGD.js";import"/static/chunk-C6TQ5FFZ.js";import"/static/chunk-GXGA523B.js";import"/static/chunk-N4MMWRNK.js";import"/static/chunk-NRLAI7OY.js";import"/static/chunk-LVVHNICT.js";import"/static/chunk-2AXSSSSX.js";import"/static/chunk-DGXQI7RB.js";import"/static/chunk-HUCRWDLX.js";import"/static/chunk-RFEQG3YN.js";import"/static/chunk-PUISI233.js";import{d as a,e as D,g as u,j as y}from"/static/chunk-SJXEOBQC.js";D();y();u();var d=a(F()),O=a(B());D();y();u();var r=a(F()),H=a(B()),J=a(Z()),E=a(Q()),K=a(W());var N=(0,r.kea)([(0,r.path)(["scenes","data-management","definition","definitionDetailLogic"]),(0,r.props)({}),(0,r.key)(e=>e.id||"new"),(0,r.connect)(({id:e})=>({values:[f({id:e}),["definition","isEvent","singular"]],actions:[f({id:e}),["setDefinition"],G,["setLocalPropertyDefinition"],z,["setLocalEventDefinition"],b,["loadTags"]]})),(0,H.forms)(({actions:e})=>({editDefinition:{defaults:{},errors:({name:t})=>({name:t?null:"You need to set a name"}),submit:t=>{e.saveDefinition(t)}}})),(0,J.loaders)(({values:e,actions:t})=>({editDefinition:[{},{saveDefinition:async(p,T)=>{let o={...e.editDefinition};if(e.isEvent){let n=o;o=await P.eventDefinitions.update({eventDefinitionId:n.id,eventDefinitionData:{...n,owner:n.owner?.id??null,verified:!!n.verified}})}else{let n=o;o=await P.propertyDefinitions.update({propertyDefinitionId:n.id,propertyDefinitionData:n}),M({[`event/${o.name}`]:o})}return T(),k.success(`${w(e.singular)} saved`),e.isEvent?t.setLocalEventDefinition(o):t.setLocalPropertyDefinition(o),t.setDefinition(o),t.loadTags(),E.router.actions.push(e.isEvent?m.eventDefinition(o.id):m.propertyDefinition(o.id)),o}}]})),(0,K.subscriptions)(({actions:e})=>({definition:t=>{e.resetEditDefinition(t)}})),(0,E.beforeUnload)(({values:e,actions:t})=>({enabled:()=>e.editDefinitionChanged,message:`Leave?
Changes you made will be discarded.`,onConfirm:()=>{t.resetEditDefinition(e.definition)}}))]);var i=a(x()),Ai={component:ti,logic:f,paramsToProps:({params:{id:e}})=>({id:e})};function ti(e={}){let t=N(e),{definitionLoading:p,definitionMissing:T,hasTaxonomyFeatures:o,isProperty:n}=(0,d.useValues)(f(e)),{editDefinition:s}=(0,d.useValues)(t),{saveDefinition:U}=(0,d.useActions)(t),{tags:X,tagsLoading:Y}=(0,d.useValues)(b),q=o&&!C(s.name)&&"verified"in s;return T?(0,i.jsx)($,{object:"event"}):(0,i.jsxs)(O.Form,{logic:N,props:e,formKey:"editDefinition",children:[(0,i.jsx)(j,{buttons:(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(h,{"data-attr":"cancel-definition",type:"secondary",to:n?m.propertyDefinition(s.id):m.eventDefinition(s.id),disabledReason:p?"Loading...":void 0,children:"Cancel"}),(0,i.jsx)(h,{"data-attr":"save-definition",type:"primary",onClick:()=>{U({})},disabledReason:p?"Loading...":void 0,children:"Save"})]})}),p?(0,i.jsxs)("div",{className:"space-y-4 mt-4",children:[(0,i.jsx)(L,{className:"h-10 w-1/3"}),(0,i.jsx)(L,{className:"h-6 w-1/2"}),(0,i.jsx)(L,{className:"h-30 w-1/2"})]}):(0,i.jsxs)("div",{className:"my-4 space-y-4",children:[(0,i.jsxs)("div",{children:[(0,i.jsxs)("h1",{children:['Editing "',S(s.name,"events")||"",'"']}),(0,i.jsxs)("div",{className:"flex flex-wrap items-center gap-2 text-secondary",children:[(0,i.jsx)("div",{children:"Raw event name:"}),(0,i.jsx)(V,{className:"font-mono",children:s.name})]})]}),o&&"tags"in s&&(0,i.jsx)("div",{className:"ph-ignore-input",children:(0,i.jsx)(v,{name:"tags",label:"Tags","data-attr":"definition-tags",children:({value:l,onChange:c})=>(0,i.jsx)(R,{className:"definition-tags",saving:p||Y,tags:l||[],onChange:g=>c(g),style:{marginBottom:4},tagsAvailable:X})})}),o&&(0,i.jsx)("div",{className:"ph-ignore-input",children:(0,i.jsx)(v,{name:"description",label:"Description","data-attr":"definition-description",children:(0,i.jsx)(A,{value:s.description})})}),q&&(0,i.jsx)("div",{className:"ph-ignore-input",children:(0,i.jsx)(v,{name:"verified",label:"Verification","data-attr":"definition-verified",children:({value:l,onChange:c})=>(0,i.jsx)(I,{isProperty:n,verified:!!l,onChange:g=>{c(g)}})})}),n&&(0,i.jsx)("div",{className:"ph-ignore-input",children:(0,i.jsx)(v,{name:"property_type",label:"Property Type","data-attr":"property-type",children:({value:l,onChange:c})=>(0,i.jsx)(_,{onChange:g=>c(g),value:l,options:[{value:"DateTime",label:"DateTime"},{value:"String",label:"String"},{value:"Numeric",label:"Numeric"},{value:"Boolean",label:"Boolean"}]})})})]})]})}export{ti as DefinitionEdit,Ai as scene};
//# sourceMappingURL=/static/DefinitionEdit-MVGXDZIF.js.map
