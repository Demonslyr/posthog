import{a as Se}from"/static/chunk-NEPY3GOZ.js";import{a as O,b as N,c as Ee}from"/static/chunk-I3JBH3PJ.js";import{a as Q,b as Le,c as xe}from"/static/chunk-TUL3J7MM.js";import{g as Te}from"/static/chunk-CIEHRPUV.js";import{Cb as ie,Hd as le,Io as V,Ko as ve,Pi as j,Qd as me,Qi as be,R as ae,Ri as ye,Sa as Y,Sd as x,Si as He,Ti as _e,Ui as E,Vi as U,Wb as ne,Wd as R,Za as re,a as S,b as B,cc as se,cf as ue,f as ee,g as Je,ga as oe,h as ze,je as pe,jo as Pe,n as Ye,oe as q,pe as X,pg as ge,qh as we,r as F,rp as I,se as de,ue as ce,vf as fe,wf as he}from"/static/chunk-TW5IU73S.js";import"/static/chunk-XPJ4MQJV.js";import{Ab as te,Ua as z,a as Z}from"/static/chunk-3UDJFOQH.js";import"/static/chunk-HHT4SG7V.js";import"/static/chunk-K7LQKAJG.js";import"/static/chunk-QQTK3LZH.js";import"/static/chunk-IJQNM355.js";import"/static/chunk-4CN6THWS.js";import"/static/chunk-272RTCFX.js";import"/static/chunk-2ROB4QWU.js";import"/static/chunk-ALT2ZZSO.js";import"/static/chunk-UE6SLBBN.js";import"/static/chunk-GINZUAUY.js";import"/static/chunk-SQELCOUW.js";import"/static/chunk-IGYUTZ65.js";import"/static/chunk-YM6UBNGD.js";import"/static/chunk-C6TQ5FFZ.js";import"/static/chunk-GXGA523B.js";import"/static/chunk-N4MMWRNK.js";import"/static/chunk-NRLAI7OY.js";import"/static/chunk-LVVHNICT.js";import"/static/chunk-2AXSSSSX.js";import"/static/chunk-DGXQI7RB.js";import"/static/chunk-HUCRWDLX.js";import"/static/chunk-RFEQG3YN.js";import"/static/chunk-PUISI233.js";import{d,e as w,g as b,j as y}from"/static/chunk-SJXEOBQC.js";w();y();b();w();y();b();var De=d(ze()),h=d(S());w();y();b();var Ue=d(S());var Ie=d(Z());w();y();b();var u=d(S()),Ae=d(re()),$=d(ee()),Me=d(Je()),Re=d(Ye());w();y();b();var H=d(S()),Fe=e=>e.match(/^([a-f]|[0-9]){8}-([a-f]|[0-9]){4}-([a-f]|[0-9]){4}-([a-f]|[0-9]){4}-([a-f]|[0-9]){12}$/)||e.match(/^[0-9]+$/)||e.length>24?"*":e;function D(e){try{return e.indexOf("#")===-1?e:e.replace(/__posthog=\{[^}]*}[^#]*/,"").replace("##","#").replace(/#$/,"")}catch{return e}}var G=(0,H.kea)([(0,H.path)(["toolbar","stats","currentPageLogic"]),(0,H.actions)(()=>({setHref:e=>({href:e}),setWildcardHref:e=>({href:e}),autoWildcardHref:!0})),(0,H.reducers)(()=>({href:[window.location.href,{setHref:(e,{href:t})=>D(t)}],wildcardHref:[window.location.href,{setHref:(e,{href:t})=>D(t),setWildcardHref:(e,{href:t})=>D(t)}]})),(0,H.listeners)(({actions:e,values:t})=>({autoWildcardHref:()=>{let o=t.wildcardHref,a=o.split("?");if(o=a[0].split("/").map(i=>Fe(i)).join("/"),a.length>1){let i=a[1].split("&");for(let m=0;m<i.length;m++){let[n,s]=i[m].split("=");i[m]=`${n}=${Fe(s)}`}o=`${o}?${i.join("&")}`}e.setWildcardHref(o)}})),(0,H.afterMount)(({actions:e,values:t,cache:o})=>{t.href&&t.href.includes("#__posthog=")&&e.setHref(D(t.href)),o.interval=window.setInterval(()=>{window.location.href!==t.href&&e.setHref(window.location.href)},500)}),(0,H.beforeUnmount)(({cache:e})=>{window.clearInterval(e.interval)})]);var qe=Te("1.99"),Ce={next:void 0,previous:void 0,results:[]},ke=[{value:"default",label:"Default (multicolor)"},{value:"red",label:"Red (monocolor)"},{value:"green",label:"Green (monocolor)"},{value:"blue",label:"Blue (monocolor)"}],Be=(0,u.kea)([(0,u.path)(["toolbar","elements","heatmapLogic"]),(0,u.connect)({values:[G,["href","wildcardHref"],E,["posthog"]],actions:[G,["setHref","setWildcardHref"]]}),(0,u.actions)({getElementStats:e=>({url:e}),enableHeatmap:!0,disableHeatmap:!0,setShiftPressed:e=>({shiftPressed:e}),setCommonFilters:e=>({filters:e}),setHeatmapFilters:e=>({filters:e}),patchHeatmapFilters:e=>({filters:e}),toggleClickmapsEnabled:e=>({enabled:e}),loadMoreElementStats:!0,setMatchLinksByHref:e=>({matchLinksByHref:e}),loadHeatmap:e=>({type:e}),loadAllEnabled:(e=0)=>({delayMs:e}),maybeLoadClickmap:(e=0)=>({delayMs:e}),maybeLoadHeatmap:(e=0)=>({delayMs:e}),fetchHeatmapApi:e=>({params:e}),setHeatmapScrollY:e=>({scrollY:e}),setHeatmapFixedPositionMode:e=>({mode:e}),setHeatmapColorPalette:e=>({Palette:e})}),(0,Re.windowValues)(()=>({windowWidth:e=>e.innerWidth,windowHeight:e=>e.innerHeight})),(0,u.reducers)({matchLinksByHref:[!1,{setMatchLinksByHref:(e,{matchLinksByHref:t})=>t}],canLoadMoreElementStats:[!0,{getElementStatsSuccess:(e,{elementStats:t})=>t.next!==null,getElementStatsFailure:()=>!0}],heatmapEnabled:[!1,{enableHeatmap:()=>!0,disableHeatmap:()=>!1,getElementStatsFailure:()=>!1}],shiftPressed:[!1,{setShiftPressed:(e,{shiftPressed:t})=>t}],commonFilters:[{date_from:"-7d"},{setCommonFilters:(e,{filters:t})=>t}],heatmapFilters:[O,{persist:!0},{setHeatmapFilters:(e,{filters:t})=>t,patchHeatmapFilters:(e,{filters:t})=>({...e,...t})}],clickmapsEnabled:[!1,{persist:!0},{toggleClickmapsEnabled:(e,{enabled:t})=>t===void 0?!e:t}],heatmapScrollY:[0,{setHeatmapScrollY:(e,{scrollY:t})=>t}],heatmapFixedPositionMode:["fixed",{setHeatmapFixedPositionMode:(e,{mode:t})=>t}],heatmapColorPalette:["default",{persist:!0},{setHeatmapColorPalette:(e,{Palette:t})=>t}]}),(0,Ae.loaders)(({values:e})=>({elementStats:[null,{resetElementStats:()=>Ce,getElementStats:async({url:t},o)=>{let{href:a,wildcardHref:i}=e,m="";if(!t){let p={properties:[i===a?{key:"$current_url",value:a,operator:"exact",type:"event"}:{key:"$current_url",value:`^${i.split("*").map(fe).join(".*")}$`,operator:"regex",type:"event"}],date_from:e.commonFilters.date_from,date_to:e.commonFilters.date_to};m=`/api/element/stats/${(0,$.encodeParams)({...p,paginate_response:!0},"?")}`}let n=await U(t||m,"GET",void 0,t?"use-as-provided":"full");if(n.status===403)return E.actions.authenticate(),Ce;let s=await n.json();if(o(),!Array.isArray(s.results))throw new Error("Error loading HeatMap data!");return{results:[...t?e.elementStats?.results||[]:[],...s.results||[]],next:s.next,previous:s.previous}}}],rawHeatmap:[null,{loadHeatmap:async()=>{let{href:t,wildcardHref:o}=e,{date_from:a,date_to:i}=e.commonFilters,{type:m,aggregation:n}=e.heatmapFilters,g=await U(`/api/heatmap/${(0,$.encodeParams)({type:m,date_from:a,date_to:i,url_exact:o===t?t:void 0,url_pattern:o!==t?o:void 0,viewport_width_min:e.viewportRange.min,viewport_width_max:e.viewportRange.max,aggregation:n},"?")}`,"GET");if(g.status===403&&E.actions.authenticate(),g.status!==200)throw new Error("API error");return await g.json()}}]})),(0,u.selectors)(({cache:e})=>({dateRange:[t=>[t.commonFilters],t=>te(t.date_from,t.date_to,"Last 7 days")],elements:[t=>[t.elementStats,E.selectors.dataAttributes,t.href,t.matchLinksByHref],(t,o,a,i)=>{e.pageElements=e.lastHref==a?e.pageElements:ye("*",document),e.selectorToElements=e.lastHref==a?e.selectorToElements:{},e.lastHref=a;let m=[];return t?.results.forEach(n=>{let s,p;for(let g=0;g<n.elements.length;g++){let _=n.elements[g],T=he(i?_:{..._,href:void 0},o)||"*";s=p?`${T} > ${p}`:T;try{let v=e.selectorToElements?.[s];if(v===void 0&&(v=Array.from(be(s,document,e.pageElements)),e.selectorToElements[s]=v),v.length===1){let P=n.elements[g];if(!(g===0&&P.tag_name&&!P.attr_class&&!P.attr_id&&!P.href&&!P.text&&P.nth_child===1&&P.nth_of_type===1&&!P.attributes["attr__data-attr"]))return m.push({element:v[0],count:n.count,selector:T,hash:n.hash,type:n.type}),null}if(v.length===0){if(g===n.elements.length-1)return null;if(g>0&&p){p=p?`* > ${p}`:"*";continue}}}catch{break}p=s}}),m}],countedElements:[t=>[t.elements,E.selectors.dataAttributes,t.clickmapsEnabled],(t,o,a)=>{if(!a)return[];let i=new Map;(t||[]).forEach(n=>{let s=_e(n.element);if(s)if(i.has(s)){let p=i.get(s);p&&(p.count+=n.count,p.clickCount+=n.type==="$rageclick"?0:n.count,p.rageclickCount+=n.type==="$rageclick"?n.count:0)}else i.set(s,{...n,clickCount:n.type==="$rageclick"?0:n.count,rageclickCount:n.type==="$rageclick"?n.count:0,element:s,actionStep:He(s,o)})});let m=Array.from(i.values());return m.sort((n,s)=>s.count-n.count),m.map((n,s)=>({...n,position:s+1}))}],elementCount:[t=>[t.countedElements],t=>t.length],clickCount:[t=>[t.countedElements],t=>t?t.map(o=>o.count).reduce((o,a)=>o+a,0):0],highestClickCount:[t=>[t.countedElements],t=>t?t.map(o=>o.count).reduce((o,a)=>a>o?a:o,0):0],heatmapElements:[t=>[t.rawHeatmap],t=>{if(!t)return[];let o=[];return t?.results.forEach(a=>{"scroll_depth_bucket"in a?o.push({count:a.cumulative_count,xPercentage:0,targetFixed:!1,y:a.scroll_depth_bucket}):o.push({count:a.count,xPercentage:a.pointer_relative_x,targetFixed:a.pointer_target_fixed,y:a.pointer_y})}),o}],viewportRange:[t=>[t.heatmapFilters,t.windowWidth],(t,o)=>N(t,o)],heatmapTooltipLabel:[t=>[t.heatmapFilters],t=>t.aggregation==="unique_visitors"?"visitors":t.type+"s"],scrollDepthPosthogJsError:[t=>[t.posthog],t=>{if(!t)return null;let o=t?.version??t?._calculate_event_properties("test",{},new Date)?.$lib_version??"0.0.0";if(!t?.scrollManager?.scrollY)return"version";let a=qe(o),i=t?.config.disable_scroll_properties;return a?i?"disabled":null:"version"}],heatmapJsData:[t=>[t.heatmapElements,t.heatmapScrollY,t.windowWidth,t.heatmapFixedPositionMode],(t,o,a,i)=>{let m=t.reduce((s,p)=>{if(i==="hidden"&&p.targetFixed)return s;let g=Math.round(p.targetFixed&&i==="fixed"?p.y:p.y-o),_=Math.round(p.xPercentage*a);return[...s,{x:_,y:g,value:p.count}]},[]);return{min:0,max:m.reduce((s,{value:p})=>Math.max(s,p),0),data:m}}]})),(0,Me.subscriptions)(({actions:e})=>({viewportRange:()=>{e.maybeLoadHeatmap(500)}})),(0,u.listeners)(({actions:e,values:t})=>({fetchHeatmapApi:async()=>{let{href:o,wildcardHref:a}=t,{date_from:i,date_to:m}=t.commonFilters,{type:n,aggregation:s}=t.heatmapFilters,_=await U(`/api/heatmap/${(0,$.encodeParams)({type:n,date_from:i,date_to:m,url_exact:a===o?o:void 0,url_pattern:a!==o?a:void 0,viewport_width_min:t.viewportRange.min,viewport_width_max:t.viewportRange.max,aggregation:s},"?")}`,"GET");if(_.status===403&&E.actions.authenticate(),_.status!==200)throw new Error("API error");return await _.json()},enableHeatmap:()=>{e.loadAllEnabled(),j.capture("toolbar mode triggered",{mode:"heatmap",enabled:!0})},disableHeatmap:()=>{e.resetElementStats(),j.capture("toolbar mode triggered",{mode:"heatmap",enabled:!1})},loadAllEnabled:async({delayMs:o},a)=>{await a(o),e.maybeLoadHeatmap(),e.maybeLoadClickmap()},maybeLoadClickmap:async({delayMs:o},a)=>{await a(o),t.heatmapEnabled&&t.clickmapsEnabled&&e.getElementStats()},maybeLoadHeatmap:async({delayMs:o},a)=>{await a(o),t.heatmapEnabled&&t.heatmapFilters.enabled&&t.heatmapFilters.type&&e.loadHeatmap(t.heatmapFilters.type)},setHref:()=>{e.loadAllEnabled()},setWildcardHref:()=>{e.loadAllEnabled(1e3)},setCommonFilters:()=>{e.loadAllEnabled(200)},toggleClickmapsEnabled:()=>{t.clickmapsEnabled&&e.getElementStats()},loadMoreElementStats:()=>{t.elementStats?.next&&e.getElementStats(t.elementStats.next)},patchHeatmapFilters:({filters:o})=>{o.type&&e.loadHeatmapSuccess({results:[]}),e.maybeLoadHeatmap(200)}})),(0,u.afterMount)(({actions:e,values:t,cache:o})=>{e.loadAllEnabled(),o.keyDownListener=a=>{a.shiftKey&&!t.shiftPressed&&e.setShiftPressed(!0)},o.keyUpListener=a=>{!a.shiftKey&&t.shiftPressed&&e.setShiftPressed(!1)},window.addEventListener("keydown",o.keyDownListener),window.addEventListener("keyup",o.keyUpListener),o.scrollCheckTimer=setInterval(()=>{let a=t.posthog?.scrollManager?.scrollY()??0;t.heatmapScrollY!==a&&e.setHeatmapScrollY(a)},100)}),(0,u.beforeUnmount)(({cache:e})=>{window.removeEventListener("keydown",e.keyDownListener),window.removeEventListener("keyup",e.keyUpListener),clearInterval(e.scrollCheckTimer)})]);var l=d(F()),Xe=()=>{let{scrollDepthPosthogJsError:e}=(0,Ue.useValues)(Be);return e?(0,l.jsx)("p",{className:"my-2 bg-danger-highlight border border-danger rounded p-2",children:e==="version"?(0,l.jsx)(l.Fragment,{children:"This feature requires a newer version of posthog-js"}):e==="disabled"?(0,l.jsxs)(l.Fragment,{children:["Your posthog-js config has ",(0,l.jsx)("i",{children:"disable_scroll_properties"})," set - these properties are required for scroll depth calculations to work."]}):null}):null},k=({children:e,title:t,info:o})=>{let[a,i]=(0,Ie.useState)(!1);return(0,l.jsxs)("div",{className:"space-y-2 mb-2",children:[(0,l.jsx)("div",{className:"flex items-center gap-2",children:(0,l.jsxs)(pe,{className:"flex-1",children:[(0,l.jsx)("span",{children:t}),o&&(0,l.jsx)(x,{icon:(0,l.jsx)(se,{}),size:"xsmall",active:a,onClick:()=>i(!a),noPadding:!0})]})}),a?(0,l.jsx)("div",{className:"text-sm",children:o}):null,e]})},Oe=({heatmapFilters:e,patchHeatmapFilters:t,viewportRange:o,heatmapColorPalette:a,setHeatmapColorPalette:i,heatmapFixedPositionMode:m,setHeatmapFixedPositionMode:n})=>(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(k,{title:"Heatmap type",info:(0,l.jsxs)(l.Fragment,{children:['Select the kind of heatmap you want to view. Clicks, rageclicks, and mouse moves options will show different "heat" based on the number of interactions at that area of the page. Scroll depth will show how far down the page users have reached.',(0,l.jsx)("br",{}),"Scroll depth uses additional information from Pageview and Pageleave events to indicate how far down the page users have scrolled."]}),children:(0,l.jsxs)("div",{className:"flex gap-2 justify-between items-center",children:[(0,l.jsx)(X,{onChange:s=>t({type:s}),value:e.type??void 0,options:[{value:"click",label:"Clicks"},{value:"rageclick",label:"Rageclicks"},{value:"deadclick",label:"Dead clicks"},{value:"mousemove",label:"Mouse moves"},{value:"scrolldepth",label:"Scroll depth"}],size:"small"}),e.type==="scrolldepth"&&(0,l.jsx)(Xe,{})]})}),(0,l.jsx)(k,{title:"Aggregation",info:(0,l.jsx)(l.Fragment,{children:"Heatmaps can be aggregated by total count or unique visitors. Total count will show the total number of interactions on the page, while unique visitors will only count each visitor once."}),children:(0,l.jsx)("div",{className:"flex gap-2 justify-between items-center",children:(0,l.jsx)(q,{onChange:s=>t({aggregation:s}),value:e.aggregation??"total_count",options:[{value:"total_count",label:"Total count"},{value:"unique_visitors",label:"Unique visitors"}],size:"small"})})}),(0,l.jsx)(k,{title:"Viewport accuracy",info:(0,l.jsxs)(l.Fragment,{children:["The viewport accuracy setting will determine how closely the loaded data will be to your current viewport.",(0,l.jsx)("br",{}),"For example if you set this to 100%, only visitors whose viewport width is identical to yours will be included in the heatmap.",(0,l.jsx)("br",{}),"At 90% you will see data from viewports that are 10% smaller or larger than yours."]}),children:(0,l.jsxs)("div",{className:"flex gap-2 justify-between items-center",children:[(0,l.jsx)(Pe,{className:"flex-1",min:0,max:1,step:.01,value:e.viewportAccuracy??0,onChange:s=>t({viewportAccuracy:s})}),(0,l.jsx)("code",{className:"w-[12rem] text-right text-xs whitsepace-nowrap",children:`${Math.round((e.viewportAccuracy??1)*100)}% (${o.min}px - ${o.max}px)`})]})}),(0,l.jsx)(k,{title:"Color palette",children:(0,l.jsx)(X,{size:"small",options:ke,value:a,onChange:i})}),e.type!=="scrolldepth"&&(0,l.jsx)(k,{title:"Fixed positioning calculation",info:(0,l.jsxs)(l.Fragment,{children:["PostHog JS will attempt to detect fixed elements such as headers or modals and will therefore show those heatmap areas, ignoring the scroll value.",(0,l.jsx)("br",{}),"You can choose to show these areas as fixed, include them with scrolled data or hide them altogether."]}),children:(0,l.jsx)(q,{onChange:n,value:m,options:[{value:"fixed",label:"Show fixed"},{value:"relative",label:"Show scrolled"},{value:"hidden",label:"Hide"}],size:"small"})})]});var W=d(Z());w();y();b();var f=d(S()),Ne=d(re()),c=d(ee());var Ve=window.POSTHOG_APP_CONTEXT?.current_team?.id,L=(0,f.kea)([(0,f.path)(["scenes","heatmaps","heatmapsBrowserLogic"]),(0,f.props)({}),(0,f.connect)({values:[xe({...Le,type:"TOOLBAR_URLS"}),["urlsKeyed","checkUrlIsAuthorized"]]}),(0,f.actions)({setBrowserSearch:e=>({searchTerm:e}),setBrowserUrl:e=>({url:e}),onIframeLoad:!0,sendToolbarMessage:(e,t)=>({type:e,payload:t}),loadTopUrls:!0,maybeLoadTopUrls:!0,loadBrowserSearchResults:!0,patchHeatmapFilters:e=>({filters:e}),setHeatmapColorPalette:e=>({Palette:e}),setHeatmapFixedPositionMode:e=>({mode:e}),setCommonFilters:e=>({filters:e}),setIframeWidth:e=>({width:e}),toggleFilterPanelCollapsed:!0,setIframeBanner:e=>({banner:e}),startTrackingLoading:!0,stopTrackingLoading:!0}),(0,Ne.loaders)(({values:e})=>({browserSearchResults:[null,{loadBrowserSearchResults:async()=>{if(!e.browserSearchTerm)return[];let t={kind:"HogQLQuery",query:I`SELECT distinct properties.$current_url AS urls
                                     FROM events
                                     WHERE timestamp >= now() - INTERVAL 7 DAY
                                       AND timestamp <= now()
                                       AND properties.$current_url like '%${I.identifier(e.browserSearchTerm)}%'
                                     ORDER BY timestamp DESC
                                         limit 100`};return(await V.query(t)).results?.map(a=>a[0])}}],topUrls:[null,{loadTopUrls:async()=>{let t={kind:"HogQLQuery",query:I`SELECT properties.$current_url AS url, count() as count
                                     FROM events
                                     WHERE timestamp >= now() - INTERVAL 7 DAY
                                       AND event in ('$pageview'
                                         , '$autocapture')
                                       AND timestamp <= now()
                                     GROUP BY properties.$current_url
                                     ORDER BY count DESC
                                         LIMIT 10`};return(await V.query(t)).results?.map(a=>({url:a[0],count:a[1]}))}}]})),(0,f.reducers)({filterPanelCollapsed:[!1,{persist:!0},{toggleFilterPanelCollapsed:e=>!e}],commonFilters:[{date_from:"-7d"},{setCommonFilters:(e,{filters:t})=>t}],heatmapColorPalette:["default",{setHeatmapColorPalette:(e,{Palette:t})=>t}],heatmapFilters:[O,{patchHeatmapFilters:(e,{filters:t})=>({...e,...t})}],heatmapFixedPositionMode:["fixed",{setHeatmapFixedPositionMode:(e,{mode:t})=>t}],iframeWidth:[null,{setIframeWidth:(e,{width:t})=>t}],browserSearchTerm:["",{setBrowserSearch:(e,{searchTerm:t})=>t}],browserUrl:[null,{persist:!0,prefix:`${Ve}__`},{setBrowserUrl:(e,{url:t})=>t}],loading:[!1,{setBrowserUrl:(e,{url:t})=>t?.trim().length?!0:e,setIframeBanner:(e,{banner:t})=>t?.level=="error"?!1:e,startTrackingLoading:()=>!0,stopTrackingLoading:()=>!1}],iframeBanner:[null,{setIframeBanner:(e,{banner:t})=>t}]}),(0,f.selectors)({browserUrlSearchOptions:[e=>[e.browserSearchResults,e.topUrls,e.browserSearchTerm],(e,t,o)=>o?e:t?.map(a=>a.url)??[]],isBrowserUrlAuthorized:[e=>[e.browserUrl,e.checkUrlIsAuthorized],(e,t)=>e?t(e):!1],viewportRange:[e=>[e.heatmapFilters,e.iframeWidth],(e,t)=>t?N(e,t):{min:0,max:1800}],noPageviews:[e=>[e.topUrlsLoading,e.topUrls],(e,t)=>!e&&(!t||t.length===0)]}),(0,f.listeners)(({actions:e,cache:t,props:o,values:a})=>({setBrowserSearch:async(i,m)=>{await m(200),e.loadBrowserSearchResults()},sendToolbarMessage:({type:i,payload:m})=>{o.iframeRef?.current?.contentWindow?.postMessage({type:i,payload:m},"*")},patchHeatmapFilters:({filters:i})=>{e.sendToolbarMessage("ph-patch-heatmap-filters",{filters:i})},setHeatmapFixedPositionMode:({mode:i})=>{e.sendToolbarMessage("ph-heatmaps-fixed-position-mode",{fixedPositionMode:i})},setHeatmapColorPalette:({Palette:i})=>{e.sendToolbarMessage("ph-heatmaps-color-palette",{colorPalette:i})},setCommonFilters:({filters:i})=>{e.sendToolbarMessage("ph-heatmaps-common-filters",{commonFilters:i})},onIframeLoad:()=>{let i=()=>{e.sendToolbarMessage("ph-app-init",{filters:a.heatmapFilters,colorPalette:a.heatmapColorPalette,fixedPositionMode:a.heatmapFixedPositionMode,commonFilters:a.commonFilters}),e.sendToolbarMessage("ph-heatmaps-config",{enabled:!0})},m=n=>{let s=n?.data?.type;if(!(!s||!s.startsWith("ph-"))){if(!a.checkUrlIsAuthorized(n.origin)){console.warn("ignoring message from iframe with origin not in authorized toolbar urls",n.origin,n.data);return}switch(s){case"ph-toolbar-init":return i();case"ph-toolbar-ready":return B.capture("in-app heatmap frame loaded",{inapp_heatmap_page_url_visited:a.browserUrl,inapp_heatmap_filters:a.heatmapFilters,inapp_heatmap_color_palette:a.heatmapColorPalette,inapp_heatmap_fixed_position_mode:a.heatmapFixedPositionMode}),e.startTrackingLoading();case"ph-toolbar-heatmap-loading":return e.startTrackingLoading();case"ph-toolbar-heatmap-loaded":return B.capture("in-app heatmap loaded",{inapp_heatmap_page_url_visited:a.browserUrl,inapp_heatmap_filters:a.heatmapFilters,inapp_heatmap_color_palette:a.heatmapColorPalette,inapp_heatmap_fixed_position_mode:a.heatmapFixedPositionMode}),e.stopTrackingLoading();case"ph-toolbar-heatmap-failed":B.capture("in-app heatmap failed",{inapp_heatmap_page_url_visited:a.browserUrl,inapp_heatmap_filters:a.heatmapFilters,inapp_heatmap_color_palette:a.heatmapColorPalette,inapp_heatmap_fixed_position_mode:a.heatmapFixedPositionMode}),e.stopTrackingLoading(),e.setIframeBanner({level:"error",message:"The heatmap failed to load."});return;default:console.warn(`[PostHog Heatmaps] Received unknown child window message: ${s}`)}}};window.addEventListener("message",m,!1),i()},maybeLoadTopUrls:()=>{!a.topUrls&&!a.topUrlsLoading&&e.loadTopUrls()},setBrowserUrl:({url:i})=>{e.maybeLoadTopUrls(),i?.trim().length&&e.startTrackingLoading()},startTrackingLoading:()=>{e.setIframeBanner(null),clearTimeout(t.errorTimeout),t.errorTimeout=setTimeout(()=>{e.setIframeBanner({level:"error",message:"The heatmap failed to load (or is very slow)."})},7500),clearTimeout(t.warnTimeout),t.warnTimeout=setTimeout(()=>{e.setIframeBanner({level:"warning",message:"Still waiting for the toolbar to load."})},3e3)},stopTrackingLoading:()=>{e.setIframeBanner(null),clearTimeout(t.errorTimeout),clearTimeout(t.warnTimeout)}})),(0,f.afterMount)(({actions:e,values:t})=>{t.browserUrl?.trim().length?e.startTrackingLoading():e.maybeLoadTopUrls()}),(0,c.urlToAction)(({actions:e,values:t})=>({"/heatmaps":(o,a)=>{a.pageURL&&a.pageURL!==t.browserUrl&&e.setBrowserUrl(a.pageURL),a.heatmapFilters&&!z(a.heatmapFilters,t.heatmapFilters)&&e.patchHeatmapFilters(a.heatmapFilters),a.heatmapPalette&&a.heatmapPalette!==t.heatmapColorPalette&&e.setHeatmapColorPalette(a.heatmapPalette),a.heatmapFixedPositionMode&&a.heatmapFixedPositionMode!==t.heatmapFixedPositionMode&&e.setHeatmapFixedPositionMode(a.heatmapFixedPositionMode),a.commonFilters&&!z(a.commonFilters,t.commonFilters)&&e.setCommonFilters(a.commonFilters)}})),(0,c.actionToUrl)(({values:e})=>({setBrowserUrl:({url:t})=>{let o={...c.router.values.searchParams,pageURL:t};return(!t||t.trim()==="")&&delete o.pageURL,[c.router.values.location.pathname,o,c.router.values.hashParams,{replace:!0}]},patchHeatmapFilters:()=>{let t={...c.router.values.searchParams,heatmapFilters:e.heatmapFilters};return[c.router.values.location.pathname,t,c.router.values.hashParams,{replace:!0}]},setHeatmapColorPalette:({Palette:t})=>{let o={...c.router.values.searchParams,heatmapPalette:t};return[c.router.values.location.pathname,o,c.router.values.hashParams,{replace:!0}]},setHeatmapFixedPositionMode:({mode:t})=>{let o={...c.router.values.searchParams,heatmapFixedPositionMode:t};return[c.router.values.location.pathname,o,c.router.values.hashParams,{replace:!0}]},setCommonFilters:({filters:t})=>{let o={...c.router.values.searchParams,commonFilters:t};return[c.router.values.location.pathname,o,c.router.values.hashParams,{replace:!0}]}}))]);var r=d(F());function Qe(){let e=L(),{browserUrlSearchOptions:t,browserUrl:o}=(0,h.useValues)(e),{setBrowserSearch:a,setBrowserUrl:i}=(0,h.useActions)(e),m=t?.[0]??"https://your-website.com/pricing";return(0,r.jsxs)("div",{className:"bg-surface-primary p-2 border-b flex items-center gap-2",children:[(0,r.jsx)("span",{className:"flex-1",children:(0,r.jsx)(ce,{mode:"single",allowCustomValues:!0,placeholder:`e.g. ${m}`,onInputChange:n=>a(n),value:o?[o]:void 0,onChange:n=>i(n[0]??null),options:t?.map(n=>({label:n,key:n}))??[]})}),(0,r.jsx)(x,{type:"secondary",sideIcon:(0,r.jsx)(oe,{}),to:o?Q(o,{userIntent:"heatmaps"}):void 0,targetBlank:!0,disabledReason:o?void 0:"Select a URL first",children:"Open in toolbar"})]})}function Ge(){let e=L(),{topUrls:t,topUrlsLoading:o,noPageviews:a}=(0,h.useValues)(e),{setBrowserUrl:i}=(0,h.useActions)(e);return(0,r.jsx)("div",{className:"flex-1 flex flex-col items-center justify-center overflow-y-auto",children:(0,r.jsxs)("div",{className:"max-w-[50rem] py-6 px-3 h-full w-full",children:[(0,r.jsxs)("div",{className:"flex items-center flex-wrap gap-6",children:[(0,r.jsx)("div",{className:"w-50",children:(0,r.jsx)(we,{className:"w-full h-full"})}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("h2",{children:"Welcome to Heatmaps"}),(0,r.jsx)("p",{children:"Heatmaps are powered by the embedded JavaScript SDK and allow you to see a range of user interactions directly on your website via the Toolbar."}),(0,r.jsx)("p",{children:"You can also view heatmaps for any page on your website by entering the URL above. As long as the page has the PostHog Toolbar installed, and can be loaded in an iframe, you can view heatmaps for it."})]})]}),(0,r.jsx)("div",{className:"gap-y-px p-2 border bg-surface-primary rounded",children:o?(0,r.jsx)(de,{className:"h-10",repeat:10}):a?(0,r.jsx)(R,{type:"info",children:"No pageview events have been received yet. Once you have some data, you'll see the most viewed pages here."}):(0,r.jsx)(r.Fragment,{children:t?.map(({url:m})=>(0,r.jsx)(x,{fullWidth:!0,onClick:()=>i(m),children:m},m))})})]})})}function Ke(){let e=L(),{browserUrl:t}=(0,h.useValues)(e);return(0,r.jsxs)("div",{className:"flex-1 p-4 gap-y-4",children:[(0,r.jsxs)(R,{type:"error",children:[t," is not an authorized URL. Please add it to the list of authorized URLs to view heatmaps on this page."]}),(0,r.jsx)("h2",{children:"Authorized Toolbar URLs"}),(0,r.jsx)(Se,{type:"TOOLBAR_URLS"})]})}function Ze(){let e=L(),{heatmapFilters:t,heatmapColorPalette:o,heatmapFixedPositionMode:a,viewportRange:i,commonFilters:m,filterPanelCollapsed:n}=(0,h.useValues)(e),{patchHeatmapFilters:s,setHeatmapColorPalette:p,setHeatmapFixedPositionMode:g,setCommonFilters:_,toggleFilterPanelCollapsed:T}=(0,h.useActions)(e);return(0,r.jsx)("div",{className:(0,De.default)("flex flex-col gap-y-2 px-2 py-1 border-r",!n&&"w-100"),children:n?(0,r.jsx)(Y,{title:"Expand heatmap settings",children:(0,r.jsx)(x,{size:"small",icon:(0,r.jsx)(ae,{}),onClick:()=>T()})}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"flex flex-row items-center",children:[(0,r.jsx)(Y,{title:"Collapse heatmap settings",children:(0,r.jsx)(x,{size:"small",icon:(0,r.jsx)(ie,{className:"rotate-90"}),onClick:()=>T()})}),(0,r.jsx)("h2",{className:"flex-1 mb-0 px-2",children:"Heatmap settings"})]}),(0,r.jsx)(ge,{dateFrom:m.date_from,dateTo:m.date_to,onChange:(v,P)=>{_({date_from:v,date_to:P})},dateOptions:Ee}),(0,r.jsx)(Oe,{heatmapFilters:t,patchHeatmapFilters:s,viewportRange:i,heatmapColorPalette:o,setHeatmapColorPalette:p,heatmapFixedPositionMode:a,setHeatmapFixedPositionMode:g})]})})}function et(){let e=L(),{iframeBanner:t}=(0,h.useValues)(e);return t?(0,r.jsx)("div",{className:"absolute flex flex-col w-full h-full bg-blend-overlay items-start py-4 px-8 pointer-events-none",children:(0,r.jsxs)(R,{className:"w-full",type:t.level,children:[t.message,'. Your site might not allow being embedded in an iframe. You can click "Open in toolbar" above to visit your site and view the heatmap there.']})}):null}function tt(){return(0,r.jsx)("div",{className:"absolute flex flex-col w-full h-full items-center justify-center pointer-events-none",children:(0,r.jsx)(me,{className:"text-5xl",textColored:!0})})}function at({iframeRef:e}){let t=L(),{browserUrl:o,loading:a,iframeBanner:i}=(0,h.useValues)(t),{onIframeLoad:m,setIframeWidth:n}=(0,h.useActions)(t),{width:s}=le({ref:e});return(0,W.useEffect)(()=>{n(s??null)},[s]),o?(0,r.jsxs)("div",{className:"flex flex-row gap-x-2 w-full",children:[(0,r.jsx)(Ze,{}),(0,r.jsxs)("div",{className:"relative flex-1 w-full h-full",children:[a?(0,r.jsx)(tt,{}):null,!a&&i?(0,r.jsx)(et,{}):null,(0,r.jsx)("iframe",{ref:e,className:"w-full h-full bg-white",src:Q(o,{userIntent:"heatmaps"}),onLoad:m,sandbox:"allow-scripts allow-same-origin",allow:""})]})]}):null}function ot(){let{currentTeam:e}=(0,h.useValues)(ve),t=e?.heatmaps_opt_in,{openSettingsPanel:o}=(0,h.useActions)(ue);return t?null:(0,r.jsx)(R,{type:"warning",action:{type:"secondary",icon:(0,r.jsx)(ne,{}),onClick:()=>o({settingId:"heatmaps"}),children:"Configure"},dismissKey:"heatmaps-might-be-disabled-warning",children:"You aren't collecting heatmaps data. Enable heatmaps in your project."})}function $e(){let e=(0,W.useRef)(null),t={ref:e},o=L({iframeRef:e}),{browserUrl:a,isBrowserUrlAuthorized:i}=(0,h.useValues)(o);return(0,r.jsx)(h.BindLogic,{logic:L,props:t,children:(0,r.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,r.jsx)(ot,{}),(0,r.jsxs)("div",{className:"flex flex-col overflow-hidden w-full h-[90vh] rounded border",children:[(0,r.jsx)(Qe,{}),(0,r.jsx)("div",{className:"relative flex flex-1 bg-surface-primary overflow-hidden",children:a?(0,r.jsx)(r.Fragment,{children:i?(0,r.jsx)(at,{iframeRef:e}):(0,r.jsx)(Ke,{})}):(0,r.jsx)(Ge,{})})]})]})})}w();y();b();var J=d(S()),We=(0,J.kea)([(0,J.path)(["scenes","heatmaps","heatmapsSceneLogic"])]);var K=d(F()),Pa={component:rt,logic:We};function rt(){return(0,K.jsx)("div",{children:(0,K.jsx)($e,{})})}export{rt as HeatmapsScene,Pa as scene};
//# sourceMappingURL=/static/HeatmapsScene-JRLG334B.js.map
