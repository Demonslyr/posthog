import{Ae as x,Eo as f,Io as Q,Qd as T,Sd as b,Za as E,a as v,ee as R,na as w,r as M,vo as y,ze as S}from"/static/chunk-RFJTZKD6.js";import"/static/chunk-XPJ4MQJV.js";import"/static/chunk-3UDJFOQH.js";import"/static/chunk-HHT4SG7V.js";import"/static/chunk-K7LQKAJG.js";import"/static/chunk-QQTK3LZH.js";import"/static/chunk-IJQNM355.js";import"/static/chunk-4CN6THWS.js";import"/static/chunk-272RTCFX.js";import"/static/chunk-2ROB4QWU.js";import"/static/chunk-ALT2ZZSO.js";import"/static/chunk-UE6SLBBN.js";import"/static/chunk-GINZUAUY.js";import"/static/chunk-SQELCOUW.js";import"/static/chunk-IGYUTZ65.js";import"/static/chunk-YM6UBNGD.js";import"/static/chunk-C6TQ5FFZ.js";import"/static/chunk-GXGA523B.js";import"/static/chunk-N4MMWRNK.js";import"/static/chunk-NRLAI7OY.js";import"/static/chunk-LVVHNICT.js";import"/static/chunk-2AXSSSSX.js";import"/static/chunk-DGXQI7RB.js";import"/static/chunk-HUCRWDLX.js";import"/static/chunk-RFEQG3YN.js";import"/static/chunk-PUISI233.js";import{d as u,e as d,g as m,j as l}from"/static/chunk-SJXEOBQC.js";d();l();m();var L=u(v());d();l();m();var s=u(v()),k=u(E());var n=(0,s.kea)([(0,s.path)(["scenes","instance","DeadLetterQueue","deadLetterQueueLogic"]),(0,s.actions)({setActiveTab:e=>({tabKey:e}),loadMoreRows:e=>({key:e}),addRowsToMetric:(e,r)=>({key:e,rows:r})}),(0,s.reducers)({activeTab:["metrics",{setActiveTab:(e,{tabKey:r})=>r}],rowsPerMetric:[{},{addRowsToMetric:(e,{key:r,rows:i})=>({...e,[r]:[...e[r]||[],...i]}),loadDeadLetterQueueMetricsSuccess:(e,{deadLetterQueueMetrics:r})=>{let i={};for(let a of r)a.subrows&&(i[a.key]=a.subrows.rows);return i}}]}),(0,k.loaders)({deadLetterQueueMetrics:[[],{loadDeadLetterQueueMetrics:async()=>f.values.user?.is_staff?(await Q.get("api/dead_letter_queue")).results:[]}]}),(0,s.listeners)(({values:e,actions:r})=>({loadMoreRows:async({key:i})=>{let a=e.rowsPerMetric[i]?.length+1;if(a){let g=await Q.get(`api/dead_letter_queue/${i}?offset=${a}`);r.addRowsToMetric(i,g.subrows.rows)}}})),(0,s.selectors)({singleValueMetrics:[e=>[e.deadLetterQueueMetrics],e=>e.filter(r=>!r.subrows)],tableMetrics:[e=>[e.deadLetterQueueMetrics],e=>e.filter(r=>!!r.subrows)]}),(0,s.afterMount)(({actions:e})=>{e.loadDeadLetterQueueMetrics()})]);d();l();m();var p=u(v());var t=u(M()),V=10;function N(){let{user:e}=(0,p.useValues)(f),{singleValueMetrics:r,tableMetrics:i,deadLetterQueueMetricsLoading:a,rowsPerMetric:g}=(0,p.useValues)(n),{loadDeadLetterQueueMetrics:P,loadMoreRows:I}=(0,p.useActions)(n);return e?.is_staff?(0,t.jsxs)("div",{children:[(0,t.jsx)("br",{}),(0,t.jsx)("div",{className:"mb-4 float-right",children:(0,t.jsx)(b,{icon:a?(0,t.jsx)(T,{}):(0,t.jsx)(w,{}),onClick:P,type:"secondary",size:"small",children:"Refresh"})}),(0,t.jsx)("div",{className:"flex space-x-8 mb-4",children:r.map(c=>(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsx)("div",{children:c.metric}),(0,t.jsx)("div",{className:"text-2xl",children:(c.value||"0").toLocaleString("en-US")})]},c.key))}),i.map(c=>(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{children:c.metric}),(0,t.jsx)(S,{columns:[{title:c.subrows?.columns[0],dataIndex:"key"},{title:c.subrows?.columns[1],dataIndex:"value"}],dataSource:g[c.key].map(([A,q])=>({key:A,value:q}))||[],loading:a,defaultSorting:{columnKey:"value",order:-1},embedded:!0}),(0,t.jsx)("div",{className:"flex justify-center m-4 text-center",children:(0,t.jsx)(b,{disabledReason:g[c.key].length%V!==0&&"No more values",onClick:()=>I(c.key),children:"Load more values"})}),(0,t.jsx)(R,{})]},c.key))]}):(0,t.jsx)(t.Fragment,{})}var o=u(M()),ue={component:B,logic:n};function B(){let{user:e}=(0,L.useValues)(f),{activeTab:r}=(0,L.useValues)(n),{setActiveTab:i}=(0,L.useActions)(n);return e?.is_staff?(0,o.jsxs)("div",{children:[(0,o.jsx)(y,{caption:(0,o.jsx)(o.Fragment,{children:(0,o.jsx)("p",{children:"Manage your instance's dead letter queue."})})}),(0,o.jsx)(x,{activeKey:r,onChange:a=>i(a),tabs:[{label:"Metrics",key:"metrics"}]}),r==="metrics"?(0,o.jsx)(N,{}):null]}):(0,o.jsx)(y,{caption:(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("p",{children:"Only users with staff access can manage the dead letter queue. Please contact your instance admin."}),(0,o.jsxs)("p",{children:["If you're an admin and don't have access, set ",(0,o.jsx)("code",{children:"is_staff=true"})," for your user on the PostgreSQL ",(0,o.jsx)("code",{children:"posthog_user"})," table."]})]})})}export{B as DeadLetterQueue,ue as scene};
//# sourceMappingURL=/static/DeadLetterQueue-XRM7YS6L.js.map
