import{$m as m,Eo as b,Io as a,Za as R,a as O,fn as P,hg as c,mn as T,on as l}from"/static/chunk-TW5IU73S.js";import{d as u,e as p,g as f,j as d}from"/static/chunk-SJXEOBQC.js";p();d();f();var o=u(O()),C=u(R());var S=(0,o.kea)([(0,o.path)(["scenes","pipeline","transformationsLogic"]),(0,o.connect)({values:[c,["currentProjectId"],b,["user"]]}),(0,o.actions)({loadPluginConfigs:!0,openReorderModal:!0,closeReorderModal:!0,setTemporaryOrder:n=>({tempOrder:n}),savePluginConfigsOrder:n=>({newOrders:n}),updatePluginConfig:n=>({pluginConfig:n})}),(0,C.loaders)(({values:n})=>({plugins:[{},{loadPlugins:async()=>T("api/organizations/@current/pipeline_transformations")}],temporaryOrder:[{},{setTemporaryOrder:async({tempOrder:e})=>e,closeReorderModal:async()=>({})}],pluginConfigs:[{},{loadPluginConfigs:async()=>{let e=await a.loadPaginatedResults(`api/projects/${n.currentProjectId}/pipeline_transformation_configs`);return Object.fromEntries(e.map(r=>[r.id,r]))},savePluginConfigsOrder:async({newOrders:e})=>{if(!l("transformation",!1))return n.pluginConfigs;let{pluginConfigs:r}=n,i=await a.update("api/plugin_config/rearrange",{orders:e}),s={...r};for(let t of i)Object.keys(n.plugins).map(Number).includes(t.plugin)&&(s[t.id]=t);return s},toggleEnabled:async({id:e,enabled:r})=>{if(!l("transformation",r))return n.pluginConfigs;let{pluginConfigs:i,plugins:s}=n,t=i[e],y=s[t.plugin];P(`plugin ${r?"enabled":"disabled"}`,y,t);let g={};r&&(g={order:n.nextAvailableOrder});let w=await a.update(`api/plugin_config/${e}`,{enabled:r,...g});return{...i,[e]:w}},updatePluginConfig:({pluginConfig:e})=>({...n.pluginConfigs,[e.id]:e})}]})),(0,o.selectors)({loading:[n=>[n.pluginsLoading,n.pluginConfigsLoading],(n,e)=>n||e],transformations:[n=>[n.pluginConfigs,n.plugins],(n,e)=>Object.values(n).map(s=>({...s,plugin_info:e[s.plugin]||null})).map(s=>m(s,"transformation"))],sortedEnabledTransformations:[n=>[n.transformations,n.temporaryOrder],(n,e)=>(n=n.filter(r=>r.enabled),e&&Object.keys(e).length>0?n=Object.entries(e).sort(([,r],[,i])=>r-i).map(([r])=>n.find(i=>i.id===Number(r))):n=n.sort((r,i)=>r.order-i.order),n)],sortedTransformations:[n=>[n.transformations,n.sortedEnabledTransformations],(n,e)=>e.concat(n.filter(r=>!r.enabled).sort((r,i)=>r.id-i.id))],nextAvailableOrder:[n=>[n.transformations],n=>{let e=n.filter(r=>r.enabled);return e.length>0?Math.max(...e.map(r=>r.order),0)+1:0}]}),(0,o.reducers)({reorderModalOpen:[!1,{openReorderModal:()=>!0,closeReorderModal:()=>!1}]}),(0,o.listeners)(({actions:n})=>({savePluginConfigsOrderSuccess:()=>{n.closeReorderModal()}})),(0,o.afterMount)(({actions:n})=>{n.loadPlugins(),n.loadPluginConfigs()})]);export{S as a};
//# sourceMappingURL=/static/chunk-6RK4TW7P.js.map
