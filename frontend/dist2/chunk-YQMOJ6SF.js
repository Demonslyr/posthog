import{a as z,b as Ee,c as Ce}from"/static/chunk-KBW4LJ4R.js";import{d as Ne}from"/static/chunk-2BLYB5CU.js";import{d as De}from"/static/chunk-DT53MXPZ.js";import{j as Ge}from"/static/chunk-YDKHEMDP.js";import{$g as fe,Ae as de,Dc as re,Dl as xe,Do as _,Eo as Se,Gm as _e,Io as M,Ko as Pe,Mi as he,Ni as be,Og as ce,Pg as ge,Qd as te,Rd as oe,Sa as Y,Sd as ae,So as ke,Ta as j,Vd as ne,Wd as ie,Xj as ve,Za as W,_g as me,a as G,bk as Fe,cc as ee,cg as X,ch as ye,f as Z,fe as se,hg as A,ie as pe,ig as Q,m as O,pe as K,r as S,re as le,te as ue,tk as Te,up as Ie,vo as Re,wk as Le,ze as B}from"/static/chunk-TW5IU73S.js";import{Da as E,F as $,Ha as C,a as qe}from"/static/chunk-3UDJFOQH.js";import{d as u,e as m,g as f,j as y}from"/static/chunk-SJXEOBQC.js";m();y();f();var w=u(G()),Xe=u(Z());m();y();f();var N=u(G());var Oe=u(qe());m();y();f();var P=u(G());var Me=(0,P.kea)([(0,P.path)(["scenes","groups","groupDashboardLogic"]),(0,P.connect)({values:[Se,["user"]]}),(0,P.selectors)(()=>({groupDashboardId:[e=>[e.user],e=>{let r=e?.scene_personalisation?.find(n=>n.scene==="Group")?.dashboard;return typeof r=="number"?r:r?.id}],dashboardLogicProps:[e=>[e.groupDashboardId],e=>e?{id:e,placement:"group"}:null]}))]);var v=u(S());function je({groupData:e}){let{showSceneDashboardChoiceModal:r}=(0,N.useActions)(z({scene:"Group"})),{dashboardLogicProps:n}=(0,N.useValues)(Me);return(0,v.jsxs)(v.Fragment,{children:[n?.id!==void 0?(0,v.jsx)(Ze,{groupData:e,dashboardLogicProps:n}):(0,v.jsx)(Ce,{open:()=>{r()},scene:"Group"}),(0,v.jsx)(Ee,{scene:"Group"})]})}function Ze({groupData:e,dashboardLogicProps:r}){let{showSceneDashboardChoiceModal:n}=(0,N.useActions)(z({scene:"Group"})),{dashboard:p}=(0,N.useValues)(X(r)),{setProperties:i}=(0,N.useActions)(X(r));return(0,Oe.useEffect)(()=>{if(p&&e){let T=Array.isArray(p?.filters.properties)?p?.filters.properties:[],d={key:"id",value:[e.group_properties.id.toString()],operator:"exact",type:"group",group_type_index:e.group_type_index};T.some(o=>o.type==="group"&&o.group_type_index===e.group_type_index&&o.key==="id")||i([...T,d])}},[p,e]),(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("div",{className:"flex items-center justify-end mb-2",children:(0,v.jsx)(ae,{type:"secondary",size:"small","data-attr":"group-dashboard-change-dashboard",onClick:n,children:"Change dashboard"})}),(0,v.jsx)(De,{id:r.id.toString(),placement:r.placement})]})}m();y();f();var c=u(G()),Ke=u(W()),Be=u(Z());function Ye(e,r){return{kind:"DataTableNode",full:!0,source:{kind:"EventsQuery",select:Ie("EventsQuery"),after:"-24h",fixedProperties:[{key:`$group_${e}`,value:r,type:"event",operator:"exact"}]}}}var V=(0,c.kea)([(0,c.props)({}),(0,c.key)(e=>`${e.groupTypeIndex}-${e.groupKey}`),(0,c.path)(e=>["scenes","groups","groupLogic",e]),(0,c.connect)({values:[A,["currentProjectId"],Q,["groupTypes","aggregationLabel"],O,["featureFlags"]]}),(0,c.actions)(()=>({setGroupTab:e=>({groupTab:e}),setGroupEventsQuery:e=>({query:e})})),(0,Ke.loaders)(({values:e,props:r})=>({groupData:[null,{loadGroup:async()=>{let n={group_type_index:r.groupTypeIndex,group_key:r.groupKey},p=`api/projects/${e.currentProjectId}/groups/find?${E(n)}`;return await M.get(p)}}]})),(0,c.reducers)({groupTab:[null,{setGroupTab:(e,{groupTab:r})=>r}],groupEventsQuery:[null,{setGroupEventsQuery:(e,{query:r})=>ke(r)?r:null}]}),(0,c.selectors)({logicProps:[()=>[(e,r)=>r],e=>e],showCustomerSuccessDashboards:[e=>[e.featureFlags],e=>e[$.CS_DASHBOARDS]],groupTypeName:[(e,r)=>[e.aggregationLabel,r.groupTypeIndex],(e,r)=>e(r).singular],groupType:[(e,r)=>[e.groupTypes,r.groupTypeIndex],(e,r)=>e.get(r)?.group_type??null],breadcrumbs:[(e,r)=>[e.groupTypeName,r.groupTypeIndex,r.groupKey,e.groupData],(e,r,n,p)=>[{key:"DataManagement",name:"People",path:_.persons()},{key:r,name:C(e),path:_.groups(String(r))},{key:["Group",`${r}-${n}`],name:fe(n,p?.group_properties||{}),path:_.group(String(r),n)}]]}),(0,Be.urlToAction)(({actions:e})=>({"/groups/:groupTypeIndex/:groupKey(/:groupTab)":({groupTab:r})=>{e.setGroupTab(r||null)}})),(0,c.afterMount)(({actions:e,props:r})=>{e.loadGroup(),e.setGroupEventsQuery(Ye(r.groupTypeIndex,r.groupKey))})]);m();y();f();var U=u(G());m();y();f();var h=u(G()),Qe=u(W());var Ve=(0,h.kea)([(0,h.props)({}),(0,h.key)(e=>`${e.groupTypeIndex??"person"}-${e.id}`),(0,h.path)(["scenes","groups","relatedGroupsLogic"]),(0,h.connect)({values:[A,["currentProjectId"]]}),(0,h.actions)(()=>({loadRelatedActors:!0})),(0,Qe.loaders)(({values:e,props:r})=>({relatedActors:[[],{loadRelatedActors:async()=>{let n=`api/projects/${e.currentProjectId}/groups/related?${E({group_type_index:r.groupTypeIndex,id:r.id})}`;return await M.get(n)},setGroup:()=>[]}]})),(0,h.events)(({actions:e})=>({afterMount:e.loadRelatedActors}))]);var F=u(S());function He({groupTypeIndex:e,id:r}){let{relatedActors:n,relatedActorsLoading:p}=(0,U.useValues)(Ve({groupTypeIndex:e,id:r})),{aggregationLabel:i}=(0,U.useValues)(Q);return(0,F.jsx)(B,{dataSource:n,columns:[{title:"Type",key:"type",render:function(L,o){return o.type==="group"?(0,F.jsx)(F.Fragment,{children:C(i(o.group_type_index).singular)}):(0,F.jsxs)(F.Fragment,{children:[(0,F.jsx)(re,{})," Person"]})}},{title:"id",key:"id",render:function(L,o){return o.type=="group"?(0,F.jsx)(me,{actor:o}):(0,F.jsx)(Le,{person:o,withIcon:!1})}}],rowKey:"id",pagination:{pageSize:30,hideOnSinglePage:!0},loading:p,nouns:["related group","related groups"],emptyState:"No related groups found"})}m();y();f();var H=u(G());m();y();f();var g=u(G()),Je=u(W());var q=(0,g.kea)([(0,g.path)(["scenes","persons","relatedFeatureFlagsLogic"]),(0,g.connect)({values:[A,["currentProjectId"],ce,["featureFlags"]]}),(0,g.props)({}),(0,g.key)(e=>`${e.distinctId}`),(0,g.actions)({setSearchTerm:e=>({searchTerm:e}),setFilters:(e,r)=>({filters:e,replace:r}),loadRelatedFeatureFlags:!0}),(0,Je.loaders)(({values:e,props:r})=>({relatedFeatureFlags:[null,{loadRelatedFeatureFlags:async()=>await M.get(`api/projects/${e.currentProjectId}/feature_flags/evaluation_reasons?${E({distinct_id:r.distinctId,...r.groups?{groups:r.groups}:{}})}`)}]})),(0,g.reducers)({searchTerm:["",{setSearchTerm:(e,{searchTerm:r})=>r}],filters:[{},{setFilters:(e,{filters:r,replace:n})=>n?{...r}:{...e,...r}}]}),(0,g.selectors)(({props:e})=>({mappedRelatedFeatureFlags:[r=>[r.relatedFeatureFlags,r.featureFlags],(r,n)=>{if(r&&n){let p=n.results.map(i=>({...r[i.key],...i})).filter(i=>i.evaluation!==void 0);return e.groupTypeIndex!==void 0&&e.groups&&Object.keys(e.groups).length>0?p=p.filter(i=>i.filters.aggregation_group_type_index!==void 0&&i.filters.aggregation_group_type_index!==null&&i.filters.aggregation_group_type_index===e.groupTypeIndex):p=p.filter(i=>i.filters.aggregation_group_type_index===void 0||i.filters.aggregation_group_type_index===null),p}return[]}],filteredMappedFlags:[r=>[r.mappedRelatedFeatureFlags,r.searchTerm,r.filters],(r,n,p)=>{if(!n&&Object.keys(p).length===0)return r;let i=r;n&&(i=new le(r,{keys:["key","name"],threshold:.3}).search(n).map(o=>o.item));let{type:T,active:d,reason:L}=p;return T&&(i=i.filter(o=>T==="Multiple variants"?o.filters.multivariate:!o.filters.multivariate)),d&&(i=i.filter(o=>d==="true"?o.active:!o.active)),L&&(i=i.filter(o=>L==="not matched"?o.evaluation.reason!=="condition_match":o.evaluation.reason==="condition_match")),i}]})),(0,g.events)(({actions:e})=>({afterMount:e.loadRelatedFeatureFlags}))]);var a=u(S());var rr={condition_match:"Matches",no_condition_match:"Doesn't match any conditions",out_of_rollout_bound:"Out of rollout bound",no_group_type:"Missing group type",super_condition_value:"Matches early access condition",disabled:"Disabled"};function We({distinctId:e,groupTypeIndex:r,groups:n}){let{filteredMappedFlags:p,relatedFeatureFlagsLoading:i,searchTerm:T,filters:d}=(0,H.useValues)(q({distinctId:e,groupTypeIndex:r,groups:n})),{setSearchTerm:L,setFilters:o}=(0,H.useActions)(q({distinctId:e,groupTypeIndex:r,groups:n})),x=[{title:"Key",dataIndex:"key",className:"ph-no-capture",sticky:!0,width:"40%",sorter:(l,b)=>(l.key||"").localeCompare(b.key||""),render:function(b,s){let R=(s.experiment_set||[]).length>0;return(0,a.jsx)(ge,{to:s.id?_.featureFlag(s.id):void 0,title:(0,a.jsxs)(a.Fragment,{children:[xe(s.key,17),(0,a.jsx)(se,{type:R?"completion":"default",className:"ml-2",children:R?"Experiment":"Feature flag"})]}),description:s.name})}},{title:"Type",width:100,render:function(b,s){return s.filters.multivariate?"Multiple variants":"Release toggle"}},{title:"Value",dataIndex:"value",width:150,render:function(b,s){return(0,a.jsx)("div",{className:"break-words",children:s.active&&s.value?C(s.value.toString()):"False"})}},{title:(0,a.jsxs)("div",{className:"inline-flex items-center space-x-1",children:[(0,a.jsx)("div",{className:"",children:"Match evaluation"}),(0,a.jsx)(Y,{title:(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("div",{children:"This column simulates the feature flag evaluation based on the selected distinct ID, current properties, and groups associated with the user. If the actual flag value differs, it could be due to different inputs used during evaluation."}),(0,a.jsxs)("div",{children:["If you are using local flag evaluation, you must ensure that you provide any person properties, groups, or group properties used to evaluate the release conditions of the flag. Read more in the"," ",(0,a.jsx)(j,{to:"https://posthog.com/docs/feature-flags/local-evaluation#step-3-evaluate-your-feature-flag",children:"documentation."})]})]}),closeDelayMs:200,children:(0,a.jsx)(ee,{className:"text-secondary text-base ml-1"})})]}),dataIndex:"evaluation",width:150,render:function(b,s){let R=s.evaluation.reason==="condition_match";return(0,a.jsxs)("div",{children:[s.active?(0,a.jsx)(a.Fragment,{children:rr[s.evaluation.reason]}):"--",R&&(0,a.jsxs)(ue,{children:["Set ",(s.evaluation.condition_index??0)+1]})]})}},{title:"Status",dataIndex:"active",sorter:(l,b)=>Number(l.active)-Number(b.active),width:100,render:function(b,s){return(0,a.jsx)("span",{className:"font-normal",children:s.active?"Enabled":"Disabled"})}}],J=[{label:"All types",value:"all"},{label:"Release toggle",value:"Release toggle"},{label:"Multiple variants",value:"Multiple variants"}];return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex justify-between mb-4 gap-2 flex-wrap",children:[(0,a.jsx)(pe,{type:"search",placeholder:"Search for feature flags",onChange:L,value:T}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{children:(0,a.jsx)("b",{children:"Type"})}),(0,a.jsx)(K,{options:J,onChange:l=>{if(l)if(l==="all"){if(d){let{type:b,...s}=d;o(s,!0)}}else o({type:l})},value:d.type||"all",dropdownMaxContentWidth:!0}),(0,a.jsx)("span",{className:"ml-2",children:(0,a.jsx)("b",{children:"Match evaluation"})}),(0,a.jsx)(K,{options:[{label:"All",value:"all"},{label:"Matched",value:"condition_match"},{label:"Not matched",value:"not matched"}],onChange:l=>{if(l)if(l==="all"){if(d){let{reason:b,...s}=d;o(s,!0)}}else o({reason:l})},value:d.reason||"all",dropdownMaxContentWidth:!0}),(0,a.jsx)("span",{className:"ml-2",children:(0,a.jsx)("b",{children:"Flag status"})}),(0,a.jsx)(K,{onChange:l=>{if(l)if(l==="all"){if(d){let{active:b,...s}=d;o(s,!0)}}else o({active:l})},options:[{label:"All",value:"all"},{label:"Enabled",value:"true"},{label:"Disabled",value:"false"}],value:d.active||"all",dropdownMaxContentWidth:!0})]})]}),(0,a.jsx)(B,{columns:x,loading:i,dataSource:p})]})}var t=u(S()),xo={component:or,logic:V,paramsToProps:({params:{groupTypeIndex:e,groupKey:r}})=>({groupTypeIndex:parseInt(e??"0"),groupKey:decodeURIComponent(r??"")})};function tr({groupData:e,groupTypeName:r}){return(0,t.jsxs)("div",{className:"flex items-center flex-wrap",children:[(0,t.jsxs)("div",{className:"mr-4",children:[(0,t.jsx)("span",{className:"text-secondary",children:"Type:"})," ",r]}),(0,t.jsxs)("div",{className:"mr-4",children:[(0,t.jsx)("span",{className:"text-secondary",children:"Key:"})," ",(0,t.jsx)(he,{tooltipMessage:null,description:"group key",style:{display:"inline-flex",justifyContent:"flex-end"},children:e.group_key})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-secondary",children:"First seen:"})," ",e.created_at?(0,t.jsx)(ye,{time:e.created_at}):"unknown"]})]})}function or(){let{logicProps:e,groupData:r,groupDataLoading:n,groupTypeName:p,groupType:i,groupTab:T,groupEventsQuery:d,showCustomerSuccessDashboards:L}=(0,w.useValues)(V),{groupKey:o,groupTypeIndex:x}=e,{setGroupEventsQuery:J}=(0,w.useActions)(V),{currentTeam:l}=(0,w.useValues)(Pe),{featureFlags:b}=(0,w.useValues)(O);if(!r||!i)return n?(0,t.jsx)(oe,{sceneLevel:!0}):(0,t.jsx)(_e,{object:"group"});let s=b[$.ENVIRONMENTS]?"environment":"project";return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(Re,{caption:(0,t.jsx)(tr,{groupData:r,groupTypeName:p}),buttons:(0,t.jsx)(Te,{type:"secondary",resource:{type:"ph-group",attrs:{id:o,groupTypeIndex:x}}})}),(0,t.jsx)(de,{activeKey:T??"properties",onChange:R=>Xe.router.actions.push(_.group(String(x),o,!0,R)),tabs:[{key:"properties",label:(0,t.jsx)("span",{"data-attr":"groups-properties-tab",children:"Properties"}),content:(0,t.jsx)(be,{type:"group",properties:r.group_properties||{},embedded:!1,searchable:!0})},{key:"events",label:(0,t.jsx)("span",{"data-attr":"groups-events-tab",children:"Events"}),content:d?(0,t.jsx)(Ge,{query:d,setQuery:J,context:{alwaysRefresh:!0}}):(0,t.jsx)(te,{})},{key:"sessionRecordings",label:(0,t.jsx)("span",{"data-attr":"group-session-recordings-tab",children:"Recordings"}),content:(0,t.jsx)(t.Fragment,{children:l?.session_recording_opt_in?(0,t.jsx)("div",{className:"SessionRecordingPlaylistHeightWrapper",children:(0,t.jsx)(Ne,{logicKey:`groups-recordings-${o}-${x}`,updateSearchParams:!0,filters:{duration:[{type:"recording",key:"duration",value:1,operator:"gt"}],filter_group:{type:"AND",values:[{type:"AND",values:[{type:"events",name:"All events",properties:[{key:`$group_${x} = '${o}'`,type:"hogql"}]}]}]}},onFiltersChange:R=>{Fe(R).filter(ve)?.some(ze=>ze.properties?.some(Ue=>Ue.key===`$group_${x} = '${o}'`))||ne.warning("Group filter removed. Please add it back to see recordings for this group.")}})}):(0,t.jsx)("div",{className:"mb-4",children:(0,t.jsxs)(ie,{type:"info",children:["Session recordings are currently disabled for this ",s,". To use this feature, please go to your"," ",(0,t.jsx)(j,{to:`${_.settings("project")}#recordings`,children:"project settings"})," ","and enable it."]})})})},{key:"related",label:(0,t.jsx)("div",{className:"flex items-center","data-attr":"group-related-tab",children:"Related people & groups"}),tooltip:`People and groups that have shared events with this ${p} in the last 90 days.`,content:(0,t.jsx)(He,{id:o,groupTypeIndex:x})},{key:"featureFlags",label:(0,t.jsx)("span",{"data-attr":"groups-related-flags-tab",children:"Feature flags"}),tooltip:`Only shows feature flags with targeting conditions based on ${p} properties.`,content:(0,t.jsx)(We,{distinctId:r.group_key,groupTypeIndex:x,groups:{[i]:o}})},L?{key:"dashboard",label:"Dashboard",content:(0,t.jsx)(je,{groupData:r})}:null]})]})}export{V as a,He as b,We as c,xo as d,tr as e,or as f};
//# sourceMappingURL=/static/chunk-YQMOJ6SF.js.map
