import{a as Ae}from"/static/chunk-LZWHW4MC.js";import{a as An}from"/static/chunk-RSTRTBMR.js";import{a as fn}from"/static/chunk-DYVMG6MY.js";import{d as yn,s as Sn}from"/static/chunk-44P5EQSU.js";import{a as Fn}from"/static/chunk-GH3IWF3M.js";import{j as Un}from"/static/chunk-CBJ7RAUW.js";import{b as Qn,d as Ke}from"/static/chunk-OKGJSIGC.js";import{$ as ke,$a as Tt,$d as Te,$e as mt,$h as pn,Ad as $t,Ae as sn,Bb as wt,Bd as en,Cg as De,Dc as ge,De as dt,Do as S,Ee as dn,Fb as ot,Fc as q,Fm as Rn,Hd as lt,Io as ee,Ip as Yn,Ko as Bn,Ld as tn,Ll as Nn,Lo as xn,Ne as cn,Oi as bn,Pe as mn,Pg as ye,Pk as Zn,Q as ft,Qd as nn,Qk as Oe,Ra as Yt,Rd as Ee,Re as ct,Sa as re,Sd as W,So as Jn,Ta as Ce,Tc as Ot,Td as st,Tf as P,Tl as je,Ub as oe,V as Bt,Vb as Ht,Vd as Re,Vl as _e,Vo as pt,W as xt,Wc as jt,Wd as on,Xl as Se,Yb as at,Za as Et,_e as gn,_l as Vn,a as O,aj as ze,bb as Lt,bc as _,bm as Wn,bp as Xn,cc as Dt,ce as $,ch as pe,cj as Fe,ee as ae,f as Ct,fe as le,fi as hn,gd as _t,gj as In,h as St,hc as zt,hd as Pt,hg as gt,id as Kt,ie as Ge,km as Pe,kp as Mn,la as Jt,lp as kn,m as Me,na as Xt,nb as Ye,oe as Le,og as ut,pe as ue,pg as He,pm as Cn,qb as vt,qh as un,r as C,u as At,ud as rt,ue as an,ve,vo as Gn,wa as Mt,wd as qt,we as rn,xa as kt,xe as ln,ze as we}from"/static/chunk-RFJTZKD6.js";import{Ab as Qt,F as Xe,Ha as Rt,Ja as Gt,Tb as Ut,Xb as yt,Ya as Ft,a as Ue,g as it,na as Ve,vb as We}from"/static/chunk-3UDJFOQH.js";import{d as s,e as b,g as I,j as Z}from"/static/chunk-SJXEOBQC.js";b();Z();I();var ne=s(O());b();Z();I();var Qe=s(O()),ei=s(Ct());b();Z();I();var te=s(O()),En=s(Et());var qe=(0,te.kea)([(0,te.path)(["lib","components","Alerts","alertLogic"]),(0,te.props)({}),(0,te.key)(({alertId:e})=>e??"new"),(0,En.loaders)(({props:e})=>({alert:[null,{loadAlert:async()=>e.alertId?await ee.alerts.get(e.alertId):null}]})),(0,te.events)(({actions:e})=>({afterMount(){e.loadAlert()}}))]);b();Z();I();var se=s(O()),Ln=s(Et());var vn=(0,se.kea)([(0,se.path)(["lib","components","Alerts","alertsLogic"]),(0,Ln.loaders)({alerts:{__default:[],loadAlerts:async()=>(await ee.alerts.list()).results}}),(0,se.selectors)({alertsSortedByState:[e=>[e.alerts],e=>e.sort((n,t)=>Tn(n)-Tn(t))]}),(0,se.afterMount)(({actions:e})=>e.loadAlerts())]),Tn=e=>{if(!e.enabled)return 100;switch(e.state){case"Firing":return 1;case"Errored":return 2;case"Snoozed":return 3;case"Not firing":return 4}};b();Z();I();var de=s(O()),he=s(Tt());b();Z();I();var $e=s(O()),Hn=s(Ct());var V=s(C());function fe({alert:e}){switch(e.state){case"Firing":return(0,V.jsx)(le,{type:"danger",children:"FIRING"});case"Errored":return(0,V.jsx)(le,{type:"danger",children:"ERRORED"});case"Snoozed":return(0,V.jsx)(le,{type:"muted",children:"SNOOZED"});case"Not firing":return(0,V.jsx)(le,{type:"success",children:"NOT FIRING"})}}function Ri({alert:e,onClick:n}){let t=e.threshold?.configuration?.bounds,o=e.threshold?.configuration.type==="percentage";return(0,V.jsx)(W,{type:"secondary",onClick:n,"data-attr":"alert-list-item",fullWidth:!0,children:(0,V.jsxs)("div",{className:"flex justify-between flex-auto items-center p-2",children:[(0,V.jsxs)("div",{className:"flex flex-row gap-3 items-center",children:[(0,V.jsx)("span",{children:e.name}),(0,V.jsx)(fe,{alert:e}),e.enabled?(0,V.jsxs)("div",{className:"text-secondary pl-3",children:[t?.lower!=null&&`Low ${o?t.lower*100:t.lower}${o?"%":""}`,t?.lower!=null&&t?.upper!=null?" \xB7 ":"",t?.upper!=null&&`High ${o?t.upper*100:t.upper}${o?"%":""}`]}):(0,V.jsx)("div",{className:"text-secondary pl-3",children:"Disabled"})]}),(0,V.jsx)(bn,{limit:4,people:e.subscribed_users?.map(({email:r})=>({email:r}))})]})})}function mo(e){let{push:n}=(0,$e.useActions)(Hn.router),t=Nn(e),{alerts:o}=(0,$e.useValues)(t);return(0,V.jsxs)($,{onClose:e.onClose,isOpen:e.isOpen,width:600,simple:!0,title:"",children:[(0,V.jsx)($.Header,{children:(0,V.jsx)("h3",{className:"!m-0",children:"Manage Alerts"})}),(0,V.jsxs)($.Content,{children:[(0,V.jsxs)("div",{className:"mb-4",children:["With alerts, PostHog will monitor your insight and notify you when certain conditions are met. We do not evaluate alerts in real-time, but rather on a schedule (hourly, daily...).",(0,V.jsx)("br",{}),(0,V.jsx)(Ce,{to:S.alerts(),target:"_blank",children:"View all your alerts here"})]}),o.length?(0,V.jsxs)("div",{className:"space-y-2",children:[(0,V.jsxs)("div",{children:[(0,V.jsx)("strong",{children:o?.length})," ",Ut(o.length||0,"alert","alerts",!1)]}),o.map(r=>(0,V.jsx)(Ri,{alert:r,onClick:()=>n(S.insightAlert(e.insightShortId,r.id))},r.id))]}):(0,V.jsxs)("div",{className:"flex flex-col p-4 items-center text-center",children:[(0,V.jsx)("h3",{children:"There are no alerts for this insight"}),(0,V.jsx)("p",{children:"Once alerts are created they will display here. "})]})]}),(0,V.jsxs)($.Footer,{children:[(0,V.jsx)(W,{type:"primary",onClick:()=>n(S.insightAlert(e.insightShortId,"new")),children:"New alert"}),(0,V.jsx)(W,{type:"secondary",onClick:e.onClose,children:"Close"})]})]})}b();Z();I();var et=s(O());var Dn=s(Ue());var On=s(C());function zn({idKey:e,value:n,onChange:t}){let{filteredMembers:o,membersLoading:r}=(0,et.useValues)(mt),{ensureAllMembersLoaded:c}=(0,et.useActions)(mt);(0,Dn.useEffect)(()=>{c()},[]);let p=o.map(m=>({key:m.user[e].toString(),label:Gt(m.user),value:m.user[e]}));return(0,On.jsx)(an,{placeholder:"Search for team members to add\u2026",value:n.map(m=>m.toString()),loading:r,onChange:m=>{let l=o.filter(g=>m.includes(g.user[e].toString()));t(l.map(g=>g.user))},mode:"multiple",options:p,"data-attr":"subscribed-users"})}var qn=s(Ue());b();Z();I();var L=s(O()),jn=s(Tt());function bt(e){return(e?.condition.type==="absolute_value"||e?.condition.type==="relative_increase")&&e?.threshold.configuration.bounds?.upper!=null&&!isNaN(e?.threshold.configuration.bounds.upper)}var Fi=e=>e==null||e.length==0?{}:{upper:Math.min(...e.map(t=>t.value))},It=(0,L.kea)([(0,L.path)(["lib","components","Alerts","alertFormLogic"]),(0,L.props)({}),(0,L.key)(({alert:e})=>e?.id??"new"),(0,L.connect)(e=>({values:[Oe({dashboardId:void 0,...e.insightVizDataLogicProps}),["goalLines"]]})),(0,L.actions)({deleteAlert:!0,snoozeAlert:e=>({snoozeUntil:e}),clearSnooze:!0}),(0,jn.forms)(({props:e,values:n})=>({alertForm:{defaults:e.alert??{id:void 0,name:n.goalLines&&n.goalLines.length>0?`Crossed ${n.goalLines[0].label}`:"",created_by:null,created_at:"",enabled:!0,config:{type:"TrendsAlertConfig",series_index:0,check_ongoing_interval:!1},threshold:{configuration:{type:"absolute",bounds:Fi(n.goalLines)}},condition:{type:"absolute_value"},subscribed_users:[],checks:[],calculation_interval:"daily",skip_weekend:!1,insight:e.insightId},errors:({name:t})=>({name:t?void 0:"You need to give your alert a name"}),submit:async t=>{let o={...t,subscribed_users:t.subscribed_users?.map(({id:r})=>r),insight:e.insightId,skip_weekend:(t.calculation_interval==="daily"||t.calculation_interval==="hourly")&&t.skip_weekend,config:{...t.config,check_ongoing_interval:bt(t)&&t.config.check_ongoing_interval}};o.condition.type==="absolute_value"&&(o.threshold.configuration.type="absolute");try{if(t.id===void 0){let c=await ee.alerts.create(o);return Re.success("Alert created."),e.onEditSuccess(),c}let r=await ee.alerts.update(t.id,o);return Re.success("Alert saved."),e.onEditSuccess(),r}catch(r){let c=r.data?.attr?.replace(/_/g," ");throw Re.error(`Error saving alert: ${c}: ${r.detail}`),r}}}})),(0,L.listeners)(({props:e,values:n})=>({deleteAlert:async()=>{if(!n.alertForm.id)throw new Error("Cannot delete alert that doesn't exist");await ee.alerts.delete(n.alertForm.id),e.onEditSuccess()},snoozeAlert:async({snoozeUntil:t})=>{if(!n.alertForm.id)throw new Error("Cannot resolve alert that doesn't exist");await ee.alerts.update(n.alertForm.id,{snoozed_until:t}),e.onEditSuccess()},clearSnooze:async()=>{if(!n.alertForm.id)throw new Error("Cannot resolve alert that doesn't exist");await ee.alerts.update(n.alertForm.id,{snoozed_until:null}),e.onEditSuccess()}}))]);b();Z();I();var Kn=s(C()),_n="MMM D - HH:mm";function Pn({onChange:e,value:n}){return(0,Kn.jsx)(He,{dateFrom:n??null,onChange:t=>{t&&e(t)},placeholder:"Snooze until",max:31,isFixedDateMode:!0,showRollingRangePicker:!1,allowedRollingDateOptions:["days","weeks","months","years"],showCustom:!0,dateOptions:[{key:"Tomorrow",values:["+1d"],getFormattedDate:t=>We(t.add(1,"d"),_n),defaultInterval:"day"},{key:"One week from now",values:["+1w"],getFormattedDate:t=>We(t.add(1,"w"),_n),defaultInterval:"day"}],size:"medium"})}var i=s(C());function Qi({alert:e}){return!e.checks||e.checks.length===0?null:(0,i.jsxs)("div",{className:"bg-primary p-4 mt-10 rounded-lg",children:[(0,i.jsxs)("div",{className:"flex flex-row gap-2 items-center mb-2",children:[(0,i.jsx)("h3",{className:"m-0",children:"Current status: "}),(0,i.jsx)(fe,{alert:e}),(0,i.jsx)("h3",{className:"m-0",children:e.snoozed_until&&` until ${We((0,Ve.default)(e?.snoozed_until),"MMM D, HH:mm")}`})]}),(0,i.jsxs)("table",{className:"w-full table-auto border-spacing-2 border-collapse",children:[(0,i.jsx)("thead",{children:(0,i.jsxs)("tr",{className:"text-left",children:[(0,i.jsx)("th",{children:"Status"}),(0,i.jsx)("th",{className:"text-right",children:"Time"}),(0,i.jsx)("th",{className:"text-right pr-4",children:"Value"}),(0,i.jsx)("th",{children:"Targets notified"})]})}),(0,i.jsx)("tbody",{children:e.checks.map(n=>(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{children:n.state}),(0,i.jsx)("td",{className:"text-right",children:(0,i.jsx)(pe,{time:n.created_at})}),(0,i.jsx)("td",{className:"text-right pr-4",children:n.calculated_value}),(0,i.jsx)("td",{children:n.targets_notified?"Yes":"No"})]},n.id))})]})]})}function $n({isOpen:e,alertId:n,insightId:t,insightShortId:o,onClose:r,onEditSuccess:c,insightLogicProps:p}){let m=qe({alertId:n}),{alert:l,alertLoading:g}=(0,de.useValues)(m),{loadAlert:u}=(0,de.useActions)(m),X=(0,qn.useCallback)(()=>{u(),c()},[u,c]),Y={alert:l,insightId:t,onEditSuccess:X,insightVizDataLogicProps:p},E=It(Y),{alertForm:h,isAlertFormSubmitting:D,alertFormChanged:T}=(0,de.useValues)(E),{deleteAlert:M,snoozeAlert:U,clearSnooze:k}=(0,de.useActions)(E),{setAlertFormValue:w}=(0,de.useActions)(E),H=Oe({dashboardItemId:o}),{alertSeries:ie,isNonTimeSeriesDisplay:Q,isBreakdownValid:f,formula:N}=(0,de.useValues)(H),z=h.id===void 0,j=bt(h);return(0,i.jsx)($,{onClose:r,isOpen:e,width:600,simple:!0,title:"",children:g?(0,i.jsx)(Ee,{}):(0,i.jsxs)(he.Form,{logic:It,props:Y,formKey:"alertForm",enableFormOnSubmit:!0,className:"LemonModal__layout",children:[(0,i.jsx)($.Header,{children:(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsx)(W,{icon:(0,i.jsx)(ft,{}),onClick:r,size:"xsmall"}),(0,i.jsxs)("h3",{children:[z?"New":"Edit "," Alert"]})]})}),(0,i.jsxs)($.Content,{children:[(0,i.jsxs)("div",{className:"space-y-8",children:[(0,i.jsxs)("div",{className:"space-y-4",children:[(0,i.jsxs)("div",{className:"flex gap-4 items-center",children:[(0,i.jsx)(P,{className:"flex-auto",name:"name",children:(0,i.jsx)(Ge,{placeholder:"Alert name","data-attr":"alertForm-name"})}),(0,i.jsx)(P,{name:"enabled",children:(0,i.jsx)(Te,{checked:h?.enabled,"data-attr":"alertForm-enabled",fullWidth:!0,label:"Enabled"})})]}),l?.created_by?(0,i.jsx)(An,{at:l.created_at,by:l.created_by,prefix:"Created"}):null]}),(0,i.jsxs)("div",{className:"space-y-6",children:[(0,i.jsx)("h3",{children:"Definition"}),(0,i.jsxs)("div",{className:"space-y-5",children:[f&&(0,i.jsx)(on,{type:"warning",children:"For trends with breakdown, the alert will fire if any of the breakdown values breaches the threshold."}),(0,i.jsxs)("div",{className:"flex gap-4 items-center",children:[(0,i.jsx)("div",{children:"When"}),(0,i.jsx)(he.Group,{name:["config"],children:(0,i.jsx)(P,{name:"series_index",className:"flex-auto",children:(0,i.jsx)(ue,{fullWidth:!0,"data-attr":"alertForm-series-index",options:ie?.map(({custom_name:y,name:Ne,event:A},xe)=>({label:f?"any breakdown value":N?`Formula (${N})`:`${yt[xe]} - ${y??Ne??A}`,value:f||N?0:xe})),disabledReason:f&&`For trends with breakdown, the alert will fire if any of the breakdown
                                            values breaches the threshold.`||N&&"When using formula mode, can only alert on formula value"})})}),(0,i.jsx)(he.Group,{name:["condition"],children:(0,i.jsx)(P,{name:"type",children:(0,i.jsx)(ue,{fullWidth:!0,className:"w-40","data-attr":"alertForm-condition",options:[{label:"has value",value:"absolute_value"},{label:"increases by",value:"relative_increase",disabledReason:Q&&"This condition is only supported for time series trends"},{label:"decreases by",value:"relative_decrease",disabledReason:Q&&"This condition is only supported for time series trends"}]})})})]}),(0,i.jsxs)("div",{className:"flex gap-4 items-center",children:[(0,i.jsx)("div",{children:"less than"}),(0,i.jsx)(P,{name:"lower",children:(0,i.jsx)(Ge,{type:"number",className:"w-30","data-attr":"alertForm-lower-threshold",value:h.threshold.configuration.type==="percentage"&&h.threshold.configuration.bounds?.lower?h.threshold.configuration.bounds?.lower*100:h.threshold.configuration.bounds?.lower,onChange:y=>w("threshold",{configuration:{type:h.threshold.configuration.type,bounds:{...h.threshold.configuration.bounds,lower:y&&h.threshold.configuration.type==="percentage"?y/100:y}}})})}),(0,i.jsx)("div",{children:"or more than"}),(0,i.jsx)(P,{name:"upper",children:(0,i.jsx)(Ge,{type:"number",className:"w-30","data-attr":"alertForm-upper-threshold",value:h.threshold.configuration.type==="percentage"&&h.threshold.configuration.bounds?.upper?h.threshold.configuration.bounds?.upper*100:h.threshold.configuration.bounds?.upper,onChange:y=>w("threshold",{configuration:{type:h.threshold.configuration.type,bounds:{...h.threshold.configuration.bounds,upper:y&&h.threshold.configuration.type==="percentage"?y/100:y}}})})}),h.condition.type!=="absolute_value"&&(0,i.jsx)(he.Group,{name:["threshold","configuration"],children:(0,i.jsx)(P,{name:"type",children:(0,i.jsx)(Le,{options:[{value:"percentage",label:"%",tooltip:"Percent"},{value:"absolute",label:"#",tooltip:"Absolute number"}]})})})]}),(0,i.jsxs)("div",{className:"flex gap-4 items-center",children:[(0,i.jsx)("div",{children:h.condition.type==="absolute_value"?"check":"compare"}),(0,i.jsx)(P,{name:"calculation_interval",children:(0,i.jsx)(ue,{fullWidth:!0,className:"w-28","data-attr":"alertForm-calculation-interval",options:Object.values(ct).map(y=>({label:y,value:y}))})}),(0,i.jsx)("div",{children:"and notify"}),(0,i.jsx)("div",{className:"flex-auto",children:(0,i.jsx)(zn,{value:h.subscribed_users?.map(y=>y.id)??[],idKey:"id",onChange:y=>w("subscribed_users",y)})})]})]})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)("h3",{className:"text-secondary",children:"Advanced"}),(0,i.jsx)(he.Group,{name:["config"],children:(0,i.jsxs)("div",{className:"flex gap-1",children:[(0,i.jsx)(P,{name:"check_ongoing_interval",children:(0,i.jsx)(Te,{checked:j&&h?.config.check_ongoing_interval,"data-attr":"alertForm-check-ongoing-interval",fullWidth:!0,label:"Check ongoing period",disabledReason:!j&&"Can only alert for ongoing period when checking for absolute value/increase above threshold"})}),(0,i.jsx)(re,{title:"Checks the insight value for the on going period (current week/month) that hasn't yet completed. Use this if you want to be alerted right away when the insight value rises/increases above threshold",placement:"right",delayMs:0,children:(0,i.jsx)(Dt,{})})]})}),(0,i.jsx)(P,{name:"skip_weekend",children:(0,i.jsx)(Te,{checked:(h?.calculation_interval==="daily"||h?.calculation_interval==="hourly")&&h?.skip_weekend,"data-attr":"alertForm-skip-weekend",fullWidth:!0,label:"Skip checking on weekends",disabledReason:h?.calculation_interval!=="daily"&&h?.calculation_interval!=="hourly"&&"Can only skip weekend checking for hourly/daily alerts"})})]})]}),l&&(0,i.jsx)(Qi,{alert:l})]}),(0,i.jsxs)($.Footer,{children:[(0,i.jsx)("div",{className:"flex-1",children:(0,i.jsxs)("div",{className:"flex gap-2",children:[z?null:(0,i.jsx)(W,{type:"secondary",status:"danger",onClick:M,children:"Delete alert"}),!z&&l?.state==="Firing"?(0,i.jsx)(Pn,{onChange:U,value:l?.snoozed_until}):null,!z&&l?.state==="Snoozed"?(0,i.jsx)(W,{type:"secondary",status:"default",onClick:k,tooltip:`Currently snoozed until ${We((0,Ve.default)(l?.snoozed_until),"MMM D, HH:mm")}`,children:"Clear snooze"}):null]})}),(0,i.jsx)(W,{type:"primary",htmlType:"submit",loading:D,disabledReason:!T&&"No changes to save",children:z?"Create alert":"Save"})]})]})})}var R=s(C());function ti({alertId:e}){let{push:n}=(0,Qe.useActions)(ei.router),t=vn(),{loadAlerts:o}=(0,Qe.useActions)(t),{alertsSortedByState:r,alertsLoading:c}=(0,Qe.useValues)(t),{alert:p}=(0,Qe.useValues)(qe({alertId:e})),m=[{key:"id",width:32},{title:"Name",dataIndex:"name",key:"name",render:function(g,u){return(0,R.jsx)(R.Fragment,{children:(0,R.jsx)(ye,{to:S.alert(u.id),className:u.enabled?"":"text-muted",title:(0,R.jsx)("div",{className:"flex flex-row gap-3 items-center",children:(0,R.jsx)("div",{children:g})})})})}},{title:"Status",dataIndex:"state",render:function(g,u){return u.enabled?(0,R.jsx)(fe,{alert:u}):null}},{title:"Last checked",sorter:!0,dataIndex:"last_checked_at",render:function(g){return(0,R.jsx)("div",{className:"whitespace-nowrap",children:g&&(0,R.jsx)(pe,{time:g})})}},{title:"Last notified",sorter:!0,dataIndex:"last_notified_at",render:function(g){return(0,R.jsx)("div",{className:"whitespace-nowrap",children:g&&(0,R.jsx)(pe,{time:g})})}},Ke(),{title:"Insight",dataIndex:"insight",key:"insight",render:function(g){return(0,R.jsx)(ye,{to:S.insightView(g.short_id),title:(0,R.jsx)(re,{title:g.name,children:(0,R.jsx)("div",{children:g.name||g.derived_name})})})}},{title:"Enabled",dataIndex:"enabled",key:"enabled",render:l=>l?(0,R.jsx)(le,{type:"success",children:"ENABLED"}):(0,R.jsx)(le,{type:"danger",children:"DISABLED"})}];return(0,R.jsxs)(R.Fragment,{children:[r.length===0&&!c&&(0,R.jsx)(Fn,{productName:"Alerts",productKey:"alerts",thingName:"alert",description:"Alerts enable you to monitor your insight and notify you when certain conditions are met. Please note that alerts are in alpha and may not be fully reliable.",isEmpty:r.length===0&&!c,customHog:un,actionElementOverride:(0,R.jsx)("span",{className:"italic",children:"To get started, visit a trends insight, expand options in the header and click 'Manage Alerts'"})}),p&&(0,R.jsx)($n,{onClose:()=>n(S.alerts()),isOpen:!0,alertId:p.id,insightShortId:p.insight.short_id,insightId:p.insight.id,insightLogicProps:{dashboardItemId:p.insight.short_id},onEditSuccess:()=>{o(),n(S.alerts())}}),(0,R.jsx)(we,{loading:c,columns:m,dataSource:r,noSortingCancellation:!0,rowKey:"id",loadingSkeletonRows:5,nouns:["alert","alerts"],rowClassName:l=>l.state==="Not firing"?null:"highlighted"})]})}b();Z();I();b();Z();I();var si=s(St()),be=s(O());var nt=s(Ue());b();Z();I();var ii=s(Ue(),1),ce=s(Ue(),1);var Zt=new Map,tt=new WeakMap,ni=0,Ui=void 0;function yi(e){return e?(tt.has(e)||(ni+=1,tt.set(e,ni.toString())),tt.get(e)):"0"}function Si(e){return Object.keys(e).sort().filter(n=>e[n]!==void 0).map(n=>`${n}_${n==="root"?yi(e.root):e[n]}`).toString()}function Ai(e){let n=Si(e),t=Zt.get(n);if(!t){let o=new Map,r,c=new IntersectionObserver(p=>{p.forEach(m=>{var l;let g=m.isIntersecting&&r.some(u=>m.intersectionRatio>=u);e.trackVisibility&&typeof m.isVisible>"u"&&(m.isVisible=g),(l=o.get(m.target))==null||l.forEach(u=>{u(g,m)})})},e);r=c.thresholds||(Array.isArray(e.threshold)?e.threshold:[e.threshold||0]),t={id:n,observer:c,elements:o},Zt.set(n,t)}return t}function fi(e,n,t={},o=Ui){if(typeof window.IntersectionObserver>"u"&&o!==void 0){let l=e.getBoundingClientRect();return n(o,{isIntersecting:o,target:e,intersectionRatio:typeof t.threshold=="number"?t.threshold:0,time:0,boundingClientRect:l,intersectionRect:l,rootBounds:l}),()=>{}}let{id:r,observer:c,elements:p}=Ai(t),m=p.get(e)||[];return p.has(e)||p.set(e,m),m.push(n),c.observe(e),function(){m.splice(m.indexOf(n),1),m.length===0&&(p.delete(e),c.unobserve(e)),p.size===0&&(c.disconnect(),Zt.delete(r))}}function oi({threshold:e,delay:n,trackVisibility:t,rootMargin:o,root:r,triggerOnce:c,skip:p,initialInView:m,fallbackInView:l,onChange:g}={}){var u;let[X,Y]=ce.useState(null),E=ce.useRef(),[h,D]=ce.useState({inView:!!m,entry:void 0});E.current=g,ce.useEffect(()=>{if(p||!X)return;let k;return k=fi(X,(w,H)=>{D({inView:w,entry:H}),E.current&&E.current(w,H),H.isIntersecting&&c&&k&&(k(),k=void 0)},{root:r,rootMargin:o,threshold:e,trackVisibility:t,delay:n},l),()=>{k&&k()}},[Array.isArray(e)?e.toString():e,X,r,o,c,p,t,l,n]);let T=(u=h.entry)==null?void 0:u.target,M=ce.useRef();!X&&T&&!c&&!p&&M.current!==T&&(M.current=T,D({inView:!!m,entry:void 0}));let U=[Y,h.inView,h.entry];return U.ref=U[0],U.inView=U[1],U.entry=U[2],U}b();Z();I();var Be=s(O());b();Z();I();var Nt=s(St());var G=s(C());function ai({ribbonColor:e,showEditingControls:n,showDetailsControls:t,refresh:o,refreshDisabledReason:r,content:c,metaDetails:p,moreButtons:m,topHeading:l,areDetailsShown:g,setAreDetailsShown:u,className:X,samplingFactor:Y}){let{ref:E,width:h}=lt(),{ref:D,height:T}=lt(),M=!!h&&h>480;return(0,G.jsxs)("div",{className:(0,Nt.default)("CardMeta",X,g&&"CardMeta--details-shown"),children:[(0,G.jsxs)("div",{className:"CardMeta__primary",ref:E,children:[e&&e!=="white"&&(0,G.jsx)("div",{className:(0,Nt.default)("CardMeta__ribbon",e)}),(0,G.jsxs)("div",{className:"CardMeta__main",children:[(0,G.jsxs)("div",{className:"CardMeta__top",children:[(0,G.jsxs)("h5",{children:[l,Y&&Y<1&&(0,G.jsx)(re,{title:`Results calculated from ${100*Y}% of users`,placement:"right",children:(0,G.jsx)(q,{className:"ml-1.5 text-base align-[-0.25em]",style:{color:"var(--primary-3000-hover)"}})})]}),(0,G.jsxs)("div",{className:"CardMeta__controls",children:[t&&u&&(0,G.jsx)(W,{icon:g?(0,G.jsx)(xt,{}):(0,G.jsx)(Bt,{}),onClick:()=>u(U=>!U),size:"small",active:g,children:M&&`${g?"Hide":"Show"} details`}),n&&o&&(0,G.jsx)(W,{icon:(0,G.jsx)(Xt,{}),size:"small",onClick:()=>o(),disabledReason:r}),n&&(0,G.jsx)(ve,{overlay:m})]})]}),c]})]}),(0,G.jsx)("div",{className:"CardMeta__divider"}),(0,G.jsx)("div",{className:"CardMeta__details",style:{height:g&&T?T+1:0},children:(0,G.jsx)(At,{in:g,timeout:200,mountOnEnter:!0,unmountOnExit:!0,children:(0,G.jsx)("div",{className:"CardMeta__details__content",ref:D,children:(0,G.jsx)("div",{className:"p-4",children:p})})})})]})}b();Z();I();var me=s(C());function ri({query:e}){let n;e?.kind?Jn(e)&&Xn(e)||pt(e)?n=K[e.source.kind]:n=K[e.kind]:n=K.TrendsQuery;let t,o;if(e){let c=kn(e);c&&(t=c.date_from,o=c.date_to)}let r=null;if(n?.name!=="Retention"){let c=e==null||Mn(e)||pt(e)?"Last 7 days":null;r=Qt(t,o,c)}return(0,me.jsxs)(me.Fragment,{children:[(0,me.jsx)("span",{title:n?.description,children:n?.name}),r?(0,me.jsxs)(me.Fragment,{children:[" \u2022 ",r]}):null]})}var d=s(C());function li({insight:e,ribbonColor:n,dashboardId:t,updateColor:o,variablesOverride:r,removeFromDashboard:c,deleteWithUndo:p,refresh:m,refreshEnabled:l,loading:g,rename:u,duplicate:X,moveToDashboard:Y,areDetailsShown:E,setAreDetailsShown:h,showEditingControls:D=!0,showDetailsControls:T=!0,moreButtons:M}){let{short_id:U,name:k,dashboards:w,next_allowed_client_refresh:H}=e,{insightProps:ie}=(0,Be.useValues)(Se),{exportContext:Q}=(0,Be.useValues)(je(ie)),{samplingFactor:f}=(0,Be.useValues)(pn(ie)),{nameSortedDashboards:N}=(0,Be.useValues)(Pe),z=N.filter(A=>!w?.includes(A.id)),j=e.effective_privilege_level>=37,y=_e()(e.query),Ne=H&&(0,Ve.default)(H).isAfter((0,Ve.default)())?"You are viewing the most recent calculated results.":g||!l?"Refreshing...":void 0;return(0,d.jsx)(ai,{ribbonColor:n,showEditingControls:D,showDetailsControls:T,refresh:m,refreshDisabledReason:Ne,setAreDetailsShown:h,areDetailsShown:E,topHeading:(0,d.jsx)(ri,{query:e.query}),content:(0,d.jsx)(xi,{link:S.insightView(U,t,r),title:k,fallbackTitle:y,description:e.description,loading:g,tags:e.tags}),metaDetails:(0,d.jsx)(yn,{query:e.query,footerInfo:e}),samplingFactor:f,moreButtons:(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(W,{to:S.insightView(U,t,r),fullWidth:!0,children:"View"}),m&&(0,d.jsx)(W,{onClick:()=>{m()},disabledReason:Ne,fullWidth:!0,children:"Refresh"})]}),j&&o&&(0,d.jsx)(st,{dropdown:{overlay:Object.values(it).map(A=>(0,d.jsx)(W,{active:A===(n||"white"),onClick:()=>o(A),icon:A!=="white"?(0,d.jsx)(Cn,{color:A}):null,fullWidth:!0,children:A!=="white"?Rt(A):"No color"},A)),placement:"right-start",fallbackPlacements:["left-start"],actionable:!0,closeParentPopoverOnClickInside:!0},fullWidth:!0,children:"Set color"}),j&&Y&&z.length>0&&(0,d.jsx)(st,{dropdown:{overlay:z.map(A=>(0,d.jsx)(W,{onClick:()=>{Y(A)},fullWidth:!0,children:A.name||(0,d.jsx)("i",{children:"Untitled"})},A.id)),placement:"right-start",fallbackPlacements:["left-start"],actionable:!0,closeParentPopoverOnClickInside:!0},fullWidth:!0,children:"Move to"}),(0,d.jsx)(ae,{}),j&&(0,d.jsx)(W,{to:S.insightEdit(U),fullWidth:!0,children:"Edit"}),j&&(0,d.jsx)(W,{onClick:u,fullWidth:!0,children:"Rename"}),(0,d.jsx)(W,{onClick:X,fullWidth:!0,"data-attr":t?"duplicate-insight-from-dashboard":"duplicate-insight-from-card-list-view",children:"Duplicate"}),Q?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(ae,{}),(0,d.jsx)(Zn,{fullWidth:!0,items:[{export_format:"image/png",insight:e.id,dashboard:ie.dashboardId},{export_format:"text/csv",export_context:Q},{export_format:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",export_context:Q}]})]}):null,M&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(ae,{}),M]}),j&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(ae,{}),c?(0,d.jsx)(W,{status:"danger",onClick:c,fullWidth:!0,children:"Remove from dashboard"}):(0,d.jsx)(W,{status:"danger",onClick:()=>{(async()=>{try{await p?.()}catch(A){Re.error(`Failed to delete insight meta: ${A.detail}`)}})()},fullWidth:!0,children:"Delete insight"})]})]})})}function xi({title:e,fallbackTitle:n,description:t,link:o,loading:r,tags:c}){let p=(0,d.jsxs)("h4",{title:e,"data-attr":"insight-card-title",children:[e||(0,d.jsx)("i",{children:n||"Untitled"}),r&&(0,d.jsx)(re,{title:"This insight is queued to check for newer results. It will be updated soon.",placement:"top-end",children:(0,d.jsxs)("span",{className:"text-accent-primary text-sm font-medium ml-1.5",children:[(0,d.jsx)(nn,{className:"mr-1.5 text-base"}),"Refreshing"]})})]});return o&&(p=(0,d.jsx)(Ce,{to:o,children:p})),(0,d.jsxs)(d.Fragment,{children:[p,!!t&&(0,d.jsx)(mn,{className:"CardMeta__description",lowKeyHeadings:!0,children:t}),c&&c.length>0&&(0,d.jsx)(De,{tags:c,staticOnly:!0}),(0,d.jsx)(tn,{loading:r})]})}var v=s(C());function Ji({insight:e,dashboardId:n,ribbonColor:t,loadingQueued:o,loading:r,apiErrored:c,timedOut:p,highlighted:m,showResizeHandles:l,canResizeWidth:g,showEditingControls:u,showDetailsControls:X,updateColor:Y,removeFromDashboard:E,deleteWithUndo:h,refresh:D,refreshEnabled:T,rename:M,duplicate:U,moveToDashboard:k,className:w,moreButtons:H,placement:ie,loadPriority:Q,doNotLoad:f,variablesOverride:N,children:z,...j},y){let{featureFlags:Ne}=(0,be.useValues)(Me),{ref:A,inView:xe}=oi(),{isVisible:hi}=Rn(),bi=Ne[Xe.EXPERIMENTAL_DASHBOARD_ITEM_RENDERING]===!0?xe&&hi:!0,Ii=Yt([y,A]),{theme:Zi}=(0,be.useValues)(cn),Je={dashboardItemId:e.short_id,dashboardId:n,cachedInsight:e,loadPriority:Q,doNotLoad:f},{insightLoading:Ni}=(0,be.useValues)(Se(Je)),{insightDataLoading:Vi}=(0,be.useValues)(je(Je));(Ni||Vi)&&(r=!0);let[Wi,Ci]=(0,nt.useState)(!1);return(0,v.jsx)("div",{className:(0,si.default)("InsightCard border",m&&"InsightCard--highlighted",w),"data-attr":"insight-card",...j,style:{...j?.style??{},...Zi?.boxStyle??{}},ref:Ii,children:bi?(0,v.jsxs)(hn,{tags:{feature:"insight"},children:[(0,v.jsxs)(be.BindLogic,{logic:Se,props:Je,children:[(0,v.jsx)(li,{insight:e,ribbonColor:t,dashboardId:n,updateColor:Y,removeFromDashboard:E,deleteWithUndo:h,refresh:D,refreshEnabled:T,loading:o||r,rename:M,duplicate:U,moveToDashboard:k,areDetailsShown:Wi,setAreDetailsShown:Ci,showEditingControls:u,showDetailsControls:X,moreButtons:H,variablesOverride:N}),(0,v.jsx)("div",{className:"InsightCard__viz",children:(0,v.jsx)(Un,{query:e.query,cachedResults:e,context:{insightProps:Je},readOnly:!0,embedded:!0,inSharedMode:ie==="public",variablesOverride:N})})]}),l&&(0,v.jsxs)(v.Fragment,{children:[g?(0,v.jsx)(dt,{orientation:"vertical"}):null,(0,v.jsx)(dt,{orientation:"horizontal"}),g?(0,v.jsx)(dn,{}):null]}),z]}):null})}var Vt=nt.default.forwardRef(Ji);b();Z();I();var Ie=s(C());function di(e){return Object.entries(Wt).filter(([t])=>t!=="JSON").map(([t,o])=>o.inMenu&&(0,Ie.jsx)(W,{icon:o.icon&&(0,Ie.jsx)(o.icon,{}),to:Vn[t],"data-attr":e,"data-attr-insight-type":t,onClick:()=>{Yn.actions.reportSavedInsightNewInsightClicked(t)},fullWidth:!0,children:(0,Ie.jsxs)("div",{className:"flex flex-col text-sm py-1",children:[(0,Ie.jsx)("strong",{children:o.name}),(0,Ie.jsx)("span",{className:"text-xs font-sans font-normal",children:o.description})]})},t))}b();Z();I();var ci=s(O());var F=s(C());function mi({filters:e,setFilters:n}){let{nameSortedDashboards:t}=(0,ci.useValues)(Pe),{tab:o,createdBy:r,insightType:c,dateFrom:p,dateTo:m,dashboardId:l,search:g}=e;return(0,F.jsxs)("div",{className:"flex justify-between gap-2 mb-2 items-center flex-wrap",children:[(0,F.jsx)(Ge,{type:"search",placeholder:"Search for insights",onChange:u=>n({search:u}),value:g||""}),(0,F.jsxs)("div",{className:"flex items-center gap-2 flex-wrap",children:[t.length>0&&(0,F.jsxs)("div",{className:"flex items-center gap-2",children:[(0,F.jsx)("span",{children:"On dashboard:"}),(0,F.jsx)(ue,{size:"small",options:t.map(u=>({value:u.id,label:u.name})),value:l,onChange:u=>{n({dashboardId:u})},dropdownMatchSelectWidth:!1,"data-attr":"insight-on-dashboard",allowClear:!0})]}),(0,F.jsxs)("div",{className:"flex items-center gap-2",children:[(0,F.jsx)("span",{children:"Type:"}),(0,F.jsx)(ue,{size:"small",options:gi,value:c,onChange:u=>n({insightType:u}),dropdownMatchSelectWidth:!1,"data-attr":"insight-type"})]}),(0,F.jsxs)("div",{className:"flex items-center gap-2",children:[(0,F.jsx)("span",{children:"Last modified:"}),(0,F.jsx)(He,{disabled:!1,dateFrom:p,dateTo:m,onChange:(u,X)=>n({dateFrom:u,dateTo:X??void 0}),makeLabel:u=>(0,F.jsxs)(F.Fragment,{children:[(0,F.jsx)(vt,{}),(0,F.jsxs)("span",{className:"hide-when-small",children:[" ",u]})]})})]}),o!=="yours"?(0,F.jsxs)("div",{className:"flex items-center gap-2",children:[(0,F.jsx)("span",{children:"Created by:"}),(0,F.jsx)(fn,{value:r==="All users"?null:r,onChange:u=>n({createdBy:u?.id||"All users"})})]}):null]})]})}b();Z();I();var ui=s(O());var Ze=s(C());function pi(){let{currentTeamId:e}=(0,ui.useValues)(Bn),n=localStorage.getItem(`draft-query-${e}`),t=null;if(n){let o=Wn(n);o?t=o:localStorage.removeItem(`draft-query-${e}`)}return t?.query?(0,Ze.jsxs)("div",{className:"text-secondary mb-4",children:["You have an unsaved insight from ",new Date(t.timestamp).toLocaleString(),"."," ",(0,Ze.jsx)(Ce,{to:S.insightNew({query:t.query}),children:"Click here"})," to view it."]}):(0,Ze.jsx)(Ze.Fragment,{children:" "})}var a=s(C()),K={TrendsQuery:{name:"Trends",description:"Visualize and break down how actions or events vary over time.",icon:rt,inMenu:!0},FunnelsQuery:{name:"Funnel",description:"Discover how many users complete or drop out of a sequence of actions.",icon:Ht,inMenu:!0},RetentionQuery:{name:"Retention",description:"See how many users return on subsequent days after an initial action.",icon:jt,inMenu:!0},PathsQuery:{name:"Paths",description:"Trace the journeys users take within your product and where they drop off.",icon:$t,inMenu:!0},StickinessQuery:{name:"Stickiness",description:"See what keeps users coming back by viewing the interval between repeated actions.",icon:Kt,inMenu:!0},LifecycleQuery:{name:"Lifecycle",description:"Understand growth by breaking down new, resurrected, returning and dormant users.",tooltipDescription:"Understand growth by breaking down new, resurrected, returning and dormant users. Doesn't include anonymous events and users/groups appear as new when they are first identified.",icon:zt,inMenu:!0},FunnelCorrelationQuery:{name:"Funnel Correlation",description:"See which events or properties correlate to a funnel result.",icon:wt,inMenu:!1},EventsNode:{name:"Events",description:"List and explore events.",icon:ot,inMenu:!0},ActionsNode:{name:"Actions",description:"List and explore actions.",icon:Jt,inMenu:!0},DataWarehouseNode:{name:"Data Warehouse",description:"List and explore data warehouse tables.",icon:ke,inMenu:!0},EventsQuery:{name:"Events Query",description:"List and explore events.",icon:ot,inMenu:!0},PersonsNode:{name:"Persons",description:"List and explore your persons.",icon:ge,inMenu:!0},ActorsQuery:{name:"Persons",description:"List of persons matching specified conditions.",icon:ge,inMenu:!1},InsightActorsQuery:{name:"Persons",description:"List of persons matching specified conditions, derived from an insight.",icon:ge,inMenu:!1},InsightActorsQueryOptions:{name:"Persons",description:"Options for InsightActorsQuery.",icon:ge,inMenu:!1},FunnelsActorsQuery:{name:"Persons",description:"List of persons matching specified conditions, derived from an insight.",icon:ge,inMenu:!1},FunnelCorrelationActorsQuery:{name:"Persons",description:"List of persons matching specified conditions, derived from an insight.",icon:ge,inMenu:!1},DataTableNode:{name:"Data table",description:"Slice and dice your data in a table.",icon:ke,inMenu:!0},DataVisualizationNode:{name:"Data visualization",description:"Slice and dice your data in a table or chart.",icon:ke,inMenu:!1},SavedInsightNode:{name:"Insight visualization by short id",description:"View your insights.",icon:at,inMenu:!0},InsightVizNode:{name:"Insight visualization",description:"View your insights.",icon:at,inMenu:!0},SessionsTimelineQuery:{name:"Sessions",description:"Sessions timeline query.",icon:rt,inMenu:!0},HogQLQuery:{name:"SQL",description:"Direct SQL query.",icon:Ye,inMenu:!0},HogQLASTQuery:{name:"SQL AST",description:"Direct SQL AST query.",icon:Ye,inMenu:!1},HogQLMetadata:{name:"SQL Metadata",description:"Metadata for a SQL query.",icon:_,inMenu:!0},HogQLAutocomplete:{name:"SQL Autocomplete",description:"Autocomplete for the SQL query editor.",icon:_,inMenu:!1},DatabaseSchemaQuery:{name:"Database Schema",description:"Introspect the PostHog database schema.",icon:_,inMenu:!0},WebOverviewQuery:{name:"Overview Stats",description:"View overview stats for a website.",icon:q,inMenu:!0},WebStatsTableQuery:{name:"Web Table",description:"A table of results from web analytics, with a breakdown.",icon:q,inMenu:!0},WebGoalsQuery:{name:"Goals",description:"View goal conversions.",icon:q,inMenu:!0},WebExternalClicksTableQuery:{name:"External click urls",description:"View clicks on external links.",icon:q,inMenu:!0},WebVitalsQuery:{name:"Web vitals",description:"View web vitals.",icon:q,inMenu:!0},WebVitalsPathBreakdownQuery:{name:"Web vitals path breakdown",description:"View web vitals broken down by path.",icon:q,inMenu:!0},HogQuery:{name:"Hog",description:"Hog query.",icon:_,inMenu:!0},SessionAttributionExplorerQuery:{name:"Session Attribution",description:"Session Attribution Explorer.",icon:q,inMenu:!0},ErrorTrackingQuery:{name:"Error Tracking",description:"List and explore exception groups.",icon:en,inMenu:!1},RecordingsQuery:{name:"Session Recordings",description:"View available recordings.",icon:qt,inMenu:!1},ExperimentQuery:{name:"Experiment Result",description:"View experiment result.",icon:oe,inMenu:!1},ExperimentExposureQuery:{name:"Experiment Exposure",description:"View experiment exposure.",icon:oe,inMenu:!1},ExperimentTrendsQuery:{name:"Experiment Trends Result",description:"View experiment trend result.",icon:oe,inMenu:!1},ExperimentFunnelsQuery:{name:"Experiment Funnels Result",description:"View experiment funnel result.",icon:oe,inMenu:!1},ExperimentMetric:{name:"Experiment Metric",description:"Experiment metric configuration.",icon:oe,inMenu:!1},ExperimentEventMetricConfig:{name:"Experiment Event Metric Config",description:"Configuration for experiment event metrics.",icon:oe,inMenu:!1},ExperimentActionMetricConfig:{name:"Experiment Action Metric Config",description:"Configuration for experiment action metrics.",icon:oe,inMenu:!1},ExperimentDataWarehouseMetricConfig:{name:"Experiment Data Warehouse Metric Config",description:"Configuration for experiment data warehouse metrics.",icon:oe,inMenu:!1},TeamTaxonomyQuery:{name:"Team Taxonomy",icon:_,inMenu:!1},EventTaxonomyQuery:{name:"Event Taxonomy",icon:_,inMenu:!1},SuggestedQuestionsQuery:{name:"AI Suggested Questions",icon:_,inMenu:!1},ActorsPropertyTaxonomyQuery:{name:"Actor Property Taxonomy",description:"View the taxonomy of the actor's property.",icon:_,inMenu:!1},TracesQuery:{name:"LLM Observability Traces",icon:Lt,inMenu:!1}},Wt={TRENDS:K.TrendsQuery,FUNNELS:K.FunnelsQuery,RETENTION:K.RetentionQuery,PATHS:K.PathsQuery,STICKINESS:K.StickinessQuery,LIFECYCLE:K.LifecycleQuery,SQL:{name:"SQL",description:"Use SQL to query your data.",icon:_,inMenu:!0},JSON:{name:"Custom",description:"Save components powered by our JSON query language.",icon:Ye,inMenu:!0},HOG:{name:"Hog",description:"Use Hog to query your data.",icon:_,inMenu:!0}},gi=[{value:"All types",label:"All types"},...Object.entries(Wt).map(([e,n])=>({value:e,label:n.name,icon:n.icon?(0,a.jsx)(n.icon,{}):void 0}))],Us={component:Ti,logic:Fe};function ki({insight:e,className:n}){let t=()=>null;if("query"in e&&Ft(e.query)){let o=xn(e.query)?e.query.source.kind:e.query.kind,r=K[o];t=r&&r.icon}return t?(0,a.jsx)(t,{className:n}):null}function Yi({dataAttr:e}){return(0,a.jsx)(W,{type:"primary",to:S.insightNew(),sideAction:{dropdown:{placement:"bottom-end",className:"new-insight-overlay",actionable:!0,overlay:di(e)},"data-attr":"saved-insights-new-insight-dropdown"},"data-attr":"saved-insights-new-insight-button",size:"small",icon:(0,a.jsx)(Ot,{}),children:"New insight"})}function Ei(){let{loadInsights:e,renameInsight:n,duplicateInsight:t}=(0,ne.useActions)(Fe),{insights:o,insightsLoading:r,pagination:c}=(0,ne.useValues)(Fe),{currentProjectId:p}=(0,ne.useValues)(gt),m=ln(o?.results||[],c);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"saved-insights-grid mb-2",children:[m.dataSourcePage.map(l=>(0,a.jsx)(Vt,{insight:l,rename:()=>n(l),duplicate:()=>t(l),deleteWithUndo:async()=>await ut({object:l,endpoint:`projects/${p}/insights`,callback:e}),placement:"SavedInsightGrid"},l.short_id)),r&&(0,a.jsx)("div",{className:"min-h-[30rem]",children:(0,a.jsx)(Ee,{sceneLevel:!0})})]}),(0,a.jsx)(rn,{...m,nouns:["insight","insights"],bordered:!0})]})}function Ti(){let{featureFlags:e}=(0,ne.useValues)(Me),n=e[Xe.ALERTS],{loadInsights:t,updateFavoritedInsight:o,renameInsight:r,duplicateInsight:c,setSavedInsightsFilters:p}=(0,ne.useActions)(Fe),{insights:m,count:l,insightsLoading:g,filters:u,sorting:X,pagination:Y,alertModalId:E}=(0,ne.useValues)(Fe),{hasTagging:h}=(0,ne.useValues)(gn),{currentProjectId:D}=(0,ne.useValues)(gt),T=_e(),{tab:M,layoutView:U,page:k}=u,w=(k-1)*ze+1,H=k*ze<l?k*ze:l,ie=[{key:"id",width:32,render:function(f,N){return(0,a.jsx)(ki,{insight:N,className:"text-secondary text-2xl"})}},{title:"Name",dataIndex:"name",key:"name",render:function(f,N){return(0,a.jsx)(a.Fragment,{children:(0,a.jsx)(ye,{to:S.insightView(N.short_id),title:(0,a.jsxs)(a.Fragment,{children:[f||(0,a.jsx)("i",{children:T(N.query)}),(0,a.jsx)(Ae,{userAccessLevel:N.user_access_level,minAccessLevel:"editor",resourceType:"insight",className:"ml-1",size:"xsmall",onClick:z=>{z.preventDefault(),o(N,!N.favorited)},icon:N.favorited?(0,a.jsx)(Pt,{className:"text-warning"}):(0,a.jsx)(_t,{className:"text-secondary"}),tooltip:`${N.favorited?"Remove from":"Add to"} favorite insights`})]}),description:N.description})})}},...h?[{title:"Tags",dataIndex:"tags",key:"tags",render:function(f){return(0,a.jsx)(De,{tags:f,staticOnly:!0})}}]:[],...M==="yours"?[]:[Ke()],Qn(),{title:"Last modified",sorter:!0,dataIndex:"last_modified_at",render:function(f){return(0,a.jsx)("div",{className:"whitespace-nowrap",children:f&&(0,a.jsx)(pe,{time:f})})}},{width:0,render:function(f,N){return(0,a.jsx)(ve,{overlay:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(W,{to:S.insightView(N.short_id),fullWidth:!0,children:"View"}),(0,a.jsx)(ae,{}),(0,a.jsx)(Ae,{userAccessLevel:N.user_access_level,minAccessLevel:"editor",resourceType:"insight",to:S.insightEdit(N.short_id),fullWidth:!0,children:"Edit"}),(0,a.jsx)(Ae,{userAccessLevel:N.user_access_level,minAccessLevel:"editor",resourceType:"insight",onClick:()=>r(N),"data-attr":`insight-item-${N.short_id}-dropdown-rename`,fullWidth:!0,children:"Rename"}),(0,a.jsx)(W,{onClick:()=>c(N),"data-attr":"duplicate-insight-from-list-view",fullWidth:!0,children:"Duplicate"}),(0,a.jsx)(ae,{}),(0,a.jsx)(Ae,{userAccessLevel:N.user_access_level,minAccessLevel:"editor",resourceType:"insight",status:"danger",onClick:()=>void ut({object:N,endpoint:`projects/${D}/insights`,callback:t}),"data-attr":`insight-item-${N.short_id}-dropdown-remove`,fullWidth:!0,children:"Delete insight"})]})})}}];return(0,a.jsxs)("div",{className:"saved-insights",children:[(0,a.jsx)(Gn,{buttons:(0,a.jsx)(Yi,{dataAttr:"saved-insights-create-new-insight"})}),(0,a.jsx)(sn,{activeKey:M,onChange:Q=>p({tab:Q}),tabs:[{key:"all",label:"All insights"},{key:"yours",label:"Your insights"},{key:"favorites",label:"Favorites"},{key:"history",label:"History"},...n?[{key:"alerts",label:(0,a.jsx)("div",{className:"flex items-center gap-2",children:"Alerts"})}]:[]]}),M==="history"?(0,a.jsx)(Sn,{scope:"Insight"}):M==="alerts"?(0,a.jsx)(ti,{alertId:E}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(mi,{filters:u,setFilters:p}),(0,a.jsx)(ae,{className:"my-4"}),(0,a.jsxs)("div",{className:"flex justify-between mb-4 gap-2 flex-wrap mt-2 items-center",children:[(0,a.jsx)("span",{className:"text-secondary",children:l?`${w}${H-w>1?"-"+H:""} of ${l} insight${l===1?"":"s"}`:null}),(0,a.jsx)("div",{children:(0,a.jsx)(Le,{onChange:Q=>p({layoutView:Q}),value:U,options:[{value:"list",label:"List",icon:(0,a.jsx)(Mt,{})},{value:"card",label:"Cards",icon:(0,a.jsx)(kt,{})}],size:"small"})})]}),!g&&m.count<1?(0,a.jsx)(In,{}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(pi,{}),U==="list"?(0,a.jsx)(we,{loading:g,columns:ie,dataSource:m.results,pagination:Y,noSortingCancellation:!0,sorting:X,onSort:Q=>p({order:Q?`${Q.order===-1?"-":""}${Q.columnKey}`:void 0}),rowKey:"id",loadingSkeletonRows:15,nouns:["insight","insights"]}):(0,a.jsx)(Ei,{})]})]})]})}export{ai as a,mo as b,$n as c,oi as d,Vt as e,mi as f,pi as g,K as h,Wt as i,gi as j,Us as k,ki as l,Yi as m,Ti as n,ri as o,xi as p};
//# sourceMappingURL=/static/chunk-CDTERFC5.js.map
