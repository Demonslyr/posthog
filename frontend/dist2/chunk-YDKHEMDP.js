import{a as Vt,b as Qr,c as yt,e as Mr,f as Br,g as Ur,h as Fr,i as kt,j as Gr,k as qr,m as zr}from"/static/chunk-7SO55T25.js";import{a as pt,c as Ar,e as xr,i as Wr,j as Or,k as Vr,m as kr}from"/static/chunk-KBNOIM2W.js";import{b as mt,f as Rr}from"/static/chunk-BB32DDTD.js";import{$a as Xo,$f as fr,$o as to,Ae as lr,Do as W,Eo as Hr,Fe as dr,Hg as ue,Ib as ne,Ig as lt,Il as ct,Io as Le,Jk as Sr,Jl as Pr,Ko as Jr,Pk as wr,Pl as ut,Qd as tt,Ql as Cr,Rl as _r,Sa as Ve,Sd as P,So as $r,Ta as de,Tl as _e,To as Yr,Ue as cr,Ug as Ot,Uo as Xr,Vd as rt,Vg as vr,Vo as jr,Wb as ke,Wd as ar,Wg as be,Wh as re,Wl as Lr,Wo as Kr,Xl as Ue,Yh as Nr,Yo as Zr,Za as Yo,Zi as dt,_o as eo,a as X,af as ur,cc as et,ce as ot,ee as De,eh as Be,f as At,fe as ze,ff as at,fi as Ir,fj as Er,ga as er,gf as st,h as Pe,ha as tr,hf as nt,hg as hr,ia as rr,if as mr,jf as pr,kf as yr,lf as br,m as Ze,mf as gr,n as $o,nb as Wt,nf as Ce,ng as Tr,of as He,pe as sr,pf as Qe,qf as Me,r as S,rf as it,se as ce,sf as ie,tf as ye,vd as or,ve as nr,ze as ir,zo as Dr}from"/static/chunk-TW5IU73S.js";import{E as Yt,Eb as Ke,F as j,Fb as Kt,Ua as xt,a as ae,ea as Oe,hb as Rt,jb as Xt,kb as jt,sc as K,wc as Zt}from"/static/chunk-3UDJFOQH.js";import{d as u,e as h,g as T,j as v}from"/static/chunk-SJXEOBQC.js";h();v();T();var F=u(X()),io=u(Yo()),ft=u(At()),lo=u($o());h();v();T();var ao=({orderBy:e,status:r,dateRange:t,assignee:o,filterTestAccounts:s,filterGroup:l,searchQuery:n,customVolume:i,columns:a,limit:c=50})=>({kind:"DataTableNode",source:{kind:"ErrorTrackingQuery",orderBy:e,status:r,dateRange:t,assignee:o,customVolume:i,filterGroup:l,filterTestAccounts:s,searchQuery:n,limit:c},showActions:!1,showTimings:!1,columns:a}),Oa=({issueId:e,dateRange:r,customVolume:t})=>({kind:"ErrorTrackingQuery",issueId:e,dateRange:r,filterTestAccounts:!1,customVolume:t}),Va=({issue:e,filterTestAccounts:r,filterGroup:t,dateRange:o})=>{if(!e)return null;let s=["*","person","timestamp","recording_button(properties.$session_id)"],n=t.values[0].values,i=[`'${e.id}' == issue_id`],a={kind:"EventsQuery",event:"$exception",select:s,where:i,properties:n,filterTestAccounts:r,after:o.date_from||e.first_seen,before:o.date_to||void 0};return{kind:"DataTableNode",source:a,showActions:!1,showTimings:!1,columns:s,expandable:!0,embedded:!0}};var p=u(S());var Dt={OVERVIEW:1,GRAPHS:2,PATHS:3,SOURCES:4,DEVICES:5,GEOGRAPHY:6,RETENTION:7,REPLAY:8,ERROR_TRACKING:9,GOALS:10,WEB_VITALS:11,WEB_VITALS_PATH_BREAKDOWN:12};var Zo=["template-geoip","plugin-posthog-plugin-geoip"],Je="web-analytics",ea=[],bt="-7d",gt=null,so=Ke(bt,gt),$e=(e,r,t)=>`new-AdHoc.web-analytics.${e}.${r||"default"}.${t?"modal":"default"}`,ta=window.POSTHOG_APP_CONTEXT?.current_team?.id,Z={persist:!0,prefix:`${ta}__`},ge=(0,F.kea)([(0,F.path)(["scenes","webAnalytics","webAnalyticsSceneLogic"]),(0,F.connect)(()=>({values:[Ze,["featureFlags"],Jr,["currentTeam"],Hr,["hasAvailableFeature"],ur,["isDev"]]})),(0,F.actions)({setWebAnalyticsFilters:e=>({webAnalyticsFilters:e}),togglePropertyFilter:(e,r,t,o)=>({type:e,key:r,value:t,tabChange:o}),setGraphsTab:e=>({tab:e}),setSourceTab:e=>({tab:e}),setDeviceTab:e=>({tab:e}),setPathTab:e=>({tab:e}),setGeographyTab:e=>({tab:e}),clearTablesOrderBy:()=>!0,setTablesOrderBy:(e,r)=>({orderBy:e,direction:r}),setDates:(e,r)=>({dateFrom:e,dateTo:r}),setInterval:e=>({interval:e}),setDatesAndInterval:(e,r,t)=>({dateFrom:e,dateTo:r,interval:t}),setIsPathCleaningEnabled:e=>({isPathCleaningEnabled:e}),setShouldFilterTestAccounts:e=>({shouldFilterTestAccounts:e}),setShouldStripQueryParams:e=>({shouldStripQueryParams:e}),setConversionGoal:e=>({conversionGoal:e}),openModal:(e,r)=>({tileId:e,tabId:r}),closeModal:()=>!0,openAsNewInsight:(e,r)=>({tileId:e,tabId:r}),setConversionGoalWarning:e=>({warning:e}),setCompareFilter:e=>({compareFilter:e}),setProductTab:e=>({tab:e}),setWebVitalsPercentile:e=>({percentile:e}),setWebVitalsTab:e=>({tab:e})}),(0,F.reducers)({_webAnalyticsFilters:[ea,Z,{setWebAnalyticsFilters:(e,{webAnalyticsFilters:r})=>r,togglePropertyFilter:(e,{key:r,value:t,type:o})=>{if(t===null)return e.some(i=>i.type===o||i.key===r||i.operator==="is_not_set")?e.filter(i=>i.type!==o||i.key!==r||i.operator!=="is_not_set"):[...e,{type:o,key:r,operator:"is_not_set"}];if(e.some(n=>n.type===o&&n.key===r&&n.operator==="exact"))return e.map(n=>{if(n.key!==r||n.type!==o||!["exact","is_not_set"].includes(n.operator))return n;let i=(Array.isArray(n.value)?n.value:[n.value]).filter(K),a;if(i.includes(t))if(i.length>1)a=[t];else return null;else a=[...i,t];return{type:"event",key:r,operator:"exact",value:a}}).filter(K);let l={type:o,key:r,value:t,operator:"exact"};return[...e,l]}}],_graphsTab:[null,Z,{setGraphsTab:(e,{tab:r})=>r,togglePropertyFilter:(e,{tabChange:r})=>r?.graphsTab||e,setConversionGoal:(e,{conversionGoal:r})=>r?"UNIQUE_CONVERSIONS":e}],_sourceTab:[null,Z,{setSourceTab:(e,{tab:r})=>r,togglePropertyFilter:(e,{tabChange:r})=>r?.sourceTab||e}],_deviceTab:[null,Z,{setDeviceTab:(e,{tab:r})=>r,togglePropertyFilter:(e,{tabChange:r})=>r?.deviceTab||e}],_pathTab:[null,Z,{setPathTab:(e,{tab:r})=>r,togglePropertyFilter:(e,{tabChange:r})=>r?.pathTab||e}],_geographyTab:[null,Z,{setGeographyTab:(e,{tab:r})=>r,togglePropertyFilter:(e,{tabChange:r})=>r?.geographyTab||e}],_isPathCleaningEnabled:[!0,Z,{setIsPathCleaningEnabled:(e,{isPathCleaningEnabled:r})=>r}],_modalTileAndTab:[null,{openModal:(e,{tileId:r,tabId:t})=>({tileId:r,tabId:t}),closeModal:()=>null}],tablesOrderBy:[null,Z,{setTablesOrderBy:(e,{orderBy:r,direction:t})=>[r,t],clearTablesOrderBy:()=>null,setConversionGoal:()=>null}],dateFilter:[{dateFrom:bt,dateTo:gt,interval:so},Z,{setDates:(e,{dateTo:r,dateFrom:t})=>({dateTo:r,dateFrom:t,interval:Ke(t,r)}),setInterval:({dateFrom:e,dateTo:r},{interval:t})=>{let{dateFrom:o,dateTo:s}=Kt(t,e,r);return{dateTo:s,dateFrom:o,interval:t}},setDatesAndInterval:(e,{dateTo:r,dateFrom:t,interval:o})=>(!t&&!r&&(t=bt,r=gt),{dateTo:r,dateFrom:t,interval:o||Ke(t,r)})}],shouldFilterTestAccounts:[!1,Z,{setShouldFilterTestAccounts:(e,{shouldFilterTestAccounts:r})=>r}],shouldStripQueryParams:[!1,Z,{setShouldStripQueryParams:(e,{shouldStripQueryParams:r})=>r}],conversionGoal:[null,Z,{setConversionGoal:(e,{conversionGoal:r})=>r}],conversionGoalWarning:[null,{setConversionGoalWarning:(e,{warning:r})=>r}],compareFilter:[{compare:!0},Z,{setCompareFilter:(e,{compareFilter:r})=>r}],productTab:["analytics",{setProductTab:(e,{tab:r})=>r}],webVitalsPercentile:["p90",Z,{setWebVitalsPercentile:(e,{percentile:r})=>r}],webVitalsTab:["INP",{setWebVitalsTab:(e,{tab:r})=>r}]}),(0,F.selectors)(({actions:e,values:r})=>({breadcrumbs:[t=>[t.productTab],t=>{let o=[{key:"WebAnalytics",name:"Web analytics",path:W.webAnalytics()}];return t==="web-vitals"&&o.push({key:"WebAnalyticsWebVitals",name:"Web vitals",path:W.webAnalyticsWebVitals()}),o}],graphsTab:[t=>[t._graphsTab],t=>t||"UNIQUE_USERS"],sourceTab:[t=>[t._sourceTab],t=>t||"CHANNEL"],deviceTab:[t=>[t._deviceTab],t=>t||"DEVICE_TYPE"],pathTab:[t=>[t._pathTab],t=>t||"PATH"],geographyTab:[t=>[t._geographyTab],t=>t||"MAP"],isPathCleaningEnabled:[t=>[t._isPathCleaningEnabled,t.hasAvailableFeature],(t,o)=>o("paths_advanced")&&t],webAnalyticsFilters:[t=>[t._webAnalyticsFilters,t.isPathCleaningEnabled,()=>r.featureFlags],(t,o,s)=>!s[j.WEB_ANALYTICS_IMPROVED_PATH_CLEANING]||!o?t:t.map(l=>({...l,operator:l.operator==="exact"?"is_cleaned_path_exact":l.operator}))],tabs:[t=>[t.graphsTab,t.sourceTab,t.deviceTab,t.pathTab,t.geographyTab,()=>r.shouldShowGeographyTile],(t,o,s,l,n,i)=>({graphsTab:t,sourceTab:o,deviceTab:s,pathTab:l,geographyTab:n,shouldShowGeographyTile:i})],controls:[t=>[t.isPathCleaningEnabled,t.shouldFilterTestAccounts,t.shouldStripQueryParams],(t,o,s)=>({isPathCleaningEnabled:t,filterTestAccounts:o,shouldStripQueryParams:s})],filters:[t=>[t.webAnalyticsFilters,t.replayFilters,t.dateFilter,t.compareFilter,t.webVitalsTab,t.webVitalsPercentile,t.tablesOrderBy,()=>r.conversionGoal],(t,o,s,l,n,i,a,c)=>({webAnalyticsFilters:t,replayFilters:o,dateFilter:s,compareFilter:l,webVitalsTab:n,webVitalsPercentile:i,tablesOrderBy:a,conversionGoal:c})],tiles:[t=>[t.productTab,t.tabs,t.controls,t.filters,()=>r.featureFlags,()=>r.isGreaterThanMd,()=>r.currentTeam],(t,{graphsTab:o,sourceTab:s,deviceTab:l,pathTab:n,geographyTab:i,shouldShowGeographyTile:a},{isPathCleaningEnabled:c,filterTestAccounts:d,shouldStripQueryParams:g},{webAnalyticsFilters:m,replayFilters:I,dateFilter:{dateFrom:E,dateTo:L,interval:k},conversionGoal:y,compareFilter:Y,webVitalsPercentile:Ie,webVitalsTab:Re,tablesOrderBy:We},oe,Ge,Ee)=>{let te={date_from:E,date_to:L},x={enabled:!1,forceSamplingRate:{numerator:1,denominator:10}},z={event:oe[j.WEB_ANALYTICS_FOR_MOBILE]?"$screen":"$pageview",kind:"EventsNode",math:"dau",name:"Pageview",custom_name:"Unique visitors"},R={...z,math:"total",custom_name:oe[j.WEB_ANALYTICS_FOR_MOBILE]?"Screen Views":"Page views"},H={...z,math:"unique_session",custom_name:"Sessions"},pe=y?"actionId"in y?{kind:"ActionsNode",id:y.actionId,math:"dau",name:"Unique conversions",custom_name:"Unique conversions"}:{kind:"EventsNode",event:y.customEventName,math:"dau",name:"Unique conversions",custom_name:"Unique conversions"}:void 0,Jt=pe?{...pe,math:"total",name:"Total conversions",custom_name:"Total conversions"}:void 0,Ct=!!oe[j.WEB_REVENUE_TRACKING]&&!(y&&"actionId"in y),qe=Ct&&Ee?.revenue_tracking_config?Ee.revenue_tracking_config.events.map(G=>({math:"sum",name:G.eventName,event:G.eventName,kind:"EventsNode",custom_name:G.eventName,math_property:G.revenueProperty})):[],$t=y&&"customEventName"in y&&Ct?qe.filter(G=>G.event===y.customEventName):[],Se=(G,se)=>({dashboardItemId:$e(G,se,!1),loadPriority:Dt[G],dataNodeCollectionId:Je}),Te=(G,se,we,_t,Lt,je)=>({id:G,title:se,linkText:we,query:{kind:"InsightVizNode",source:{kind:"TrendsQuery",dateRange:te,interval:k,series:_t,trendsFilter:{display:"ActionsLineGraph",...Lt},compareFilter:Y,filterTestAccounts:d,conversionGoal:y,properties:m,...je},hidePersonsModal:!0,embedded:!0},showIntervalSelect:!0,insightProps:Se("GRAPHS",G),canOpenInsight:!0}),V=(G,se,we,_t,Lt,je,Ho)=>{let Jo=["breakdown_value","visitors","views",je?.includeBounceRate?"bounce_rate":null,"cross_sell"].filter(K);return{id:se,title:we,linkText:_t,query:{full:!0,kind:"DataTableNode",source:{kind:"WebStatsTableQuery",properties:m,breakdownBy:Lt,dateRange:te,sampling:x,compareFilter:Y,limit:10,filterTestAccounts:d,conversionGoal:y,orderBy:We??void 0,...je||{}},embedded:!1,showActions:!0,columns:Jo},insightProps:Se(G,se),canOpenModal:!0,...Ho||{}}};if(oe[j.WEB_VITALS]&&t==="web-vitals"){let G=(se,we)=>({kind:"EventsNode",event:"$web_vitals",name:"$web_vitals",custom_name:se,math:we,math_property:`$web_vitals_${se}_value`});return[{kind:"query",tileId:"WEB_VITALS",layout:{colSpanClassName:"md:col-span-full",orderWhenLargeClassName:"xxl:order-0"},query:{kind:"WebVitalsQuery",properties:m,source:{kind:"TrendsQuery",dateRange:te,interval:k,series:["INP","LCP","CLS","FCP"].flatMap(se=>["p75","p90","p99"].map(we=>G(se,we))),trendsFilter:{display:"ActionsLineGraph"},compareFilter:Y,filterTestAccounts:d,properties:m}},insightProps:{dashboardItemId:$e("WEB_VITALS","web-vitals-overview",!1),loadPriority:Dt.WEB_VITALS,dataNodeCollectionId:Je},showIntervalSelect:!0},{kind:"query",tileId:"WEB_VITALS_PATH_BREAKDOWN",layout:{colSpanClassName:"md:col-span-full",orderWhenLargeClassName:"xxl:order-0"},query:{kind:"WebVitalsPathBreakdownQuery",dateRange:te,filterTestAccounts:d,properties:m,percentile:Ie,metric:Re,doPathCleaning:c,thresholds:[ie[Re].good,ie[Re].poor]},insightProps:{dashboardItemId:$e("WEB_VITALS_PATH_BREAKDOWN","web-vitals-path-breakdown",!1),loadPriority:Dt.WEB_VITALS_PATH_BREAKDOWN,dataNodeCollectionId:Je}}]}return[{kind:"query",tileId:"OVERVIEW",layout:{colSpanClassName:"md:col-span-full",orderWhenLargeClassName:"xxl:order-0"},query:{kind:"WebOverviewQuery",properties:m,dateRange:te,sampling:x,compareFilter:Y,filterTestAccounts:d,conversionGoal:y,includeRevenue:Ct},insightProps:Se("OVERVIEW")},{kind:"tabs",tileId:"GRAPHS",layout:{colSpanClassName:"md:col-span-2",orderWhenLargeClassName:"xxl:order-1"},activeTabId:o,setTabId:e.setGraphsTab,tabs:[Te("UNIQUE_USERS","Unique visitors","Visitors",[z]),y?null:Te("PAGE_VIEWS","Page views","Views",[R]),y?null:Te("NUM_SESSION","Unique sessions","Sessions",[H]),!y&&qe?.length?Te("REVENUE_EVENTS","Revenue","Revenue",qe,{display:qe.length>1?"ActionsAreaGraph":"ActionsLineGraph"},{compareFilter:qe.length>1?void 0:Y}):null,y&&pe?Te("UNIQUE_CONVERSIONS","Unique conversions","Unique conversions",[pe]):null,y&&Jt?Te("TOTAL_CONVERSIONS","Total conversions","Total conversions",[Jt]):null,y&&z&&pe?Te("CONVERSION_RATE","Conversion rate","Conversion rate",[pe,z],{formula:"A / B",aggregationAxisFormat:"percentage_scaled"}):null,y&&$t.length?Te("CONVERSION_REVENUE","Conversion revenue","Conversion revenue",$t):null].filter(K)},{kind:"tabs",tileId:"PATHS",layout:{colSpanClassName:"md:col-span-2",orderWhenLargeClassName:"xxl:order-4"},activeTabId:n,setTabId:e.setPathTab,tabs:oe[j.WEB_ANALYTICS_FOR_MOBILE]?[V("PATHS","SCREEN_NAME","Screens","Screen","ScreenName",{},{})]:[V("PATHS","PATH","Paths","Path","Page",{includeScrollDepth:!1,includeBounceRate:!0,doPathCleaning:c},{docs:{url:"https://posthog.com/docs/web-analytics/dashboard#paths",title:"Paths",description:(0,p.jsxs)("div",{children:[(0,p.jsx)("p",{children:"In this view you can validate all of the paths that were accessed in your application, regardless of when they were accessed through the lifetime of a user session."}),y?(0,p.jsx)("p",{children:"The conversion rate is the percentage of users who completed the conversion goal in this specific path."}):(0,p.jsxs)("p",{children:["The"," ",(0,p.jsx)(de,{to:"https://posthog.com/docs/web-analytics/dashboard#bounce-rate",children:"bounce rate"})," ","indicates the percentage of users who left your page immediately after visiting without capturing any event."]})]})}}),V("PATHS","INITIAL_PATH","Entry paths","Entry path","InitialPage",{includeBounceRate:!0,includeScrollDepth:!1,doPathCleaning:c},{docs:{url:"https://posthog.com/docs/web-analytics/dashboard#paths",title:"Entry Path",description:(0,p.jsxs)("div",{children:[(0,p.jsx)("p",{children:"Entry paths are the paths a user session started, i.e. the first path they saw when they opened your website."}),y&&(0,p.jsx)("p",{children:"The conversion rate is the percentage of users who completed the conversion goal after the first path in their session being this path."})]})}}),V("PATHS","END_PATH","End paths","End path","ExitPage",{includeBounceRate:!1,includeScrollDepth:!1,doPathCleaning:c},{docs:{url:"https://posthog.com/docs/web-analytics/dashboard#paths",title:"End Path",description:(0,p.jsx)("div",{children:"End paths are the last path a user visited before their session ended, i.e. the last path they saw before leaving your website/closing the browser/turning their computer off."})}}),{id:"EXIT_CLICK",title:"Outbound link clicks",linkText:"Outbound clicks",query:{full:!0,kind:"DataTableNode",source:{kind:"WebExternalClicksTableQuery",properties:m,dateRange:te,compareFilter:Y,sampling:x,limit:10,filterTestAccounts:d,conversionGoal:y,orderBy:We??void 0,stripQueryParams:g},embedded:!1,showActions:!0,columns:["url","visitors","clicks","cross_sell"]},insightProps:Se("PATHS","END_PATH"),canOpenModal:!0,docs:{title:"Outbound Clicks",description:(0,p.jsx)("div",{children:"You'll be able to verify when someone leaves your website by clicking an outbound link (to a separate domain)"})}}].filter(K)},{kind:"tabs",tileId:"SOURCES",layout:{colSpanClassName:"md:col-span-1",orderWhenLargeClassName:"xxl:order-2"},activeTabId:s,setTabId:e.setSourceTab,tabs:[V("SOURCES","CHANNEL","Channels","Channel","InitialChannelType",{},{control:(0,p.jsxs)("div",{className:"flex flex-row space-x-2 font-medium",children:[(0,p.jsx)("span",{children:"Customize channel types"}),(0,p.jsx)(P,{icon:(0,p.jsx)(ke,{}),type:"tertiary",status:"alt",size:"small",noPadding:!0,tooltip:"Customize channel types",to:W.settings("environment-web-analytics","channel-type")})]}),docs:{url:"https://posthog.com/docs/data/channel-type",title:"Channels",description:(0,p.jsxs)("div",{children:[(0,p.jsx)("p",{children:"Channels are the different sources that bring traffic to your website, e.g. Paid Search, Organic Social, Direct, etc."}),(0,p.jsxs)("p",{children:["You can also"," ",(0,p.jsx)(de,{to:W.settings("environment-web-analytics","channel-type"),children:"create custom channel types"}),", allowing you to further categorize your channels."]}),(0,p.jsxs)("p",{children:["Something unexpected? Try the"," ",(0,p.jsx)(de,{to:W.sessionAttributionExplorer(),children:"Session attribution explorer"})]})]})}}),V("SOURCES","REFERRING_DOMAIN","Referrers","Referring domain","InitialReferringDomain",{},{docs:{url:"https://posthog.com/docs/web-analytics/dashboard#referrers-channels-utms",title:"Referrers",description:"Understand where your users are coming from"}}),V("SOURCES","UTM_SOURCE","UTM sources","UTM source","InitialUTMSource",{},{docs:{url:"https://posthog.com/docs/web-analytics/dashboard#utms",title:"UTM source",description:(0,p.jsxs)(p.Fragment,{children:["Understand where your users are coming from - filtered down by their"," ",(0,p.jsx)("code",{children:"utm_source"})," parameter"]})}}),V("SOURCES","UTM_MEDIUM","UTM medium","UTM medium","InitialUTMMedium",{},{docs:{url:"https://posthog.com/docs/web-analytics/dashboard#utms",title:"UTM medium",description:(0,p.jsxs)(p.Fragment,{children:["Understand where your users are coming from - filtered down by their"," ",(0,p.jsx)("code",{children:"utm_medium"})," parameter"]})}}),V("SOURCES","UTM_CAMPAIGN","UTM campaigns","UTM campaign","InitialUTMCampaign",{},{docs:{url:"https://posthog.com/docs/web-analytics/dashboard#utms",title:"UTM campaign",description:(0,p.jsxs)(p.Fragment,{children:["Understand where your users are coming from - filtered down by their"," ",(0,p.jsx)("code",{children:"utm_campaign"})," parameter"]})}}),V("SOURCES","UTM_CONTENT","UTM content","UTM content","InitialUTMContent",{},{docs:{url:"https://posthog.com/docs/web-analytics/dashboard#utms",title:"UTM content",description:(0,p.jsxs)(p.Fragment,{children:["Understand where your users are coming from - filtered down by their"," ",(0,p.jsx)("code",{children:"utm_content"})," parameter"]})}}),V("SOURCES","UTM_TERM","UTM terms","UTM term","InitialUTMTerm",{},{docs:{url:"https://posthog.com/docs/web-analytics/dashboard#utms",title:"UTM term",description:(0,p.jsxs)(p.Fragment,{children:["Understand where your users are coming from - filtered down by their"," ",(0,p.jsx)("code",{children:"utm_term"})," parameter"]})}}),V("SOURCES","UTM_SOURCE_MEDIUM_CAMPAIGN","Source / Medium / Campaign","UTM s/m/c","InitialUTMSourceMediumCampaign",{},{docs:{url:"https://posthog.com/docs/web-analytics/dashboard#utms",title:"UTM parameters",description:(0,p.jsxs)(p.Fragment,{children:["Understand where your users are coming from - filtered down by a tuple of their ",(0,p.jsx)("code",{children:"utm_source"}),", ",(0,p.jsx)("code",{children:"utm_medium"}),", and"," ",(0,p.jsx)("code",{children:"utm_campaign"})," parameters"]})}})]},{kind:"tabs",tileId:"DEVICES",layout:{colSpanClassName:"md:col-span-1",orderWhenLargeClassName:"xxl:order-3"},activeTabId:l,setTabId:e.setDeviceTab,tabs:[V("DEVICES","DEVICE_TYPE","Device type","Device type","DeviceType"),V("DEVICES","BROWSER","Browsers","Browser","Browser"),V("DEVICES","OS","OS","OS","OS"),V("DEVICES","VIEWPORT","Viewports","Viewport","Viewport")]},a?{kind:"tabs",tileId:"GEOGRAPHY",layout:{colSpanClassName:"md:col-span-full"},activeTabId:i||"MAP",setTabId:e.setGeographyTab,tabs:[{id:"MAP",title:"World map",linkText:"Map",query:{kind:"InsightVizNode",source:{kind:"TrendsQuery",breakdownFilter:{breakdown:"$geoip_country_code",breakdown_type:"event"},dateRange:te,series:[{event:"$pageview",name:"Pageview",kind:"EventsNode",math:"dau"}],trendsFilter:{display:"WorldMap"},conversionGoal:y,filterTestAccounts:d,properties:m},hidePersonsModal:!0,embedded:!0},insightProps:Se("GEOGRAPHY","MAP"),canOpenInsight:!0},V("GEOGRAPHY","COUNTRIES","Countries","Countries","Country"),V("GEOGRAPHY","REGIONS","Regions","Regions","Region"),V("GEOGRAPHY","CITIES","Cities","Cities","City"),V("GEOGRAPHY","TIMEZONES","Timezones","Timezones","Timezone"),V("GEOGRAPHY","LANGUAGES","Languages","Languages","Language")]}:null,y?null:{kind:"query",tileId:"RETENTION",title:"Retention",layout:{colSpanClassName:"md:col-span-2"},query:{kind:"InsightVizNode",source:{kind:"RetentionQuery",properties:m,dateRange:te,filterTestAccounts:d,retentionFilter:{retentionType:Yt,retentionReference:"total",totalIntervals:Ge?8:5,period:"Week"}},vizSpecificOptions:{RETENTION:{hideLineGraph:!0,hideSizeColumn:!Ge,useSmallLayout:!Ge}},embedded:!0},insightProps:Se("RETENTION"),canOpenInsight:!1,canOpenModal:!0,docs:{url:"https://posthog.com/docs/web-analytics/dashboard#retention",title:"Retention",description:(0,p.jsx)(p.Fragment,{children:(0,p.jsxs)("div",{children:[(0,p.jsx)("p",{children:"Retention creates a cohort of unique users who performed any event for the first time in the last week. It then tracks the percentage of users who return to perform any event in the following weeks."}),(0,p.jsx)("p",{children:"You want the numbers to be the highest possible, suggesting that people that come to your page continue coming to your page - and performing an actions. Also, the further down the table the higher the numbers should be (or at least as high), which would indicate that you're either increasing or keeping your retention at the same level."})]})})}},y?null:{kind:"query",tileId:"GOALS",title:"Goals",layout:{colSpanClassName:"md:col-span-2"},query:{full:!0,kind:"DataTableNode",source:{kind:"WebGoalsQuery",properties:m,dateRange:te,compareFilter:Y,sampling:x,limit:10,orderBy:We??void 0,filterTestAccounts:d},embedded:!0,showActions:!0,columns:["breakdown_value","visitors","views","cross_sell"]},insightProps:Se("GOALS"),canOpenInsight:!1,docs:{url:"https://posthog.com/docs/web-analytics/dashboard#goals",title:"Goals",description:(0,p.jsx)(p.Fragment,{children:(0,p.jsx)("div",{children:(0,p.jsxs)("p",{children:["Goals shows your pinned or most recently created actions and the number of conversions they've had. You can set a custom event or action as a"," ",(0,p.jsx)(de,{to:"https://posthog.com/docs/web-analytics/conversion-goals",children:"conversion goal"})," ","at the top of the dashboard for more specific metrics."]})})})}},y?null:{kind:"replay",tileId:"REPLAY",layout:{colSpanClassName:y?"md:col-span-full":"md:col-span-1"},docs:{url:"https://posthog.com/docs/session-replay",title:"Session Replay",description:"Play back sessions to diagnose UI issues, improve support, and get context for nuanced user behavior."}},!y&&oe[j.ERROR_TRACKING]?{kind:"error_tracking",tileId:"ERROR_TRACKING",layout:{colSpanClassName:"md:col-span-1"},query:ao({orderBy:"users",dateRange:te,filterTestAccounts:d,filterGroup:I.filter_group,columns:["error","users","occurrences"],limit:4}),docs:{url:"https://posthog.com/docs/error-tracking",title:"Error Tracking",description:(0,p.jsx)(p.Fragment,{children:(0,p.jsxs)("div",{children:[(0,p.jsx)("p",{children:"Error tracking allows you to track, investigate, and resolve exceptions your customers face."}),(0,p.jsxs)("p",{children:["Errors are captured as ",(0,p.jsx)("code",{children:"$exception"})," events which means that you can create insights, filter recordings and trigger surveys based on them exactly the same way you can for any other type of event."]})]})})}}:null].filter(K)}],modal:[t=>[t.tiles,t._modalTileAndTab],(t,o)=>{if(!o)return null;let{tileId:s,tabId:l}=o,n=t.find(a=>a.tileId===s);if(!n)return null;let i=a=>a.kind==="DataTableNode"&&(a.source.kind==="WebStatsTableQuery"||a.source.kind==="WebExternalClicksTableQuery"||a.source.kind==="WebGoalsQuery")?{...a,source:{...a.source,limit:50}}:a;if(n.kind==="tabs"){let a=n.tabs.find(c=>c.id===l);return a?{tileId:s,tabId:l,title:a.title,showIntervalSelect:a.showIntervalSelect,control:a.control,insightProps:{dashboardItemId:$e(s,l,!0),loadPriority:0,doNotLoad:!1,dataNodeCollectionId:Je},query:i(a.query),canOpenInsight:a.canOpenInsight}:null}else if(n.kind==="query")return{tileId:s,title:n.title,showIntervalSelect:n.showIntervalSelect,control:n.control,insightProps:{dashboardItemId:$e(s,void 0,!0),loadPriority:0,dataNodeCollectionId:Je},query:i(n.query)};return null}],hasCountryFilter:[t=>[t.webAnalyticsFilters],t=>t.some(o=>o.key==="$geoip_country_code")],hasDeviceTypeFilter:[t=>[t.webAnalyticsFilters],t=>t.some(o=>o.key==="$device_type")],hasBrowserFilter:[t=>[t.webAnalyticsFilters],t=>t.some(o=>o.key==="$browser")],hasOSFilter:[t=>[t.webAnalyticsFilters],t=>t.some(o=>o.key==="$os")],replayFilters:[t=>[t.webAnalyticsFilters,t.dateFilter,t.shouldFilterTestAccounts,t.conversionGoal],(t,o,s,l)=>{let n=[...t];return l&&("actionId"in l?n.push({id:l.actionId,name:String(l.actionId),type:"actions"}):"customEventName"in l&&n.push({id:l.customEventName,name:l.customEventName,type:"events"})),{filter_test_accounts:s,date_from:o.dateFrom,date_to:o.dateTo,filter_group:{type:"AND",values:[{type:"AND",values:n}]},duration:[{type:"recording",key:"active_seconds",operator:"gt",value:1}]}}],webVitalsMetricQuery:[t=>[t.webVitalsPercentile,t.webVitalsTab,t.dateFilter,t.webAnalyticsFilters,t.shouldFilterTestAccounts],(t,o,{dateFrom:s,dateTo:l,interval:n},i,a)=>({kind:"InsightVizNode",source:{kind:"TrendsQuery",dateRange:{date_from:s,date_to:l},interval:n,series:[{kind:"EventsNode",event:"$web_vitals",name:"$web_vitals",custom_name:o,math:t,math_property:`$web_vitals_${o}_value`}],trendsFilter:{display:"ActionsLineGraph",aggregationAxisFormat:o==="CLS"?"numeric":"duration_ms",goalLines:[{label:"Good",value:ie[o].good,displayLabel:!1,borderColor:ye.good},{label:"Poor",value:ie[o].poor,displayLabel:!1,borderColor:ye.needs_improvements}]},filterTestAccounts:a,properties:i},embedded:!1})],getNewInsightUrl:[t=>[t.tiles],t=>function(s,l){let n=a=>a.kind==="InsightVizNode"?{...a,embedded:void 0,hidePersonsModal:void 0}:a,i=t.find(a=>a.tileId===s);if(i)if(i.kind==="tabs"){let a=i.tabs.find(c=>c.id===l);return a?W.insightNew({query:n(a.query)}):void 0}else{if(i.kind==="query")return W.insightNew({query:n(i.query)});if(i.kind==="replay")return W.replay()}}]})),(0,io.loaders)(({values:e})=>({statusCheck:{__default:null,loadStatusCheck:async()=>{let[r,t,o,s]=await Promise.allSettled([Le.eventDefinitions.list({event_type:"event",search:"$web_vitals"}),Le.eventDefinitions.list({event_type:"event",search:"$pageview"}),Le.eventDefinitions.list({event_type:"event",search:"$pageleave"}),Le.propertyDefinitions.list({event_names:["$pageleave"],properties:["$prev_pageview_max_content_percentage"]})]),l=r.status==="fulfilled"?r.value.results.find(I=>I.name==="$web_vitals"):void 0,n=t.status==="fulfilled"?t.value.results.find(I=>I.name==="$pageview"):void 0,i=o.status==="fulfilled"?o.value.results.find(I=>I.name==="$pageleave"):void 0,a=s.status==="fulfilled"?s.value.results.find(I=>I.name==="$prev_pageview_max_content_percentage"):void 0,c=!!l&&!Be(l),d=!!n&&!Be(n),g=!!i&&!Be(i),m=!!a&&!Be(a);return{isSendingWebVitals:c,isSendingPageViews:d,isSendingPageLeaves:g,isSendingPageLeavesScroll:m}}},shouldShowGeographyTile:{_default:null,loadShouldShowGeographyTile:async()=>{if(e.isDev)return!0;let[r,t]=await Promise.allSettled([Le.propertyDefinitions.list({event_names:["$pageview"],properties:["$geoip_country_code"]}),Le.hogFunctions.list({types:["transformation"]})]);return!(r.status==="fulfilled"&&r.value.results.some(l=>l.name==="$geoip_country_code"&&!Be(l)))||t.status!=="fulfilled"?!1:!!t.value.results.find(l=>{let n=Zo.includes(l.template?.id??""),i=l.name==="GeoIP";return(n||i)&&l.enabled})}}})),(0,F.afterMount)(({actions:e})=>{e.loadStatusCheck(),e.loadShouldShowGeographyTile()}),(0,lo.windowValues)({isGreaterThanMd:e=>e.innerWidth>768}),(0,ft.actionToUrl)(({values:e})=>{let r=()=>{let{webAnalyticsFilters:t,conversionGoal:o,dateFilter:{dateTo:s,dateFrom:l,interval:n},_sourceTab:i,_deviceTab:a,_pathTab:c,_geographyTab:d,_graphsTab:g,isPathCleaningEnabled:m,shouldFilterTestAccounts:I,compareFilter:E,productTab:L,webVitalsPercentile:k}=e,y=new URLSearchParams;return t.length>0&&y.set("filters",JSON.stringify(t)),o&&("actionId"in o?y.set("conversionGoal.actionId",o.actionId.toString()):y.set("conversionGoal.customEventName",o.customEventName)),(l!==bt||s!==gt||n!==so)&&(y.set("date_from",l??""),y.set("date_to",s??""),y.set("interval",n??"")),a&&y.set("device_tab",a),i&&y.set("source_tab",i),g&&y.set("graphs_tab",g),c&&y.set("path_tab",c),d&&y.set("geography_tab",d),m!=null&&y.set("path_cleaning",m.toString()),I!=null&&y.set("filter_test_accounts",I.toString()),E&&y.set("compare_filter",JSON.stringify(E)),L!=="analytics"&&y.set("product_tab",L),L==="web-vitals"&&y.set("percentile",k),`${L==="web-vitals"?"/web/web-vitals":"/web"}${y.toString()?"?"+y.toString():""}`};return{setWebAnalyticsFilters:r,togglePropertyFilter:r,setConversionGoal:r,setDates:r,setInterval:r,setDeviceTab:r,setSourceTab:r,setGraphsTab:r,setPathTab:r,setGeographyTab:r,setCompareFilter:r,setProductTab:r,setWebVitalsPercentile:r,setIsPathCleaningEnabled:r}}),(0,ft.urlToAction)(({actions:e,values:r})=>{let t=({productTab:o="analytics"},{filters:s,"conversionGoal.actionId":l,"conversionGoal.customEventName":n,date_from:i,date_to:a,interval:c,device_tab:d,source_tab:g,graphs_tab:m,path_tab:I,geography_tab:E,path_cleaning:L,filter_test_accounts:k,compare_filter:y,percentile:Y})=>{if(!["analytics","web-vitals"].includes(o))return;let Ie=kr(s)?s:void 0;Ie&&!xt(Ie,r.webAnalyticsFilters)&&e.setWebAnalyticsFilters(Ie),l&&l!==r.conversionGoal?.actionId?e.setConversionGoal({actionId:parseInt(l,10)}):n&&n!==r.conversionGoal?.customEventName&&e.setConversionGoal({customEventName:n}),(i&&i!==r.dateFilter.dateFrom||a&&a!==r.dateFilter.dateTo||c&&c!==r.dateFilter.interval)&&e.setDatesAndInterval(i,a,c),d&&d!==r._deviceTab&&e.setDeviceTab(d),g&&g!==r._sourceTab&&e.setSourceTab(g),m&&m!==r._graphsTab&&e.setGraphsTab(m),I&&I!==r._pathTab&&e.setPathTab(I),E&&E!==r._geographyTab&&e.setGeographyTab(E),L&&L!==r.isPathCleaningEnabled&&e.setIsPathCleaningEnabled([!0,"true",1,"1"].includes(L)),k&&k!==r.shouldFilterTestAccounts&&e.setShouldFilterTestAccounts([!0,"true",1,"1"].includes(k)),y&&!xt(y,r.compareFilter)&&e.setCompareFilter(y),o&&o!==r.productTab&&e.setProductTab(o),Y&&Y!==r.webVitalsPercentile&&e.setWebVitalsPercentile(Y)};return{"/web":t,"/web/:productTab":t}}),(0,F.listeners)(({values:e,actions:r})=>{let t=(o,s)=>{s?(o==="PAGE_VIEWS"||o==="NUM_SESSION")&&r.setGraphsTab("UNIQUE_USERS"):(o==="TOTAL_CONVERSIONS"||o==="CONVERSION_RATE"||o==="UNIQUE_CONVERSIONS")&&r.setGraphsTab("UNIQUE_USERS")};return{setGraphsTab:({tab:o})=>{t(o,e.conversionGoal)},setConversionGoal:[({conversionGoal:o})=>{t(e.graphsTab,o)},({conversionGoal:o},s)=>no(o,s,r.setConversionGoalWarning)]}}),(0,F.afterMount)(({actions:e,values:r})=>{no(r.conversionGoal,void 0,e.setConversionGoalWarning).catch(()=>{})})]),no=async(e,r,t)=>{if(!e||!("customEventName"in e)||!e.customEventName){t(null);return}let{customEventName:o}=e,s=await fr("select count() from events where timestamp >= (now() - toIntervalHour(24)) AND ($session_id IS NULL OR $session_id = '') AND event = {event}",{event:o});r?.(),s.results[0][0]?t("CustomEventWithNoSessionId"):t(null)};h();v();T();var qo=u(Pe()),le=u(X()),zo=u(At());var Ht=u(ae());h();v();T();var wt=u(ae());h();v();T();var co=u(Pe()),ht=u(X());var fe=u(ae());var C=u(S()),ra=0;function oa(e){let r=(0,fe.useRef)([]);(0,fe.useEffect)(()=>()=>{r.current.forEach(n=>n?.dispose())},[]);let[t,o]=(0,fe.useState)(e.query.code);(0,fe.useEffect)(()=>{o(e.query?.code)},[e.query?.code]);let[s]=(0,fe.useState)(()=>ra++);function l(){e.setQuery&&e.setQuery({...e.query,code:t})}return(0,C.jsx)("div",{className:"space-y-2",children:(0,C.jsxs)("div",{"data-attr":"hogql-query-editor",className:(0,co.default)("flex flex-col rounded space-y-2 w-full p-2 border"),children:[(0,C.jsx)("div",{className:"relative flex-1 overflow-hidden",children:(0,C.jsx)("div",{className:"resize-y overflow-hidden h-[222px]",children:(0,C.jsx)(ue,{queryKey:e.queryKey??`new/${s}`,className:"border rounded overflow-hidden h-full",language:"hog",value:t,onChange:n=>o(n??""),height:"100%",onMount:(n,i)=>{r.current.push(n.addAction({id:"saveAndRunPostHog",label:"Save and run query",keybindings:[i.KeyMod.CtrlCmd|i.KeyCode.Enter],run:()=>l()}))},options:{minimap:{enabled:!1},wordWrap:"on",scrollBeyondLastLine:!1,automaticLayout:!0,fixedOverflowWidgets:!0,suggest:{showInlineDetails:!0},quickSuggestionsDelay:300}})})}),(0,C.jsx)("div",{className:"flex flex-row",children:(0,C.jsx)("div",{className:"flex-1",children:(0,C.jsx)(P,{onClick:l,type:"primary",disabledReason:e.setQuery?void 0:"No permission to update",center:!0,fullWidth:!0,"data-attr":"hogql-query-editor-save",children:e.setQuery?"Update and run":"No permission to update"})})})]})})}function uo({query:e,setQuery:r,queryKey:t,debug:o}){let s={query:e,key:t,dataNodeCollectionId:t},{dataLoading:l,response:n}=(0,ht.useValues)(re(s)),i=n,[a,c]=(0,fe.useState)("results");return(0,C.jsx)(ht.BindLogic,{logic:re,props:s,children:(0,C.jsxs)("div",{className:"space-y-2",children:[r?(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)(oa,{query:e,setQuery:r,queryKey:t}),(0,C.jsx)(De,{className:"my-4"}),(0,C.jsx)("div",{className:"flex gap-2",children:(0,C.jsx)(pt,{})})]}):null,l?(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)("h2",{children:"Running query..."}),(0,C.jsxs)("div",{className:"flex",children:["Time elapsed:\xA0",(0,C.jsx)(mt,{})]})]}):(0,C.jsxs)(C.Fragment,{children:[o?(0,C.jsx)(lr,{tabs:[{label:"Results",key:"results"},{label:"Stdout",key:"stdout"},{label:"Bytecode",key:"coloredBytecode"},{label:"Raw bytecode",key:"bytecode"}],activeKey:a,onChange:d=>c(String(d))}):null,a==="bytecode"&&o?(0,C.jsx)(ue,{className:"border",language:"json",value:i?.bytecode?JSON.stringify(i?.bytecode):"No bytecode returned with response",height:500,path:`debug/${t}/hog-bytecode.json`,options:{wordWrap:"on"}}):a==="coloredBytecode"&&o?(0,C.jsx)(ue,{className:"border",language:"swift",value:i?.coloredBytecode&&Array.isArray(i?.coloredBytecode)?i?.coloredBytecode.map(d=>d.startsWith("op.")?d:`    ${d}`).join(`
`):"No bytecode returned with response",height:500,path:`debug/${t}/hog-bytecode.json`,options:{wordWrap:"on",lineNumbers:d=>String(d-1)}}):a==="stdout"?(0,C.jsx)(ue,{className:"border",language:"text",value:String(i?.stdout??"No bytecode returned with response"),height:500,path:`debug/${t}/hog-stdout.txt`,options:{wordWrap:"on"}}):(0,C.jsx)(ue,{className:"border",language:typeof i?.results=="object"?"json":"text",value:typeof i?.results=="object"?JSON.stringify(i?.results??"",null,2):String(i?.results??""),height:500,path:`debug/${t}/hog-result.json`,options:{wordWrap:"on"}})]})]})})}h();v();T();var mo=u(X());var po=u(ae());var he=u(S()),aa=0;function yo(e){let[r]=(0,po.useState)(()=>`DataNode.${aa++}`),t=re({...e,key:r,cachedResults:e.cachedResults,dataNodeCollectionId:r}),{response:o,responseLoading:s,responseErrorObject:l}=(0,mo.useValues)(t);return(0,he.jsxs)("div",{className:"relative",children:[(0,he.jsx)("div",{className:"absolute right-0 z-10 p-1 mr-3",children:(0,he.jsx)(Ar,{query:e.query})}),s?(0,he.jsx)("div",{className:"text-2xl",children:(0,he.jsx)(tt,{})}):(0,he.jsx)(lt,{disableWidth:!0,children:({height:n})=>(0,he.jsx)(ue,{className:"border",language:"json",value:JSON.stringify(o??l,null,2),height:Math.max(n,300)})})]})}h();v();T();var To=u(X());var vo=u(ae());h();v();T();var bo=u(Pe()),ve=u(ae()),fo=u(S()),go=({children:e,minWidthRems:r,className:t})=>{let[o,s]=(0,ve.useState)(),l=(0,ve.useRef)(null),n=(0,ve.useCallback)(()=>{if(!l.current)return;let i=parseFloat(getComputedStyle(document.documentElement).fontSize),a=r*i,c=l.current.offsetWidth,d=Math.floor(c/a),g=Math.ceil(e.length/d),m=Math.ceil(e.length/g);s({numRows:g,itemsPerRow:m})},[s,l,r,e.length]);return(0,ve.useEffect)(()=>{let i=l.current;if(!i)return;n();let a;return typeof ResizeObserver<"u"&&(a=new ResizeObserver(n)),a?.observe(i),()=>{a?.unobserve(i)}},[n]),(0,fo.jsx)("div",{className:(0,bo.default)("grid",t),style:{gridTemplateColumns:`repeat(${o?.itemsPerRow??1}, 1fr)`},ref:l,children:o?e:null})};var A=u(S()),sa=10,No="flex-1 border p-2 bg-surface-primary rounded min-w-[10rem] h-30 flex flex-col items-center text-center justify-between",na=0;function Io(e){let{onData:r,loadPriority:t,dataNodeCollectionId:o}=e.context.insightProps??{},[s]=(0,vo.useState)(()=>`WebOverview.${na++}`),l=re({query:e.query,key:s,cachedResults:e.cachedResults,loadPriority:t,onData:r,dataNodeCollectionId:o??s}),{response:n,responseLoading:i}=(0,To.useValues)(l),a=n,c=a?.samplingRate,d=e.query.conversionGoal?4:5;return Nr("WEB_REVENUE_TRACKING")&&(d+=1),(0,A.jsxs)(A.Fragment,{children:[(0,A.jsx)(go,{className:"flex justify-center items-center flex-wrap w-full gap-2",minWidthRems:sa+2,children:i?Zt(d).map(g=>(0,A.jsx)(ia,{},g)):a?.results?.map(g=>(0,A.jsx)(la,{item:g},g.key))||[]}),c&&!(c.numerator===1&&(c.denominator??1)===1)?(0,A.jsxs)(ar,{type:"info",className:"my-4",children:["These results are using a sampling factor of ",c.numerator,c.denominator??!1?`/${c.denominator}`:"",". Sampling is currently in beta."]}):null]})}var ia=()=>(0,A.jsxs)("div",{className:No,children:[(0,A.jsx)(ce,{className:"h-2 w-10"}),(0,A.jsx)(ce,{className:"h-6 w-20"}),(0,A.jsx)(ce,{className:"h-2 w-10"})]}),la=({item:e})=>{let r=ca(e.key),t=K(e.changeFromPreviousPct)?e.changeFromPreviousPct===0?{Icon:tr,color:Oe("muted")}:e.changeFromPreviousPct>0?{Icon:or,color:e.isIncreaseBad?Oe("danger"):Oe("success")}:{Icon:rr,color:e.isIncreaseBad?Oe("success"):Oe("danger")}:void 0,o=ua(e.key),s=K(e.value)&&K(e.previous)&&K(e.changeFromPreviousPct)?`${r}: ${e.value>=e.previous?"increased":"decreased"} by ${Qt(Math.abs(e.changeFromPreviousPct),{precise:!0})}, to ${Tt(e.value,e.kind,{precise:!0})} from ${Tt(e.previous,e.kind,{precise:!0})}`:K(e.value)?`${r}: ${Tt(e.value,e.kind,{precise:!0})}`:"No data";return(0,A.jsx)(Ve,{title:s,children:(0,A.jsxs)("div",{className:No,children:[(0,A.jsxs)("div",{className:"flex flex-row w-full",children:[(0,A.jsx)("div",{className:"flex-1"}),(0,A.jsx)("div",{className:"font-bold uppercase text-xs py-1",children:r}),(0,A.jsx)("div",{className:"flex flex-1 flex-row justify-end items-start",children:o&&(0,A.jsx)(P,{to:o,icon:(0,A.jsx)(ke,{}),size:"xsmall"})})]}),(0,A.jsx)("div",{className:"w-full flex-1 flex items-center justify-center",children:(0,A.jsx)("div",{className:"text-2xl",children:Tt(e.value,e.kind)})}),t&&K(e.changeFromPreviousPct)?(0,A.jsxs)("div",{style:{color:t.color},children:[(0,A.jsx)(t.Icon,{color:t.color})," ",Qt(e.changeFromPreviousPct)]}):(0,A.jsx)("div",{})]})})},Qt=(e,r)=>r?.precise?(e/100).toLocaleString(void 0,{style:"percent",maximumFractionDigits:1}):e>=1e3?Rt(e)+"%":(e/100).toLocaleString(void 0,{style:"percent",maximumSignificantDigits:2}),ho=(e,r)=>r?.precise?e.toLocaleString():Rt(e),da=e=>{let t=new Intl.NumberFormat("en-US",{style:"currency",currency:e}).formatToParts(0),o=t.find(l=>l.type==="currency")?.value,s=o?t[0].type==="currency":!0;return{symbol:o??e,isPrefix:s}},Tt=(e,r,t)=>{if(e==null)return"-";if(r==="percentage")return Qt(e,{precise:t?.precise});if(r==="duration_s")return Xt(e,{secondsPrecision:3});if(r==="currency"){let{symbol:o,isPrefix:s}=da(t?.currency??"USD");return`${s?o:""}${ho(e,{precise:t?.precise})}${s?"":" "+o}`}return ho(e,t)},ca=e=>{switch(e){case"visitors":return"Visitors";case"views":return"Page views";case"sessions":return"Sessions";case"session duration":return"Session duration";case"bounce rate":return"Bounce rate";case"lcp score":return"LCP Score";case"conversion rate":return"Conversion rate";case"total conversions":return"Total conversions";case"unique conversions":return"Unique conversions";default:return e.split(" ").map(r=>r.charAt(0).toUpperCase()+r.slice(1)).join(" ")}},ua=e=>{switch(e){case"revenue":case"conversion revenue":return W.revenue();default:return null}};h();v();T();var Xe=u(X());var Ae=u(ae());h();v();T();var Eo=u(X()),So=u(ae());var B=u(S()),wo=({webVitalsQueryResponse:e})=>{let{webVitalsTab:r,webVitalsPercentile:t}=(0,Eo.useValues)(ge),o=(0,So.useMemo)(()=>Ce(e?.results,r,t),[e,t,r]),s=L=>r==="CLS"?L.join(" and "):L.map(k=>`${k}ms`).join(" and "),l=Me(o,r),n=He(o,r);if(o===void 0||n==="none")return(0,B.jsx)(ce,{fade:!0,className:"w-full h-40 rounded sm:w-[30%]"});let i=mr[n],a=ie[r],c=nt[n],d=pr[n],g=s(yr[n](a)),m=br[n](t),I=gr[n],E=r==="CLS"?"":"ms";return(0,B.jsxs)("div",{className:"w-full p-4 sm:w-[30%] flex flex-col gap-2 bg-surface-primary rounded border",children:[(0,B.jsx)("span",{className:"text-lg",children:(0,B.jsx)("strong",{children:at[r]})}),(0,B.jsxs)("div",{className:"flex flex-col",children:[(0,B.jsxs)(Ve,{title:(0,B.jsxs)("div",{children:["Great: Below ",a.good,E," ",(0,B.jsx)("br",{}),"Needs Improvement: Between ",a.good,E," and ",a.poor,E," ",(0,B.jsx)("br",{}),"Poor: Above ",a.poor,E]}),children:[(0,B.jsx)("strong",{children:i}),(0,B.jsx)(et,{className:"inline-block ml-1"})]}),(0,B.jsxs)("span",{children:[(0,B.jsx)(c,{className:"inline-block mr-1",style:{color:l}}),d," ",g]})]}),(0,B.jsxs)("div",{className:"text-xs text-secondary-foreground",children:[m," ",I]}),(0,B.jsx)("hr",{className:"my-2"}),(0,B.jsx)("span",{children:st[r]})]})};h();v();T();var Co=u(Pe());h();v();T();var me=u(S());function Po({value:e,metric:r}){let t=He(e,r),o=ie[r],s=o.good/o.end*100,l=(o.poor-o.good)/o.end*100,n=100-s-l;return(0,me.jsxs)("div",{className:"w-full h-1 rounded-full relative",children:[(0,me.jsx)("div",{style:{width:`${s}%`,backgroundColor:t==="good"?`${ye.good} !important`:void 0},className:"absolute h-full rounded-full bg-surface-secondary",children:(0,me.jsx)(Mt,{value:e,metric:r,band:"good"})}),(0,me.jsx)("div",{style:{left:`${s+1}%`,width:`${l-1}%`,backgroundColor:t==="needs_improvements"?`${ye.needs_improvements} !important`:void 0},className:"absolute h-full rounded-full bg-surface-secondary",children:(0,me.jsx)(Mt,{value:e,metric:r,band:"needs_improvements"})}),(0,me.jsx)("div",{style:{left:`${s+l+1}%`,width:`${n-1}%`,backgroundColor:t==="poor"?`${ye.poor} !important`:void 0},className:"absolute h-full rounded-full bg-surface-secondary",children:(0,me.jsx)(Mt,{value:e,metric:r,band:"poor"})})]})}var Mt=({value:e,metric:r,band:t})=>{if(!e||He(e,r)!==t)return null;let s=it(e,r),l=Me(e,r);return(0,me.jsx)("div",{style:{left:`${s*100}%`,backgroundColor:l},className:"absolute w-0.5 h-3 -top-1"})};var q=u(S());function Ye({value:e,metric:r,isActive:t,setTab:o}){let s=at[r],{value:l,unit:n}=Qe(e,r),i=Me(e,r);return(0,q.jsxs)("div",{onClick:o,className:(0,Co.default)("flex-1 gap-2 border p-2 bg-surface-primary rounded items-center sm:items-start flex flex-col justify-between cursor-pointer",t&&"border-accent-primary border-2"),children:[(0,q.jsxs)("div",{className:"text-sm hidden sm:flex w-full flex-row justify-between",children:[(0,q.jsxs)("span",{children:[s," (",r,")"]}),(0,q.jsx)(Ve,{title:st[r],children:(0,q.jsx)(et,{})})]}),(0,q.jsxs)("div",{className:"flex flex-col items-center sm:hidden",children:[(0,q.jsx)("span",{className:"text-sm font-bold",children:r}),(0,q.jsx)("span",{className:"text-xs",children:s})]}),(0,q.jsxs)("div",{className:"flex flex-row items-end",children:[(0,q.jsx)("span",{style:{color:i},className:"text-2xl",children:l||(0,q.jsx)(ce,{fade:!0,className:"w-20 h-8"})}),(0,q.jsx)("span",{className:"text-xs ml-1 mb-1",children:n})]}),(0,q.jsx)("div",{className:"w-full mt-2 hidden sm:block",children:(0,q.jsx)(Po,{value:e,metric:r})})]})}var J=u(S()),ma=0;function _o(e){let{onData:r,loadPriority:t,dataNodeCollectionId:o}=e.context.insightProps??{},[s]=(0,Ae.useState)(()=>`WebVitals.${ma++}`),l=re({query:e.query,key:s,cachedResults:e.cachedResults,loadPriority:t,onData:r,dataNodeCollectionId:o??s}),{webVitalsPercentile:n,webVitalsTab:i,webVitalsMetricQuery:a}=(0,Xe.useValues)(ge),{setWebVitalsTab:c}=(0,Xe.useActions)(ge),{response:d,responseLoading:g}=(0,Xe.useValues)(l),m=g?void 0:d,I=(0,Ae.useMemo)(()=>Ce(m?.results,"INP",n),[m,n]),E=(0,Ae.useMemo)(()=>Ce(m?.results,"LCP",n),[m,n]),L=(0,Ae.useMemo)(()=>Ce(m?.results,"CLS",n),[m,n]),k=(0,Ae.useMemo)(()=>Ce(m?.results,"FCP",n),[m,n]);return(0,J.jsxs)("div",{className:"flex flex-col flex-1 gap-4",children:[(0,J.jsxs)("div",{className:"grid gap-2 grid-cols-1 sm:grid-cols-2 xl:grid-cols-4",children:[(0,J.jsx)(Ye,{metric:"INP",value:I,isActive:i==="INP",setTab:()=>c("INP")}),(0,J.jsx)(Ye,{metric:"LCP",value:E,isActive:i==="LCP",setTab:()=>c("LCP")}),(0,J.jsx)(Ye,{metric:"FCP",value:k,isActive:i==="FCP",setTab:()=>c("FCP")}),(0,J.jsx)(Ye,{metric:"CLS",value:L,isActive:i==="CLS",setTab:()=>c("CLS")})]}),(0,J.jsxs)("div",{className:"flex flex-col sm:flex-row gap-2",children:[(0,J.jsx)(wo,{webVitalsQueryResponse:m}),(0,J.jsxs)("div",{className:"flex flex-col flex-1 bg-surface-primary rounded border p-4",children:[(0,J.jsx)(xe,{query:a,readOnly:!0,embedded:!0,context:{renderEmptyStateAsSkeleton:!0}}),(0,J.jsx)("div",{className:"flex w-full justify-end",children:(0,J.jsx)(P,{to:W.insightNew({query:a}),icon:(0,J.jsx)(er,{}),size:"small",type:"secondary",onClick:()=>{cr({from:"web_analytics",to:"product_analytics",intent_context:"web_vitals_insight"})},children:"Open as new Insight"})})]})]})]})}h();v();T();var Lo=u(Pe()),vt=u(X());var Ao=u(ae());h();v();T();var U=u(X());function Bt(e){try{return JSON.stringify(JSON.parse(e),null,2)+`
`}catch{return e}}var Ut=(0,U.kea)([(0,U.path)(["queries","QueryEditor","queryEditorLogic"]),(0,U.props)({}),(0,U.key)(e=>e.key),(0,U.propsChanged)(({actions:e,props:r},t)=>{r.query!==t.query&&e.setQueryInput(Bt(r.query))}),(0,U.actions)({saveQuery:!0,setQueryInput:e=>({queryInput:e})}),(0,U.reducers)(({props:e})=>({queryInput:[Bt(e.query),{setQueryInput:(r,{queryInput:t})=>t}]})),(0,U.selectors)({parsedQuery:[e=>[e.queryInput],e=>{let r=null,t=null;try{r=JSON.parse(e)}catch(o){t=o.message}return{JSONQuery:r,error:t}}],JSONQuery:[e=>[e.parsedQuery],({JSONQuery:e})=>e],error:[e=>[e.parsedQuery],({error:e})=>e],inputChanged:[(e,r)=>[r.query,e.queryInput],(e,r)=>e!==r]}),(0,U.listeners)(({actions:e,props:r,values:t})=>({saveQuery:()=>{if(t.error)rt.error(`Error parsing JSON: ${t.error}`);else{let o=JSON.stringify(JSON.parse(t.queryInput));e.setQueryInput(Bt(o)),r.setQuery?.(o)}}}))]);var $=u(S()),pa=0;function xo(e){let[r]=(0,Ao.useState)(()=>pa++),{queryInput:t,error:o,inputChanged:s}=(0,vt.useValues)(Ut({...e,key:r})),{setQueryInput:l,saveQuery:n}=(0,vt.useActions)(Ut({...e,key:r}));return(0,$.jsxs)($.Fragment,{children:[e.context?.showQueryHelp?(0,$.jsx)("div",{className:"mb-2 flex flex-row flex-wrap justify-between items-center",children:(0,$.jsxs)("div",{children:["Insight configurations follow a declarative schema. Edit them as code here. Open under"," ",(0,$.jsx)(de,{to:W.debugQuery(t),children:"/debug"}),"."]})}):null,(0,$.jsxs)("div",{"data-attr":"query-editor",className:(0,Lo.default)("flex flex-col p-2 bg-primary space-y-2 resize-y overflow-auto h-80 rounded",e.className),children:[(0,$.jsx)("div",{className:"flex-1",children:(0,$.jsx)(lt,{disableWidth:!0,children:({height:i})=>(0,$.jsx)(ue,{className:"border",language:"json",value:t,onChange:a=>l(a??""),height:i,schema:Vr})})}),o?(0,$.jsxs)("div",{className:"bg-danger text-white p-2",children:[(0,$.jsx)("strong",{children:"Error parsing JSON:"})," ",o]}):null,e.aboveButton,(0,$.jsx)(P,{onClick:n,type:"primary",status:o?"danger":"default",disabled:!e.setQuery||!!o||!s,fullWidth:!0,center:!0,"data-attr":"query-editor-save",children:e.setQuery?"Update and run":"No permission to update"})]})]})}h();v();T();var Ft=u(Pe()),ee=u(X()),Wo=u(At());var Nt=u(ae());var f=u(S()),ya=0;function Oo({uniqueKey:e,query:r,setQuery:t,context:o,cachedResults:s,readOnly:l,variablesOverride:n}){let[i]=(0,Nt.useState)(`DataVisualizationNode.${e??ya++}`),a=o?.insightProps||{dashboardItemId:`new-AdHoc.${i}`,query:r,setQuery:t,dataNodeCollectionId:i},c=ut(a),d=Cr(a,i),{insightMode:g}=(0,ee.useValues)(Lr),m={key:c,query:r,dashboardId:a.dashboardId,dataNodeCollectionId:d,loadPriority:a.loadPriority,insightMode:g,setQuery:t,cachedResults:s,variablesOverride:n},I={query:r.source,key:c,cachedResults:s,loadPriority:a.loadPriority,dataNodeCollectionId:d,variablesOverride:n},{insightProps:E}=(0,ee.useValues)(Ue),{exportContext:L}=(0,ee.useValues)(_e(E));return(0,f.jsx)(ee.BindLogic,{logic:re,props:I,children:(0,f.jsx)(ee.BindLogic,{logic:ct,props:m,children:(0,f.jsx)(ee.BindLogic,{logic:Mr,props:{key:m.key},children:(0,f.jsx)(ee.BindLogic,{logic:kt,props:{key:m.key,readOnly:l??!1,dashboardId:a.dashboardId},children:(0,f.jsx)(ee.BindLogic,{logic:Gr,props:{key:m.key},children:(0,f.jsx)(ba,{uniqueKey:i,query:r,setQuery:t,context:o,cachedResults:s,readOnly:l,exportContext:L})})})})})})}function ba(e){let{readOnly:r}=e,{query:t,visualizationType:o,showEditingUI:s,showResultControls:l,sourceFeatures:n,response:i,responseLoading:a,responseError:c,queryCancelled:d,isChartSettingsPanelOpen:g}=(0,ee.useValues)(ct),{setEditorQuery:m}=(0,ee.useActions)(kt),{toggleChartSettingsPanel:I}=(0,ee.useActions)(ct),E=(0,Nt.useCallback)(k=>e.setQuery?.({...e.query,source:k}),[e.setQuery,e.query]),L=null;return!s&&(!i||a)?L=(0,f.jsx)("div",{className:"flex flex-col flex-1 justify-center items-center bg-surface-primary h-full",children:(0,f.jsx)(dt,{})}):o==="ActionsTable"?L=(0,f.jsx)(Rr,{uniqueKey:e.uniqueKey,query:t,context:e.context,cachedResults:e.cachedResults}):o==="ActionsLineGraph"||o==="ActionsBar"||o==="ActionsAreaGraph"||o==="ActionsStackedBar"?L=(0,f.jsx)(Br,{}):o==="BoldNumber"&&(L=(0,f.jsx)(Pr,{})),(0,f.jsxs)("div",{className:"DataVisualization flex flex-1 gap-2",children:[!r&&s&&(0,f.jsx)("div",{className:"max-sm:hidden max-w-xs",children:(0,f.jsx)(Ro,{inline:!0})}),(0,f.jsxs)("div",{className:"relative w-full flex flex-col gap-4 flex-1 overflow-hidden",children:[!r&&s&&(0,f.jsx)(f.Fragment,{children:(0,f.jsx)(Wr,{query:t.source,queryResponse:i??void 0,setQuery:E,embedded:!0,onChange:m})}),!r&&l&&(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(De,{className:"my-0"}),(0,f.jsxs)("div",{className:"flex gap-4 justify-between flex-wrap px-px",children:[(0,f.jsxs)("div",{className:"flex gap-4 items-center",children:[(0,f.jsx)(pt,{}),(0,f.jsx)(mt,{})]}),(0,f.jsx)("div",{className:"flex gap-4 items-center",children:(0,f.jsxs)("div",{className:"flex gap-4 items-center flex-wrap",children:[(0,f.jsx)(qr,{}),n.has(2)&&!Wo.router.values.location.pathname.includes(W.dataWarehouse())&&(0,f.jsx)(xr,{query:t.source,setQuery:k=>{k.kind==="HogQLQuery"&&E(k)}},"date-range"),(0,f.jsx)(Fr,{}),(0,f.jsx)(P,{icon:(0,f.jsx)(ke,{}),type:g?"primary":"secondary",onClick:()=>I(),tooltip:"Visualization settings"}),e.exportContext&&(0,f.jsx)(wr,{disabledReason:o!="ActionsTable"&&"Only table results are exportable",type:"secondary",items:[{export_format:"text/csv",export_context:e.exportContext},{export_format:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",export_context:e.exportContext}]})]})})]})]}),(0,f.jsx)(zr,{}),(0,f.jsxs)("div",{className:"flex flex-1 flex-row gap-4",children:[s&&g&&(0,f.jsx)("div",{className:"h-full",children:(0,f.jsx)(Ur,{})}),(0,f.jsx)("div",{className:(0,Ft.default)("w-full h-full flex-1 overflow-auto"),children:o!=="ActionsTable"&&c?(0,f.jsx)("div",{className:(0,Ft.default)("rounded bg-surface-primary relative flex flex-1 flex-col p-2",{border:s}),children:(0,f.jsx)(Er,{query:e.query,excludeDetail:!0,title:d?"The query was cancelled":i&&"error"in i?i.error:c})}):L})]})]})]})}h();v();T();var Gt=u(X());var It=u(S());function Vo({query:e,context:r,embedded:t,readOnly:o}){let s={dashboardItemId:e.shortId},{insight:l,insightLoading:n}=(0,Gt.useValues)(Ue(s)),{query:i}=(0,Gt.useValues)(_e(s));if(n)return(0,It.jsx)("div",{className:"text-center",children:(0,It.jsx)(dt,{})});let a={...e,...i,full:e.full};return(0,It.jsx)(xe,{query:a,cachedResults:l,context:{...r,insightProps:s},embedded:t,readOnly:o})}h();v();T();var Et=u(Pe()),Fe=u(X());var St=u(ae());var w=u(S()),ga=0;function ko(e){let{onData:r,loadPriority:t,dataNodeCollectionId:o}=e.context.insightProps??{},[s]=(0,St.useState)(()=>`WebVitalsPathBreakdown.${ga++}`),l=re({query:e.query,key:s,cachedResults:e.cachedResults,loadPriority:t,onData:r,dataNodeCollectionId:o??s}),{response:n,responseLoading:i}=(0,Fe.useValues)(l),a=n;return(0,w.jsxs)("div",{className:"border rounded bg-surface-primary grid grid-cols-1 md:grid-cols-3 divide-y md:divide-y-0 md:divide-x min-h-60 h-full",children:[(0,w.jsxs)("div",{className:"p-4",children:[(0,w.jsx)(qt,{band:"good",label:"Good"}),(0,w.jsx)(zt,{band:"good",response:a,responseLoading:i})]}),(0,w.jsxs)("div",{className:"p-4",children:[(0,w.jsx)(qt,{band:"needs_improvements",label:"Needs Improvements"}),(0,w.jsx)(zt,{band:"needs_improvements",response:a,responseLoading:i})]}),(0,w.jsxs)("div",{className:"p-4",children:[(0,w.jsx)(qt,{band:"poor",label:"Poor"}),(0,w.jsx)(zt,{band:"poor",response:a,responseLoading:i})]})]})}var qt=({band:e,label:r})=>{let{webVitalsTab:t}=(0,Fe.useValues)(ge),o=nt[e],s=(0,St.useMemo)(()=>{let l=ie[t],{value:n,unit:i}=Qe(l.poor,t),{value:a,unit:c}=Qe(l.good,t);return e==="poor"?(0,w.jsxs)(w.Fragment,{children:["> ",n,i]}):e==="needs_improvements"?(0,w.jsxs)(w.Fragment,{children:[a,c," - ",n,i]}):e==="good"?(0,w.jsxs)(w.Fragment,{children:["< ",a,c]}):null},[e,t]);return(0,w.jsxs)("div",{className:"flex flex-row justify-between",children:[(0,w.jsxs)("span",{className:"flex flex-row gap-1 items-center font-semibold",style:{color:ye[e]},children:[(0,w.jsx)(o,{className:"w-6 h-6"}),r]}),(0,w.jsx)("span",{className:"text-sm text-secondary",children:s})]})},fa={good:"h-40",needs_improvements:"h-60",poor:"h-20"},zt=({band:e,response:r,responseLoading:t})=>{let{webVitalsTab:o,isPathCleaningEnabled:s}=(0,Fe.useValues)(ge),{togglePropertyFilter:l}=(0,Fe.useActions)(ge),n=r?.results[0][e],i=n!=null,a=n?.length===0;return(0,w.jsx)("div",{className:(0,Et.default)("pt-4",{"h-full":i}),children:(0,w.jsx)("div",{className:(0,Et.default)("flex flex-col gap-1",{"justify-center":a,"h-full":i}),children:t?(0,w.jsx)(ce,{fade:!0,className:(0,Et.default)("w-full",fa[e])}):n?.length?n?.map(({path:c,value:d})=>{let g=it(d,o)*100,{value:m,unit:I}=Qe(d,o);return(0,w.jsxs)("div",{className:"flex flex-row items-center justify-between relative w-full p-2 py-1",children:[(0,w.jsx)("div",{className:"absolute top-0 left-0 h-full opacity-80 bg-surface-secondary",style:{width:g}}),(0,w.jsx)("span",{title:c,className:"relative z-10 truncate mr-2 flex-1 cursor-pointer hover:underline",onClick:()=>{l("event","$pathname",c)},children:s?Sr(c):c}),(0,w.jsxs)("span",{className:"relative z-10 flex-shrink-0",children:[m,I]})]},c)}):(0,w.jsxs)("div",{className:"text-center",children:[(0,w.jsx)("span",{children:e==="good"?"\u{1F63F}":"\u{1F680}"}),(0,w.jsx)("span",{className:"text-secondary",children:"No scores in this band"})]})})})};var O=u(S());function xe(e){let{query:r,setQuery:t,readOnly:o,embedded:s,filtersOverride:l,variablesOverride:n,inSharedMode:i}=e,[a,c]=(0,wt.useState)(r);(0,wt.useEffect)(()=>{r!==a&&c(r)},[r]);let d=o?r:a,g=t??c,m=e.context||{},I=e.uniqueKey??(e.context?.insightProps&&ut(e.context.insightProps));if(d===null)return null;if(typeof d=="string")try{return(0,O.jsx)(xe,{...e,query:JSON.parse(d)})}catch(L){return(0,O.jsxs)("div",{className:"border border-danger p-4 text-danger",children:["Error parsing JSON: ",L.message]})}let E;return $r(d)?E=(0,O.jsx)(Or,{query:d,setQuery:g,context:m,cachedResults:e.cachedResults,uniqueKey:I,readOnly:o}):Yr(d)?E=(0,O.jsx)(Oo,{query:d,setQuery:g,cachedResults:e.cachedResults,uniqueKey:I,context:m,readOnly:o,variablesOverride:e.variablesOverride}):Xr(d)?E=(0,O.jsx)(Vo,{query:d,context:m,readOnly:o,embedded:s}):jr(d)?E=(0,O.jsx)(_r,{query:d,setQuery:g,context:m,readOnly:o,uniqueKey:I,embedded:s,inSharedMode:i,filtersOverride:l,variablesOverride:n}):Zr(d)?E=(0,O.jsx)(Io,{query:d,cachedResults:e.cachedResults,context:m}):eo(d)?E=(0,O.jsx)(_o,{query:d,cachedResults:e.cachedResults,context:m}):to(d)?E=(0,O.jsx)(ko,{query:d,cachedResults:e.cachedResults,context:m}):Kr(d)?E=(0,O.jsx)(uo,{query:d,setQuery:g,queryKey:String(I)}):E=(0,O.jsx)(yo,{query:d,cachedResults:e.cachedResults}),(0,O.jsx)(Ir,{children:(0,O.jsxs)(O.Fragment,{children:[m.showQueryEditor?(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(xo,{query:JSON.stringify(d),setQuery:L=>g?.(JSON.parse(L),!0),context:m}),(0,O.jsx)("div",{className:"my-4",children:(0,O.jsx)(De,{})})]}):null,E]})})}h();v();T();var Pt=u(X()),Uo=u(Xo());h();v();T();var Ne=u(X());var Mo=u(ae());var _=u(S()),ha=["lazy_table","virtual_table","field_traverser","expression","view","materialized_view"],Do={integer:"Integer",float:"Float",string:"String",datetime:"DateTime",date:"Date",boolean:"Boolean",array:"Array",json:"JSON"},Ta=Object.keys(Do).map(e=>({value:e,label:Do[e]})),va=e=>typeof e=="string"&&ha.includes(e),Qo=({tableName:e,fieldName:r})=>{let{currentProjectId:t}=(0,Ne.useValues)(hr),{toggleEditJoinModal:o}=(0,Ne.useActions)(yt),{joins:s,joinsLoading:l}=(0,Ne.useValues)(Ot),{loadJoins:n}=(0,Ne.useActions)(Ot),{loadDatabase:i}=(0,Ne.useActions)(be),a=s.find(d=>d.source_table_name===e&&d.field_name===r),c=(0,Mo.useCallback)(()=>l||!a?(0,_.jsx)(tt,{}):(0,_.jsxs)(_.Fragment,{children:[(0,_.jsx)(P,{fullWidth:!0,onClick:()=>void o(a),children:"Edit"}),(0,_.jsx)(P,{status:"danger",fullWidth:!0,onClick:()=>{Tr({endpoint:`projects/${t}/warehouse_view_link`,object:{id:a.id,name:`${a.field_name} on ${a.source_table_name}`},callback:()=>{i(),n()}}).catch(d=>{rt.error(`Failed to delete warehouse view link: ${d.detail}`)})},children:"Delete"})]}),[l,a]);return(0,_.jsx)(nr,{overlay:c()})};function Bo({table:e,tables:r,inEditSchemaMode:t,schemaOnChange:o}){let s=Object.values(r.find(({name:i})=>i===e)?.fields??{}),{dataWarehouseTables:l,databaseLoading:n}=(0,Ne.useValues)(be);return(0,_.jsx)(ir,{dataSource:s,loading:n,disableTableWhileLoading:!1,columns:[{title:"Column",key:"key",dataIndex:"name",render:function(a){return(0,_.jsx)("code",{children:a})}},{title:"Type",key:"type",dataIndex:"type",render:function(a,{name:c,type:d,schema_valid:g}){return t&&!va(d)?(0,_.jsx)(sr,{options:Ta,value:d,onChange:I=>{o&&o(c,I)}}):d==="virtual_table"?(0,_.jsx)(ze,{type:"default",className:"uppercase",children:"Virtual Table"}):d==="lazy_table"?(0,_.jsx)(ze,{type:"default",className:"uppercase",children:"Reference"}):d==="field_traverser"?(0,_.jsx)(ze,{type:"default",className:"uppercase",children:"Expression"}):(0,_.jsx)(ze,{type:g?"default":"danger",className:"uppercase",children:d})}},{title:"Info",key:"info",dataIndex:"type",render:function(a,c){return a==="virtual_table"||a==="view"?(0,_.jsxs)(_.Fragment,{children:["Fields: ",(0,_.jsx)("code",{children:c.fields.join(", ")})]}):a==="lazy_table"?(0,_.jsxs)(_.Fragment,{children:["To table: ",(0,_.jsx)("code",{children:String(c.table)})]}):a==="field_traverser"&&Array.isArray(c.chain)?(0,_.jsx)("code",{children:c.chain.join(".")}):e=="events"&&a=="json"&&c.name=="properties"?(0,_.jsx)(de,{to:W.propertyDefinitions("event"),children:"Manage event properties"}):e=="persons"&&a=="json"&&c.name=="properties"?(0,_.jsx)(de,{to:W.propertyDefinitions("person"),children:"Manage person properties"}):!c.schema_valid&&!t?(0,_.jsxs)(_.Fragment,{children:[(0,_.jsx)("code",{children:c.name})," can't be parsed as a ",(0,_.jsx)("code",{children:c.type}),". It will not be queryable until this is fixed."]}):""}},{width:0,dataIndex:"type",render:function(a,c){if(c.type==="view")return(0,_.jsx)(Qo,{tableName:e,fieldName:c.name});if(c.type==="lazy_table"&&c.table){let d=!!l.find(m=>m.name===c.table),g=!!l.find(m=>m.name===e);if(d||g)return(0,_.jsx)(Qo,{tableName:e,fieldName:c.name})}return null}}]})}var N=u(S());function Fo(){let{selectedRow:e,isEditingSavedQuery:r,inEditSchemaMode:t,editSchemaIsLoading:o}=(0,Pt.useValues)(be),{setIsEditingSavedQuery:s,toggleEditSchemaMode:l,updateSelectedSchema:n,saveSchema:i,cancelEditSchema:a}=(0,Pt.useActions)(be),d=e?.type==="data_warehouse"&&!e.source;return(0,N.jsx)("div",{className:"border rounded p-3 bg-surface-primary",children:e?(0,N.jsxs)(N.Fragment,{children:[(0,N.jsxs)("div",{className:"flex flex-row justify-between items-center gap-2",children:[(0,N.jsxs)("h2",{className:"flex-1 text-wrap break-all leading-4",children:[(0,N.jsx)(ne,{})," ",e.name]}),r&&(0,N.jsx)("div",{className:"flex flex-row gap-2 justify-between",children:(0,N.jsx)(P,{type:"secondary",onClick:()=>s(!1),children:"Cancel"})}),t&&(0,N.jsxs)("div",{className:"flex flex-row gap-2 justify-between",children:[(0,N.jsx)(P,{type:"primary",loading:o,onClick:()=>{i()},children:"Save schema"}),(0,N.jsx)(P,{type:"secondary",disabledReason:o&&"Schema is saving...",onClick:()=>{a()},children:"Cancel edit"})]}),!t&&!r&&(0,N.jsx)("div",{className:"flex flex-row gap-2 justify-between",children:d&&(0,N.jsx)(P,{type:"primary",onClick:()=>{l()},children:"Edit schema"})})]}),e.type=="data_warehouse"&&(0,N.jsxs)("div",{className:"flex flex-col",children:[e.source&&e.schema&&(0,N.jsxs)(N.Fragment,{children:[(0,N.jsx)("span",{className:"card-secondary mt-2",children:"Last Synced At"}),(0,N.jsx)("span",{children:e.schema.last_synced_at?jt(e.schema.last_synced_at,"MMMM DD, YYYY","h:mm A"):"Not yet synced"})]}),!e.source&&(0,N.jsxs)(N.Fragment,{children:[(0,N.jsx)("span",{className:"card-secondary mt-2",children:"Files URL pattern"}),(0,N.jsx)("span",{className:"break-all",children:e.url_pattern}),(0,N.jsx)("span",{className:"card-secondary mt-2",children:"File format"}),(0,N.jsx)("span",{children:e.format})]})]}),!r&&(0,N.jsxs)("div",{className:"mt-2",children:[(0,N.jsx)("span",{className:"card-secondary",children:"Columns"}),(0,N.jsx)(Bo,{table:e.name,tables:[e],inEditSchemaMode:t,schemaOnChange:(g,m)=>n(g,m)})]})]}):(0,N.jsx)("div",{className:"px-4 py-3 h-100 col-span-2 flex justify-center items-center"})})}function Go({table:e,isOpen:r,setIsOpen:t,onDelete:o}){let s;return e.type==="view"?s="view":s="table",(0,N.jsx)(ot,{title:`Delete ${s}?`,onClose:()=>t(!1),footer:(0,N.jsxs)(N.Fragment,{children:[(0,N.jsx)(P,{type:"secondary",onClick:()=>t(!1),children:"Cancel"}),(0,N.jsx)(P,{type:"secondary",status:"danger",onClick:()=>o(),children:`Delete ${e.name}`})]}),isOpen:r,children:(0,N.jsxs)("p",{children:[(0,Uo.capitalizeFirstLetter)(s)," deletion ",(0,N.jsx)("b",{children:"cannot be undone"}),". All"," ",e.type==="view"?"joins":"views and joins"," related to this ",s," will be deleted"]})})}var b=u(S()),$d=({insightProps:e})=>{let{query:r}=(0,le.useValues)(_e(e)),{setQuery:t}=(0,le.useActions)(_e(e));return(0,b.jsx)(b.Fragment,{children:(0,b.jsx)(le.BindLogic,{logic:Ue,props:e,children:(0,b.jsx)("div",{className:"Insight",children:(0,b.jsx)(xe,{query:r,setQuery:t,readOnly:!1,context:{showOpenEditorButton:!1,showQueryEditor:!1,showQueryHelp:!1,insightProps:e}})})})})},Ro=({inline:e,collapsible:r=!0})=>{let{dataWarehouseTablesBySourceType:t,posthogTables:o,databaseLoading:s,nonMaterializedViews:l,materializedViews:n,views:i,selectedRow:a,schemaModalIsOpen:c,dataWarehouseSavedQueriesLoading:d}=(0,le.useValues)(be),{selectRow:g,deleteDataWarehouseSavedQuery:m,deleteDataWarehouseTable:I,toggleSchemaModal:E}=(0,le.useActions)(be),[L,k]=(0,Ht.useState)(!1),{toggleJoinTableModal:y,selectSourceTable:Y}=(0,le.useActions)(yt),[Ie,Re]=(0,Ht.useState)(!1),{runDataWarehouseSavedQuery:We}=(0,le.useActions)(vr),{featureFlags:oe}=(0,le.useValues)(Ze),Ge=x=>x?x.type==="view"||x.type==="materialized_view"?(0,b.jsx)(P,{"data-attr":"schema-list-item-delete",status:"danger",onClick:()=>{g(x),Re(!0)},fullWidth:!0,children:"Delete"}):(0,b.jsx)(b.Fragment,{}):(0,b.jsx)(b.Fragment,{}),Ee=x=>(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(P,{onClick:()=>{dr(x.name,x.name)},fullWidth:!0,"data-attr":"schema-list-item-copy",children:"Copy table name"}),(0,b.jsx)(P,{onClick:()=>{g(x),E()},"data-attr":"schema-list-item-schema",fullWidth:!0,children:"View table schema"}),(0,b.jsx)(P,{onClick:()=>{Y(x.name),y()},"data-attr":"schema-list-item-join",fullWidth:!0,children:"Add join"}),(x.type=="view"||x.type=="materialized_view")&&(0,b.jsx)(P,{onClick:()=>{zo.router.actions.push(W.dataWarehouseView(x.id))},"data-attr":"schema-list-item-edit",fullWidth:!0,children:"Edit view definition"}),oe[j.DATA_MODELING]&&x.type==="view"&&(0,b.jsx)(P,{onClick:()=>{We(x.id)},"data-attr":"schema-list-item-materialize",fullWidth:!0,children:"Materialize"}),oe[j.DATA_MODELING]&&x.type==="materialized_view"&&(0,b.jsx)(P,{onClick:()=>{We(x.id)},"data-attr":"schema-list-item-run",fullWidth:!0,children:"Run"}),Ge(x)]}),te=()=>e?[{name:"External",items:Object.keys(t).map(R=>({name:Dr[R]?.label??R,items:t[R].map(H=>({name:H.name,table:H,dropdownOverlay:Ee(H),items:Object.values(H.fields).map(pe=>({name:pe.name,type:pe.type,icon:(0,b.jsx)(ne,{})}))}))})),emptyLabel:(0,b.jsx)("span",{className:"text-secondary",children:"No tables found"}),isLoading:s},{name:"PostHog",items:o.map(R=>({name:R.name,table:R,dropdownOverlay:Ee(R),items:Object.values(R.fields).map(H=>({name:H.name,type:H.type,icon:(0,b.jsx)(ne,{})}))})),isLoading:s},{name:"Views",items:(oe[j.DATA_MODELING]?l:i).map(R=>({name:R.name,table:R,dropdownOverlay:Ee(R),items:Object.values(R.fields).map(H=>({name:H.name,type:H.type,icon:(0,b.jsx)(ne,{})}))})),emptyLabel:(0,b.jsx)("span",{className:"text-secondary",children:"No views found"}),isLoading:s||d},...oe[j.DATA_MODELING]?[{name:"Materialized views",items:n.map(R=>({name:R.name,table:R,dropdownOverlay:Ee(R),items:Object.values(R.fields).map(H=>({name:H.name,type:H.type,icon:(0,b.jsx)(ne,{})}))})),emptyLabel:(0,b.jsx)("span",{className:"text-secondary",children:"No materialized views found"}),isLoading:s||d}]:[]]:[{name:"External",items:Object.keys(t).map(z=>({name:z,items:t[z].map(R=>({table:R,icon:(0,b.jsx)(ne,{})}))})),emptyLabel:(0,b.jsx)("span",{className:"text-secondary",children:"No tables found"}),isLoading:s},{name:"PostHog",items:o.map(z=>({table:z,icon:(0,b.jsx)(ne,{})})),isLoading:s},{name:"Views",items:l.map(z=>({table:z,icon:(0,b.jsx)(Wt,{})})),emptyLabel:(0,b.jsx)("span",{className:"text-secondary",children:"No views found"}),isLoading:s||d},...oe[j.DATA_MODELING]?[{name:"Materialized views",items:n.map(z=>({table:z,icon:(0,b.jsx)(Wt,{})})),emptyLabel:(0,b.jsx)("span",{className:"text-secondary",children:"No materialized views found"}),isLoading:s||d}]:[]];return(0,b.jsxs)("div",{className:(0,qo.clsx)("bg-surface-primary rounded space-y-px border p-2 overflow-y-auto",L?"":"min-w-80 flex-1"),children:[L?(0,b.jsx)(P,{icon:(0,b.jsx)(ne,{}),onClick:()=>k(!1)}):r?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(P,{size:"xsmall",onClick:()=>k(!0),fullWidth:!0,icon:(0,b.jsx)(ne,{}),className:"font-normal",children:(0,b.jsx)("span",{className:"uppercase text-secondary tracking-wider",children:"Sources"})}),(0,b.jsx)(Vt,{onSelectRow:g,items:te(),selectedRow:a})]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("span",{className:"text-secondary tracking-wider font-normal",children:"Sources"}),(0,b.jsx)(Vt,{onSelectRow:g,items:te(),selectedRow:a})]}),(0,b.jsx)(ot,{width:"50rem",isOpen:!!a&&c,onClose:()=>{g(null),E()},title:"Table Schema",children:(0,b.jsx)(Fo,{})}),(0,b.jsx)(Qr,{}),a&&(0,b.jsx)(Go,{table:a,isOpen:Ie,setIsOpen:Re,onDelete:()=>{a&&(a.type==="view"||a.type==="materialized_view"?m(a.id):I(a.id))}})]})};export{uo as a,ao as b,Oa as c,Va as d,Je as e,ge as f,xo as g,Bo as h,$d as i,xe as j};
//# sourceMappingURL=/static/chunk-YDKHEMDP.js.map
