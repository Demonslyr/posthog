import{a as V,b as _,c as N,e as E,f as J}from"/static/chunk-QB3AUFV2.js";import"/static/chunk-PWG7LMNW.js";import"/static/chunk-CEZSENEJ.js";import{Ae as A,Do as g,Io as P,Kg as B,Sd as w,a as L,f as D,io as F,r as T,ze as M}from"/static/chunk-TW5IU73S.js";import"/static/chunk-XPJ4MQJV.js";import{a as j}from"/static/chunk-3UDJFOQH.js";import"/static/chunk-HHT4SG7V.js";import"/static/chunk-K7LQKAJG.js";import"/static/chunk-QQTK3LZH.js";import"/static/chunk-IJQNM355.js";import"/static/chunk-4CN6THWS.js";import"/static/chunk-272RTCFX.js";import"/static/chunk-2ROB4QWU.js";import"/static/chunk-ALT2ZZSO.js";import"/static/chunk-UE6SLBBN.js";import"/static/chunk-GINZUAUY.js";import"/static/chunk-SQELCOUW.js";import"/static/chunk-IGYUTZ65.js";import"/static/chunk-YM6UBNGD.js";import"/static/chunk-C6TQ5FFZ.js";import"/static/chunk-GXGA523B.js";import"/static/chunk-N4MMWRNK.js";import"/static/chunk-NRLAI7OY.js";import"/static/chunk-LVVHNICT.js";import"/static/chunk-2AXSSSSX.js";import"/static/chunk-DGXQI7RB.js";import"/static/chunk-HUCRWDLX.js";import"/static/chunk-RFEQG3YN.js";import"/static/chunk-PUISI233.js";import{d,e as C,g as y,j as b}from"/static/chunk-SJXEOBQC.js";C();b();y();var R=d(L());var v=d(j());C();b();y();var i=d(L()),k=d(D());var f=(0,i.kea)([(0,i.path)(["scenes","debug","HogRepl"]),(0,i.actions)({runCode:e=>({code:e}),setResult:(e,t,s)=>({index:e,result:t,error:s}),print:(e,t)=>({index:e,line:t}),setBytecode:(e,t,s)=>({index:e,bytecode:t,locals:s}),setVMState:(e,t)=>({index:e,state:t}),setCurrentCode:e=>({code:e}),runCurrentCode:!0,editFromHere:e=>({index:e}),setReplChunks:e=>({replChunks:e})}),(0,i.reducers)({currentCode:["",{setCurrentCode:(e,{code:t})=>t}],replChunks:[[],{setReplChunks:(e,{replChunks:t})=>t,runCode:(e,{code:t})=>[...e,{code:t,status:"pending"}],setResult:(e,{index:t,result:s,error:r})=>e.map((o,l)=>l===t?{...o,result:s,error:r,status:r?"error":"success"}:o),setBytecode:(e,{index:t,bytecode:s,locals:r})=>e.map((o,l)=>l===t?{...o,bytecode:s,locals:r}:o),print:(e,{index:t,line:s})=>e.map((r,o)=>o===t?{...r,print:[...r.print??[],s]}:r),setVMState:(e,{index:t,state:s})=>e.map((r,o)=>o===t?{...r,state:s}:r)}]}),(0,i.selectors)({lastLocals:[e=>[e.replChunks],e=>{for(let t=e.length-1;t>=0;t--)if(e[t].locals)return e[t].locals}],lastState:[e=>[e.replChunks],e=>{for(let t=e.length-1;t>=0;t--)if(e[t].state)return e[t].state}],lastLocalGlobals:[e=>[e.lastLocals],e=>{if(e)return e.reduce((t,s)=>({...t,[s[0]]:"local"}),{})}]}),(0,i.listeners)(({actions:e,values:t})=>({editFromHere:({index:s})=>{let r=[...t.replChunks.slice(s).map(o=>o.code),t.currentCode].join(`
`);e.setCurrentCode(r.replace(/\n+$/,"")),e.setReplChunks(t.replChunks.slice(0,s))},runCode:async({code:s})=>{let r=t.replChunks.length-1,{lastLocals:o,lastState:l}=t;try{let a=await P.hog.create(s,o,!0),[c,x,...m]=a.bytecode,O=a.locals;e.setBytecode(r,m,O);let p=[c,x];for(let h of t.replChunks)h.bytecode&&p.push(...h.bytecode);let H=p.length-m.length;p[p.length-1]===35&&p.pop();let S=[...l?.stack??[]];S.length!==o?.length&&S.splice(o?.length??0);let U={stack:S??[],bytecodes:{root:{bytecode:p}},callStack:[{ip:H,chunk:"root",stackStart:0,argCount:0,closure:V(_("local",{name:"",argCount:0,upvalueCount:0,ip:H,chunk:"root"}))}],upvalues:l?.upvalues??[],ops:l?.ops??0,asyncSteps:l?.asyncSteps??0,declaredFunctions:l?.declaredFunctions??{},throwStack:l?.throwStack??[],maxMemUsed:l?.maxMemUsed??0,syncDuration:l?.syncDuration??0},u=await E(U,{repl:!0,functions:{print:(...h)=>{e.print(r,h)}}}),X=u.result!==void 0?u.result:(u.state?.stack?.length??0)>0?u.state?.stack?.[u.state.stack.length-1]:"null";e.setResult(r,X),e.setVMState(r,u.state)}catch(a){console.error(a),e.setResult(r,void 0,(a.error||a.message||a).toString())}},runCurrentCode:()=>{e.runCode(t.currentCode),e.setCurrentCode("")}})),(0,k.actionToUrl)(({values:e})=>{let t=()=>{if(e.replChunks.length>0){if(JSON.stringify(e.replChunks).length>1048576){let r=e.replChunks.map(o=>o.code).join(`
`);return r.length>1048576?[g.debugHog(),void 0,void 0,{replace:!0}]:[g.debugHog(),void 0,{code:r},{replace:!0}]}return[g.debugHog(),void 0,{repl:e.replChunks,code:e.currentCode},{replace:!0}]}};return{setReplChunks:t,runCode:t,setResult:t,setBytecode:t,print:t,setVMState:t,setCurrentCode:t}}),(0,k.urlToAction)(({actions:e,values:t})=>({[g.debugHog()]:(s,r,{repl:o,code:l},{method:a})=>{(a==="PUSH"||(o||l)&&!t.currentCode&&t.replChunks.length===0)&&(e.setReplChunks(o),e.setCurrentCode(l))}}))]);var n=d(T());function Q({response:e}){let[t,s]=(0,v.useState)("table");return(0,n.jsx)("div",{children:(0,n.jsx)(A,{activeKey:t,onChange:s,tabs:[{key:"table",label:"Table",content:(0,n.jsx)(M,{columns:e.columns.map((r,o)=>({dataIndex:o,title:r})),dataSource:e.results})},{key:"json",label:"JSON",content:(0,n.jsx)(F,{name:!1,src:e})},{key:"raw",label:"Raw",content:(0,n.jsx)("div",{children:N(e)})}]})})}function z(e){if(typeof e=="object"&&e!==null){if("__hx_tag"in e)return J(e);if("results"in e&&"columns"in e&&Array.isArray(e.results)&&Array.isArray(e.columns))return(0,n.jsx)(Q,{response:e})}return N(e)}function W({chunk:{code:e,result:t,print:s,error:r,status:o},editFromHere:l}){return(0,n.jsxs)("div",{className:"pb-2 border-b border-gray-300",children:[(0,n.jsx)(w,{size:"small",type:"secondary",className:"float-right",onClick:l,children:"\u{1F4DD}"}),(0,n.jsxs)("div",{className:"flex items-start",children:[(0,n.jsx)("span",{style:{color:"blue"},children:">"}),(0,n.jsx)("div",{className:"flex-1 whitespace-pre-wrap ml-2",children:e})]}),o==="pending"&&(0,n.jsx)("div",{className:"flex items-center ml-4 mt-2",children:(0,n.jsxs)("svg",{className:"animate-spin h-5 w-5 text-gray-500 mr-2",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,n.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,n.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v8z"})]})}),s&&Array.isArray(s)?(0,n.jsxs)("div",{className:"flex items-start mt-2",children:[(0,n.jsx)("span",{style:{color:"green"},children:"#"}),(0,n.jsx)("div",{className:"flex-1 whitespace-pre-wrap ml-2",children:s.map((a,c)=>(0,n.jsx)("div",{children:a.map((x,m)=>(0,n.jsxs)(v.default.Fragment,{children:[z(x),m<a.length-1?" ":""]},m))},c))})]}):null,o==="success"&&t!==void 0&&(0,n.jsxs)("div",{className:"flex items-start mt-2",children:[(0,n.jsx)("span",{style:{color:"green"},children:"<"}),(0,n.jsx)("div",{className:"flex-1 whitespace-pre-wrap ml-2",children:z(t)})]}),o==="error"&&(0,n.jsxs)("div",{className:"flex items-start mt-2",children:[(0,n.jsx)("span",{className:"text-danger",children:"!"}),(0,n.jsx)("div",{className:"flex-1 whitespace-pre-wrap ml-2 text-danger",children:r})]})]})}function $(){let{replChunks:e,currentCode:t,lastLocalGlobals:s}=(0,R.useValues)(f),{runCurrentCode:r,setCurrentCode:o,editFromHere:l}=(0,R.useActions)(f);return(0,n.jsx)("div",{className:"p-4 bg-white text-black font-mono",children:(0,n.jsxs)("div",{className:"space-y-4",children:[e.map((a,c)=>(0,n.jsx)(W,{chunk:a,editFromHere:()=>l(c)},c)),(0,n.jsxs)("div",{className:"flex items-start",children:[(0,n.jsx)("span",{style:{color:"blue"},children:">"}),(0,n.jsx)("div",{className:"w-full",style:{marginLeft:-10,marginTop:-7,marginRight:-5,marginBottom:-5},children:(0,n.jsx)(B,{language:"hog",embedded:!0,className:"flex-1 bg-transparent focus:outline-none resize-none ml-2 p-0",value:t,onChange:a=>o(a??""),onPressCmdEnter:r,onPressUpNoValue:()=>{let a=f.findMounted()?.values.replChunks??[];a.length>0&&l(a.length-1)},options:{fontSize:14,padding:{top:0,bottom:0}},globals:s,autoFocus:!0})}),(0,n.jsx)(w,{size:"small",type:"primary",onClick:r,children:"\u2318\u23CE"})]})]})})}var me={component:$,logic:f};export{$ as HogRepl,W as ReplChunk,Q as ReplResultsTable,me as scene};
//# sourceMappingURL=/static/HogRepl-TVLMA5NF.js.map
