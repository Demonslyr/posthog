import{a as p,b as l,c as k}from"/static/chunk-G6Q3YRDS.js";import{Do as x,Io as t,Vd as a,Za as M,a as D,af as u,f as w}from"/static/chunk-RFJTZKD6.js";import{Ea as G}from"/static/chunk-3UDJFOQH.js";import{d as I,e as g,g as c,j as f}from"/static/chunk-SJXEOBQC.js";g();f();c();var $=I(D()),q=I(M()),H=I(w());var y="/static/assets/google-ads-RWFJAUDR.png";var X="/static/assets/google-cloud-WTGGLKGO.png";var m="/static/assets/linkedin-YPGZB423.png";var Z="/static/assets/slack-EDCRACS4.png";var O="/static/assets/snapchat-IAEQCM4I.png";var W={slack:Z,salesforce:k,hubspot:l,"google-pubsub":X,"google-cloud-storage":p,"google-ads":y,snapchat:O,"linkedin-ads":m},ao=(0,$.kea)([(0,$.path)(["lib","integrations","integrationsLogic"]),(0,$.connect)({values:[u,["siteUrlMisconfigured","preflight"]]}),(0,$.actions)({handleOauthCallback:(o,e)=>({kind:o,searchParams:e}),newGoogleCloudKey:(o,e,r)=>({kind:o,key:e,callback:r}),deleteIntegration:o=>({id:o})}),(0,q.loaders)(({values:o})=>({integrations:[null,{loadIntegrations:async()=>(await t.integrations.list()).results.map(r=>({...r,icon_url:W[r.kind]})),newGoogleCloudKey:async({kind:e,key:r,callback:s})=>{try{let d=new FormData;d.append("kind",e),d.append("key",r);let n=await t.integrations.create(d),_={...n,icon_url:W[e]??W["google-pubsub"]};return window.setTimeout(()=>s?.(_),0),o.integrations?.find(i=>i.kind===e&&i.display_name===n.display_name)?(a.success("Google Cloud key updated."),o.integrations.map(i=>i.kind===e&&i.display_name===n.display_name?_:i)):(a.success("Google Cloud key created."),[...o.integrations??[],_])}catch(d){throw a.error("Failed to upload Google Cloud key."),d}}}]})),(0,$.listeners)(({actions:o})=>({handleOauthCallback:async({kind:e,searchParams:r})=>{let{state:s,code:d,error:n}=r,{next:_}=G(s),i=_||x.settings("project-integrations");if(n){a.error(`Failed due to "${n}"`),H.router.actions.replace(i);return}try{let F=await t.integrations.create({kind:e,config:{state:s,code:d}});i+=`${i.includes("?")?"&":"?"}integration_id=${F.id}`,o.loadIntegrations(),a.success("Integration successful.")}catch{a.error("Something went wrong. Please try again.")}finally{H.router.actions.replace(i)}},deleteIntegration:async({id:e})=>{await t.integrations.delete(e),o.loadIntegrations()}})),(0,$.afterMount)(({actions:o})=>{o.loadIntegrations()}),(0,H.urlToAction)(({actions:o})=>({"/integrations/:kind/callback":({kind:e=""},r)=>{o.handleOauthCallback(e,r)}})),(0,$.selectors)({slackIntegrations:[o=>[o.integrations],o=>o?.filter(e=>e.kind=="slack")],slackAvailable:[o=>[o.preflight],o=>o?.slack_service?.available]})]);export{ao as a};
//# sourceMappingURL=/static/chunk-SSCAQKOK.js.map
