import{b as or}from"/static/chunk-2D47HF5T.js";import{a as tt,b as nr,c as rr,d as ir,e as ar}from"/static/chunk-DH2YOUXA.js";import{a as Lt,b as tr}from"/static/chunk-ZTROLN7N.js";import{a as he,c as Et,d as Mt,e as Hn,f as Qn,h as Zn,i as Kn,j as er}from"/static/chunk-36DSVTR6.js";import{a as Tt}from"/static/chunk-DXU2OWVA.js";import{a as _t}from"/static/chunk-ZDFMFKTJ.js";import"/static/chunk-X3DMY2SE.js";import{a as jn}from"/static/chunk-FQ666B2X.js";import"/static/chunk-XW2JOKCQ.js";import{d as u,i as bt}from"/static/chunk-VVSLW35Y.js";import{a as Gn}from"/static/chunk-KYJ4OXJI.js";import"/static/chunk-GVAK35JD.js";import"/static/chunk-HOCRDURT.js";import"/static/chunk-KHKNIVWH.js";import"/static/chunk-34UVU7UN.js";import{j as Be}from"/static/chunk-CBJ7RAUW.js";import"/static/chunk-XSEDUXPL.js";import"/static/chunk-HRNZBUVG.js";import"/static/chunk-NKVVAJQ7.js";import"/static/chunk-2HTNY362.js";import"/static/chunk-S27Q4QO6.js";import"/static/chunk-JUFFFVO5.js";import"/static/chunk-JZCOVRBI.js";import"/static/chunk-EIJECEWK.js";import{$a as jr,Ac as Ln,Ae as yt,Cd as vt,Ce as Fn,Cg as Dn,Do as Me,Ei as On,Eo as qn,Gm as Un,Ip as Yn,Ki as Yt,Ko as Nt,N as ft,Ne as gt,Nk as Ke,Qd as In,Sa as ee,Sc as Ut,Sd as E,Sk as Re,Ta as ve,Tb as xt,Tc as _n,Tf as Ue,Tk as Pn,Vb as Nn,Vd as $t,Wd as Z,Xh as Qe,Xl as Ht,Yb as En,Zg as Gt,Zi as Wn,_ as fn,a as H,ab as xn,bi as Bn,cc as ue,ce as $,de as Ie,e as qr,ee as ye,em as et,fb as vn,fe as be,ga as De,gb as yn,ge as kn,gg as An,h as Yr,ie as le,ig as Vn,jb as gn,je as ke,ji as Ze,jl as jt,jo as $n,ki as qt,mc as Mn,ol as zn,pe as He,pl as Xn,ql as ht,r as k,rd as wn,rl as Jn,sb as hn,se as Rn,tb as Jt,tc as Tn,td as Sn,vd as Cn,wb as bn,ze as ge}from"/static/chunk-RFJTZKD6.js";import"/static/chunk-XPJ4MQJV.js";import"/static/chunk-KQJ3FYBQ.js";import{A as Pt,B as Je,F as zt,Ha as un,a as Ve,fb as de,na as Xt}from"/static/chunk-3UDJFOQH.js";import"/static/chunk-HHT4SG7V.js";import"/static/chunk-K7LQKAJG.js";import"/static/chunk-QQTK3LZH.js";import"/static/chunk-IJQNM355.js";import"/static/chunk-4CN6THWS.js";import"/static/chunk-272RTCFX.js";import"/static/chunk-2ROB4QWU.js";import"/static/chunk-ALT2ZZSO.js";import"/static/chunk-UE6SLBBN.js";import"/static/chunk-GINZUAUY.js";import"/static/chunk-SQELCOUW.js";import"/static/chunk-IGYUTZ65.js";import"/static/chunk-YM6UBNGD.js";import"/static/chunk-C6TQ5FFZ.js";import"/static/chunk-GXGA523B.js";import"/static/chunk-N4MMWRNK.js";import"/static/chunk-NRLAI7OY.js";import"/static/chunk-LVVHNICT.js";import"/static/chunk-2AXSSSSX.js";import"/static/chunk-DGXQI7RB.js";import"/static/chunk-HUCRWDLX.js";import"/static/chunk-RFEQG3YN.js";import"/static/chunk-PUISI233.js";import{d as f,e as w,g as S,j as C}from"/static/chunk-SJXEOBQC.js";w();C();S();var Br=f(H());w();C();S();var Te=f(H()),nt=f(jr());var sr=f(Ve());var l=f(k()),Hr=()=>{let{experiment:e,groupTypes:t,aggregationLabel:r,hasPrimaryMetricSet:i,validExistingFeatureFlag:o}=(0,Te.useValues)(u),{addVariant:s,removeExperimentGroup:a,setExperiment:c,createExperiment:m,setExperimentType:d,validateFeatureFlag:x}=(0,Te.useActions)(u),{webExperimentsAvailable:N,unavailableFeatureFlagKeys:p}=(0,Te.useValues)(Gt),{groupsAccessStatus:v}=(0,Te.useValues)(An),{reportExperimentFeatureFlagModalOpened:y,reportExperimentFeatureFlagSelected:R}=(0,Te.useActions)(Yn),[_,B]=(0,sr.useState)(!1);return(0,l.jsxs)("div",{children:[i&&(0,l.jsx)(Z,{type:"info",className:"my-4",children:"Fill out the details below to create your experiment based off of the insight."}),(0,l.jsxs)("div",{className:"space-y-8",children:[(0,l.jsxs)("div",{className:"space-y-6 max-w-120",children:[(0,l.jsx)(Ue,{name:"name",label:"Name",children:(0,l.jsx)(le,{placeholder:"Pricing page conversion","data-attr":"experiment-name"})}),(0,l.jsx)(Ue,{name:"feature_flag_key",label:"Feature flag key",help:(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,l.jsx)("span",{children:"Each experiment is backed by a feature flag. Create a new one by entering a key, or choose an existing feature flag with multiple variants."}),(0,l.jsxs)(E,{type:"secondary",size:"xsmall",onClick:()=>{y(),B(!0)},children:[(0,l.jsx)(wn,{className:"mr-1"})," Choose"]}),(0,l.jsxs)(E,{type:"secondary",size:"xsmall",disabledReason:e.name?void 0:"Fill out the experiment name first to generate a key from it.",tooltip:e.name?"Generate a key from the experiment name":void 0,onClick:()=>{c({feature_flag_key:Qr(e.name,p)})},children:[(0,l.jsx)(Mn,{className:"mr-1"})," Generate"]})]}),children:(0,l.jsx)(le,{placeholder:"pricing-page-conversion","data-attr":"experiment-feature-flag-key"})}),(0,l.jsx)(Ue,{name:"description",label:"Description",children:(0,l.jsx)(Fn,{placeholder:"The goal of this experiment is ...","data-attr":"experiment-description"})})]}),(0,l.jsx)(Zr,{isOpen:_,onClose:()=>B(!1),onSelect:M=>{R(M),c({feature_flag_key:M}),x(M),B(!1)}}),N&&(0,l.jsxs)("div",{className:"mt-10",children:[(0,l.jsx)("h3",{className:"mb-1",children:"Experiment type"}),(0,l.jsx)("div",{className:"text-xs text-secondary font-medium tracking-normal",children:"Select your experiment setup, this cannot be changed once saved."}),(0,l.jsx)(ye,{}),(0,l.jsx)(qt,{value:e.type,className:"space-y-2 -mt-2",onChange:M=>{d(M)},options:[{value:"product",label:(0,l.jsxs)("div",{className:"translate-y-2",children:[(0,l.jsx)("div",{children:"Product experiment"}),(0,l.jsx)("div",{className:"text-xs text-secondary",children:"Use custom code to manage how variants modify your product."})]})},{value:"web",label:(0,l.jsxs)("div",{className:"translate-y-2",children:[(0,l.jsx)("div",{children:"No-code web experiment"}),(0,l.jsx)("div",{className:"text-xs text-secondary",children:"Define variants on your website using the PostHog toolbar, no coding required."})]})}]})]}),v===0&&(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"mt-10",children:"Participant type"}),(0,l.jsx)("div",{className:"text-xs text-secondary",children:"The type on which to aggregate metrics. You can change this at any time during the experiment."}),(0,l.jsx)(ye,{}),(0,l.jsx)(qt,{value:e.parameters.aggregation_group_type_index!=null?e.parameters.aggregation_group_type_index:-1,onChange:M=>{let I=M!==-1?M:void 0;c({parameters:{...e.parameters,aggregation_group_type_index:I??void 0}})},options:[{value:-1,label:"Persons"},...Array.from(t.values()).map(M=>({value:M.group_type_index,label:un(r(M.group_type_index).plural)}))]})]}),o&&(0,l.jsxs)("div",{className:"mt-10",children:[(0,l.jsx)("h3",{className:"mb-1",children:"Variants"}),(0,l.jsx)(ye,{}),(0,l.jsx)(Z,{type:"info",className:"mb-8",children:(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)("div",{children:"Existing feature flag configuration will be applied to the experiment."}),(0,l.jsx)(ve,{to:Me.featureFlag(o.id),target:"_blank",className:"flex items-center",children:(0,l.jsx)(De,{className:"ml-1"})})]})})]}),!o&&(0,l.jsx)(l.Fragment,{children:(0,l.jsxs)("div",{className:"mt-10",children:[(0,l.jsx)("h3",{className:"mb-1",children:"Variants"}),(0,l.jsxs)("div",{className:"text-xs text-secondary",children:["Add up to ",Pt-1," variants to test against your control."]}),(0,l.jsx)(ye,{}),(0,l.jsxs)("div",{className:"grid grid-cols-2 gap-4 max-w-160",children:[(0,l.jsxs)("div",{className:"max-w-60",children:[(0,l.jsx)("h3",{children:"Control"}),(0,l.jsx)("div",{className:"flex items-center",children:(0,l.jsxs)(nt.Group,{name:["parameters","feature_flag_variants",0],children:[(0,l.jsx)(Yt,{index:0,className:"h-7 w-7 text-base"}),(0,l.jsx)(Ue,{name:"key",className:"ml-2 flex-grow",children:(0,l.jsx)(le,{disabled:!0,"data-attr":"experiment-variant-key","data-key-index":0,className:"ph-ignore-input",fullWidth:!0,autoComplete:"off",autoCapitalize:"off",autoCorrect:"off",spellCheck:!1})})]},0)}),(0,l.jsx)("div",{className:"text-muted text-xs mt-2",children:"Included automatically, cannot be edited or removed"})]}),(0,l.jsxs)("div",{className:"max-w-100",children:[(0,l.jsx)("h3",{children:"Test(s)"}),e.parameters.feature_flag_variants?.map((M,I)=>I===0?null:(0,l.jsx)(nt.Group,{name:["parameters","feature_flag_variants",I],children:(0,l.jsxs)("div",{className:`flex items-center space-x-2 ${I>1&&"mt-2"}`,children:[(0,l.jsx)(Yt,{index:I,className:"h-7 w-7 text-base"}),(0,l.jsx)(Ue,{name:"key",className:"flex-grow",children:(0,l.jsx)(le,{"data-attr":"experiment-variant-key","data-key-index":I.toString(),className:"ph-ignore-input",fullWidth:!0,autoComplete:"off",autoCapitalize:"off",autoCorrect:"off",spellCheck:!1})}),(0,l.jsx)("div",{className:`${I===1&&"pr-9"}`,children:I!==1&&(0,l.jsx)(ee,{title:"Delete this variant",placement:"top-start",children:(0,l.jsx)(E,{size:"small",icon:(0,l.jsx)(Sn,{}),onClick:()=>a(I)})})})]},`variant-${I}`)},I)),(0,l.jsx)("div",{className:"text-secondary text-xs ml-9 mr-20 mt-2",children:"Alphanumeric, hyphens and underscores only"}),(e.parameters.feature_flag_variants.length??0)<Pt&&(0,l.jsx)(E,{className:"ml-9 mt-2",type:"secondary",onClick:()=>s(),icon:(0,l.jsx)(_n,{}),"data-attr":"add-test-variant",children:"Add test variant"})]})]})]})})]}),(0,l.jsx)(E,{className:"mt-2",type:"primary","data-attr":"save-experiment",onClick:()=>m(!0),children:"Save as draft"})]})};function lr(){let{props:e}=(0,Te.useValues)(u);return(0,l.jsx)("div",{children:(0,l.jsx)(nt.Form,{id:"experiment-step",logic:u,formKey:"experiment",props:e,enableFormOnSubmit:!0,className:"space-y-6 experiment-form",children:(0,l.jsx)(Hr,{})})})}var Qr=(e,t)=>{let r=e.toLowerCase().replace(/[^A-Za-z0-9-_]+/g,"-").replace(/-+$/,"").replace(/^-+/,""),i=r,o=1;for(;t.has(i);)i=`${r}-${o}`,o++;return i},Zr=({isOpen:e,onClose:t,onSelect:r})=>{let{featureFlags:i}=(0,Te.useValues)(Gt);return(0,l.jsx)($,{isOpen:e,onClose:t,title:"Choose an existing feature flag",children:(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsxs)("div",{className:"text-muted mb-2 max-w-xl",children:["Select an existing feature flag to use with this experiment. The feature flag must use multiple variants with ",(0,l.jsx)("code",{children:"'control'"})," as the first, and not be associated with an existing experiment."]}),(0,l.jsx)(ge,{dataSource:i.results,useURLForSorting:!1,columns:[{title:"Key",dataIndex:"key",sorter:(o,s)=>(o.key||"").localeCompare(s.key||""),render:(o,s)=>(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)("div",{className:"font-semibold",children:o}),(0,l.jsx)(ve,{to:Me.featureFlag(s.id),target:"_blank",className:"flex items-center",children:(0,l.jsx)(De,{className:"ml-1"})})]})},{title:"Name",dataIndex:"name",sorter:(o,s)=>(o.name||"").localeCompare(s.name||"")},{title:null,render:function(s,a){let c;try{zn(a)}catch(m){c=m.message}return(0,l.jsx)(E,{size:"xsmall",type:"primary",disabledReason:c,onClick:()=>{r(a.key),t()},children:"Select"})}}]})]})})};w();C();S();var Ye=f(H());w();C();S();var ae=f(k());function mr({experiment:e}){return(0,ae.jsx)(ae.Fragment,{children:(0,ae.jsxs)("div",{children:[(0,ae.jsx)("h2",{className:"font-semibold text-lg mb-2",children:"Implementation"}),(0,ae.jsxs)("div",{className:"border p-6 rounded bg-surface-primary space-y-2",children:[(0,ae.jsx)("div",{className:"font-semibold leading-tight text-base text-current",children:"Define variant changes directly on your website"}),(0,ae.jsx)("div",{className:"text-sm text-secondary",children:"Use our toolbar to select elements and apply transformations for each variant."}),(0,ae.jsx)("div",{children:(0,ae.jsx)(E,{size:"small",type:"secondary",onClick:()=>{Ie.open({title:"Select a domain",description:e?.id?"Choose the domain on which to edit this experiment":"Choose the domain on which to create this experiment",content:(0,ae.jsx)(ae.Fragment,{children:(0,ae.jsx)(_t,{experimentId:e?.id,type:"TOOLBAR_URLS"})}),primaryButton:{children:"Close",type:"secondary"}})},sideIcon:(0,ae.jsx)(ft,{}),children:"Launch toolbar on your website"})})]})]})})}w();C();S();var wt=f(H());var oe=f(k());function Qt({experimentId:e,isSecondary:t}){let{experiment:r,experimentLoading:i,isPrimaryMetricModalOpen:o,isSecondaryMetricModalOpen:s,editingPrimaryMetricIndex:a,editingSecondaryMetricIndex:c}=(0,wt.useValues)(u({experimentId:e})),{setMetric:m,updateExperimentGoal:d,setExperiment:x,closePrimaryMetricModal:N,closeSecondaryMetricModal:p,restoreUnmodifiedExperiment:v}=(0,wt.useActions)(u({experimentId:e})),y=t?c:a,R=t?"metrics_secondary":"metrics";if(!y&&y!==0)return(0,oe.jsx)(oe.Fragment,{});let _=r[R],B=_[y],M=()=>{v(),t?p():N()};return(0,oe.jsxs)($,{isOpen:t?s:o,onClose:M,width:1e3,title:"Edit experiment metric",footer:(0,oe.jsxs)("div",{className:"flex items-center w-full",children:[(0,oe.jsx)(E,{type:"secondary",status:"danger",onClick:()=>{Ie.open({title:"Delete this metric?",content:(0,oe.jsx)("div",{className:"text-sm text-muted",children:"This action cannot be undone."}),primaryButton:{children:"Delete",type:"primary",onClick:()=>{let I=_.filter((V,W)=>W!==y);x({[R]:I}),d(),t?p():N()},size:"small"},secondaryButton:{children:"Cancel",type:"tertiary",size:"small"}})},children:"Delete"}),(0,oe.jsxs)("div",{className:"flex items-center gap-2 ml-auto",children:[(0,oe.jsx)(E,{form:"edit-experiment-metric-form",type:"secondary",onClick:M,children:"Cancel"}),(0,oe.jsx)(E,{form:"edit-experiment-metric-form",onClick:()=>{d(),t?p():N()},type:"primary",loading:i,"data-attr":"save-experiment-metric",children:"Save"})]})]}),children:[(0,oe.jsxs)("div",{className:"mb-4",children:[(0,oe.jsx)(ke,{children:"Name (optional)"}),(0,oe.jsx)(le,{value:B.name,onChange:I=>{m({metricIdx:y,metric:{...B,name:I},isSecondary:t})}})]}),(0,oe.jsx)(ar,{metric:B,handleSetMetric:({newMetric:I})=>{m({metricIdx:y,metric:I,isSecondary:t})}})]})}w();C();S();var Ct=f(H());w();C();S();var rt=f(H());var te=f(k());function cr({isSecondary:e=!1}){let{currentTeam:t}=(0,rt.useValues)(Nt),{experiment:r,isExperimentRunning:i,editingPrimaryMetricIndex:o,editingSecondaryMetricIndex:s}=(0,rt.useValues)(u),{setFunnelsMetric:a}=(0,rt.useActions)(u),c=(t?.test_account_filters||[]).length>0,m=e?r.metrics_secondary:r.metrics,d=e?s:o;if(!d&&d!==0)return(0,te.jsx)(te.Fragment,{});let x=m[d],N={...tt,actionsTaxonomicGroupTypes:["events","actions"]};return(0,te.jsxs)(te.Fragment,{children:[(0,te.jsxs)("div",{className:"mb-4",children:[(0,te.jsx)(ke,{children:"Name (optional)"}),(0,te.jsx)(le,{value:x.name,onChange:p=>{a({metricIdx:d,name:p,isSecondary:e})}})]}),(0,te.jsx)(Ze,{bordered:!0,filters:Qe(x.funnels_query),setFilters:({actions:p,events:v,data_warehouse:y})=>{let R=et({actions:p,events:v,data_warehouse:y},!0,3);a({metricIdx:d,series:R,isSecondary:e})},typeKey:"experiment-metric",mathAvailability:3,buttonCopy:"Add funnel step",showSeriesIndicator:!0,seriesIndicatorType:"numeric",sortable:!0,showNestedArrow:!0,...N}),(0,te.jsxs)("div",{className:"mt-4 space-y-4",children:[(0,te.jsx)(nr,{value:On(x.funnels_query.aggregation_group_type_index??void 0,x.funnels_query.funnelsFilter?.funnelAggregateByHogQL??void 0),onChange:p=>{a({metricIdx:d,funnelAggregateByHogQL:p,isSecondary:e})}}),(0,te.jsx)(rr,{funnelWindowInterval:x.funnels_query?.funnelsFilter?.funnelWindowInterval,funnelWindowIntervalUnit:x.funnels_query?.funnelsFilter?.funnelWindowIntervalUnit,onFunnelWindowIntervalChange:p=>{a({metricIdx:d,funnelWindowInterval:p,isSecondary:e})},onFunnelWindowIntervalUnitChange:p=>{a({metricIdx:d,funnelWindowIntervalUnit:p||void 0,isSecondary:e})}}),(0,te.jsx)(ir,{value:(()=>{let p=x.funnels_query?.funnelsFilter?.breakdownAttributionType,v=x.funnels_query?.funnelsFilter?.breakdownAttributionValue;return p?p==="step"?`${p}/${v||0}`:p:"first_touch"})(),onChange:p=>{let[v,y]=(p||"").split("/");a({metricIdx:d,breakdownAttributionType:v,breakdownAttributionValue:y?parseInt(y):void 0,isSecondary:e})},stepsLength:x.funnels_query?.series?.length}),(0,te.jsx)(Ke,{checked:(()=>{let p=x.funnels_query?.filterTestAccounts;return c?!!p:!1})(),onChange:p=>{a({metricIdx:d,filterTestAccounts:p,isSecondary:e})},fullWidth:!0})]}),i&&(0,te.jsxs)(Z,{type:"info",className:"mt-3 mb-3",children:["Preview insights are generated based on ",Je," days of data. This can cause a mismatch between the preview and the actual results."]}),(0,te.jsx)("div",{className:"mt-4",children:(0,te.jsx)(Be,{query:{kind:"InsightVizNode",source:x.funnels_query,showTable:!1,showLastComputation:!0,showLastComputationRefresh:!1},readOnly:!0})})]})}w();C();S();var at=f(H());var dr=f(Ve());var A=f(k());function pr({isSecondary:e=!1}){let{experiment:t,isExperimentRunning:r,editingPrimaryMetricIndex:i,editingSecondaryMetricIndex:o}=(0,at.useValues)(u),{setTrendsMetric:s,setTrendsExposureMetric:a,setExperiment:c}=(0,at.useActions)(u),{currentTeam:m}=(0,at.useValues)(Nt),d=(m?.test_account_filters||[]).length>0,[x,N]=(0,dr.useState)("main"),p=e?t.metrics_secondary:t.metrics,v=e?o:i;if(!v&&v!==0)return(0,A.jsx)(A.Fragment,{});let y=p[v],R=y.count_query?.series[0]?.kind==="DataWarehouseNode";return(0,A.jsx)(A.Fragment,{children:(0,A.jsx)(yt,{activeKey:x,onChange:_=>N(_),tabs:[{key:"main",label:"Main metric",content:(0,A.jsxs)(A.Fragment,{children:[(0,A.jsxs)("div",{className:"mb-4",children:[(0,A.jsx)(ke,{children:"Name (optional)"}),(0,A.jsx)(le,{value:y.name,onChange:_=>{s({metricIdx:v,name:_,isSecondary:e})}})]}),(0,A.jsx)(Ze,{bordered:!0,filters:Qe(y.count_query),setFilters:({actions:_,events:B,data_warehouse:M})=>{let I=et({actions:_,events:B,data_warehouse:M},!0,0);I[0].kind==="DataWarehouseNode"&&c({...t,[e?"metrics_secondary":"metrics"]:p.map((W,ie)=>ie===v?{...W,exposure_query:void 0}:W)}),s({metricIdx:v,series:I,isSecondary:e})},typeKey:"experiment-metric",buttonCopy:"Add graph series",showSeriesIndicator:!0,entitiesLimit:1,showNumericalPropsOnly:!0,allowedMathTypes:Gn,...tt}),(0,A.jsx)("div",{className:"mt-4 space-y-4",children:(0,A.jsx)(Ke,{checked:d?!!y.count_query?.filterTestAccounts:!1,onChange:_=>{s({metricIdx:v,filterTestAccounts:_,isSecondary:e})},fullWidth:!0})}),r&&(0,A.jsxs)(Z,{type:"info",className:"mt-3 mb-3",children:["Preview insights are generated based on ",Je," days of data. This can cause a mismatch between the preview and the actual results."]}),(0,A.jsx)("div",{className:"mt-4",children:(0,A.jsx)(Be,{query:{kind:"InsightVizNode",source:y.count_query,showTable:!1,showLastComputation:!0,showLastComputationRefresh:!1},readOnly:!0})})]})},{key:"exposure",label:"Exposure",content:(0,A.jsxs)(A.Fragment,{children:[(0,A.jsxs)("div",{className:"flex gap-4 mb-4",children:[(0,A.jsxs)(E,{className:`trends-metric-form__exposure-button flex-1 cursor-pointer p-4 rounded border ${y.exposure_query?"border-border":"border-accent-primary bg-accent-primary-highlight"}`,onClick:()=>{c({...t,[e?"metrics_secondary":"metrics"]:p.map((B,M)=>M===v?{...B,exposure_query:void 0}:B)})},children:[(0,A.jsxs)("div",{className:"font-semibold flex justify-between items-center",children:[(0,A.jsx)("span",{children:"Default"}),!y.exposure_query&&(0,A.jsx)(Jt,{fontSize:18,color:"var(--accent-primary)"})]}),(0,A.jsxs)("div",{className:"text-secondary text-sm leading-relaxed mt-1",children:["Uses the number of unique users who trigger the"," ",(0,A.jsx)(be,{children:"$feature_flag_called"})," event as your exposure count. This is the recommended setting for most experiments, as it accurately tracks variant exposure."]})]}),(0,A.jsxs)(E,{className:`trends-metric-form__exposure-button flex-1 cursor-pointer p-4 rounded border ${y.exposure_query?"border-accent-primary bg-accent-primary-highlight":"border-border"}`,disabledReason:R?"Custom exposure events are not supported for data warehouse metrics. Please contact support if you need this feature.":void 0,onClick:()=>{c({...t,[e?"metrics_secondary":"metrics"]:p.map((B,M)=>M===v?{...B,exposure_query:{kind:"TrendsQuery",series:[{kind:"EventsNode",name:"$feature_flag_called",event:"$feature_flag_called",math:"dau"}],interval:"day",dateRange:{date_from:(0,Xt.default)().subtract(Je,"day").format("YYYY-MM-DDTHH:mm"),date_to:(0,Xt.default)().endOf("d").format("YYYY-MM-DDTHH:mm"),explicitDate:!0},trendsFilter:{display:"ActionsLineGraph"},filterTestAccounts:!0}}:B)})},children:[(0,A.jsxs)("div",{className:"font-semibold flex justify-between items-center",children:[(0,A.jsx)("span",{children:"Custom"}),y.exposure_query&&(0,A.jsx)(Jt,{fontSize:18,color:"var(--accent-primary)"})]}),(0,A.jsx)("div",{className:"text-secondary text-sm leading-relaxed mt-1",children:"Define your own exposure metric for specific use cases, such as counting by sessions instead of users. This gives you full control but requires careful configuration."})]})]}),y.exposure_query&&(0,A.jsxs)(A.Fragment,{children:[(0,A.jsx)(Ze,{bordered:!0,filters:Qe(y.exposure_query),setFilters:({actions:_,events:B,data_warehouse:M})=>{let I=et({actions:_,events:B,data_warehouse:M},!0,0);a({metricIdx:v,series:I,isSecondary:e})},typeKey:"experiment-metric",buttonCopy:"Add graph series",showSeriesIndicator:!0,entitiesLimit:1,showNumericalPropsOnly:!0,...tt}),(0,A.jsx)("div",{className:"mt-4 space-y-4",children:(0,A.jsx)(Ke,{checked:(()=>{let _=y.exposure_query?.filterTestAccounts;return d?!!_:!1})(),onChange:_=>{a({metricIdx:v,filterTestAccounts:_,isSecondary:e})},fullWidth:!0})}),r&&(0,A.jsxs)(Z,{type:"info",className:"mt-3 mb-3",children:["Preview insights are generated based on ",Je," ","days of data. This can cause a mismatch between the preview and the actual results."]}),(0,A.jsx)("div",{className:"mt-4",children:(0,A.jsx)(Be,{query:{kind:"InsightVizNode",source:y.exposure_query,showTable:!1,showLastComputation:!0,showLastComputationRefresh:!1},readOnly:!0})})]})]})}]})})}var ne=f(k());function Zt({experimentId:e,isSecondary:t}){let{experiment:r,experimentLoading:i,getMetricType:o,isPrimaryMetricModalOpen:s,isSecondaryMetricModalOpen:a,editingPrimaryMetricIndex:c,editingSecondaryMetricIndex:m}=(0,Ct.useValues)(u({experimentId:e})),{updateExperimentGoal:d,setExperiment:x,closePrimaryMetricModal:N,closeSecondaryMetricModal:p,restoreUnmodifiedExperiment:v}=(0,Ct.useActions)(u({experimentId:e})),y=t?m:c,R=t?"metrics_secondary":"metrics";if(!y&&y!==0)return(0,ne.jsx)(ne.Fragment,{});let _=r[R],B=_[y],M=o(B),I=B?.funnels_query?.series?.length||0,V=()=>{v(),t?p():N()};return(0,ne.jsxs)($,{isOpen:t?a:s,onClose:V,width:1e3,title:"Edit experiment metric",footer:(0,ne.jsxs)("div",{className:"flex items-center w-full",children:[(0,ne.jsx)(E,{type:"secondary",status:"danger",onClick:()=>{Ie.open({title:"Delete this metric?",content:(0,ne.jsx)("div",{className:"text-sm text-secondary",children:"This action cannot be undone."}),primaryButton:{children:"Delete",type:"primary",onClick:()=>{let W=_.filter((ie,O)=>O!==y);x({[R]:W}),d(),t?p():N()},size:"small"},secondaryButton:{children:"Cancel",type:"tertiary",size:"small"}})},children:"Delete"}),(0,ne.jsxs)("div",{className:"flex items-center gap-2 ml-auto",children:[(0,ne.jsx)(E,{form:"edit-experiment-goal-form",type:"secondary",onClick:V,children:"Cancel"}),(0,ne.jsx)(E,{disabledReason:M==="FUNNELS"&&I<2&&"The experiment needs at least two funnel steps.",form:"edit-experiment-goal-form",onClick:()=>{d(),t?p():N()},type:"primary",loading:i,"data-attr":"create-annotation-submit",children:"Save"})]})]}),children:[(0,ne.jsxs)("div",{className:"flex items-center w-full gap-2 mb-4",children:[(0,ne.jsx)("span",{children:"Metric type"}),(0,ne.jsx)(He,{"data-attr":"metrics-selector",value:M,onChange:W=>{x({...r,[R]:[..._.slice(0,y),W==="TRENDS"?Xn():ht(),..._.slice(y+1)]})},options:[{value:"TRENDS",label:(0,ne.jsx)("b",{children:"Trends"})},{value:"FUNNELS",label:(0,ne.jsx)("b",{children:"Funnels"})}]})]}),M==="TRENDS"?(0,ne.jsx)(pr,{isSecondary:t}):(0,ne.jsx)(cr,{isSecondary:t})]})}w();C();S();var It=f(H());var fe=f(k());function Kt({experimentId:e,isSecondary:t}){let{experiment:r,isPrimaryMetricSourceModalOpen:i,isSecondaryMetricSourceModalOpen:o,shouldUseExperimentMetrics:s}=(0,It.useValues)(u({experimentId:e})),{setExperiment:a,closePrimaryMetricSourceModal:c,closeSecondaryMetricSourceModal:m,openPrimaryMetricModal:d,openSecondaryMetricModal:x,openPrimarySharedMetricModal:N,openSecondarySharedMetricModal:p}=(0,It.useActions)(u({experimentId:e})),v=t?"metrics_secondary":"metrics",y=t?o:i,R=t?m:c,_=t?x:d,B=t?p:N;return(0,fe.jsx)($,{isOpen:y,onClose:R,width:1e3,title:"Choose metric source",children:(0,fe.jsxs)("div",{className:"flex gap-4 mb-4",children:[(0,fe.jsxs)("div",{className:"flex-1 cursor-pointer p-4 rounded border hover:border-accent-primary",onClick:()=>{R();let M=s?Jn():ht(),I=[...r[v],M];a({[v]:I}),_(I.length-1)},children:[(0,fe.jsx)("div",{className:"font-semibold",children:(0,fe.jsx)("span",{children:"Single-use"})}),(0,fe.jsx)("div",{className:"text-secondary text-sm leading-relaxed",children:"Create a new metric specific to this experiment."})]}),(0,fe.jsxs)("div",{className:"flex-1 cursor-pointer p-4 rounded border hover:border-accent-primary",onClick:()=>{R(),B(null)},children:[(0,fe.jsx)("div",{className:"font-semibold",children:(0,fe.jsx)("span",{children:"Shared"})}),(0,fe.jsx)("div",{className:"text-secondary text-sm leading-relaxed",children:"Use a pre-configured metric that can be reused across experiments."})]})]})})}w();C();S();var st=f(H());var ur=f(Ve());w();C();S();var D=f(k());function en({experimentId:e,isSecondary:t}){let{experiment:r,compatibleSharedMetrics:i,isPrimarySharedMetricModalOpen:o,isSecondarySharedMetricModalOpen:s,editingSharedMetricId:a,primaryMetricsLengthWithSharedMetrics:c,secondaryMetricsLengthWithSharedMetrics:m}=(0,st.useValues)(u({experimentId:e})),{closePrimarySharedMetricModal:d,closeSecondarySharedMetricModal:x,addSharedMetricsToExperiment:N,removeSharedMetricFromExperiment:p,restoreUnmodifiedExperiment:v}=(0,st.useActions)(u({experimentId:e})),[y,R]=(0,ur.useState)([]),_=a?"edit":"create",{hasAvailableFeature:B}=(0,st.useValues)(qn);if(!i)return(0,D.jsx)(D.Fragment,{});let M=t?s:o,I=()=>{v(),t?x():d()},V=()=>{if(y.length===0)return"Please select at least one metric";if(!t&&c+y.length>10)return`You can only add up to ${10} primary metrics.`;if(t&&m+y.length>10)return`You can only add up to ${10} secondary metrics.`},W=i.filter(O=>!r.saved_metrics.some(Y=>Y.saved_metric===O.id)),ie=Array.from(new Set(W.filter(O=>O.tags).flatMap(O=>O.tags).filter(Boolean))).sort();return(0,D.jsxs)($,{isOpen:M,onClose:I,width:500,title:_==="create"?"Select one or more shared metrics":"Shared metric",footer:(0,D.jsxs)("div",{className:"flex justify-between w-full",children:[(0,D.jsx)("div",{children:a&&(0,D.jsx)(E,{status:"danger",onClick:()=>{p(a),t?x():d()},type:"secondary",children:"Remove from experiment"})}),(0,D.jsxs)("div",{className:"flex gap-2",children:[(0,D.jsx)(E,{onClick:I,type:"secondary",children:"Cancel"}),_==="create"&&(0,D.jsx)(E,{onClick:()=>{N(y,{type:t?"secondary":"primary"}),t?x():d()},type:"primary",disabledReason:V(),children:y.length<2?"Add metric":"Add metrics"})]})]}),children:[_==="create"&&(0,D.jsx)("div",{className:"space-y-2",children:W.length>0?(0,D.jsxs)(D.Fragment,{children:[r.saved_metrics.length>0&&(0,D.jsx)(Z,{type:"info",children:`Hiding ${r.saved_metrics.length} shared ${r.saved_metrics.length>1?"metrics":"metric"} already in use with this experiment.`}),B("tagging")&&ie.length>0&&(0,D.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,D.jsx)(ke,{children:"Quick select:"}),ie.map((O,Y)=>(0,D.jsx)(E,{size:"xsmall",type:"secondary",onClick:()=>{R(W.filter(j=>j.tags?.includes(O)).map(j=>j.id))},children:O},Y))]}),(0,D.jsx)(ge,{dataSource:W,columns:[{title:"",key:"checkbox",render:(O,Y)=>(0,D.jsx)("input",{type:"checkbox",checked:y.includes(Y.id),onChange:j=>{j.target.checked?R([...y,Y.id]):R(y.filter(mt=>mt!==Y.id))}})},{title:"Name",dataIndex:"name",key:"name"},{title:"Description",dataIndex:"description",key:"description"},...B("tagging")?[{title:"Tags",dataIndex:"tags",key:"tags",render:(O,Y)=>(0,D.jsx)(Dn,{tags:Y.tags||[],staticOnly:!0})}]:[],{title:"Type",key:"type",render:(O,Y)=>Y.query.kind==="ExperimentMetric"?Y.query.metric_type:Y.query.kind==="ExperimentTrendsQuery"?"Trend":"Funnel"}],footer:(0,D.jsx)("div",{className:"flex items-center justify-center m-2",children:(0,D.jsx)(E,{to:Me.experimentsSharedMetrics(),size:"xsmall",type:"tertiary",children:"See all shared metrics"})})})]}):(0,D.jsx)(Z,{className:"w-full",type:"info",action:{children:"New shared metric",to:Me.experimentsSharedMetric("new")},children:i.length>0?"All of your shared metrics are already in this experiment.":"You don't have any shared metrics that match the experiment type. Shared metrics let you create reusable metrics that you can quickly add to any experiment."})}),a&&(0,D.jsx)("div",{children:(()=>{let O=i.find(Y=>Y.id===a);return O?(0,D.jsxs)("div",{className:"space-y-2",children:[(0,D.jsxs)("div",{className:"flex items-center gap-2",children:[(0,D.jsx)("h3",{className:"font-semibold m-0 flex items-center",children:O.name}),(0,D.jsx)(ve,{target:"_blank",className:"font-semibold flex items-center",to:Me.experimentsSharedMetric(O.id),children:(0,D.jsx)(De,{fontSize:"18"})})]}),O.description&&(0,D.jsx)("p",{className:"mt-2",children:O.description}),O.query.kind==="ExperimentTrendsQuery"&&(0,D.jsx)(Kn,{query:O.query.count_query}),O.query.kind==="ExperimentFunnelsQuery"&&(0,D.jsx)(er,{query:O.query.funnels_query})]}):(0,D.jsx)(D.Fragment,{})})()})]})}w();C();S();var Oe=f(H());w();C();S();var rn=f(Yr()),Ge=f(H());var xe=f(Ve());w();C();S();var kt=f(H());var re=f(k());function tn({result:e,experimentId:t}){let{getIndexForVariant:r,getHighestProbabilityVariant:i}=(0,kt.useValues)(u),o=i(e),s=r(e,o||"");if(o&&s!==null&&e){let{probability:a}=e;return(0,re.jsxs)("div",{className:"items-center inline-flex flex-wrap",children:[(0,re.jsx)(he,{experimentId:t,variantKey:o}),(0,re.jsx)("span",{children:"\xA0is winning with a\xA0"}),(0,re.jsxs)("span",{className:"font-semibold items-center",children:[`${(a[o]*100).toFixed(2)}% probability`,"\xA0"]}),(0,re.jsx)("span",{children:"of being best.\xA0"})]})}return(0,re.jsx)(re.Fragment,{})}function nn({metricIndex:e,isSecondary:t=!1}){let{isPrimaryMetricSignificant:r,isSecondaryMetricSignificant:i}=(0,kt.useValues)(u);return(0,re.jsxs)("div",{className:"flex-wrap",children:[(0,re.jsx)("span",{children:"Your results are\xA0"}),(0,re.jsxs)("span",{className:"font-semibold",children:[`${t?i(e):r(e)?"significant":"not significant"}`,"."]})]})}function fr({metricIndex:e=0}){let{experimentId:t,metricResults:r}=(0,kt.useValues)(u),i=r?.[e];return i?(0,re.jsx)("div",{children:(0,re.jsxs)("div",{className:"items-center inline-flex flex-wrap",children:[(0,re.jsx)(tn,{result:i,experimentId:t}),(0,re.jsx)(nn,{metricIndex:e})]})}):(0,re.jsx)(re.Fragment,{})}w();C();S();var xr=f(H()),vr=f(qr());var G=f(k()),yr=(i=>(i.NO_CONTROL_VARIANT="no-control-variant",i.NO_TEST_VARIANT="no-test-variant",i.NO_EXPOSURES="no-exposures",i))(yr||{});function gr({error:e,metric:t}){let{experiment:r,variants:i,getMetricType:o}=(0,xr.useValues)(u);if(!e)return(0,G.jsx)(G.Fragment,{});let{statusCode:s,hasDiagnostics:a}=e;function c({errorCode:m,value:d}){let x={"no-control-variant":"Events with the control variant not received","no-test-variant":"Events with at least one test variant not received","no-exposures":"Exposure events not received"},N={"no-control-variant":"Events with the control variant received","no-test-variant":"Events with at least one test variant received","no-exposures":"Exposure events have been received"},p=o(t),v=m==="no-exposures",y=p==="TRENDS"?v?t.exposure_query?.series[0]?.event||"$feature_flag_called":t.count_query?.series[0]?.event:t.funnels_query?.series[0]?.event,R={kind:"DataTableNode",full:!0,source:{kind:"EventsQuery",select:["*","event",`properties."$feature/${r.feature_flag?.key}"`,"timestamp"],orderBy:["timestamp DESC"],after:r.start_date,event:y,properties:[{key:`$feature/${r.feature_flag?.key}`,value:v?i.map(_=>_.key):m==="no-control-variant"?["control"]:i.slice(1).map(_=>_.key),operator:"exact",type:"event"},...v?[{key:"$feature_flag",value:[r.feature_flag?.key],operator:"exact",type:"event"}]:[]],filterTestAccounts:t.count_query?.filter_test_accounts},propertiesViaUrl:!0,showPersistentColumnConfigurator:!0};return(0,G.jsx)("div",{className:"flex items-center space-x-2",children:d===!1?(0,G.jsxs)("span",{className:"flex items-center space-x-2",children:[(0,G.jsx)(hn,{className:"text-success",fontSize:16}),(0,G.jsx)("span",{className:"text-secondary",children:N[m]})]}):(0,G.jsxs)("span",{className:"flex items-center space-x-2",children:[(0,G.jsx)(vt,{className:"text-danger",fontSize:16}),(0,G.jsx)("span",{children:x[m]}),(0,G.jsx)(ee,{title:"Verify missing events in the Activity tab",children:(0,G.jsx)(ve,{target:"_blank",className:"font-semibold",to:(0,vr.combineUrl)(Me.activity("explore"),{},{q:R}).url,children:(0,G.jsx)(De,{fontSize:"16",className:"-ml-1"})})})]})})}if(a){let m=[];for(let[d,x]of Object.entries(e.detail))Object.values(yr).includes(d)&&m.push((0,G.jsx)(c,{errorCode:d,value:x},d));return(0,G.jsx)("div",{children:m})}return s===504?(0,G.jsxs)(G.Fragment,{children:[(0,G.jsx)("h2",{className:"text-xl font-semibold leading-tight",children:"Experiment results timed out"}),(0,G.jsx)("div",{className:"text-sm text-center text-balance",children:"This may occur when the experiment has a large amount of data or is particularly complex. We are actively working on fixing this. In the meantime, please try refreshing the experiment to retrieve the results."})]}):(0,G.jsx)("div",{children:e.detail})}var n=f(k());function ti(e){return e.kind==="ExperimentMetric"?e.metric_type.charAt(0).toUpperCase()+e.metric_type.slice(1).toLowerCase():e.kind==="ExperimentFunnelsQuery"?"Funnel":"Trend"}function ni(e){return e.metric_config.kind==="ExperimentEventMetricConfig"?e.metric_config.event:e.metric_config.kind==="ExperimentActionMetricConfig"?e.metric_config.name||`Action ${e.metric_config.action}`:"Untitled metric"}function ri(e){if(e===0)return"0%";let t=Math.abs(e),r=0;return t<.01?r=3:t<.1?r=2:t<1?r=1:r=0,`${(e*100).toFixed(r)}%`}var ii=(e,t)=>{if(e.name)return(0,n.jsx)("span",{className:"truncate",children:e.name});if(e.kind==="ExperimentMetric")return(0,n.jsx)("span",{className:"truncate",children:ni(e)});if(t==="TRENDS"&&e.count_query?.series?.[0]?.name)return(0,n.jsx)("span",{className:"truncate",children:e.count_query.series[0].name});if(t==="FUNNELS"&&e.funnels_query?.series){let r=e.funnels_query.series;if(r.length>0){let i=r[0]?.name,o=r[r.length-1]?.name;return(0,n.jsxs)("span",{className:"inline-flex items-center gap-1 min-w-0",children:[(0,n.jsx)(Nn,{className:"text-secondary flex-shrink-0",fontSize:"14"}),(0,n.jsx)("span",{className:"truncate",children:i}),(0,n.jsx)(yn,{className:"text-secondary flex-shrink-0",fontSize:"14"}),(0,n.jsx)("span",{className:"truncate",children:o})]})}}return(0,n.jsx)("span",{className:"text-secondary truncate",children:"Untitled metric"})};function hr(e,t,r,i,o){let s=[],c=i/2;for(let m=0;m<=20;m++){let d=m/20,x=e+(o-e)*d,N=(d-1)*2,p=Math.exp(-.5*N*N)*c;s.push([x,r+i/2-p])}for(let m=0;m<=20;m++){let d=m/20,x=o+(t-o)*d,N=d*2,p=Math.exp(-.5*N*N)*c;s.push([x,r+i/2-p])}for(let m=20;m>=0;m--){let d=m/20,x=o+(t-o)*d,N=d*2,p=Math.exp(-.5*N*N)*c;s.push([x,r+i/2+p])}for(let m=20;m>=0;m--){let d=m/20,x=e+(o-e)*d,N=(d-1)*2,p=Math.exp(-.5*N*N)*c;s.push([x,r+i/2+p])}return`
        M ${s[0][0]} ${s[0][1]}
        ${s.map(m=>`L ${m[0]} ${m[1]}`).join(" ")}
        Z
    `}function br({isSecondary:e,result:t,error:r,variants:i,metricType:o,metricIndex:s,isFirstMetric:a,metric:c,tickValues:m,chartBound:d}){let{credibleIntervalForVariant:x,conversionRateForVariant:N,experimentId:p,experiment:v,countDataForVariant:y,exposureCountDataForVariant:R,metricResultsLoading:_,secondaryMetricResultsLoading:B,featureFlags:M,primaryMetricsLengthWithSharedMetrics:I}=(0,Ge.useValues)(u),{openPrimaryMetricModal:V,openSecondaryMetricModal:W,openPrimarySharedMetricModal:ie,openSecondarySharedMetricModal:O,openVariantDeltaTimeseriesModal:Y}=(0,Ge.useActions)(u),[j,mt]=(0,xe.useState)(null),[Or,ct]=(0,xe.useState)(!0),[on,Wr]=(0,xe.useState)({x:0,y:0}),[Pr,Bt]=(0,xe.useState)(!1),sn=T=>T<3?6:T<4?3:T<5?1:0,zr=e?B:_,We=10+sn(i.length),dt=10+sn(i.length),Ot=20,Se=800,ln=20,Xr=2,Jr=9,mn=1e3,{isDarkModeOn:pt}=(0,Ge.useValues)(gt),me={TICK_TEXT_COLOR:"var(--text-tertiary)",BOUNDARY_LINES:"var(--border-primary)",ZERO_LINE:"var(--border-bold)",BAR_NEGATIVE:pt?"#c32f45":"#f84257",BAR_POSITIVE:pt?"#12a461":"#36cd6f",BAR_DEFAULT:pt?"rgb(121 121 121)":"rgb(217 217 217)",BAR_CONTROL:pt?"rgba(217, 217, 217, 0.2)":"rgba(217, 217, 217, 0.4)",BAR_MIDDLE_POINT:"black",BAR_MIDDLE_POINT_CONTROL:"rgba(0, 0, 0, 0.4)"},Fe=dt+(We+dt)*i.length,je=T=>{let P=(T/d+1)/2;return ln+P*(Se-2*ln)},cn="20%",dn=(0,xe.useRef)(null),ut=(0,xe.useRef)(null),[Ur,$r]=(0,xe.useState)(0),[pn,Gr]=(0,xe.useState)(0);return(0,xe.useEffect)(()=>{let T=dn.current,P=ut.current,Q=new ResizeObserver(ce=>{for(let se of ce)se.target===T?$r(se.contentRect.height):se.target===P&&Gr(se.contentRect.height)});return T&&Q.observe(T),P&&Q.observe(P),()=>{Q.disconnect()}},[t]),(0,n.jsxs)("div",{className:"rounded bg-[var(--bg-table)]",children:[(0,n.jsxs)("div",{style:{width:cn,verticalAlign:"top",display:"inline-block"},children:[a&&(0,n.jsx)("svg",{style:{height:`${Ur}px`}}),a&&(0,n.jsx)("div",{className:"w-full border-t border-border"}),(0,n.jsx)("div",{style:{height:`${pn}px`,borderRight:`1px solid ${me.BOUNDARY_LINES}`},className:"p-2 overflow-auto",children:(0,n.jsx)("div",{className:"text-xs font-semibold whitespace-nowrap overflow-hidden",children:(0,n.jsxs)("div",{className:"space-y-1",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsxs)("div",{className:"cursor-default text-xs font-semibold whitespace-nowrap overflow-hidden text-ellipsis flex-grow flex items-center",children:[(0,n.jsxs)("span",{className:"mr-1",children:[s+1,"."]}),ii(c,o)]}),(0,n.jsx)(E,{className:"flex-shrink-0",type:"secondary",size:"xsmall",icon:(0,n.jsx)(Ln,{fontSize:"12"}),onClick:()=>{if(c.isSharedMetric){e?O(c.sharedMetricId):ie(c.sharedMetricId);return}e?W(s):V(s)}})]}),(0,n.jsxs)("div",{className:"space-x-1",children:[(0,n.jsx)(be,{type:"muted",size:"small",children:ti(c)}),c.isSharedMetric&&(0,n.jsx)(be,{type:"option",size:"small",children:"Shared"})]})]})})})]}),(0,n.jsxs)("div",{style:{width:`calc(100% - ${cn})`,verticalAlign:"top",display:"inline-block",minWidth:"780px"},children:[a&&(0,n.jsx)("div",{className:"flex justify-center",children:(0,n.jsx)("svg",{ref:dn,viewBox:`0 0 ${Se} ${Ot}`,preserveAspectRatio:"xMidYMid meet",className:t?"ml-12":void 0,style:{minHeight:`${Ot}px`,maxWidth:`${mn}px`},children:m.map((T,P)=>{let Q=je(T);return(0,n.jsx)("g",{children:(0,n.jsx)("text",{x:Q,y:Ot/2,textAnchor:"middle",dominantBaseline:"middle",fontSize:Jr,fill:me.TICK_TEXT_COLOR,fontWeight:"600",children:ri(T)})},P)})})}),a&&(0,n.jsx)("div",{className:"w-full border-t border-border"}),t?(0,n.jsxs)("div",{className:"relative",children:[(0,n.jsx)("div",{className:"absolute top-2 left-2",style:{zIndex:102},children:(0,n.jsx)(ai,{metricIndex:s,isSecondary:e})}),(e||!e&&I>1)&&(0,n.jsx)("div",{className:"absolute bottom-2 left-2 flex justify-center bg-[var(--bg-table)]",style:{zIndex:101},children:(0,n.jsx)(E,{type:"secondary",size:"xsmall",icon:(0,n.jsx)(En,{}),onClick:()=>Bt(!0),children:"Details"})}),(0,n.jsx)("div",{className:"flex justify-center",children:(0,n.jsxs)("svg",{ref:ut,viewBox:`0 0 ${Se} ${Fe}`,preserveAspectRatio:"xMidYMid meet",className:"ml-12",style:{minHeight:`${Fe}px`,maxWidth:`${mn}px`},children:[m.map((T,P)=>{let Q=je(T);return(0,n.jsx)("line",{x1:Q,y1:0,x2:Q,y2:pn+20,stroke:T===0?me.ZERO_LINE:me.BOUNDARY_LINES,strokeWidth:T===0?1:.5},P)}),i.map((T,P)=>{let Q=x(t,T.key,o),[ce,se]=Q?[Q[0]/100,Q[1]/100]:[0,0],Ae;if(o==="TRENDS"){let Ee=t.variants.find(Xe=>Xe.key==="control"),pe=t.variants.find(Xe=>Xe.key===T.key);if(!pe?.count||!pe?.absolute_exposure||!Ee?.count||!Ee?.absolute_exposure)Ae=0;else{let Xe=Ee.count/Ee.absolute_exposure;Ae=(pe.count/pe.absolute_exposure-Xe)/Xe}}else{let Ee=N(t,T.key),pe=N(t,"control");Ae=Ee&&pe?(Ee-pe)/pe:0}let Pe=dt+(We+dt)*P,Ce=je(ce),ze=je(se),Wt=je(Ae);return(0,n.jsxs)("g",{onMouseEnter:Ee=>{let pe=Ee.currentTarget.getBoundingClientRect();mt({x:pe.left+pe.width/2,y:pe.top-10,variant:T.key})},onMouseLeave:()=>mt(null),onClick:()=>{M[zt.EXPERIMENT_INTERVAL_TIMESERIES]&&Y()},className:M[zt.EXPERIMENT_INTERVAL_TIMESERIES]?"cursor-pointer":"",children:[(0,n.jsx)("foreignObject",{x:Ce-8,y:Pe+We/2-10,width:"90",height:"16",transform:"translate(-90, 0)",children:(0,n.jsx)(he,{className:"justify-end mt-0.5",experimentId:p,variantKey:T.key,fontSize:10,muted:!0})}),T.key==="control"?(0,n.jsx)("path",{d:hr(Ce,ze,Pe,We,Wt),fill:me.BAR_CONTROL,stroke:me.BOUNDARY_LINES,strokeWidth:1,strokeDasharray:"2,2"}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("defs",{children:(0,n.jsx)("linearGradient",{id:`gradient-${s}-${T.key}-${e?"secondary":"primary"}`,x1:"0",x2:"1",y1:"0",y2:"0",children:ce<0&&se>0?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("stop",{offset:"0%",stopColor:me.BAR_NEGATIVE}),(0,n.jsx)("stop",{offset:`${-ce/(se-ce)*100}%`,stopColor:me.BAR_NEGATIVE}),(0,n.jsx)("stop",{offset:`${-ce/(se-ce)*100}%`,stopColor:me.BAR_POSITIVE}),(0,n.jsx)("stop",{offset:"100%",stopColor:me.BAR_POSITIVE})]}):(0,n.jsx)("stop",{offset:"100%",stopColor:se<=0?me.BAR_NEGATIVE:me.BAR_POSITIVE})})}),(0,n.jsx)("path",{d:hr(Ce,ze,Pe,We,Wt),fill:`url(#gradient-${s}-${T.key}-${e?"secondary":"primary"})`})]}),(0,n.jsx)("g",{transform:`translate(${Wt}, 0)`,children:(0,n.jsx)("line",{x1:0,y1:Pe,x2:0,y2:Pe+We,stroke:T.key==="control"?me.BAR_MIDDLE_POINT_CONTROL:me.BAR_MIDDLE_POINT,strokeWidth:Xr,vectorEffect:"non-scaling-stroke",shapeRendering:"crispEdges"})})]},T.key)})]})})]}):zr?(0,n.jsx)("svg",{ref:ut,viewBox:`0 0 ${Se} ${Fe}`,preserveAspectRatio:"xMidYMid meet",children:(0,n.jsx)("foreignObject",{x:Se/2-100,y:Fe/2-10,width:"200",height:"20",children:(0,n.jsx)("div",{className:"flex items-center justify-center text-secondary cursor-default",style:{fontSize:"10px",fontWeight:400},children:(0,n.jsx)("span",{children:"Results loading\u2026"})})})}):(0,n.jsx)("svg",{ref:ut,viewBox:`0 0 ${Se} ${Fe}`,preserveAspectRatio:"xMidYMid meet",children:v.start_date?(0,n.jsx)("foreignObject",{x:0,y:Fe/2-10,width:Se,height:"20",onMouseEnter:T=>{let P=T.currentTarget.getBoundingClientRect();Wr({x:P.left+P.width/2,y:P.top}),ct(!0)},onMouseLeave:()=>ct(!1),children:(0,n.jsxs)("div",{className:"flex items-center ml-2 xl:ml-0 xl:justify-center text-secondary cursor-default",style:{fontSize:"10px",fontWeight:400},children:[r?.hasDiagnostics?(0,n.jsxs)(be,{size:"small",type:"highlight",className:"mr-2",children:[(0,n.jsx)(xn,{className:"mr-1",fontSize:"1em"}),(0,n.jsx)("span",{className:"font-semibold",children:(()=>{try{return Object.values(r.detail).filter(T=>T===!1).length}catch{return"0"}})()}),"/",(0,n.jsx)("span",{className:"font-semibold",children:o==="TRENDS"?"3":"2"})]}):(0,n.jsx)(be,{size:"small",type:"danger",className:"mr-1",children:"Error"}),(0,n.jsx)("span",{children:"Results not yet available"})]})}):(0,n.jsx)("foreignObject",{x:"0",y:Fe/2-10,width:Se,height:"20",children:(0,n.jsxs)("div",{className:"flex items-center ml-2 xl:ml-0 xl:justify-center text-secondary cursor-default",style:{fontSize:"10px",fontWeight:400},children:[(0,n.jsx)(be,{size:"small",className:"mr-2",children:(0,n.jsx)(bn,{fontSize:"1em"})}),(0,n.jsx)("span",{children:"Waiting for experiment to start\u2026"})]})})}),j&&(0,n.jsx)("div",{style:{position:"fixed",left:j.x,top:j.y,transform:"translate(-50%, -100%)",backgroundColor:"var(--bg-surface-primary)",border:"1px solid var(--border-primary)",padding:"8px 12px",borderRadius:"6px",fontSize:"13px",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.1)",pointerEvents:"none",zIndex:100,minWidth:"300px"},children:(0,n.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,n.jsx)(he,{experimentId:p,variantKey:j.variant}),(0,n.jsxs)("div",{className:"inline-flex",children:[(0,n.jsx)("span",{className:"text-secondary font-semibold mb-1",children:"Win probability:"}),t?.probability?.[j.variant]!==void 0?(0,n.jsxs)("span",{className:"flex items-center justify-between flex-1 pl-6",children:[(0,n.jsx)(Tt,{className:"w-3/4 mr-4",percent:t.probability[j.variant]*100}),(0,n.jsxs)("span",{className:"font-semibold",children:[(t.probability[j.variant]*100).toFixed(2),"%"]})]}):"\u2014"]}),o==="TRENDS"?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"flex justify-between items-center",children:[(0,n.jsxs)("span",{className:"text-secondary font-semibold",children:[o==="TRENDS"&&t.exposure_query?.series?.[0]?.math?"Total":"Count",":"]}),(0,n.jsx)("span",{className:"font-semibold",children:(()=>{let T=y(t,j.variant);return T!==null?de(T):"\u2014"})()})]}),(0,n.jsxs)("div",{className:"flex justify-between items-center",children:[(0,n.jsx)("span",{className:"text-secondary font-semibold",children:"Exposure:"}),(0,n.jsx)("span",{className:"font-semibold",children:(()=>{let T=R(t,j.variant);return T!==null?de(T):"\u2014"})()})]}),(0,n.jsxs)("div",{className:"flex justify-between items-center",children:[(0,n.jsx)("span",{className:"text-secondary font-semibold",children:"Mean:"}),(0,n.jsx)("span",{className:"font-semibold",children:(()=>{let T=t.variants.find(P=>P.key===j.variant);return T?.count&&T?.absolute_exposure?(T.count/T.absolute_exposure).toFixed(2):"\u2014"})()})]})]}):(0,n.jsxs)("div",{className:"flex justify-between items-center",children:[(0,n.jsx)("span",{className:"text-secondary font-semibold",children:"Conversion rate:"}),(0,n.jsxs)("span",{className:"font-semibold",children:[N(t,j.variant)?.toFixed(2),"%"]})]}),(0,n.jsxs)("div",{className:"flex justify-between items-center",children:[(0,n.jsx)("span",{className:"text-secondary font-semibold",children:"Delta:"}),(0,n.jsx)("span",{className:"font-semibold",children:j.variant==="control"?(0,n.jsx)("em",{className:"text-secondary",children:"Baseline"}):(()=>{if(o==="TRENDS"){let ce=t.variants.find(ze=>ze.key==="control"),se=t.variants.find(ze=>ze.key===j.variant);if(!se?.count||!se?.absolute_exposure||!ce?.count||!ce?.absolute_exposure)return"\u2014";let Ae=ce.count/ce.absolute_exposure,Ce=(se.count/se.absolute_exposure-Ae)/Ae;return Ce?(0,n.jsx)("span",{className:Ce>0?"text-success":"text-danger",children:`${Ce>0?"+":""}${(Ce*100).toFixed(2)}%`}):"\u2014"}let T=N(t,j.variant),P=N(t,"control"),Q=T&&P?(T-P)/P:0;return Q?(0,n.jsx)("span",{className:Q>0?"text-success":"text-danger",children:`${Q>0?"+":""}${(Q*100).toFixed(2)}%`}):"\u2014"})()})]}),(0,n.jsxs)("div",{className:"flex justify-between items-center",children:[(0,n.jsx)("span",{className:"text-secondary font-semibold",children:"Credible interval:"}),(0,n.jsx)("span",{className:"font-semibold",children:(()=>{let T=x(t,j.variant,o),[P,Q]=T?[T[0]/100,T[1]/100]:[0,0];return`[${P>0?"+":""}${(P*100).toFixed(2)}%, ${Q>0?"+":""}${(Q*100).toFixed(2)}%]`})()})]})]})}),Or&&(0,n.jsx)("div",{style:{position:"fixed",left:on.x,top:on.y,transform:"translate(-50%, -100%)",backgroundColor:"var(--bg-surface-primary)",border:"1px solid var(--border-primary)",padding:"8px 12px",borderRadius:"6px",fontSize:"13px",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.1)",zIndex:100,minWidth:"200px"},onMouseEnter:()=>ct(!0),onMouseLeave:()=>ct(!1),children:(0,n.jsx)(gr,{error:r,metric:c})})]}),(0,n.jsxs)($,{isOpen:Pr,onClose:()=>Bt(!1),width:1200,title:`Metric results: ${c.name||"Untitled metric"}`,footer:(0,n.jsx)(E,{form:"secondary-metric-modal-form",type:"secondary",onClick:()=>Bt(!1),children:"Close"}),children:[t&&(t.kind==="ExperimentTrendsQuery"||t.kind==="ExperimentFunnelsQuery")&&(0,n.jsx)("div",{className:"flex justify-end",children:(0,n.jsx)(Mt,{result:t})}),(0,n.jsx)(Z,{type:t?.significant?"success":"info",className:"mb-4",children:(0,n.jsxs)("div",{className:"items-center inline-flex flex-wrap",children:[(0,n.jsx)(tn,{result:t,experimentId:p}),(0,n.jsx)(nn,{metricIndex:s})]})}),(0,n.jsx)(Lt,{metric:c,metricIndex:s,isSecondary:e}),t&&(t.kind==="ExperimentTrendsQuery"||t.kind==="ExperimentFunnelsQuery")&&(0,n.jsx)(Et,{result:t,showTable:!0})]})]})}function ai({metricIndex:e=0,isSecondary:t=!1,className:r=""}){let{isPrimaryMetricSignificant:i,isSecondaryMetricSignificant:o,significanceDetails:s}=(0,Ge.useValues)(u),a=t?o(e):i(e),c=a?{color:"success",label:"Significant"}:{color:"primary",label:"Not significant"},m=a?(0,n.jsxs)("div",{className:"bg-success-highlight text-success-light px-1.5 py-0.5 flex items-center gap-1 rounded border border-success-light",children:[(0,n.jsx)(Cn,{fontSize:20,fontWeight:600}),(0,n.jsx)("span",{className:"text-xs font-semibold",children:c.label})]}):(0,n.jsxs)("div",{className:"bg-warning-highlight text-warning-dark px-1.5 py-0.5 flex items-center gap-1 rounded border border-warning",children:[(0,n.jsx)(Tn,{fontSize:20,fontWeight:600}),(0,n.jsx)("span",{className:"text-xs font-semibold",children:c.label})]}),d=s(e);return d?(0,n.jsx)(ee,{title:d,children:(0,n.jsx)("div",{className:(0,rn.default)({"cursor-default":!0,"bg-[var(--bg-table)]":!0,[r]:!0}),children:m})}):(0,n.jsx)("div",{className:(0,rn.default)({"bg-[var(--bg-table)]":!0,[r]:!0}),children:m})}var L=f(k());function oi(e){e=Math.ceil(e*10)/10;let t=Math.floor(Math.log10(e)),r=Math.pow(10,t),i,o=e/r;o<=1?i=.2*r:o<=2?i=.5*r:o<=5?i=1*r:i=2*r;let s=Math.ceil(e/i),a=Math.max(0,-t+1),c=[];for(let m=-s;m<=s;m++){let d=Number((i*m).toFixed(a));c.push(d)}return c}function Nr(){let{primaryMetricsLengthWithSharedMetrics:e}=(0,Oe.useValues)(u),{openPrimaryMetricSourceModal:t}=(0,Oe.useActions)(u);return(0,L.jsx)(E,{icon:(0,L.jsx)(Ut,{}),type:"secondary",size:"xsmall",onClick:()=>{t()},disabledReason:e>=10?`You can only add up to ${10} primary metrics.`:void 0,children:"Add primary metric"})}function Er(){let{secondaryMetricsLengthWithSharedMetrics:e}=(0,Oe.useValues)(u),{openSecondaryMetricSourceModal:t}=(0,Oe.useActions)(u);return(0,L.jsx)(E,{icon:(0,L.jsx)(Ut,{}),type:"secondary",size:"xsmall",onClick:()=>{t()},disabledReason:e>=10?`You can only add up to ${10} secondary metrics.`:void 0,children:"Add secondary metric"})}function an({isSecondary:e}){let{experiment:t,getMetricType:r,metricResults:i,secondaryMetricResults:o,primaryMetricsResultErrors:s,secondaryMetricsResultErrors:a,credibleIntervalForVariant:c}=(0,Oe.useValues)(u),m=t?.feature_flag?.filters?.multivariate?.variants;if(!m)return(0,L.jsx)(L.Fragment,{});let d=e?o:i,x=e?a:s,N=d?.some(M=>M?.insight),p=e?t.metrics_secondary:t.metrics,v=t.saved_metrics.filter(M=>M.metadata.type===(e?"secondary":"primary")).map(M=>({...M.query,name:M.name,sharedMetricId:M.saved_metric,isSharedMetric:!0}));v&&(p=[...p,...v]);let y=Math.max(...p.flatMap((M,I)=>{let V=d?.[I];return V?m.flatMap(W=>{let ie=r(M),O=c(V,W.key,ie);return O?[Math.abs(O[0]/100),Math.abs(O[1]/100)]:[]}):[]})),R=Math.max(y*.05,.1),_=y+R,B=oi(_);return(0,L.jsxs)("div",{className:"mb-4 -mt-2",children:[(0,L.jsxs)("div",{className:"flex",children:[(0,L.jsx)("div",{className:"w-1/2 pt-5",children:(0,L.jsxs)("div",{className:"inline-flex items-center space-x-2 mb-0",children:[(0,L.jsx)("h2",{className:"mb-0 font-semibold text-lg leading-6",children:e?"Secondary metrics":"Primary metrics"}),p.length>0&&(0,L.jsx)(ee,{title:e?"Secondary metrics capture additional outcomes or behaviors affected by your experiment. They help you understand broader impacts and potential side effects beyond the primary goal.":"Primary metrics represent the main goal of your experiment. They directly measure whether your hypothesis was successful and are the key factor in deciding if the test achieved its primary objective.",children:(0,L.jsx)(ue,{className:"text-secondary text-lg"})}),N&&!e&&(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(ye,{vertical:!0,className:"mx-2"}),(0,L.jsx)(ee,{title:(0,L.jsxs)("div",{className:"p-2",children:[(0,L.jsxs)("p",{className:"mb-4",children:["Each bar shows how a variant is performing compared to the control (the gray bar) for this metric, using a"," ",(0,L.jsx)("strong",{children:"95% credible interval."}),` That means there's a 95% chance the true difference for that variant falls within this range. The vertical "0%" line is your baseline:`]}),(0,L.jsxs)("ul",{className:"mb-4 list-disc pl-4",children:[(0,L.jsxs)("li",{children:[(0,L.jsx)("strong",{children:"To the right (green):"})," The metric is higher (an improvement)."]}),(0,L.jsxs)("li",{children:[(0,L.jsx)("strong",{children:"To the left (red):"})," The metric is lower (a decrease)."]})]}),(0,L.jsx)("p",{className:"mb-4",children:"The shape of each bar represents the probability distribution. The true value is more likely to be near the center (where the bar is wider) than at the edges (where it tapers off)."}),(0,L.jsx)("p",{className:"mb-4",children:"The control (baseline) is always shown in gray. Other bars will be green or red\u2014or even a mix\u2014depending on whether the change is positive or negative."}),(0,L.jsx)("img",{src:"https://res.cloudinary.com/dmukukwp6/image/upload/violin_plot_screenshot_acca775d36.png",width:700,className:"rounded border object-contain",alt:"How to read metrics"})]}),children:(0,L.jsx)("span",{className:"text-xs text-secondary cursor-help",children:"How to read"})})]})]})}),(0,L.jsx)("div",{className:"w-1/2 flex flex-col justify-end",children:(0,L.jsx)("div",{className:"ml-auto",children:p.length>0&&(0,L.jsx)("div",{className:"mb-2 mt-4 justify-end",children:e?(0,L.jsx)(Er,{}):(0,L.jsx)(Nr,{})})})})]}),p.length>0?(0,L.jsx)("div",{className:"w-full overflow-x-auto",children:(0,L.jsx)("div",{className:"min-w-[1000px]",children:p.map((M,I)=>{let V=d?.[I],W=I===0;return(0,L.jsx)("div",{className:`w-full border border-border bg-light ${p.length===1?"rounded":W?"rounded-t":I===p.length-1?"rounded-b":""}`,children:(0,L.jsx)(br,{isSecondary:!!e,result:V,error:x?.[I],variants:m,metricType:r(M),metricIndex:I,isFirstMetric:W,metric:M,tickValues:B,chartBound:_})},I)})})}):(0,L.jsx)("div",{className:"border rounded bg-surface-primary pt-6 pb-8 text-secondary mt-2",children:(0,L.jsxs)("div",{className:"flex flex-col items-center mx-auto space-y-3",children:[(0,L.jsx)(fn,{fontSize:"30"}),(0,L.jsxs)("div",{className:"text-sm text-center text-balance max-w-sm",children:[(0,L.jsxs)("p",{children:["Add up to ",10," ",e?"secondary":"primary"," metrics."]}),(0,L.jsx)("p",{children:e?"Secondary metrics provide additional context and help detect unintended side effects.":"Primary metrics represent the main goal of the experiment and directly measure if your hypothesis was successful."})]}),e?(0,L.jsx)(Er,{}):(0,L.jsx)(Nr,{})]})})]})}w();C();S();w();C();S();Re.register(...Pn);var Rt=f(H());var Mr=f(Ve());var lt=f(k()),si=[.16,.17,.15,.16,.14,.15,.145,.15,.155,.148,.15,.147,.152,.15],li=[.26,.27,.24,.24,.21,.21,.2,.2,.195,.183,.182,.177,.182,.18],mi=[.06,.07,.06,.08,.07,.09,.09,.1,.115,.113,.118,.117,.122,.12],Tr=()=>{let{closeVariantDeltaTimeseriesModal:e}=(0,Rt.useActions)(u),{isVariantDeltaTimeseriesModalOpen:t}=(0,Rt.useValues)(u);return(0,Mr.useEffect)(()=>{t&&setTimeout(()=>{let r=document.getElementById("variantDeltaChart");if(!r){console.error("Canvas element not found");return}let i=Re.getChart(r);i&&i.destroy(),r.style.width="100%",r.style.height="100%";let s={type:"line",data:{labels:["Day 1","Day 2","Day 3","Day 4","Day 5","Day 6","Day 7","Day 8","Day 9","Day 10","Day 11","Day 12","Day 13","Day 14"],datasets:[{label:"Upper Bound",data:li,borderColor:"rgba(200, 200, 200, 1)",fill:!1,tension:0,pointRadius:0},{label:"Lower Bound",data:mi,borderColor:"rgba(200, 200, 200, 1)",fill:"-1",backgroundColor:"rgba(200, 200, 200, 0.2)",tension:0,pointRadius:0},{label:"Delta",data:si,borderColor:"rgba(0, 100, 255, 1)",borderWidth:2,fill:!1,tension:0,pointRadius:0}]},options:{responsive:!0,maintainAspectRatio:!1,interaction:{intersect:!1,mode:"nearest",axis:"x"},scales:{y:{beginAtZero:!0,grid:{display:!1},ticks:{count:6,callback:a=>`${(Number(a)*100).toFixed(1)}%`}}},plugins:{legend:{display:!1},tooltip:{callbacks:{labelPointStyle:function(){return{pointStyle:"circle",rotation:0}}},usePointStyle:!0,boxWidth:16,boxHeight:1},crosshair:!1}}};new Re(r,s)},0)},[t]),(0,lt.jsx)($,{isOpen:t,onClose:()=>{e()},width:800,title:"Variant performance over time",footer:(0,lt.jsx)(E,{form:"secondary-metric-modal-form",type:"secondary",onClick:()=>{},children:"Close"}),children:(0,lt.jsx)("div",{className:"relative h-[400px]",children:(0,lt.jsx)("canvas",{id:"variantDeltaChart"})})})};w();C();S();var qe=f(H());w();C();S();var Le=f(H());var h=f(k());function ci({experimentId:e}){let{minimumDetectableEffect:t,experiment:r,conversionMetrics:i,minimumSampleSizePerVariant:o,recommendedRunningTime:s,variants:a}=(0,Le.useValues)(u({experimentId:e})),c=i?.totalRate*100||0,m=i.totalRate*100,x=o(m)*a.length,N=c.toFixed(1),p=(c+(t||5)).toFixed(1),v=de(x||0);return(0,h.jsxs)("div",{className:"flex flex-wrap",children:[!r?.start_date&&(0,h.jsxs)(h.Fragment,{children:[(0,h.jsxs)("div",{className:"mb-4 w-1/2",children:[(0,h.jsx)("div",{className:"card-secondary",children:"Baseline Conversion Rate"}),(0,h.jsxs)("div",{className:"l4",children:[N,"%"]})]}),(0,h.jsxs)("div",{className:"mb-4 w-1/2",children:[(0,h.jsx)("div",{className:"card-secondary",children:"Minimum Acceptable Conversion Rate"}),(0,h.jsxs)("div",{className:"l4",children:[p,"%"]})]})]}),(0,h.jsxs)("div",{className:"w-1/2",children:[(0,h.jsx)("div",{className:"card-secondary",children:"Recommended Sample Size"}),(0,h.jsxs)("div",{className:"pb-4",children:[(0,h.jsxs)("span",{className:"l4",children:["~",v]})," persons"]})]}),!r?.start_date&&(0,h.jsxs)("div",{className:"w-1/2",children:[(0,h.jsx)("div",{className:"card-secondary",children:"Recommended running time"}),(0,h.jsxs)("div",{children:[(0,h.jsxs)("span",{className:"l4",children:["~",s]})," days"]})]})]})}function di({experimentId:e}){let{minimumDetectableEffect:t,experiment:r,trendResults:i,recommendedExposureForCountData:o}=(0,Le.useValues)(u({experimentId:e})),s=i[0]?.count||0,a=o(s),c=de(s||0),m=de(s+Math.ceil(s*((t||5)/100))||0),d=de(a||0);return(0,h.jsxs)("div",{className:"flex flex-wrap",children:[!r?.start_date&&(0,h.jsxs)(h.Fragment,{children:[(0,h.jsxs)("div",{className:"mb-4 w-1/2",children:[(0,h.jsx)("div",{className:"card-secondary",children:"Baseline Count"}),(0,h.jsx)("div",{className:"l4",children:c})]}),(0,h.jsxs)("div",{className:"mb-4 w-1/2",children:[(0,h.jsx)("div",{className:"card-secondary",children:"Minimum Acceptable Count"}),(0,h.jsx)("div",{className:"l4",children:m})]})]}),(0,h.jsxs)("div",{className:"w-1/2",children:[(0,h.jsx)("div",{className:"card-secondary",children:"Recommended running time"}),(0,h.jsxs)("div",{children:[(0,h.jsxs)("span",{className:"l4",children:["~",d]})," days"]})]})]})}function Lr({experimentId:e}){let{getMetricType:t,firstPrimaryMetric:r,minimumDetectableEffect:i,experiment:o,conversionMetrics:s}=(0,Le.useValues)(u({experimentId:e})),{setExperiment:a}=(0,Le.useActions)(u({experimentId:e})),c=t(r),m=Ht({dashboardItemId:c==="FUNNELS"?"new-experiment-funnels-metric":"new-experiment-trends-metric",syncWithUrl:!1}),{insightProps:d}=(0,Le.useValues)(m),x=null;o.metrics.length>0&&(x={kind:"InsightVizNode",source:c==="FUNNELS"?r.funnels_query:r.count_query});let N=s?.totalRate*100||0,p=0;return c==="FUNNELS"?100-N<50?p=100-N:p=50:p=100,(0,h.jsx)("div",{className:"flex",children:(0,h.jsxs)("div",{className:"w-full",children:[(0,h.jsxs)("div",{className:"mb-4 experiment-preview-row",children:[(0,h.jsxs)("div",{className:"flex items-center",children:[(0,h.jsx)("b",{children:"Minimum detectable effect"}),(0,h.jsx)(ee,{title:(0,h.jsxs)("div",{className:"space-y-2",children:[(0,h.jsx)("div",{children:"The Minimum detectable effect represents the smallest change that you want to be able to detect in your experiment."}),(0,h.jsx)("div",{children:"To make things easier, we initially set this value to a reasonable default. However, we encourage you to review and adjust it based on your specific goals."}),(0,h.jsxs)("div",{children:["Read more in the"," ",(0,h.jsx)(ve,{to:"https://posthog.com/docs/experiments/sample-size-running-time#minimum-detectable-effect-mde",children:"documentation."})]})]}),closeDelayMs:200,children:(0,h.jsx)(ue,{className:"text-secondary text-base ml-1"})})]}),(0,h.jsxs)("div",{className:"flex gap-4",children:[(0,h.jsx)($n,{value:i,min:1,max:p,step:1,onChange:v=>{a({parameters:{...o.parameters,minimum_detectable_effect:v}})},className:"w-5/6"}),(0,h.jsx)(le,{className:"w-1/6","data-attr":"min-detectable-effect",type:"number",min:1,max:p,defaultValue:5,suffix:(0,h.jsx)("span",{children:"%"}),value:i,onChange:v=>{v&&a({parameters:{...o.parameters,minimum_detectable_effect:v}})}})]})]}),(0,h.jsxs)("div",{className:"flex flex-col experiment-preview-row",children:[(0,h.jsx)(Z,{type:"info",className:"mb-4",children:"The calculations are based on the events received in the last 14 days. This event count may differ from what was considered in earlier estimates."}),t(r)==="TRENDS"?(0,h.jsx)(di,{experimentId:e}):(0,h.jsx)(ci,{experimentId:e}),(0,h.jsx)("div",{className:"hidden",children:(0,h.jsx)(Le.BindLogic,{logic:Ht,props:d,children:(0,h.jsx)(Be,{query:x,context:{insightProps:d},readOnly:!0})})})]})]})})}var g=f(k());function _r(){let{experimentId:e,experiment:t,getMetricType:r,funnelResultsPersonsTotal:i,actualRunningTime:o,minimumDetectableEffect:s,firstPrimaryMetric:a}=(0,qe.useValues)(u),{openExperimentCollectionGoalModal:c}=(0,qe.useActions)(u),m=r(a),d=t?.parameters?.recommended_running_time||1,x=t?.parameters?.recommended_sample_size||100,N=m==="FUNNELS"?i(0)/x*100:o/d*100,p=d>62,v=()=>t?.parameters?.minimum_detectable_effect?(0,g.jsx)(ee,{title:(0,g.jsxs)("div",{children:[(0,g.jsx)("div",{children:`Based on the Minimum detectable effect of ${t.parameters.minimum_detectable_effect}%.`}),p&&(0,g.jsx)("div",{className:"mt-2",children:"Given the current data, this experiment might take a while to reach statistical significance. Please make sure events are being tracked correctly and consider if this timeline works for you."})]}),children:(0,g.jsx)(ue,{className:"text-secondary text-base"})}):(0,g.jsx)(g.Fragment,{});return(0,g.jsxs)("div",{children:[(0,g.jsxs)("div",{className:"inline-flex items-center space-x-2",children:[(0,g.jsx)("h2",{className:"font-semibold text-lg mb-0",children:"Data collection"}),(0,g.jsx)(ee,{title:`Estimated target for the number of participants. Actual data may reveal significance earlier or later
                    than predicted.`,children:(0,g.jsx)(ue,{className:"text-secondary text-base"})})]}),(0,g.jsxs)("div",{className:"flex",children:[(0,g.jsxs)("div",{className:"w-3/5 pr-4",children:[(0,g.jsx)("div",{className:"mt-2 mb-1 font-semibold",children:`${N>100?100:N.toFixed(2)}% complete`}),(0,g.jsx)(Tt,{className:"w-full border",bgColor:"var(--bg-table)",size:"medium",percent:N}),m==="TRENDS"&&(0,g.jsx)("div",{className:"flex justify-between mt-0",children:(0,g.jsxs)("span",{className:"flex items-center text-xs",children:["Completed\xA0",(0,g.jsxs)("b",{children:[o," of"]}),p?(0,g.jsx)("b",{children:"\xA0 > 60 days"}):(0,g.jsxs)("span",{children:["\xA0",(0,g.jsx)("b",{children:d})," ",jt(d,"day")]}),(0,g.jsx)("span",{className:"ml-1 text-xs",children:(0,g.jsx)(v,{})})]})}),m==="FUNNELS"&&(0,g.jsx)("div",{className:"flex justify-between mt-0",children:(0,g.jsxs)("div",{className:"space-x-1 flex items-center text-xs",children:[(0,g.jsxs)("span",{children:["Saw\xA0",(0,g.jsxs)("b",{children:[de(i(0))," of"," ",de(x)," "]})," ",jt(x,"participant")]}),(0,g.jsx)(v,{})]})})]}),(0,g.jsx)(ye,{className:"my-0",vertical:!0}),(0,g.jsxs)("div",{className:"w-2/5 pl-4",children:[(0,g.jsxs)("div",{className:`text-lg font-semibold ${t.end_date?"mt-4":""}`,children:[s,"%"]}),(0,g.jsxs)("div",{className:"text-xs space-x-1 text-sm flex",children:[(0,g.jsx)("span",{children:"Minimum detectable effect"}),(0,g.jsx)(ee,{title:(0,g.jsxs)("div",{className:"space-y-2",children:[(0,g.jsx)("div",{children:"The Minimum detectable effect represents the smallest change that you want to be able to detect in your experiment."}),(0,g.jsx)("div",{children:"To make things easier, we initially set this value to a reasonable default. However, we encourage you to review and adjust it based on your specific goals."}),(0,g.jsxs)("div",{children:["Read more in the"," ",(0,g.jsx)(ve,{to:"https://posthog.com/docs/experiments/sample-size-running-time#minimum-detectable-effect-mde",children:"documentation."})]})]}),closeDelayMs:200,children:(0,g.jsx)(ue,{className:"text-secondary text-base"})})]}),!t.end_date&&(0,g.jsx)("div",{className:"w-24",children:(0,g.jsx)(E,{className:"mt-2",size:"xsmall",type:"secondary",onClick:c,children:(0,g.jsx)("span",{className:"px-0",children:"Edit"})})}),(0,g.jsx)(pi,{experimentId:e})]})]})]})}function pi({experimentId:e}){let{isExperimentCollectionGoalModalOpen:t,getMetricType:r,firstPrimaryMetric:i,trendMetricInsightLoading:o,funnelMetricInsightLoading:s}=(0,qe.useValues)(u({experimentId:e})),{closeExperimentCollectionGoalModal:a,updateExperimentCollectionGoal:c,restoreUnmodifiedExperiment:m}=(0,qe.useActions)(u({experimentId:e})),d=r(i)==="TRENDS"?o:s;return(0,g.jsx)($,{isOpen:t,onClose:a,width:550,title:"Recalculate estimated sample size",footer:(0,g.jsxs)("div",{className:"flex items-center gap-2",children:[(0,g.jsx)(E,{form:"edit-experiment-exposure-form",type:"secondary",onClick:()=>{m(),a()},children:"Cancel"}),(0,g.jsx)(E,{form:"edit-experiment-exposure-form",onClick:()=>{c(),a()},type:"primary","data-attr":"create-annotation-submit",children:"Save"})]}),children:d?(0,g.jsxs)("div",{className:"flex flex-col flex-1 justify-center items-center mb-6",children:[(0,g.jsx)(Wn,{}),(0,g.jsxs)("div",{className:"text-xs text-secondary w-60",children:[(0,g.jsx)("span",{className:"mr-1",children:"Fetching past events for the estimation"}),(0,g.jsx)(Hn,{})]})]}):(0,g.jsx)(Lr,{experimentId:e})})}w();C();S();var Ne=f(H());w();C();S();var Ft=f(H());var _e=f(k());function wr(){let{experiment:e,holdouts:t,isExperimentRunning:r}=(0,Ft.useValues)(u),{setExperiment:i,reportExperimentHoldoutAssigned:o}=(0,Ft.useActions)(u),s=t.map(a=>({value:a.id,label:a.name}));return s.unshift({value:null,label:"No holdout"}),(0,_e.jsxs)("div",{className:"mt-3",children:[(0,_e.jsxs)("div",{className:"inline-flex space-x-1",children:[(0,_e.jsx)("h4",{className:"font-semibold mb-0",children:"Holdout group"}),(0,_e.jsx)(ee,{title:"Exclude a stable group of users from the experiment. This cannot be changed once the experiment is launched.",children:(0,_e.jsx)(ue,{className:"text-secondary text-base"})})]}),(0,_e.jsx)("div",{className:"mt-1",children:(0,_e.jsx)(He,{disabledReason:r&&!e.end_date&&"The holdout group cannot be changed once the experiment is launched.",size:"xsmall",options:s,value:e.holdout_id||null,onChange:a=>{i({...e,holdout_id:a}),o({experimentId:e.id,holdoutId:a})},"data-attr":"experiment-holdout-selector"})})]})}w();C();S();var Vt=f(H());var At=f(Ve());var z=f(k());function Sr({variantKey:e,rolloutPercentage:t}){let{experiment:r}=(0,Vt.useValues)(u),{updateExperimentVariantImages:i,reportExperimentVariantScreenshotUploaded:o}=(0,Vt.useActions)(u),s=()=>{let V=r.parameters?.variant_screenshot_media_ids?.[e];return V?Array.isArray(V)?V:[V]:[]},[a,c]=(0,At.useState)(s()),[m,d]=(0,At.useState)({}),[x,N]=(0,At.useState)(null),{setFilesToUpload:p,filesToUpload:v,uploading:y}=Bn({onUpload:(V,W,ie)=>{if(ie&&a.length<5){let O=[...a,ie];c(O);let Y={...r.parameters?.variant_screenshot_media_ids,[e]:O};i(Y),o(r.id)}else a.length>=5&&$t.error("Maximum of 5 images allowed")},onError:V=>{$t.error(`Error uploading image: ${V}`)}}),R=V=>{d(W=>({...W,[V]:!1}))},_=V=>{d(W=>({...W,[V]:!1}))},B=V=>{let W=a.filter((O,Y)=>Y!==V);c(W);let ie={...r.parameters?.variant_screenshot_media_ids,[e]:W};i(ie)},I=(()=>{switch(a.length<5?a.length+1:a.length){case 1:return"w-20";case 2:return"w-20";case 3:return"w-16";case 4:return"w-14";case 5:return"w-12";default:return"w-20"}})();return(0,z.jsxs)("div",{className:"space-y-4",children:[(0,z.jsxs)("div",{className:"flex gap-4 items-start",children:[a.map((V,W)=>(0,z.jsx)("div",{className:"relative",children:(0,z.jsx)("div",{className:"text-secondary inline-flex flow-row items-center gap-1 cursor-pointer",children:(0,z.jsxs)("div",{onClick:()=>N(W),className:"cursor-zoom-in relative",children:[(0,z.jsxs)("div",{className:`relative flex overflow-hidden select-none ${I} h-16 rounded before:absolute before:inset-0 before:border before:rounded`,children:[m[V]&&(0,z.jsx)(Rn,{className:"absolute inset-0"}),(0,z.jsx)("img",{className:"w-full h-full object-cover",src:V.startsWith("data:")?V:`/uploaded_media/${V}`,onError:()=>_(V),onLoad:()=>R(V)})]}),(0,z.jsx)("div",{className:"absolute -inset-2 group",children:(0,z.jsx)(E,{icon:(0,z.jsx)(vt,{}),onClick:ie=>{ie.stopPropagation(),B(W)},size:"small",tooltip:"Remove",tooltipPlacement:"right",noPadding:!0,className:"group-hover:flex hidden absolute right-0 top-0"})})]})})},V)),a.length<5&&(0,z.jsx)("div",{className:`relative ${I} h-16`,children:(0,z.jsx)(kn,{accept:"image/*",multiple:!1,onChange:p,loading:y,value:v,callToAction:(0,z.jsx)("div",{className:"flex items-center justify-center w-full h-16 border border-dashed rounded cursor-pointer hover:border-accent-primary",children:(0,z.jsx)("span",{className:"text-2xl text-secondary",children:"+"})})})})]}),(0,z.jsx)($,{isOpen:x!==null,onClose:()=>N(null),title:(0,z.jsxs)("div",{className:"flex items-center gap-2",children:[(0,z.jsxs)("span",{children:["Screenshot ",x!==null?x+1:""]}),(0,z.jsx)(ye,{className:"my-0 mx-1",vertical:!0}),(0,z.jsx)(he,{experimentId:r.id,variantKey:e}),t!==void 0&&(0,z.jsxs)("span",{className:"text-secondary text-sm",children:["(",t,"% rollout)"]})]}),children:x!==null&&a[x]&&(0,z.jsx)("img",{src:a[x]?.startsWith("data:")?a[x]:`/uploaded_media/${a[x]}`,alt:`Screenshot ${x+1}: ${e}`,className:"max-w-full max-h-[80vh] overflow-auto"})})]})}var F=f(k());function Cr({experimentId:e}){let{experiment:t,experimentLoading:r,isDistributionModalOpen:i}=(0,Ne.useValues)(u({experimentId:e})),{closeDistributionModal:o,updateDistributionModal:s}=(0,Ne.useActions)(u({experimentId:e})),a=bt({id:t.feature_flag?.id??null}),{featureFlag:c,areVariantRolloutsValid:m,variantRolloutSum:d}=(0,Ne.useValues)(a),{setFeatureFlagFilters:x,distributeVariantsEqually:N}=(0,Ne.useActions)(a),p=(v,y)=>{if(!c?.filters?.multivariate)return;let R=y||0,_=c.filters.multivariate.variants.map((B,M)=>M===v?{...B,rollout_percentage:R}:B);x({...c.filters,multivariate:{...c.filters.multivariate,variants:_}},null)};return(0,F.jsx)($,{isOpen:i,onClose:o,width:600,title:"Change experiment distribution",footer:(0,F.jsxs)("div",{className:"flex items-center gap-2",children:[(0,F.jsx)(E,{type:"secondary",onClick:o,children:"Cancel"}),(0,F.jsx)(E,{onClick:()=>{s(c),o()},type:"primary",loading:r,disabled:!m,children:"Save"})]}),children:(0,F.jsxs)("div",{className:"space-y-4",children:[(0,F.jsx)(Z,{type:"info",children:"Adjusting variant distribution may impact the validity of your results. Adjust only if you're aware of how changes will affect your experiment."}),(0,F.jsxs)("div",{children:[(0,F.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,F.jsx)("h3",{className:"font-semibold mb-0",children:"Variant distribution"}),(0,F.jsx)(E,{size:"small",onClick:N,tooltip:"Redistribute variant rollout percentages equally",icon:(0,F.jsx)(gn,{}),children:"Distribute equally"})]}),(0,F.jsx)(ge,{dataSource:c?.filters?.multivariate?.variants||[],columns:[{title:"Variant",dataIndex:"key",render:v=>(0,F.jsx)("span",{className:"font-semibold",children:v})},{title:"Rollout Percentage",dataIndex:"rollout_percentage",render:(v,y,R)=>(0,F.jsx)(le,{type:"number",value:y.rollout_percentage,onChange:_=>p(R,_),min:0,max:100,suffix:(0,F.jsx)("span",{children:"%"})})}]}),!m&&(0,F.jsxs)("p",{className:"text-danger mt-2",children:["Percentage rollouts must sum to 100 (currently ",d,")."]})]}),(0,F.jsx)(wr,{})]})})}function Ir(){let{openDistributionModal:e}=(0,Ne.useActions)(u),{experimentId:t,experiment:r,metricResults:i}=(0,Ne.useValues)(u),{reportExperimentReleaseConditionsViewed:o}=(0,Ne.useActions)(u),{isDarkModeOn:s}=(0,Ne.useValues)(gt),a=i?.[0],c=v=>{Ie.open({title:"Select a domain",description:"Choose the domain on which to preview this experiment variant",content:(0,F.jsx)(F.Fragment,{children:(0,F.jsx)(_t,{query:"?__experiment_id="+r?.id+"&__experiment_variant="+v,experimentId:r?.id,type:"WEB_EXPERIMENTS"})}),primaryButton:{children:"Close",type:"secondary"}})},m=r?.type==="web"?"w-1/2.5":"w-1/3",d=[{className:m,key:"key",title:"Variant",render:function(y,R){return!a||!a.insight?(0,F.jsx)("span",{className:"font-semibold",children:R.key}):(0,F.jsx)(he,{experimentId:t,variantKey:R.key})}},{className:m,key:"rollout_percentage",title:"Rollout",render:function(y,R){return(0,F.jsx)("div",{children:`${R.rollout_percentage}%`})}},{className:m,key:"variant_screenshot",title:"Screenshot",render:function(y,R){return R.key===`holdout-${r.holdout?.id}`?(0,F.jsx)("div",{className:"h-16"}):(0,F.jsx)("div",{className:"my-2",children:(0,F.jsx)(Sr,{variantKey:R.key,rolloutPercentage:R.rollout_percentage})})}}];r.type==="web"&&d.push({className:m,key:"preview_web_experiment",title:"Preview",render:function(y,R){return(0,F.jsx)("div",{className:"my-2",children:(0,F.jsx)(E,{size:"small",type:"secondary",onClick:_=>{_.preventDefault(),c(R.key)},sideIcon:(0,F.jsx)(ft,{}),children:"Preview variant"})})}});let x=r.holdout?[{key:`holdout-${r.holdout.id}`,rollout_percentage:r.holdout.filters[0].rollout_percentage}]:[],p=[...(r.feature_flag?.filters.multivariate?.variants||[]).map(v=>({...v,rollout_percentage:v.rollout_percentage*((100-(r.holdout?.filters[0].rollout_percentage||0))/100)})),...x];return(0,F.jsxs)("div",{children:[(0,F.jsxs)("div",{className:"flex",children:[(0,F.jsx)("div",{className:"w-1/2",children:(0,F.jsx)("h2",{className:"font-semibold text-lg",children:"Distribution"})}),(0,F.jsx)("div",{className:"w-1/2 flex flex-col justify-end",children:(0,F.jsx)("div",{className:"ml-auto mb-2",children:(0,F.jsx)(E,{icon:(0,F.jsx)(xt,{}),onClick:()=>{e(),o(r.id)},type:"secondary",size:"xsmall",className:"font-semibold",children:"Manage distribution"})})})]}),r.holdout&&(0,F.jsxs)(Z,{type:"info",className:"mb-4",children:["This experiment has a holdout group of ",r.holdout.filters[0].rollout_percentage,"%. The variants are modified to show their relative rollout percentage."]}),(0,F.jsx)(ge,{loading:!1,columns:d,dataSource:p,rowClassName:v=>v.key===`holdout-${r.holdout?.id}`?s?"bg-fill-primary":"bg-mid":""})]})}w();C();S();var kr=f(H());var Rr=f(Ve());var K=f(k());function Fr(){let{experimentId:e,exposures:t,exposuresLoading:r}=(0,kr.useValues)(u);return(0,Rr.useEffect)(()=>{if(!t||!t.timeseries.length)return;let i=document.getElementById("exposuresChart");if(!i){console.error("Canvas element not found");return}let o=Re.getChart(i);o&&o.destroy();let s=t.timeseries,a={type:"line",data:{labels:s[0].days,datasets:s.map(c=>({label:c.variant,data:c.exposure_counts,borderColor:"rgb(17 17 17 / 60%)",backgroundColor:"rgb(17 17 17 / 40%)",fill:!0,tension:.4,stack:"stack1",borderWidth:2,pointRadius:0}))},options:{responsive:!0,maintainAspectRatio:!1,interaction:{intersect:!1,mode:"nearest",axis:"x"},scales:{y:{stacked:!0,beginAtZero:!0,grid:{display:!0}}},plugins:{legend:{display:!1,labels:{boxWidth:4,boxPadding:20,pointStyle:"dash"}},crosshair:!1}}};new Re(i,a)},[t]),(0,K.jsxs)("div",{children:[(0,K.jsxs)("div",{className:"flex items-center space-x-2 mb-2",children:[(0,K.jsx)("h2",{className:"mb-0 font-semibold text-lg leading-6",children:"Exposures"}),(0,K.jsx)(ee,{title:"Shows the daily cumulative count of unique users exposed to each variant throughout the experiment duration.",children:(0,K.jsx)(ue,{className:"text-secondary text-lg"})})]}),r?(0,K.jsx)("div",{className:"h-[200px] bg-white rounded border flex items-center justify-center",children:(0,K.jsx)(In,{className:"text-5xl"})}):t.timeseries.length?(0,K.jsxs)("div",{className:"flex gap-2",children:[(0,K.jsx)("div",{className:"relative h-[200px] border rounded bg-white p-4 w-2/3",children:(0,K.jsx)("canvas",{id:"exposuresChart"})}),(0,K.jsx)(ge,{dataSource:t?.timeseries||[],className:"w-1/3 h-[200px]",columns:[{title:"Variant",key:"variant",render:function(o,s){return(0,K.jsx)(he,{experimentId:e,variantKey:s.variant})}},{title:"Exposures",key:"exposures",render:function(o,s){return de(t?.total_exposures[s.variant])}},{title:"%",key:"percentage",render:function(o,s){let a=t?.total_exposures.test+t?.total_exposures.control;return(0,K.jsxs)("span",{className:"font-semibold",children:[(t?.total_exposures[s.variant]/a*100).toFixed(1),"%"]})}}]})]}):(0,K.jsx)("div",{className:"h-[200px] bg-white rounded border flex items-center justify-center",children:(0,K.jsxs)("div",{className:"text-center",children:[(0,K.jsx)(vn,{className:"text-3xl mb-2 text-tertiary"}),(0,K.jsx)("h2",{className:"text-lg leading-tight",children:"No exposures yet"}),(0,K.jsx)("p",{className:"text-sm text-center text-balance text-tertiary mb-0",children:"Exposures will appear here once the first participant has been exposed."})]})})]})}w();C();S();var we=f(H());var q=f(k());function Ar({experimentId:e}){let{experiment:t,isReleaseConditionsModalOpen:r}=(0,we.useValues)(u({experimentId:e})),{closeReleaseConditionsModal:i}=(0,we.useActions)(u({experimentId:e})),o=bt({id:t.feature_flag?.id??null}),{featureFlag:s,nonEmptyVariants:a}=(0,we.useValues)(o),{setFeatureFlagFilters:c,saveSidebarExperimentFeatureFlag:m}=(0,we.useActions)(o);return(0,q.jsx)($,{isOpen:r,onClose:i,width:600,title:"Change release conditions",footer:(0,q.jsxs)("div",{className:"flex items-center gap-2",children:[(0,q.jsx)(E,{type:"secondary",onClick:i,children:"Cancel"}),(0,q.jsx)(E,{onClick:()=>{m(s),i()},type:"primary",children:"Save"})]}),children:(0,q.jsxs)("div",{className:"space-y-4",children:[(0,q.jsx)(Z,{type:"info",children:"Adjusting user targeting may impact the validity of your results. Adjust only if you're aware of how changes will affect your experiment."}),(0,q.jsx)(jn,{id:`${t.feature_flag?.id}`,filters:s?.filters??[],onChange:c,nonEmptyFeatureFlagVariants:a})]})})}function Vr(){let{experiment:e}=(0,we.useValues)(u),{reportExperimentReleaseConditionsViewed:t,openReleaseConditionsModal:r}=(0,we.useActions)(u),{aggregationLabel:i}=(0,we.useValues)(Vn);return(0,q.jsxs)("div",{children:[(0,q.jsxs)("div",{className:"flex",children:[(0,q.jsx)("div",{className:"w-1/2",children:(0,q.jsx)("h2",{className:"font-semibold text-lg",children:"Release conditions"})}),(0,q.jsx)("div",{className:"w-1/2 flex flex-col justify-end",children:(0,q.jsx)("div",{className:"ml-auto mb-2",children:(0,q.jsx)(E,{icon:(0,q.jsx)(xt,{}),onClick:()=>{r(),t(e.id)},type:"secondary",size:"xsmall",className:"font-semibold",children:"Manage release conditions"})})})]}),(0,q.jsx)(ge,{loading:!1,columns:[{key:"key",title:"",render:function(a,c,m){return(0,q.jsx)("div",{className:"font-semibold",children:`Set ${m+1}`})}},{key:"rollout_percentage",title:"Rollout",render:function(a,c){let m=e.filters.aggregation_group_type_index!=null?i(e.filters.aggregation_group_type_index).plural:"users",d=`${c.rollout_percentage}% of ${m}`;return(0,q.jsx)("div",{children:d.startsWith("100% of")?(0,q.jsx)(be,{type:"highlight",children:d}):d})}},{key:"variant",title:"Override",render:function(a,c){return(0,q.jsx)("div",{children:c.variant||"--"})}}],dataSource:e.feature_flag?.filters.groups||[]})]})}var b=f(k()),ui=()=>{let{experiment:e,metricResults:t,firstPrimaryMetric:r,primaryMetricsLengthWithSharedMetrics:i,metricResultsLoading:o}=(0,Ye.useValues)(u),s=t?.some(c=>c?.insight),a=i===1;return(0,b.jsxs)(b.Fragment,{children:[!s&&!o&&(0,b.jsx)(b.Fragment,{children:e.type==="web"?(0,b.jsx)(mr,{experiment:e}):(0,b.jsx)(or,{experiment:e})}),a&&(0,b.jsx)("div",{className:"mb-4 mt-2",children:(0,b.jsx)(fr,{})}),(0,b.jsx)(an,{isSecondary:!1}),s&&a&&r&&(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"pb-4",children:(0,b.jsx)(Lt,{metric:r,metricIndex:0,isSecondary:!1})}),t?.[0]&&(t[0].kind==="ExperimentTrendsQuery"||t[0].kind==="ExperimentFunnelsQuery")&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{className:"flex justify-end",children:(0,b.jsx)(Mt,{result:t[0],size:"xsmall"})}),(0,b.jsx)("div",{className:"pb-4",children:(0,b.jsx)(Et,{result:t?.[0]||null,showTable:!0})})]})]}),(0,b.jsx)(an,{isSecondary:!0})]})},fi=()=>{let{shouldUseExperimentMetrics:e,isExperimentRunning:t}=(0,Ye.useValues)(u);return(0,b.jsxs)("div",{className:"space-y-8 mt-2",children:[e&&t&&(0,b.jsx)(Fr,{}),(0,b.jsx)(Vr,{}),(0,b.jsx)(Ir,{})]})};function Dr(){let{experimentLoading:e,experimentId:t,tabKey:r,shouldUseExperimentMetrics:i}=(0,Ye.useValues)(u),{setTabKey:o}=(0,Ye.useActions)(u);return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(Qn,{}),(0,b.jsx)("div",{className:"space-y-8 experiment-view",children:e?(0,b.jsx)(Zn,{}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(tr,{}),(0,b.jsx)("div",{className:"xl:flex",children:(0,b.jsx)("div",{className:"w-1/2 mt-8 xl:mt-0",children:(0,b.jsx)(_r,{})})}),(0,b.jsx)(yt,{activeKey:r,onChange:s=>o(s),tabs:[{key:"results",label:"Results",content:(0,b.jsx)(ui,{})},{key:"variants",label:"Variants",content:(0,b.jsx)(fi,{})}]}),(0,b.jsx)(Kt,{experimentId:t,isSecondary:!0}),(0,b.jsx)(Kt,{experimentId:t,isSecondary:!1}),i?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(Qt,{experimentId:t,isSecondary:!0}),(0,b.jsx)(Qt,{experimentId:t,isSecondary:!1})]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(Zt,{experimentId:t,isSecondary:!0}),(0,b.jsx)(Zt,{experimentId:t,isSecondary:!1})]}),(0,b.jsx)(en,{experimentId:t,isSecondary:!0}),(0,b.jsx)(en,{experimentId:t,isSecondary:!1}),(0,b.jsx)(Cr,{experimentId:t}),(0,b.jsx)(Ar,{experimentId:t}),(0,b.jsx)(Tr,{})]})})]})}var Dt=f(k()),oc={component:xi,logic:u,paramsToProps:({params:{id:e}})=>({experimentId:e==="new"?"new":parseInt(e)})};function xi(){let{experimentId:e,editingExistingExperiment:t,experimentMissing:r}=(0,Br.useValues)(u);return r?(0,Dt.jsx)(Un,{object:"experiment"}):e==="new"||t?(0,Dt.jsx)(lr,{}):(0,Dt.jsx)(Dr,{})}export{xi as Experiment,oc as scene};
//# sourceMappingURL=/static/Experiment-HBGJJFNU.js.map
