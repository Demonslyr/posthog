import{b as Ka}from"/static/chunk-3DYUWTAQ.js";import{a as ja}from"/static/chunk-7PA3KW4F.js";import{b as Ya}from"/static/chunk-THBCC2KR.js";import{b as ta}from"/static/chunk-TJEKTQLD.js";import{d as Ee}from"/static/chunk-HH2POOHN.js";import{a as Pa}from"/static/chunk-DKBGYLEK.js";import{a as He}from"/static/chunk-V3PKUTU3.js";import{a as Ha}from"/static/chunk-EHZHZ2BZ.js";import{a as ze}from"/static/chunk-BKGCJ5HZ.js";import{a as Oa}from"/static/chunk-WLM24SYZ.js";import"/static/chunk-I3JBH3PJ.js";import"/static/chunk-TUL3J7MM.js";import{a as le}from"/static/chunk-7Q4UL5YB.js";import"/static/chunk-DWEVWBHF.js";import{a as Ma,b as Xa,d as za}from"/static/chunk-DT53MXPZ.js";import"/static/chunk-5QZ3UKWA.js";import"/static/chunk-HH2JRGNR.js";import"/static/chunk-ONXXPKL4.js";import"/static/chunk-67FTXEWX.js";import"/static/chunk-QUCOEN55.js";import"/static/chunk-G6Q3YRDS.js";import"/static/chunk-FZRQH23Q.js";import{e as Ga,f as Me,h as Wa,i as N}from"/static/chunk-TIKFJXRT.js";import"/static/chunk-KYJ4OXJI.js";import"/static/chunk-KYV72GAC.js";import{a as wa}from"/static/chunk-OXUIEO32.js";import{a as Oe}from"/static/chunk-SEJ4C6TB.js";import"/static/chunk-WNE4BY7V.js";import"/static/chunk-QYIJYWV3.js";import{a as Xe}from"/static/chunk-EWYESSII.js";import"/static/chunk-DJ5KSU5H.js";import"/static/chunk-QNYERZG7.js";import{s as Qa}from"/static/chunk-MOVKLCV5.js";import"/static/chunk-FT4MFWRB.js";import{j as Ua}from"/static/chunk-YDKHEMDP.js";import"/static/chunk-7SO55T25.js";import"/static/chunk-HRNZBUVG.js";import{a as Ja,b as ke,d as Ve}from"/static/chunk-Y35PDO57.js";import"/static/chunk-KBNOIM2W.js";import"/static/chunk-BB32DDTD.js";import"/static/chunk-QB3AUFV2.js";import"/static/chunk-PWG7LMNW.js";import"/static/chunk-CEZSENEJ.js";import"/static/chunk-GOBPXP3Z.js";import{$a as la,$d as re,$l as Va,Ae as va,Bi as xa,Cb as ma,Ce as Fa,Cg as xe,Do as _,En as Za,Eo as Be,Gm as Ea,Hg as Ta,Hn as _a,Ko as fe,Mi as Qe,Nb as ua,Og as Ue,Oh as La,Pg as Ra,Qd as Te,Sa as Ie,Sc as ga,Sd as h,Sf as Ca,Ta as z,Tf as S,U as ia,Wb as pa,Wd as X,Xd as fa,Xi as De,Yh as Sa,Zc as Je,Zd as ha,_e as Se,a as ae,b as aa,cg as Ia,de as Re,ee as L,ef as Na,f as rt,fe as G,gb as da,ie as H,ig as Ae,jb as ca,ji as Aa,km as Ba,m as ra,oe as ya,pe as P,r as B,se as ge,td as te,tk as ka,ue as ba,up as Da,ve as Le,vo as Ye,ze as ie}from"/static/chunk-TW5IU73S.js";import"/static/chunk-XPJ4MQJV.js";import"/static/chunk-KQJ3FYBQ.js";import{F as se,Fc as sa,Ha as pe,Ka as na,Xb as We,a as we,fb as Ge,na as oa}from"/static/chunk-3UDJFOQH.js";import"/static/chunk-HHT4SG7V.js";import"/static/chunk-K7LQKAJG.js";import"/static/chunk-QQTK3LZH.js";import"/static/chunk-IJQNM355.js";import"/static/chunk-4CN6THWS.js";import"/static/chunk-272RTCFX.js";import"/static/chunk-2ROB4QWU.js";import"/static/chunk-ALT2ZZSO.js";import"/static/chunk-UE6SLBBN.js";import"/static/chunk-GINZUAUY.js";import"/static/chunk-SQELCOUW.js";import"/static/chunk-IGYUTZ65.js";import"/static/chunk-YM6UBNGD.js";import"/static/chunk-C6TQ5FFZ.js";import"/static/chunk-GXGA523B.js";import"/static/chunk-N4MMWRNK.js";import"/static/chunk-NRLAI7OY.js";import"/static/chunk-LVVHNICT.js";import"/static/chunk-2AXSSSSX.js";import"/static/chunk-DGXQI7RB.js";import"/static/chunk-HUCRWDLX.js";import"/static/chunk-RFEQG3YN.js";import"/static/chunk-PUISI233.js";import{d as u,e as x,g as k,j as V}from"/static/chunk-SJXEOBQC.js";x();V();k();var J=u(ae()),ve=u(la()),Fe=u(rt());var Ne=u(we());x();V();k();var Pe=u(we()),de=u(B());function he({onChange:t,placeholder:s,lineHeight:a=20,defaultNumberOfLines:r=1,value:i="",readOnly:p=!1}){let y=i?.toString()||"",n=a,T=Math.max(r,y.split(/\r\n|\r|\n/).length)+1,f=n*T,[g,d]=(0,Pe.useState)(f),[C,A]=(0,Pe.useState)(!1),U=I=>{if(I){let E=I.split(/\r\n|\r|\n/).length,Z=Math.max(E,r)+1;d(n*Z)}else d(n*(r+1))};return(0,de.jsxs)("div",{className:"JsonEditorInput",onFocus:()=>A(!0),onBlur:()=>A(!1),children:[(0,de.jsx)(Ta,{className:"border",language:"json",height:g,value:i?.toString(),options:{readOnly:p,lineHeight:n,minimap:{enabled:!1},scrollbar:{alwaysConsumeMouseWheel:!1},padding:{bottom:0,top:10},overviewRulerLanes:0,hideCursorInOverviewRuler:!0,overviewRulerBorder:!1,glyphMargin:!0,folding:!1,lineNumbers:"off",lineDecorationsWidth:0,lineNumbersMinChars:0,renderLineHighlight:"none",cursorStyle:"block-outline",scrollBeyondLastLine:!1,quickSuggestions:!1,contextmenu:!1},onChange:I=>{U(I),t?.(I)}}),!C&&!i?.toString()&&s&&(0,de.jsx)("div",{className:"placeholder",children:(0,de.jsx)("div",{className:"placeholderLabelContainer",children:s})})]})}x();V();k();var oe=u(ae());var v=u(B());function dt(t){return t.map(s=>({key:s.id,label:`${s.name}`,labelComponent:(0,v.jsx)("span",{children:(0,v.jsx)("b",{children:`${s.name}`})})}))}function je({featureFlag:t}){let{addableRoles:s,unfilteredAddableRolesLoading:a,rolesToAdd:r,derivedRoles:i}=(0,oe.useValues)(Me({flagId:t.id})),{setRolesToAdd:p,addAssociatedRoles:y,deleteAssociatedRole:n}=(0,oe.useActions)(Me({flagId:t.id})),{currentTeam:T}=(0,oe.useValues)(fe);return Sa("ROLE_BASED_ACCESS_CONTROL")&&T?.access_control_version==="v2"?t.id?(0,v.jsx)(_a,{resourceType:"feature_flag"}):(0,v.jsx)("p",{children:"Please save the feature flag before changing the access controls."}):(0,v.jsx)(xa,{feature:"role_based_access",children:(0,v.jsx)(ct,{resourceType:"feature flags",onChange:g=>p(g),rolesToAdd:r,addableRoles:s,addableRolesLoading:a,onAdd:()=>y(),roles:i,deleteAssociatedRole:g=>n({roleId:g}),canEdit:t.can_edit})})}function ct({rolesToAdd:t,addableRoles:s,onChange:a,addableRolesLoading:r,onAdd:i,roles:p,deleteAssociatedRole:y,resourceType:n,canEdit:T}){let{allPermissions:f}=(0,oe.useValues)(Pa),{roles:g}=(0,oe.useValues)(Ga),d=f.find(F=>F.resource===n),C=g.filter(F=>F.feature_flags_access_level===37),A=[{title:"Role",dataIndex:"name",key:"name",render:function(Q,I){return(0,v.jsx)(v.Fragment,{children:I.name==="Organization default"?(0,v.jsx)(Za,{icon:(0,v.jsx)(h,{icon:(0,v.jsx)(pa,{}),to:`${_.settings("organization-roles")}`,targetBlank:!0,size:"small",noPadding:!0,tooltip:"Organization-wide permissions for roles can be managed in the organization settings.",className:"ml-1"}),children:"All users by default"}):I.name})}},{title:"Access",dataIndex:"feature_flags_access_level",key:"feature_flags_access_level",render:function(Q,I){return(0,v.jsxs)("div",{className:"flex flex-row justify-between",children:[I.feature_flags_access_level===37?"Edit":"View",I.deletable&&(0,v.jsx)(h,{icon:(0,v.jsx)(te,{}),onClick:()=>y(I.id),tooltip:"Remove custom role from feature flag",tooltipPlacement:"bottom-start",size:"small"})]})}}],U=[{id:"",name:"Organization default",feature_flags_access_level:d?d.access_level:37,created_by:null,created_at:""},...C,...p.map(F=>({...F,feature_flags_access_level:37,deletable:!0}))];return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(ie,{dataSource:U,columns:A,className:"mt-4"}),T&&(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("h5",{className:"mt-4",children:"Custom edit roles"}),(0,v.jsxs)("div",{className:"flex gap-2",children:[(0,v.jsx)("div",{className:"flex-1",children:(0,v.jsx)(ba,{placeholder:"Search for roles to add\u2026",loading:r,onChange:a,value:t,mode:"multiple","data-attr":"resource-permissioning-select",options:dt(s)})}),(0,v.jsx)(h,{type:"primary",loading:!1,disabled:t.length===0,onClick:i,children:"Add"})]})]})]})}x();V();k();var q=u(ae());var w=u(B());function $a({featureFlag:t}){return(0,w.jsx)("div",{className:"NewDashboardModal",children:(0,w.jsx)(q.BindLogic,{logic:Oe,props:{featureFlagId:t.id},children:t.analytics_dashboards&&t.analytics_dashboards.length>0?(0,w.jsx)(mt,{}):t.id&&(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(Oa,{scope:"feature_flag"}),(0,w.jsx)(ze,{})]})})})}function mt(){let{filteredDashboards:t}=(0,q.useValues)(N),{showNewDashboardModal:s}=(0,q.useActions)(Oe),{dashboardsLoading:a}=(0,q.useValues)(Ba),{filters:r}=(0,q.useValues)(wa);return(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(Ya,{extraActions:(0,w.jsx)("div",{className:"flex items-center gap-2",children:(0,w.jsx)(h,{type:"primary",onClick:s,children:"New dashboard"})}),hideActions:!0,dashboards:t,dashboardsLoading:a,filters:r}),(0,w.jsx)(ze,{})]})}x();V();k();var ye=u(ae()),qa=u(la());var o=u(B());function Ke({readOnly:t}){let{featureFlag:s,sentryIntegrationEnabled:a,sentryErrorCount:r,insightRollingAverages:i}=(0,ye.useValues)(N),{addRollbackCondition:p,removeRollbackCondition:y,loadInsightAtIndex:n}=(0,ye.useActions)(N),{user:T}=(0,ye.useValues)(Be);return(0,o.jsxs)("div",{children:[(0,o.jsxs)("div",{className:"mb-2",children:[(0,o.jsx)("b",{children:"Auto rollback"}),(0,o.jsx)(G,{type:"warning",className:"uppercase ml-2",children:"Beta"}),!t&&(0,o.jsx)("div",{className:"mt-2",children:"Specify the conditions in which this feature flag will automatically roll back."})]}),t&&s.rollback_conditions&&s.rollback_conditions.map((f,g)=>(0,o.jsxs)(o.Fragment,{children:[g>0&&(0,o.jsx)("div",{className:"condition-set-separator",children:"OR"}),f.threshold_type==="insight"&&f.threshold_metric?.events?.[0]?.name?(0,o.jsxs)("div",{className:"mb-4 border rounded p-4 bg-surface-primary",children:[(0,o.jsx)("b",{children:`${pe(f.threshold_type)} based rollback`}),(0,o.jsx)(L,{className:"my-3"}),(0,o.jsxs)("div",{className:"flex items-center",children:[i[g]&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("b",{children:f.threshold_metric.events[0].name}),"\xA0 trailing average is ",i[g],"."]}),"\xA0Trigger when trailing average of \xA0",(0,o.jsx)("b",{children:f.threshold_metric.events[0].name}),"\xA0 is\xA0",f.operator&&na[f.operator]," ",f.threshold]})]}):(0,o.jsxs)("div",{className:"mb-4 border rounded p-4 bg-surface-primary",children:[(0,o.jsx)("b",{children:`${pe(f.threshold_type)} based rollback`}),(0,o.jsx)(L,{className:"my-3"}),(0,o.jsxs)("div",{className:"flex items-center",children:["Trigger when there is a\xA0",(0,o.jsxs)("b",{children:[f.threshold,"%"]}),"\xA0increase in errors"]})]})]})),!t&&s.rollback_conditions&&s.rollback_conditions.map((f,g)=>(0,o.jsxs)(o.Fragment,{children:[g>0&&(0,o.jsx)("div",{className:"condition-set-separator",children:"OR"}),(0,o.jsx)("div",{className:"mb-4 border rounded p-4 bg-surface-primary",children:(0,o.jsxs)(qa.Group,{name:["rollback_conditions",g],children:[(0,o.jsxs)("div",{className:"flex items-center justify-between",children:[(0,o.jsxs)("div",{className:"flex",children:[(0,o.jsx)("div",{className:"mt-3 mr-3",children:(0,o.jsx)("b",{children:"Rollback Condition Type"})}),(0,o.jsx)(S,{name:"threshold_type",children:({value:d,onChange:C})=>(0,o.jsx)(P,{value:d,onChange:C,options:[{value:"sentry",label:"Error Based"},{value:"insight",label:"Metric Based"}]})})]}),(0,o.jsx)(h,{icon:(0,o.jsx)(te,{}),noPadding:!0,onClick:()=>{y(g)}})]}),(0,o.jsx)(L,{className:"my-3"}),s.rollback_conditions[g].threshold_type=="insight"?(0,o.jsxs)("div",{className:"flex gap-2 items-center mt-4",children:[(0,o.jsx)(S,{name:"threshold_metric",children:({value:d,onChange:C})=>(0,o.jsx)(Aa,{filters:d,setFilters:A=>{C({...A}),n(g,A)},typeKey:"feature-flag-rollback-trends-"+g,buttonCopy:"Add graph series",showSeriesIndicator:!1,showNestedArrow:!0,hideRename:!0,entitiesLimit:1,mathAvailability:3,propertiesTaxonomicGroupTypes:["event_properties","person_properties","event_feature_flags","cohorts","elements"]})}),(0,o.jsxs)("span",{children:["trailing 7 day average is\xA0",i[g]!==void 0?(0,o.jsx)("b",{children:i[g]}):(0,o.jsx)(Te,{}),". Trigger when trailing average is"]}),(0,o.jsx)(S,{name:"operator",children:({value:d,onChange:C})=>(0,o.jsx)(P,{value:d,onChange:C,options:[{label:"greater than",value:"gt"},{label:"less than",value:"lt"}]})}),(0,o.jsx)(S,{name:"threshold",children:(0,o.jsx)(H,{min:0,type:"number"})})]}):a?(0,o.jsx)("div",{children:(0,o.jsxs)("div",{className:"flex items-center",children:[r?(0,o.jsxs)("span",{children:[(0,o.jsxs)("b",{children:[Ge(r)," "]})," Sentry errors in the past 24 hours."," "]}):(0,o.jsx)(Te,{}),(0,o.jsx)("span",{children:"\xA0Trigger when there is a"}),(0,o.jsx)(S,{name:"threshold",className:"ml-3 mr-3",children:({value:d,onChange:C})=>(0,o.jsx)(H,{value:d,suffix:(0,o.jsx)(o.Fragment,{children:"%"}),type:"number",min:0,onChange:C})}),(0,o.jsx)(S,{name:"operator",className:"mr-3",children:({value:d,onChange:C})=>(0,o.jsx)(P,{options:[{label:"increase",value:"gt"},{label:"decrease",value:"lt"}],value:d,onChange:C})}),(0,o.jsxs)("span",{children:["to"," ",r?(0,o.jsx)("b",{children:Ge(Math.round(r*(1+(s.rollback_conditions[g].threshold||0)/100)))}):(0,o.jsx)(Te,{})," ","errors."]}),(0,o.jsx)("div",{})]})}):T?.is_staff?(0,o.jsxs)("div",{className:"mt-4",children:[(0,o.jsx)("b",{children:"This feature requires an active Sentry integration."}),(0,o.jsx)("br",{}),(0,o.jsx)(z,{to:_.instanceSettings(),children:"Go to Instance Settings"})," and update the"," ",(0,o.jsx)("code",{children:'"SENTRY_"'})," properties from your Sentry account to enable."]}):(0,o.jsx)("p",{className:"text-secondary",children:"This PostHog instance is not configured for Sentry. Please contact the instance owner to configure it."})]})})]})),!t&&(0,o.jsx)(h,{type:"secondary",onClick:p,children:"Add condition"})]})}x();V();k();var W=u(ae());var et=u(we());var l=u(B());function ut(t,s){let a=new Set;s.forEach(r=>{r.is_static&&a.add(r.id)});for(let r of t.filters.groups)for(let i of r.properties||[])if(i.type==="cohort"&&a.has(i.value))return!0;return!1}var pt=({aggregationLabel:t,currentTeamId:s,currentOrganization:a})=>[{title:"Project",dataIndex:"team_id",width:"45%",render:(r,i)=>{let p=a?.teams?.find(T=>T.id===Number(r));if(!p)return"(project does not exist)";let y=p.id===s,n=y?`${p.name} (current)`:p.name;return(0,l.jsx)(Ra,{to:y?void 0:_.project(p.id,i.flag_id?_.featureFlag(i.flag_id):""),title:n})}},Ve(),ke(),{title:"Release conditions",width:200,render:function(i,p){let y=Ee(p.filters,void 0,t);return typeof y=="string"&&y.startsWith("100% of")?(0,l.jsx)(G,{type:"highlight",children:y}):y}},{title:"Status",dataIndex:"active",render:r=>r?(0,l.jsx)(G,{type:"success",className:"uppercase",children:"Enabled"}):(0,l.jsx)(G,{type:"default",className:"uppercase",children:"Disabled"})}];function gt(){let{currentOrganization:t}=(0,W.useValues)(Se),{featureFlag:s}=(0,W.useValues)(N),a=(t?.teams?.length??0)>1,r=!t?.membership_level||t.membership_level<8,i;if(r&&!a)i="You currently have access to only one project. If your organization manages multiple projects and you wish to copy this feature flag across them, request project access from your administrator.";else if(!a)i="This feature enables the copying of a feature flag across different projects. Once additional projects are added within your organization, you'll be able to replicate this flag to them.";else if(!s.can_edit)i="You don't have the necessary permissions to copy this flag to another project. Contact your administrator to request editing rights.";else return(0,l.jsx)(l.Fragment,{});return(0,l.jsx)(X,{type:"info",className:"mb-4",children:i})}function ft(){let{featureFlag:t,copyDestinationProject:s,projectsWithCurrentFlag:a,featureFlagCopyLoading:r}=(0,W.useValues)(N),{setCopyDestinationProject:i,copyFlag:p}=(0,W.useActions)(N),{currentOrganization:y}=(0,W.useValues)(Se),{currentTeam:n}=(0,W.useValues)(fe),{cohorts:T}=(0,W.useValues)(La),f=ut(t,T.results);return(y?.teams?.length??0)>1&&t.can_edit?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("h3",{className:"l3",children:"Feature flag copy"}),(0,l.jsx)("div",{children:"Copy your flag and its configuration to another project."}),f&&(0,l.jsx)(X,{type:"info",className:"mt-4",children:"The flag you are about to copy references a static cohort. If the cohort with identical name does not exist in the target project, it will be copied as an empty cohort. This is because the associated persons might not exist in the target project."}),(0,l.jsxs)("div",{className:"inline-flex gap-4 my-6",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"font-semibold leading-6 h-6",children:"Key"}),(0,l.jsx)("div",{className:"border px-3 rounded h-10 text-center flex items-center justify-center max-w-200",children:(0,l.jsx)("span",{className:"font-semibold truncate",children:t.key})})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"h-6"}),(0,l.jsx)(da,{className:"h-10",fontSize:"30"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"font-semibold leading-6 h-6",children:"Destination project"}),(0,l.jsx)(P,{dropdownMatchSelectWidth:!1,value:s,onChange:d=>i(d),options:y?.teams?.map(d=>({value:d.id,label:d.name})).sort((d,C)=>d.label.localeCompare(C.label)).filter(d=>d.value!==n?.id)||[],className:"min-w-[10rem]"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"h-6"}),(0,l.jsx)(h,{disabledReason:!s&&"Select destination project",loading:r,type:"primary",icon:(0,l.jsx)(ia,{}),onClick:()=>p(),className:"w-28 max-w-28",children:a.find(d=>Number(d.team_id)===s)?"Update":"Copy"})]})]})]}):(0,l.jsx)(l.Fragment,{})}function $e(){let{projectsWithCurrentFlag:t}=(0,W.useValues)(N),{loadProjectsWithCurrentFlag:s}=(0,W.useActions)(N),{currentTeamId:a}=(0,W.useValues)(fe),{currentOrganization:r}=(0,W.useValues)(Se),{aggregationLabel:i}=(0,W.useValues)(Ae);return(0,et.useEffect)(()=>{s()},[]),(0,l.jsxs)("div",{children:[(0,l.jsx)(gt,{}),(0,l.jsx)(ft,{}),(0,l.jsx)(ie,{loading:!1,dataSource:t,columns:pt({currentTeamId:a,currentOrganization:r,aggregationLabel:i}),emptyState:"This feature flag is not being used in any other project."})]})}x();V();k();var be=u(ae());var c=u(B());function qe(){let{featureFlag:t,scheduledChanges:s,scheduledChangeOperation:a,scheduleDateMarker:r,schedulePayload:i,schedulePayloadErrors:p}=(0,be.useValues)(N),{deleteScheduledChange:y,setScheduleDateMarker:n,setSchedulePayload:T,setScheduledChangeOperation:f,createScheduledChange:g}=(0,be.useActions)(N),{aggregationLabel:d}=(0,be.useValues)(Ae),C=t.filters.aggregation_group_type_index,A={...i.filters,aggregation_group_type_index:C},U=[{title:"Change",dataIndex:"payload",render:function(Q,I){let{payload:E}=I;if(E.operation==="update_status"){let Z=E.value;return(0,c.jsx)(G,{type:Z?"success":"default",className:"uppercase",children:Z?"Enable":"Disable"})}else if(E.operation==="add_release_condition"){let Z=Ee(E.value,void 0,d);return(0,c.jsxs)("div",{className:"inline-flex leading-8",children:[(0,c.jsx)("span",{className:"mr-2",children:(0,c.jsx)("b",{children:"Add release condition:"})}),typeof Z=="string"&&Z.startsWith("100% of")?(0,c.jsx)(G,{type:"highlight",children:Z}):Z]})}return JSON.stringify(E)}},Ja("scheduled_at","Scheduled at"),ke(),Ve(),{title:"Status",dataIndex:"executed_at",render:function(Q,I){let{executed_at:E,failure_reason:Z}=I;function ce(){return Z?{type:"danger",text:"Error"}:E?{type:"completion",text:"Complete"}:{type:"default",text:"Scheduled"}}let{type:me,text:ee}=ce();return(0,c.jsx)(Ie,{title:Z?`Failed: ${Z}`:E&&`Completed: ${(0,oa.default)(E).format("MMMM D, YYYY h:mm A")}`,children:(0,c.jsx)(G,{type:me,children:(0,c.jsx)("b",{className:"uppercase",children:ee})})})}},{width:0,render:function(Q,I){return!I.executed_at&&t.can_edit&&(0,c.jsx)(Le,{overlay:(0,c.jsx)(h,{status:"danger",onClick:()=>y(I.id),fullWidth:!0,children:"Delete scheduled change"})})}}];return(0,c.jsxs)("div",{children:[t.can_edit?(0,c.jsxs)("div",{children:[(0,c.jsx)("h3",{className:"l3",children:"Add a scheduled change"}),(0,c.jsx)("div",{className:"mb-6",children:"Automatically change flag properties at a future point in time."}),(0,c.jsxs)("div",{className:"inline-flex gap-10 mb-8",children:[(0,c.jsxs)("div",{children:[(0,c.jsx)("div",{className:"font-semibold leading-6 h-6 mb-1",children:"Change type"}),(0,c.jsx)(P,{className:"w-50",placeholder:"Select variant",value:a,onChange:F=>F&&f(F),options:[{label:"Change status",value:"update_status"},{label:"Add a condition",value:"add_release_condition"}]})]}),(0,c.jsxs)("div",{className:"w-50",children:[(0,c.jsx)("div",{className:"font-semibold leading-6 h-6 mb-1",children:"Date and time"}),(0,c.jsx)(ha,{value:r,onChange:F=>n(F),placeholder:"Select date",selectionPeriod:"upcoming",granularity:"minute"})]})]}),(0,c.jsxs)("div",{className:"space-y-4",children:[a==="update_status"&&(0,c.jsx)(c.Fragment,{children:(0,c.jsx)("div",{className:"border rounded p-4",children:(0,c.jsx)(re,{id:"flag-enabled-checkbox",label:"Enable feature flag",onChange:F=>{T(null,F)},checked:i.active})})}),a==="add_release_condition"&&(0,c.jsx)(le,{id:`schedule-release-conditions-${t.id}`,filters:A,onChange:(F,Q)=>T(F,null,Q),hideMatchOptions:!0}),(0,c.jsx)("div",{className:"flex items-center justify-end",children:(0,c.jsx)(h,{type:"primary",onClick:g,disabledReason:r?sa(p)?"Fix release condition errors":void 0:"Select the scheduled date and time",children:"Schedule"})}),(0,c.jsx)(L,{className:""})]})]}):(0,c.jsx)(X,{type:"info",className:"mb-2",children:"You don't have the necessary permissions to schedule changes to this flag. Contact your administrator to request editing rights."}),(0,c.jsx)(ie,{rowClassName:F=>F.executed_at?"opacity-75":"",className:"mt-4",loading:!1,dataSource:s,columns:U,defaultSorting:{columnKey:"scheduled_at",order:1},emptyState:"You do not have any scheduled changes"})]})}x();V();k();var O=u(B());function at({flagStatus:t}){return!t||["active","inactive","deleted","unknown"].includes(t.status)?null:(0,O.jsx)(Ie,{title:(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)("div",{className:"text-sm",children:t.reason}),(0,O.jsxs)("div",{className:"text-xs",children:[t.status==="stale"&&"Make sure to remove any references to this flag in your code before deleting it.",t.status==="inactive"&&"It is probably not being used in your code, but be sure to remove any references to this flag before deleting it."]})]}),placement:"right",children:(0,O.jsx)("span",{children:(0,O.jsx)(G,{type:"warning",className:"uppercase cursor-default",children:t.status})})})}x();V();k();var tt=u(ae());var ea=u(B());function ot(){let{relatedInsights:t,relatedInsightsLoading:s,featureFlag:a}=(0,tt.useValues)(N),r={kind:"InsightVizNode",source:{kind:"TrendsQuery",series:[{event:"$pageview",name:"$pageview",kind:"EventsNode",math:"dau"}],breakdownFilter:{breakdown_type:"event",breakdown:`$feature/${a.key}`}}};return(0,ea.jsx)(ja,{loading:s,emptyMessage:{title:"You have no insights that use this feature flag",description:"Explore this feature flag's insights by creating one below.",buttonText:"Create insight",buttonTo:_.insightNew({query:r})},items:t.slice(0,5),renderRow:(i,p)=>(0,ea.jsx)(Ka,{insight:i},p),contentHeightBehavior:"shrink"})}var e=u(B()),Ks={component:yt,logic:N,paramsToProps:({params:{id:t}})=>({id:t&&t!=="new"?parseInt(t):"new"})};function nt(t){setTimeout(()=>document.querySelector(`.VariantFormList input[data-key-index="${t}"]`)?.focus(),50)}function yt({id:t}={}){let{props:s,featureFlag:a,featureFlagLoading:r,featureFlagMissing:i,isEditingFlag:p,newCohortLoading:y,activeTab:n,accessDeniedToFeatureFlag:T}=(0,J.useValues)(N),{featureFlags:f}=(0,J.useValues)(ra),{deleteFeatureFlag:g,restoreFeatureFlag:d,editFeatureFlag:C,loadFeatureFlag:A,saveFeatureFlag:U,createStaticCohort:F,setFeatureFlagFilters:Q,setActiveTab:I}=(0,J.useActions)(N),{tags:E}=(0,J.useValues)(Na),{hasAvailableFeature:Z}=(0,J.useValues)(Be),[ce,me]=(0,Ne.useState)(!1),[ee,ue]=(0,Ne.useState)(!1),Ce=t==="new"||t===void 0;if(i)return(0,e.jsx)(Ea,{object:"feature flag"});if(r)return(0,e.jsxs)("div",{className:"space-y-2",children:[(0,e.jsx)(ge,{active:!0,className:"h-4 w-2/5"}),(0,e.jsx)(ge,{active:!0,className:"h-4 w-full"}),(0,e.jsx)(ge,{active:!0,className:"h-4 w-full"}),(0,e.jsx)(ge,{active:!0,className:"h-4 w-3/5"})]});if(T)return(0,e.jsx)(Ma,{object:"feature flag"});let M=[{label:"Overview",key:"overview",content:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:"flex gap-4 flex-wrap",children:(0,e.jsxs)("div",{className:"w-full",children:[(0,e.jsx)(st,{readOnly:!0}),!a.is_remote_configuration&&(0,e.jsxs)(e.Fragment,{children:[a.filters.super_groups&&(0,e.jsx)(le,{readOnly:!0,isSuper:!0,filters:a.filters}),(0,e.jsxs)("div",{className:"flex gap-x-8",children:[(0,e.jsx)("div",{className:"grow",children:(0,e.jsx)(le,{readOnly:!0,filters:a.filters})}),(0,e.jsxs)("div",{className:"max-w-120 w-full",children:[(0,e.jsx)("h3",{className:"l3",children:"Insights that use this feature flag"}),(0,e.jsx)(ot,{}),(0,e.jsx)("div",{className:"my-4"})]})]}),f[se.AUTO_ROLLBACK_FEATURE_FLAGS]&&(0,e.jsx)(Ke,{readOnly:!0}),(0,e.jsx)(L,{className:"mb-4"})]})]})}),(0,e.jsx)(He,{featureFlag:a})]})}];return a.key&&t&&(M.push({label:"Usage",key:"usage",content:(0,e.jsx)(bt,{id:t,featureFlag:a})}),M.push({label:"Projects",key:"projects",content:(0,e.jsx)($e,{})}),M.push({label:"Schedule",key:"schedule",content:(0,e.jsx)(qe,{})})),f[se.FF_DASHBOARD_TEMPLATES]&&a.key&&t&&M.push({label:(0,e.jsxs)("div",{className:"flex flex-row",children:[(0,e.jsx)("div",{children:"Analysis"}),(0,e.jsxs)(G,{className:"ml-1 float-right uppercase",type:"warning",children:[" ","Beta"]})]}),key:"analysis",content:(0,e.jsx)(ta,{flag:se.FF_DASHBOARD_TEMPLATES,match:!0,children:(0,e.jsx)($a,{id:t,featureFlag:a})})}),a.id&&M.push({label:"History",key:"history",content:(0,e.jsx)(Qa,{scope:"FeatureFlag",id:a.id})}),a.can_edit&&M.push({label:"Permissions",key:"permissions",content:(0,e.jsx)(je,{featureFlag:a})}),(0,e.jsx)(e.Fragment,{children:(0,e.jsx)("div",{className:"feature-flag",children:Ce||p?(0,e.jsxs)(ve.Form,{id:"feature-flag",logic:N,props:s,formKey:"featureFlag",enableFormOnSubmit:!0,className:"space-y-4",children:[(0,e.jsx)(Ye,{buttons:(0,e.jsxs)("div",{className:"flex items-center gap-2",children:[(0,e.jsx)(h,{"data-attr":"cancel-feature-flag",type:"secondary",onClick:()=>{p?(C(!1),A()):Fe.router.actions.push(_.featureFlags())},children:"Cancel"}),(0,e.jsx)(h,{type:"primary","data-attr":"save-feature-flag",htmlType:"submit",form:"feature-flag",children:"Save"})]})}),a.experiment_set&&a.experiment_set.length>0&&(0,e.jsxs)(X,{type:"warning",children:["This feature flag is linked to an experiment. Edit settings here only for advanced functionality. If unsure, go back to"," ",(0,e.jsx)(z,{to:_.experiment(a.experiment_set[0]),children:"the experiment creation screen."})]}),(0,e.jsx)("div",{className:"my-4",children:(0,e.jsxs)("div",{className:"max-w-1/2 space-y-4",children:[(0,e.jsx)(S,{name:"key",label:"Key",help:ce&&t!=="new"?(0,e.jsxs)("span",{className:"text-warning",children:[(0,e.jsx)("b",{children:"Warning! "}),"Changing this key will",(0,e.jsxs)(z,{to:`https://posthog.com/docs/feature-flags${Ha}#feature-flag-persistence`,target:"_blank",targetBlankIcon:!0,children:[" ","affect the persistence of your flag"]})]}):void 0,children:({value:R,onChange:D})=>(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(H,{value:R,onChange:m=>{m!==R&&me(!0),D(m)},"data-attr":"feature-flag-key",className:"ph-ignore-input",autoFocus:!0,placeholder:"examples: new-landing-page, betaFeature, ab_test_1",autoComplete:"off",autoCapitalize:"off",autoCorrect:"off",spellCheck:!1}),(0,e.jsx)("span",{className:"text-secondary text-sm",children:"Feature flag keys must be unique"})]})}),(0,e.jsx)(S,{name:"name",label:"Description",children:(0,e.jsx)(Fa,{className:"ph-ignore-input","data-attr":"feature-flag-description",defaultValue:a.name||""})}),Z("tagging")&&(0,e.jsx)(S,{name:"tags",label:"Tags",children:({value:R,onChange:D})=>(0,e.jsx)(xe,{saving:r,tags:R,onChange:m=>D(m),tagsAvailable:E.filter(m=>!a.tags?.includes(m)),className:"mt-2"})}),(0,e.jsx)(S,{name:"active",children:({value:R,onChange:D})=>(0,e.jsx)("div",{className:"border rounded p-4",children:(0,e.jsx)(re,{id:"flag-enabled-checkbox",label:"Enable feature flag",onChange:()=>D(!R),checked:R,dataAttr:"feature-flag-enabled-checkbox"})})}),!a.is_remote_configuration&&(0,e.jsx)(S,{name:"ensure_experience_continuity",children:({value:R,onChange:D})=>(0,e.jsxs)("div",{className:"border rounded p-4",children:[(0,e.jsx)(re,{id:"continuity-checkbox",label:"Persist flag across authentication steps",onChange:()=>D(!R),fullWidth:!0,checked:R}),(0,e.jsxs)("div",{className:"text-secondary text-sm pl-7",children:["If your feature flag is applied before identifying the user, use this to ensure that the flag value remains consistent for the same user. Depending on your setup, this option might not always be suitable. This feature requires creating profiles for anonymous users."," ",(0,e.jsx)(z,{to:"https://posthog.com/docs/feature-flags/creating-feature-flags#persisting-feature-flags-across-authentication-steps",target:"_blank",children:"Learn more"})]})]})})]})}),(0,e.jsx)(L,{}),(0,e.jsx)(st,{}),(0,e.jsx)(L,{}),!a.is_remote_configuration&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(le,{id:`${a.id}`,filters:a.filters,onChange:Q}),(0,e.jsx)(L,{})]}),(0,e.jsx)(He,{featureFlag:a}),(0,e.jsx)(L,{}),Ce&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{children:(0,e.jsx)(h,{fullWidth:!0,onClick:()=>ue(!ee),sideIcon:ee?(0,e.jsx)(ma,{}):(0,e.jsx)(ua,{}),children:(0,e.jsxs)("div",{children:[(0,e.jsx)("h3",{className:"l4 mt-2",children:"Advanced settings"}),(0,e.jsx)("div",{className:"text-secondary mb-2 font-medium",children:"Define who can modify this flag."})]})})}),ee&&(0,e.jsxs)(e.Fragment,{children:[f[se.AUTO_ROLLBACK_FEATURE_FLAGS]&&(0,e.jsx)(Ke,{}),(0,e.jsxs)("div",{className:"border rounded bg-surface-primary",children:[(0,e.jsx)("h3",{className:"p-2 mb-0",children:"Permissions"}),(0,e.jsx)(L,{className:"my-0"}),(0,e.jsx)("div",{className:"p-3",children:(0,e.jsx)(je,{featureFlag:a})})]})]}),(0,e.jsx)(L,{})]}),(0,e.jsxs)("div",{className:"flex items-center gap-2 justify-end",children:[(0,e.jsx)(h,{"data-attr":"cancel-feature-flag",type:"secondary",onClick:()=>{p?(C(!1),A()):Fe.router.actions.push(_.featureFlags())},children:"Cancel"}),(0,e.jsx)(h,{type:"primary","data-attr":"save-feature-flag",htmlType:"submit",form:"feature-flag",children:"Save"})]})]}):(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(Ye,{notebookProps:{href:_.featureFlag(t)},caption:(0,e.jsxs)("div",{children:[(0,e.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,e.jsx)("div",{className:"flex space-x-1",children:(0,e.jsxs)("div",{children:[(0,e.jsx)("span",{className:"text-secondary",children:"Key:"})," ",(0,e.jsx)(Qe,{tooltipMessage:null,description:"Feature flag key",className:"justify-end",children:a.key})]})}),(0,e.jsx)("div",{children:a?.tags&&(0,e.jsxs)(e.Fragment,{children:[a.tags.length>0?(0,e.jsx)("span",{className:"text-secondary",children:"Tags:"}):null," ",a.can_edit?(0,e.jsx)(xe,{tags:a.tags,onChange:R=>{U({tags:R})},tagsAvailable:E.filter(R=>!a.tags?.includes(R))}):a.tags.length>0?(0,e.jsx)(xe,{tags:a.tags,staticOnly:!0}):null]})})]}),(0,e.jsx)("div",{className:"mt-2",children:a.name||(0,e.jsx)("i",{children:"Description (optional)"})})]}),buttons:(0,e.jsx)(e.Fragment,{children:(0,e.jsxs)("div",{className:"flex items-center gap-2",children:[(0,e.jsx)(Le,{loading:y,overlay:(0,e.jsxs)(e.Fragment,{children:[f[se.FEATURE_FLAG_COHORT_CREATION]&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(h,{loading:y,onClick:()=>{F()},fullWidth:!0,children:"Create Cohort"}),(0,e.jsx)(L,{})]}),(0,e.jsxs)(Xe,{userAccessLevel:a.user_access_level,minAccessLevel:"editor",resourceType:"feature_flag","data-attr":a.deleted?"restore-feature-flag":"delete-feature-flag",status:"danger",fullWidth:!0,onClick:()=>{a.deleted?d(a):g(a)},disabledReason:a.can_edit?(a.features?.length||0)>0?"This feature flag is in use with an early access feature. Delete the early access feature to delete this flag":(a.experiment_set?.length||0)>0?"This feature flag is linked to an experiment. Delete the experiment to delete this flag":null:"You have only 'View' access for this feature flag. To make changes, please contact the flag's creator.",children:[a.deleted?"Restore":"Delete"," feature flag"]})]})}),(0,e.jsx)(L,{vertical:!0}),(0,e.jsx)(ka,{resource:{type:"ph-feature-flag",attrs:{id:a.id}},type:"secondary"}),(0,e.jsx)(Xe,{userAccessLevel:a.user_access_level,minAccessLevel:"editor",resourceType:"feature_flag","data-attr":"edit-feature-flag",type:"secondary",disabledReason:a.can_edit?a.deleted?"This feature flag has been deleted. Restore it to edit.":null:"You have only 'View' access for this feature flag. To make changes, please contact the flag's creator.",onClick:()=>{C(!0)},children:"Edit"})]})})}),(0,e.jsx)(va,{activeKey:n,onChange:R=>R!==n&&I(R),tabs:M})]})})})}function bt({featureFlag:t}){let{key:s,usage_dashboard:a,has_enriched_analytics:r}=t,{generateUsageDashboard:i,enrichUsageDashboard:p}=(0,J.useActions)(N),{featureFlagLoading:y}=(0,J.useValues)(N),n=null;a&&(n=(0,J.useValues)(Ia({id:a,placement:"feature-flag"})).dashboard);let{closeEnrichAnalyticsNotice:T}=(0,J.useActions)(Ue),{enrichAnalyticsNoticeAcknowledged:f}=(0,J.useValues)(Ue);(0,Ne.useEffect)(()=>{n&&r&&n.tiles?.find(d=>(d.insight?.name?.indexOf("Feature Viewed")??-1)>-1)===void 0&&p()},[n,r,p]);let g=[{key:"$feature_flag",type:"event",value:s,operator:"exact"}];return t.deleted?(0,e.jsx)("div",{"data-attr":"feature-flag-usage-deleted-banner",children:(0,e.jsx)(X,{type:"error",children:"This feature flag has been deleted."})}):(0,e.jsxs)("div",{"data-attr":"feature-flag-usage-container",children:[n?(0,e.jsxs)(e.Fragment,{children:[!r&&!f&&(0,e.jsxs)(X,{type:"info",className:"mb-3",onClose:()=>T(),children:["Get richer insights automatically by"," ",(0,e.jsxs)(z,{to:"https://posthog.com/docs/libraries/js#enriched-analytics",target:"_blank",children:["enabling enriched analytics for flags"," "]})]}),(0,e.jsx)(za,{id:a.toString(),placement:"feature-flag"})]}):(0,e.jsxs)("div",{children:[(0,e.jsx)("b",{children:"Dashboard"}),(0,e.jsx)("div",{className:"text-secondary mb-2",children:"There is currently no connected dashboard to this feature flag. If there was previously a connected dashboard, it may have been deleted."}),y?(0,e.jsx)(Xa,{loading:!0,canEdit:!1}):(0,e.jsx)(h,{type:"primary",onClick:()=>i(),children:"Generate Usage Dashboard"})]}),(0,e.jsxs)("div",{className:"mt-4 mb-4",children:[(0,e.jsx)("b",{children:"Log"}),(0,e.jsx)("div",{className:"text-secondary",children:`Feature flag calls for "${s}" will appear here`})]}),(0,e.jsx)(Ua,{query:{kind:"DataTableNode",source:{kind:"EventsQuery",select:[...Da("EventsQuery"),"properties.$feature_flag_response"],event:"$feature_flag_called",properties:g,after:"-30d"},full:!1,showDateRange:!0}})]})}function vt(t){return t===null||t.length<3?Va(t):`${t[0]} and ${t.length-1} more sets`}function st({readOnly:t}){let{multivariateEnabled:s,variants:a,areVariantRolloutsValid:r,variantRolloutSum:i,nonEmptyVariants:p,aggregationTargetName:y,featureFlag:n,recordingFilterForFlag:T,flagStatus:f,flagType:g,flagTypeString:d,hasEncryptedPayloadBeenSaved:C,hasExperiment:A,isDraftExperiment:U}=(0,J.useValues)(N),{distributeVariantsEqually:F,addVariant:Q,removeVariant:I,setMultivariateEnabled:E,setFeatureFlag:Z,saveFeatureFlag:ce,setRemoteConfigEnabled:me,resetEncryptedPayload:ee}=(0,J.useActions)(N),ue=n.filters.groups||[],Ce=()=>{Re.open({title:"Change value type?",description:"The existing variants will be lost",primaryButton:{children:"Confirm",type:"primary",onClick:()=>E(!1),size:"small"},secondaryButton:{children:"Cancel",type:"tertiary",size:"small"}})},M=()=>{Re.open({title:"Reset payload?",description:"The existing payload will not be reset until the feature flag is saved.",primaryButton:{children:"Reset",onClick:ee,size:"small",status:"danger"},secondaryButton:{children:"Cancel",type:"tertiary",size:"small"}})},R=m=>{let b={multivariate:s.toString()};m&&(b.variant_key=m),aa.capture("viewed recordings from feature flag",b)},D=m=>!(A&&!U||A&&U&&m===0);return(0,e.jsxs)(e.Fragment,{children:[t?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("div",{className:"flex flex-col mb-4",children:[(0,e.jsxs)("div",{className:"grid grid-cols-8",children:[(0,e.jsx)("div",{className:"col-span-2 card-secondary",children:"Status"}),(0,e.jsx)("div",{className:"col-span-6 card-secondary",children:"Type"}),(0,e.jsx)("div",{className:"col-span-2",children:n.deleted?(0,e.jsx)(G,{size:"medium",type:"danger",className:"uppercase",children:"Deleted"}):(0,e.jsx)("div",{className:"flex gap-2",children:(0,e.jsx)(Ca,{userAccessLevel:n.user_access_level,minAccessLevel:"editor",resourceType:"feature_flag",children:({disabledReason:m})=>(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(fa,{onChange:b=>{Re.open({title:`${b===!0?"Enable":"Disable"} this flag?`,description:`This flag will be immediately ${b===!0?"rolled out to":"rolled back from"} the users matching the release conditions.`,primaryButton:{children:"Confirm",type:"primary",onClick:()=>{let ne={...n,active:b};Z(ne),ce(ne)},size:"small"},secondaryButton:{children:"Cancel",type:"tertiary",size:"small"}})},label:"Enabled",disabledReason:m||(n.can_edit?null:"You only have view access to this feature flag. To make changes, contact the flag's creator."),checked:n.active}),!n.is_remote_configuration&&(0,e.jsx)(at,{flagStatus:f})]})})})}),(0,e.jsx)("div",{className:"col-span-6",children:(0,e.jsx)("span",{className:"mt-1",children:d})})]}),(0,e.jsx)("span",{className:"card-secondary mt-4",children:"Flag persistence"}),(0,e.jsxs)("span",{children:["This flag"," ",(0,e.jsxs)("b",{children:[n.ensure_experience_continuity?"persists":"does not persist"," "]}),"across authentication events."]})]}),(0,e.jsx)(L,{className:"my-3"}),n.filters.multivariate&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("h3",{className:"l3",children:"Variant keys"}),(0,e.jsxs)("div",{className:"border rounded p-4 mb-4 bg-surface-primary",children:[(0,e.jsxs)("div",{className:"grid grid-cols-10 gap-4 font-semibold",children:[(0,e.jsx)("div",{className:"col-span-2",children:"Key"}),(0,e.jsx)("div",{className:"col-span-2",children:"Description"}),(0,e.jsx)("div",{className:"col-span-2",children:"Payload"}),(0,e.jsx)("div",{children:"Rollout"})]}),(0,e.jsx)(L,{className:"my-3"}),a.map((m,b)=>(0,e.jsxs)("div",{children:[(0,e.jsxs)("div",{className:"grid grid-cols-10 gap-4",children:[(0,e.jsxs)("div",{className:"col-span-2",children:[(0,e.jsx)(De,{name:We[b],color:"gray"}),(0,e.jsx)(Qe,{tooltipMessage:null,description:"key",style:{marginLeft:"0.5rem"},iconStyle:{color:"var(--text-secondary)"},children:m.key})]}),(0,e.jsx)("div",{className:"col-span-2",children:(0,e.jsx)("span",{className:m.name?"":"text-muted",children:m.name||"There is no description for this variant key"})}),(0,e.jsx)("div",{className:"col-span-2",children:n.filters.payloads?.[b]?(0,e.jsx)(he,{readOnly:!0,value:n.filters.payloads[b]}):(0,e.jsx)("span",{className:"text-secondary",children:"No payload associated with this variant"})}),(0,e.jsxs)("div",{children:[m.rollout_percentage,"%"]}),(0,e.jsx)("div",{className:"col-span-2",children:(0,e.jsx)(h,{size:"xsmall",icon:(0,e.jsx)(Je,{}),type:"secondary",onClick:()=>{R(m.key),Fe.router.actions.push(_.replay("home",Wa(n.key,m.key,n.has_enriched_analytics)))},children:"View recordings"})})]}),b!==a.length-1&&(0,e.jsx)(L,{className:"my-3"})]},b))]})]})]}):(0,e.jsxs)("div",{className:"mb-8",children:[(0,e.jsx)("h3",{className:"l3",children:"Served value"}),(0,e.jsx)("div",{className:"mb-2","data-attr":"feature-flag-served-value-segmented-button",children:(0,e.jsx)(ya,{size:"small",options:[{label:"Release toggle (boolean)",value:"boolean",disabledReason:A?"This feature flag is associated with an experiment.":void 0},{label:(0,e.jsx)("span",{children:"Multiple variants with rollout percentages (A/B/n test)"}),value:"multivariate"},{label:(0,e.jsx)("span",{children:"Remote config (single payload)"}),value:"remote_config",disabledReason:A?"This feature flag is associated with an experiment.":void 0}],onChange:m=>{["boolean","remote_config"].includes(m)&&p.length?Ce():(E(m==="multivariate"),me(m==="remote_config"),nt(0))},value:g})}),(0,e.jsx)("div",{className:"text-secondary mb-4",children:n.is_remote_configuration?(0,e.jsxs)("span",{children:["Remote config flags provide runtime configuration values in your app. Read more in the"," ",(0,e.jsx)(z,{to:"https://posthog.com/docs/feature-flags/remote-config",children:"remote config flags documentation"}),"."]}):(0,e.jsxs)(e.Fragment,{children:[pe(y)," will be served"," ",s?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("strong",{children:"a variant key"})," according to the below distribution"]}):(0,e.jsx)("strong",{children:(0,e.jsx)("code",{children:"true"})})," ",(0,e.jsx)("span",{children:"if they match one or more release condition groups."})]})})]}),!s&&(0,e.jsxs)("div",{className:"mb-6 flex flex-col gap-y-4",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("h3",{className:"l3",children:"Payload"}),t?n.filters.payloads?.true?(0,e.jsx)(he,{readOnly:t,value:n.filters.payloads?.true}):(0,e.jsx)("span",{className:"text-secondary",children:"No payload associated with this flag"}):(0,e.jsxs)("div",{className:"w-1/2",children:[(0,e.jsx)("div",{className:"text-secondary mb-4",children:n.is_remote_configuration?(0,e.jsx)(e.Fragment,{children:"Specify a valid JSON payload to be returned for the config flag"}):(0,e.jsxs)(e.Fragment,{children:["Specify a valid JSON payload to be returned when the served value is"," ",(0,e.jsx)("strong",{children:(0,e.jsx)("code",{children:"true"})})]})}),n.is_remote_configuration&&(0,e.jsx)(S,{name:"has_encrypted_payloads",children:({value:m,onChange:b})=>(0,e.jsx)("div",{className:"border rounded mb-4 p-4",children:(0,e.jsx)(re,{id:"flag-payload-encrypted-checkbox",label:"Encrypt remote configuration payload",onChange:()=>b(!m),checked:m,dataAttr:"feature-flag-payload-encrypted-checkbox",disabledReason:C&&"An encrypted payload has already been saved for this flag. Reset the payload or create a new flag to create an unencrypted configuration payload."})})}),(0,e.jsxs)("div",{className:"flex gap-2",children:[(0,e.jsx)(ve.Group,{name:["filters","payloads"],children:(0,e.jsx)(S,{name:"true",className:"grow",children:(0,e.jsx)(he,{readOnly:t||n.has_encrypted_payloads&&!!n.filters?.payloads?.true,placeholder:'Examples: "A string", 2500, {"key": "value"}'})})}),n.has_encrypted_payloads&&(0,e.jsx)(h,{className:"grow-0",icon:(0,e.jsx)(te,{}),type:"secondary",size:"small",status:"danger",onClick:M,children:"Reset"})]}),n.is_remote_configuration&&(0,e.jsxs)("div",{className:"text-sm text-secondary mt-4",children:["Note: remote config flags must be accessed through payloads, e.g."," ",(0,e.jsx)("span",{className:"font-mono font-bold",children:n.has_encrypted_payloads?"getDecryptedFeatureFlagPayload":"getFeatureFlagPayload"}),". Using standard SDK methods such as"," ",(0,e.jsx)("span",{className:"font-mono font-bold",children:"getFeatureFlag"})," or"," ",(0,e.jsx)("span",{className:"font-mono font-bold",children:"isFeatureEnabled"})," will always return"," ",(0,e.jsx)("span",{className:"font-mono font-bold",children:"true"})]})]})]}),t&&!n.is_remote_configuration&&(0,e.jsxs)("div",{children:[(0,e.jsx)("h3",{className:"l3",children:"Recordings"}),(0,e.jsx)("p",{children:"Watch recordings of people who have been exposed to the feature flag."}),(0,e.jsx)("div",{className:"inline-block",children:(0,e.jsx)(h,{onClick:()=>{R(),Fe.router.actions.push(_.replay("home",T))},icon:(0,e.jsx)(Je,{}),type:"secondary",size:"small",children:"View recordings"})})]})]}),!t&&s&&(0,e.jsxs)("div",{className:"feature-flag-variants",children:[(0,e.jsx)("h3",{className:"l4",children:"Variant keys"}),(0,e.jsx)("span",{children:"The rollout percentage of feature flag variants must add up to 100%"}),(0,e.jsxs)("div",{className:"VariantFormList space-y-2",children:[(0,e.jsxs)("div",{className:"VariantFormList__row grid label-row gap-2 items-center",children:[(0,e.jsx)("div",{}),(0,e.jsx)("div",{className:"col-span-4",children:"Variant key"}),(0,e.jsx)("div",{className:"col-span-6",children:"Description"}),(0,e.jsx)("div",{className:"col-span-8",children:(0,e.jsxs)("div",{className:"flex flex-col",children:[(0,e.jsx)("b",{children:"Payload"}),(0,e.jsx)("span",{className:"text-secondary font-normal",children:"Specify return payload when the variant key matches"})]})}),(0,e.jsxs)("div",{className:"col-span-3 flex justify-between items-center gap-1",children:[(0,e.jsx)("span",{children:"Rollout"}),(0,e.jsx)(h,{onClick:F,tooltip:"Normalize variant rollout percentages",children:(0,e.jsx)(ca,{})})]})]}),a.map((m,b)=>(0,e.jsx)(ve.Group,{name:"filters",children:(0,e.jsxs)("div",{className:"VariantFormList__row grid gap-2",children:[(0,e.jsx)("div",{className:"flex items-center justify-center",children:(0,e.jsx)(De,{name:We[b],color:"gray"})}),(0,e.jsx)("div",{className:"col-span-4",children:(0,e.jsx)(S,{name:["multivariate","variants",b,"key"],children:(0,e.jsx)(H,{"data-attr":"feature-flag-variant-key","data-key-index":b.toString(),className:"ph-ignore-input",placeholder:`example-variant-${b+1}`,autoComplete:"off",autoCapitalize:"off",autoCorrect:"off",spellCheck:!1,disabled:!D(b)})})}),(0,e.jsx)("div",{className:"col-span-6",children:(0,e.jsx)(S,{name:["multivariate","variants",b,"name"],children:(0,e.jsx)(H,{"data-attr":"feature-flag-variant-name",className:"ph-ignore-input",placeholder:"Description"})})}),(0,e.jsx)("div",{className:"col-span-8",children:(0,e.jsx)(S,{name:["payloads",b],children:({value:ne,onChange:Ze})=>(0,e.jsx)(he,{onChange:Ze,value:ne,placeholder:'{"key": "value"}'})})}),(0,e.jsx)("div",{className:"col-span-3",children:(0,e.jsx)(S,{name:["multivariate","variants",b,"rollout_percentage"],children:({value:ne,onChange:Ze})=>(0,e.jsxs)("div",{children:[(0,e.jsx)(H,{type:"number",min:0,max:100,value:ne.toString(),onChange:Y=>{let _e=Y!==void 0&&!isNaN(Y)?parseInt(Y.toString()):0;Ze(_e)},suffix:(0,e.jsx)("span",{children:"%"}),"data-attr":"feature-flag-variant-rollout-percentage-input"}),ue.filter(Y=>Y.variant===m.key).length>0&&(0,e.jsxs)("span",{className:"text-secondary text-xs",children:["Overridden by"," ",(0,e.jsx)("strong",{children:vt(ue.filter(Y=>Y.variant!=null&&Y.variant===m.key).map(Y=>"Set "+(ue.findIndex(_e=>_e===Y)+1)))})]})]})})}),(0,e.jsx)("div",{className:"flex items-center justify-center",children:a.length>1&&(0,e.jsx)(h,{icon:(0,e.jsx)(te,{}),"data-attr":`delete-prop-filter-${b}`,noPadding:!0,onClick:()=>I(b),disabledReason:D(b)?void 0:U?"Cannot delete the control variant from an experiment.":"Cannot delete variants from a feature flag that is part of a launched experiment.",tooltipPlacement:"top-end"})})]})},b)),a.length>0&&!r&&(0,e.jsxs)("p",{className:"text-danger",children:["Percentage rollouts for variants must sum to 100 (currently ",i,")."]}),(0,e.jsx)(h,{type:"secondary",onClick:()=>{let m=a.length;Q(),nt(m)},icon:(0,e.jsx)(ga,{}),disabledReason:A&&!U?"Cannot add variants to a feature flag that is part of a launched experiment. To update variants, reset the experiment to draft.":void 0,tooltipPlacement:"top-start",center:!0,children:"Add variant"})]})]})]})}export{yt as FeatureFlag,Ks as scene};
//# sourceMappingURL=/static/FeatureFlag-52NBX7NF.js.map
