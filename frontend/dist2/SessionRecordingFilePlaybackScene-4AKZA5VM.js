import{Bi as v,Do as R,Eo as D,Im as P,Ip as N,Jm as T,Km as I,Rd as x,Vd as w,Wd as E,Za as M,a as F,f as K,ge as k,lo as _,m as L,r as h,ta as b}from"/static/chunk-TW5IU73S.js";import"/static/chunk-XPJ4MQJV.js";import{a as C,na as y,za as S}from"/static/chunk-3UDJFOQH.js";import"/static/chunk-HHT4SG7V.js";import"/static/chunk-K7LQKAJG.js";import"/static/chunk-QQTK3LZH.js";import"/static/chunk-IJQNM355.js";import"/static/chunk-4CN6THWS.js";import"/static/chunk-272RTCFX.js";import"/static/chunk-2ROB4QWU.js";import"/static/chunk-ALT2ZZSO.js";import"/static/chunk-UE6SLBBN.js";import"/static/chunk-GINZUAUY.js";import"/static/chunk-SQELCOUW.js";import"/static/chunk-IGYUTZ65.js";import"/static/chunk-YM6UBNGD.js";import"/static/chunk-C6TQ5FFZ.js";import"/static/chunk-GXGA523B.js";import"/static/chunk-N4MMWRNK.js";import"/static/chunk-NRLAI7OY.js";import"/static/chunk-LVVHNICT.js";import"/static/chunk-2AXSSSSX.js";import"/static/chunk-DGXQI7RB.js";import"/static/chunk-HUCRWDLX.js";import"/static/chunk-RFEQG3YN.js";import"/static/chunk-PUISI233.js";import{d as a,e as p,g as m,j as g}from"/static/chunk-SJXEOBQC.js";p();g();m();var d=a(F());var V=a(C());p();g();m();var i=a(F()),O=a(M()),B=a(K());var X=r=>{let o=JSON.parse(r);if(!o.version||!o.data)throw new Error("File does not appear to be a valid session recording export");if(o.version==="2023-04-28")return o;if(o.version==="2022-12-02")return{version:"2023-04-28",data:{id:"",person:o.data.person||void 0,snapshots:Object.entries(o.data.snapshotsByWindowId).flatMap(([e,n])=>n.map(t=>({...t,windowId:e}))).sort((e,n)=>e.timestamp-n.timestamp)}};throw new Error("File version is not supported")},$=async r=>{let e=0,n=null;for(;e<20;){if(n=I.findMounted({sessionRecordingId:"",playerKey:r}),n!==null)return console.log("found after retries",e),n;await new Promise(t=>setTimeout(t,1)),e++}throw new Error("Timeout reached: dataLogic is still null after 2 seconds")},f=(0,i.kea)([(0,i.path)(["scenes","session-recordings","detail","sessionRecordingFilePlaybackSceneLogic"]),(0,i.connect)({actions:[N,["reportRecordingLoadedFromFile"]],values:[L,["featureFlags"]]}),(0,O.loaders)(({actions:r})=>({sessionRecording:{__default:null,loadFromFile:async o=>{try{let e=await new Promise((t,u)=>{let l=new FileReader;l.onload=c=>{t(c.target?.result)},l.onerror=c=>{u(c)},l.readAsText(o)}),n=X(e);return r.reportRecordingLoadedFromFile({success:!0}),n.data}catch(e){return r.reportRecordingLoadedFromFile({success:!1,error:`${e}`}),w.error(`File import failed: ${e}`),null}},resetSessionRecording:()=>null}})),(0,i.reducers)({playerKey:["file-playback",{loadFromFileSuccess:()=>`file-playback-${S()}`,resetSessionRecording:()=>"file-playback"}]}),(0,i.listeners)(({values:r})=>({loadFromFileSuccess:async()=>{let o=await $(r.playerKey);if(!o||!r.sessionRecording)return;let e=T(await P(r.sessionRecording.snapshots,r.sessionRecording.id));o.actions.loadSnapshotsForSourceSuccess({snapshots:e,untransformed_snapshots:e,source:{source:"file"}}),o.actions.loadSnapshotSourcesSuccess([{source:"file"}]),o.actions.loadRecordingMetaSuccess({id:r.sessionRecording.id,viewed:!1,recording_duration:e[e.length-1].timestamp-e[0].timestamp,person:r.sessionRecording.person||void 0,start_time:(0,y.default)(e[0].timestamp).toISOString(),end_time:(0,y.default)(e[e.length-1].timestamp).toISOString(),snapshot_source:"unknown"})}})),(0,B.beforeUnload)(({values:r,actions:o})=>({enabled:()=>!!r.sessionRecording,message:"The loaded session recording will be lost. Are you sure you want to leave?",onConfirm:()=>{o.resetSessionRecording()}})),(0,i.selectors)({breadcrumbs:[()=>[],()=>[{key:"Replay",name:"Replay",path:R.replay()},{key:"ReplayFilePlayback",name:"File playback",path:R.replayFilePlayback()}]]})]);var s=a(h()),Re={component:J,logic:f};function J(){let{loadFromFile:r,resetSessionRecording:o}=(0,d.useActions)(f),{sessionRecording:e,sessionRecordingLoading:n,playerKey:t}=(0,d.useValues)(f),{hasAvailableFeature:u}=(0,d.useValues)(D),l=u("recordings_file_export"),c=(0,V.useRef)(null);return l?(0,s.jsx)("div",{children:n?(0,s.jsx)(x,{}):e?(0,s.jsxs)("div",{className:"flex flex-col gap-2 h-screen pb-4",children:[(0,s.jsx)(E,{type:"info",action:{onClick:()=>o(),children:"Load a different recording"},children:"You are viewing a recording loaded from a file."}),(0,s.jsx)(_,{sessionRecordingId:"",playerKey:t})]}):(0,s.jsx)("div",{ref:c,className:"w-full border rounded p-20 text-secondary flex flex-col items-center justify-center",children:(0,s.jsx)(k,{accept:"application/json",multiple:!1,onChange:A=>r(A[0]),alternativeDropTargetRef:c,callToAction:(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center space-y-2",children:[(0,s.jsxs)("span",{className:"flex items-center gap-2 font-semibold",children:[(0,s.jsx)(b,{className:"text-2xl"})," Load recording"]}),(0,s.jsx)("div",{children:"Drag and drop your exported recording here or click to open the file browser."})]})})})}):(0,s.jsx)(v,{feature:"recordings_file_export",className:"py-8",docsLink:"https://posthog.com/docs/user-guides/session-recordings"})}export{J as SessionRecordingFilePlaybackScene,Re as scene};
//# sourceMappingURL=/static/SessionRecordingFilePlaybackScene-4AKZA5VM.js.map
