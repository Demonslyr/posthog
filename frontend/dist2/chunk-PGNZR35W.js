import{a as G}from"/static/chunk-X4GKH4OI.js";import{$a as A,Ao as b,Ce as W,Sd as P,Ta as M,Tf as m,Vd as K,Xd as O,a as ee,ee as V,fe as I,ge as q,ie as y,ki as z,pe as N,r as S,yo as X,zo as J}from"/static/chunk-TW5IU73S.js";import{a as U}from"/static/chunk-3UDJFOQH.js";import{d as u,e as p,g as d,j as g}from"/static/chunk-SJXEOBQC.js";p();g();d();var w=u(A());var E=u(U());p();g();d();var B=u(S());function Y({sourceConfig:e,...n}){return(0,B.jsx)(G,{...n,integration:e.name.toLowerCase(),redirectUrl:`/data-warehouse/new?kind=${e.name.toLowerCase()}`})}p();g();d();function $(e){let n={},a,s=!1;e.startsWith("postgres://")&&(e="postgresql://"+e.substring(11)),/ |%[^a-f0-9]|%[a-f0-9][^a-f0-9]/i.test(e)&&(e=encodeURI(e).replace(/%25(\d\d)/g,"%$1"));try{a=new URL(e,"postgresql://base")}catch{a=new URL(e.replace("@/","@___DUMMY___/"),"postgresql://base"),s=!0}for(let[h,c]of a.searchParams.entries())n[h]=c;if(n.user=n.user||decodeURIComponent(a.username||""),n.password=n.password||decodeURIComponent(a.password||""),a.protocol==="socket:")return n.host=decodeURI(a.pathname),n.database=a.searchParams.get("db"),n.client_encoding=a.searchParams.get("encoding"),n;let r=s?"":a.hostname;n.host?r&&/^%2f/i.test(r)&&(a.pathname=r+a.pathname):n.host=decodeURIComponent(r),n.port=n.port||a.port;let t=a.pathname.slice(1)||null;return n.database=t?decodeURIComponent(t):null,n.isValid=!!(n.user&&n.database&&n.host),n}var o=u(S()),ae={Postgres:5432},T=(e,n,a,s)=>{if(e.type==="text"&&e.name==="connection_string")return s?(0,o.jsx)(E.default.Fragment,{},e.name):(0,o.jsxs)(E.default.Fragment,{children:[(0,o.jsx)(m,{name:e.name,label:e.label,children:({onChange:r})=>(0,o.jsx)(y,{className:"ph-connection-string","data-attr":e.name,placeholder:e.placeholder,type:"text",onChange:t=>{r(t);let{host:h,port:c,database:C,user:L,password:R,isValid:F}=$(t);F&&(b.actions.setSourceConnectionDetailsValue(["payload","database"],C||""),b.actions.setSourceConnectionDetailsValue(["payload","host"],h||""),b.actions.setSourceConnectionDetailsValue(["payload","user"],L||""),b.actions.setSourceConnectionDetailsValue(["payload","port"],c||ae[n.name]),b.actions.setSourceConnectionDetailsValue(["payload","password"],R||""))}},e.name)}),(0,o.jsx)(V,{})]},e.name);if(e.type==="switch-group"){let r=!!a?.[e.name]?.enabled||a?.[e.name]?.enabled==="True";return(0,o.jsx)(m,{name:[e.name,"enabled"],label:e.label,children:({value:t,onChange:h})=>{let c=t==null||t==="False"?r:t;return(0,o.jsxs)(o.Fragment,{children:[!!e.caption&&(0,o.jsx)("p",{children:e.caption}),(0,o.jsx)(O,{checked:c,onChange:h}),c&&(0,o.jsx)(w.Group,{name:e.name,children:e.fields.map(C=>T(C,n,a?.[C.name]))})]})}},e.name)}if(e.type==="select"){let r=!!e.options.filter(t=>(t.fields?.length??0)>0).length;return(0,o.jsx)(m,{name:r?[e.name,"selection"]:e.name,label:e.label,children:({value:t,onChange:h})=>(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(N,{options:e.options,value:t==null?a?.[e.name]:t||e.defaultValue,onChange:h}),(0,o.jsx)(w.Group,{name:e.name,children:e.options.find(c=>c.value===(t??e.defaultValue))?.fields?.map(c=>T(c,n,a?.[c.name]))})]})},e.name)}return e.type==="textarea"?(0,o.jsx)(m,{name:e.name,label:e.label,children:({value:r,onChange:t})=>(0,o.jsx)(W,{className:"ph-ignore-input","data-attr":e.name,placeholder:e.placeholder,minRows:4,value:r||"",onChange:t})},e.name):e.type==="oauth"?(0,o.jsx)(m,{name:e.name,label:e.label,children:({value:r,onChange:t})=>(0,o.jsx)(Y,{sourceConfig:n,value:r,onChange:t},e.name)},e.name):e.type==="file-upload"?(0,o.jsx)(m,{name:e.name,label:e.label,children:({value:r,onChange:t})=>(0,o.jsx)("div",{className:"bg-[white] p-2 border rounded-[var(--radius)]",children:(0,o.jsx)(q,{value:r,accept:e.fileFormat,multiple:!1,onChange:t})})},e.name):(0,o.jsx)(m,{name:e.name,label:e.label,children:({value:r,onChange:t})=>(0,o.jsx)(y,{className:"ph-ignore-input","data-attr":e.name,placeholder:e.placeholder,type:e.type,value:r||"",onChange:t})},e.name)};function ne(e){return(0,o.jsx)(w.Form,{logic:b,formKey:"sourceConnectionDetails",enableFormOnSubmit:!0,children:(0,o.jsx)(te,{...e})})}function te({sourceConfig:e,showPrefix:n=!0,jobInputs:a,setSourceConfigValue:s}){(0,E.useEffect)(()=>{if(a&&s)for(let t of Object.keys(a||{}))s(["payload",t],a[t])},[JSON.stringify(a),s]);let r=!!s;return(0,o.jsxs)("div",{className:"space-y-4",children:[(0,o.jsx)(w.Group,{name:"payload",children:J[e.name].fields.map(t=>T(t,e,a?.[t.name],r))}),n&&(0,o.jsx)(m,{name:"prefix",label:"Table Prefix (optional)",children:({value:t,onChange:h})=>(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(y,{className:"ph-ignore-input","data-attr":"prefix",placeholder:"internal_",value:t,onChange:h}),(0,o.jsxs)("p",{children:["Example table name:"," ",(0,o.jsxs)("strong",{children:[t,e.name.toLowerCase(),"_table_name"]})]})]})})]})}p();g();d();var H=u(ee()),Q=u(A());var i=u(S()),D={aws:{fileUrlPatternPlaceholder:"eg: https://your-org.s3.amazonaws.com/airbyte/stripe/invoices/*.pqt",accessKeyPlaceholder:"eg: AKIAIOSFODNN7EXAMPLE",accessKeyLabel:"Access key",accessSecretLabel:"Access secret"},"google-cloud":{fileUrlPatternPlaceholder:"eg: https://storage.googleapis.com/your-org/airbyte/stripe/invoices/*.pqt",accessKeyPlaceholder:"eg: GOOGTS7C7FUP3AIRVEXAMPLE",accessKeyLabel:"Access ID",accessSecretLabel:"Secret"},"cloudflare-r2":{fileUrlPatternPlaceholder:"eg: https://your-account-id.r2.cloudflarestorage.com/airbyte/stripe/invoices/*.pqt",accessKeyPlaceholder:"eg: AKIAIOSFODNN7EXAMPLE",accessKeyLabel:"Access key",accessSecretLabel:"Access secret"},azure:{fileUrlPatternPlaceholder:"https://your-storage-container.blob.core.windows.net/airbyte/stripe/invoices/*.parquet",accessKeyPlaceholder:"your-storage-container",accessKeyLabel:"Storage account name",accessSecretLabel:"Account key"}};function De({onUpdate:e}){let{manualLinkingProvider:n}=(0,H.useValues)(b),a=n??"aws";return(0,i.jsxs)(Q.Form,{formKey:"table",logic:X,className:"space-y-4",enableFormOnSubmit:!0,autoComplete:"off",children:[(0,i.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,i.jsx)(m,{name:"name",label:"Table name",children:({value:s="",onChange:r})=>(0,i.jsx)(y,{"data-attr":"table-name",className:"ph-ignore-input",placeholder:"Examples: stripe_invoice, hubspot_contacts, users",autoComplete:"off",autoCapitalize:"off",autoCorrect:"off",spellCheck:!1,value:s,onChange:r})}),(0,i.jsx)("div",{className:"text-secondary text-xs mb-4",children:"This will be the table name used when writing queries"}),(0,i.jsx)(m,{name:"url_pattern",label:"Files URL pattern",children:({value:s="",onChange:r})=>(0,i.jsx)(y,{"data-attr":"table-url-pattern",className:"ph-ignore-input",placeholder:D[a].fileUrlPatternPlaceholder,autoComplete:"off",autoCapitalize:"off",autoCorrect:"off",spellCheck:!1,value:s,onChange:r})}),(0,i.jsxs)("div",{className:"text-secondary text-xs mb-4",children:["You can use ",(0,i.jsx)("strong",{children:"*"})," to select multiple files."]}),(0,i.jsx)(m,{name:"format",label:"File format",className:"w-max mb-4",children:({value:s="",onChange:r})=>(0,i.jsx)(N,{"data-attr":"table-format",options:[{label:"Parquet (recommended)",value:"Parquet"},{label:"CSV",value:"CSV"},{label:"CSV with headers",value:"CSVWithNames"},{label:"JSON",value:"JSONEachRow"},{label:"Delta",value:"Delta"}],value:s,onChange:r})}),(0,i.jsx)(m,{name:["credential","access_key"],label:D[a].accessKeyLabel,children:({value:s="",onChange:r})=>(0,i.jsx)(y,{"data-attr":"access-key",className:"ph-ignore-input",placeholder:D[a].accessKeyPlaceholder,autoComplete:"off",autoCapitalize:"off",autoCorrect:"off",spellCheck:!1,value:s,onChange:r})}),(0,i.jsx)(m,{name:["credential","access_secret"],label:D[a].accessSecretLabel,children:({value:s="",onChange:r})=>(0,i.jsx)(y,{"data-attr":"access-secret",className:"ph-ignore-input",type:"password",placeholder:"eg: wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY",autoComplete:"off",autoCapitalize:"off",autoCorrect:"off",spellCheck:!1,value:s,onChange:r})}),a==="google-cloud"&&(0,i.jsxs)("div",{className:"text-secondary text-xs",children:["We use HMAC keys to access your Google Cloud Storage. Find more about generating them"," ",(0,i.jsx)(M,{to:"https://cloud.google.com/storage/docs/authentication/hmackeys",target:"_new",children:"here"})]})]}),!!e&&(0,i.jsx)("div",{className:"flex justify-end",children:(0,i.jsx)(P,{type:"primary",onClick:e,children:"Save"})})]})}p();g();d();var v=u(U()),l=u(S()),oe=e=>e.incremental_available?e.incremental_fields.length===0?{disabled:!0,disabledReason:"No incremental fields found on table"}:{disabled:!1}:{disabled:!0,disabledReason:"Incremental replication isn't supported on this table"},re=(e,n,a,s)=>a!==e||e==="incremental"&&n!==s,le=(e,n)=>{if(!e)return"You must select a sync method before saving";if(e==="incremental"&&!n)return"You must select an incremental field"},Oe=({schema:e,onClose:n,onSave:a,saveButtonIsLoading:s,showRefreshMessageOnChange:r})=>{let[t]=(0,v.useState)(e.sync_type??null),[h]=(0,v.useState)(e.incremental_field??null),[c,C]=(0,v.useState)(e.sync_type??void 0),[L,R]=(0,v.useState)(e.incremental_field??null);(0,v.useEffect)(()=>{C(e.sync_type??void 0),R(e.incremental_field??null)},[e.table]);let F=oe(e),Z=re(c??null,L,t,h)&&r;return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(z,{radioPosition:"top",value:c,options:[{value:"incremental",disabledReason:F.disabled&&F.disabledReason||void 0,label:(0,l.jsxs)("div",{className:"mb-6 font-normal",children:[(0,l.jsxs)("div",{className:"items-center flex leading-[normal] overflow-hidden mb-2.5",children:[(0,l.jsx)("h2",{className:"mb-0 mr-2",children:"Incremental replication"}),!F.disabled&&(0,l.jsx)(I,{type:"success",children:"Recommended"})]}),(0,l.jsx)("p",{children:"When using incremental replication, we'll store the max value of the below field on each sync and only sync rows with greater or equal value on the next run."}),(0,l.jsxs)("p",{children:["You should pick a field that increments or updates each time the row is updated, such as a ",(0,l.jsx)("code",{children:"updated_at"})," timestamp."]}),(0,l.jsx)(N,{value:L,onChange:f=>R(f),options:e.incremental_fields.map(f=>({value:f.field,label:(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("span",{className:"leading-5",children:f.label}),(0,l.jsx)(I,{className:"ml-2",type:"success",children:f.type})]})}))??[],disabledReason:F.disabled?"":void 0})]})},{value:"full_refresh",label:(0,l.jsxs)("div",{className:"mb-6 font-normal",children:[(0,l.jsx)("div",{className:"items-center flex leading-[normal] overflow-hidden mb-2.5",children:(0,l.jsx)("h2",{className:"mb-0 mr-2",children:"Full table replication"})}),(0,l.jsx)("p",{children:"We'll replicate the whole table on every sync. This can take longer to sync and increase your monthly billing."})]})}],onChange:f=>C(f)}),Z&&(0,l.jsx)("p",{className:"text-danger",children:"Note: Changing the sync type or incremental replication field will trigger a full table refresh"}),(0,l.jsxs)("div",{className:"flex flex-row justify-end w-full",children:[(0,l.jsx)(P,{className:"mr-3",type:"secondary",onClick:n,children:"Close"}),(0,l.jsx)(P,{type:"primary",loading:s,disabledReason:le(c,L),onClick:()=>{if(c==="incremental"){let f=e.incremental_fields.find(j=>j.field===L);if(!f){K.error("Selected field for incremental replication not found");return}a("incremental",L,f.field_type)}else a("full_refresh",null,null)},children:"Save"})]})]})};p();g();d();var Be=(e,n)=>({kind:"DataVisualizationNode",source:{kind:"HogQLQuery",query:`SELECT ${n.filter(({table:a,fields:s,chain:r,schema_valid:t})=>!a&&!s&&!r&&t).map(({name:a})=>a)} FROM ${e==="numbers"?"numbers(0, 10)":e} LIMIT 100`}});export{Oe as a,ne as b,te as c,Be as d,De as e};
//# sourceMappingURL=/static/chunk-PGNZR35W.js.map
