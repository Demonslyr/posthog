import{d as o}from"/static/chunk-TIKFJXRT.js";import{j as P}from"/static/chunk-YDKHEMDP.js";import{Do as v,Kh as E,Rk as k,Sa as N,Sd as a,Ta as _,Ub as R,Wd as F,Xg as M,Yg as X,_ as B,a as K,ce as Q,de as g,ee as V,fe as h,h as W,ig as J,il as S,pe as z,r as w,se as f,ve as A,vo as q}from"/static/chunk-TW5IU73S.js";import{a as j}from"/static/chunk-3UDJFOQH.js";import{d as y,e as L,g as T,j as C}from"/static/chunk-SJXEOBQC.js";L();C();T();var I=y(W()),s=y(K());var x=y(j());var e=y(w());function G({experimentId:n,variantKey:t,muted:r=!1,fontSize:i,className:l}){let{experiment:p,getIndexForVariant:d,metricResults:m}=(0,s.useValues)(o({experimentId:n}));return m?p.holdout&&t===`holdout-${p.holdout_id}`?(0,e.jsxs)("span",{className:(0,I.default)("flex items-center min-w-0",l),children:[(0,e.jsx)("div",{className:"w-2 h-2 rounded-full shrink-0",style:{backgroundColor:S(d(m[0],t))}}),(0,e.jsx)(h,{type:"option",className:"ml-2",children:p.holdout.name})]}):(0,e.jsxs)("span",{className:(0,I.default)("flex items-center min-w-0",l),children:[(0,e.jsx)("div",{className:"w-2 h-2 rounded-full shrink-0",style:{backgroundColor:S(d(m[0],t))}}),(0,e.jsx)("span",{className:`ml-2 font-semibold truncate ${r?"text-secondary":""}`,style:i?{fontSize:`${i}px`}:void 0,children:t})]}):(0,e.jsx)(e.Fragment,{})}function Le({metricIndex:n=0}){let{isPrimaryMetricSignificant:t,significanceDetails:r}=(0,s.useValues)(o),i=t(n)?{color:"success",label:"Significant"}:{color:"primary",label:"Not significant"};return r(n)?(0,e.jsx)(N,{title:r(n),children:(0,e.jsx)(h,{className:"cursor-pointer",type:i.color,children:(0,e.jsx)("b",{className:"uppercase",children:i.label})})}):(0,e.jsx)(h,{type:i.color,children:(0,e.jsx)("b",{className:"uppercase",children:i.label})})}function Te({result:n,showTable:t}){if(!n)return(0,e.jsx)(e.Fragment,{});let r=n.kind==="ExperimentTrendsQuery"?n.count_query:n.funnels_query,i=Math.random().toString(36).substring(2,15);return(0,e.jsx)(P,{query:{kind:"InsightVizNode",source:r,showTable:t,showLastComputation:!0,showLastComputationRefresh:!1},context:{insightProps:{dashboardItemId:i,cachedInsight:{short_id:i,query:{kind:"InsightVizNode",source:r},result:n?.insight,disable_baseline:!0},doNotLoad:!0}},readOnly:!0})}function Ce({result:n,size:t="small"}){if(!n)return(0,e.jsx)(e.Fragment,{});let r={kind:"InsightVizNode",source:n.kind==="ExperimentTrendsQuery"?n.count_query:n.funnels_query};return(0,e.jsx)(a,{className:"ml-auto -translate-y-2",size:t,type:"primary",icon:(0,e.jsx)(B,{}),to:v.insightNew({query:r}),targetBlank:!0,children:"Explore as Insight"})}function we(){let[n,t]=(0,x.useState)(".");return(0,x.useEffect)(()=>{let r=1,i=1,l=setInterval(()=>{t(".".repeat(r)),r+=i,(r===3||r===1)&&(i*=-1)},300);return()=>clearInterval(l)},[]),(0,e.jsx)("span",{children:n})}function Be(){let{experimentId:n,experiment:t,isExperimentRunning:r,isExperimentStopped:i,isPrimaryMetricSignificant:l,isSingleVariantShipped:p,hasPrimaryMetricSet:d,isCreatingExperimentDashboard:m}=(0,s.useValues)(o),{launchExperiment:b,endExperiment:c,archiveExperiment:D,createExposureCohort:O,openShipVariantModal:$,createExperimentDashboard:H}=(0,s.useActions)(o),u=t?.exposure_cohort;return(0,e.jsx)(q,{buttons:(0,e.jsxs)(e.Fragment,{children:[t&&!r&&(0,e.jsx)("div",{className:"flex items-center",children:(0,e.jsx)(a,{type:"primary","data-attr":"launch-experiment",onClick:()=>b(),disabledReason:d?void 0:"Add at least one primary metric before launching the experiment",children:"Launch"})}),t&&r&&(0,e.jsxs)("div",{className:"flex flex-row gap-2",children:[(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(A,{overlay:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(a,{onClick:()=>u?void 0:O(),fullWidth:!0,"data-attr":`${u?"view":"create"}-exposure-cohort`,to:u?v.cohort(u):void 0,targetBlank:!!u,children:[u?"View":"Create"," exposure cohort"]}),(0,e.jsx)(a,{onClick:()=>H(),fullWidth:!0,disabled:m,children:"Create dashboard"})]})}),(0,e.jsx)(V,{vertical:!0})]}),(0,e.jsx)(Y,{experimentId:t.id}),!t.end_date&&(0,e.jsx)(a,{type:"secondary","data-attr":"stop-experiment",status:"danger",onClick:()=>{g.open({title:"Stop this experiment?",content:(0,e.jsx)("div",{className:"text-sm text-secondary",children:"This action will end data collection. The experiment can be restarted later if needed."}),primaryButton:{children:"Stop",type:"primary",onClick:()=>c(),size:"small"},secondaryButton:{children:"Cancel",type:"tertiary",size:"small"}})},children:"Stop"}),i&&(0,e.jsx)(a,{type:"secondary",status:"danger",onClick:()=>{g.open({title:"Archive this experiment?",content:(0,e.jsx)("div",{className:"text-sm text-secondary",children:"This action will move the experiment to the archived tab. It can be restored at any time."}),primaryButton:{children:"Archive",type:"primary",onClick:()=>D(),size:"small"},secondaryButton:{children:"Cancel",type:"tertiary",size:"small"}})},children:(0,e.jsx)("b",{children:"Archive"})})]}),l(0)&&!p&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(N,{title:"Choose a variant and roll it out to all users",children:(0,e.jsx)(a,{type:"primary",icon:(0,e.jsx)(R,{}),onClick:()=>$(),children:(0,e.jsx)("b",{children:"Ship a variant"})})}),(0,e.jsx)(U,{experimentId:n})]})]})})}function U({experimentId:n}){let{experiment:t,isShipVariantModalOpen:r}=(0,s.useValues)(o({experimentId:n})),{closeShipVariantModal:i,shipVariant:l}=(0,s.useActions)(o({experimentId:n})),{aggregationLabel:p}=(0,s.useValues)(J),[d,m]=(0,x.useState)();(0,x.useEffect)(()=>{t.parameters?.feature_flag_variants?.length>1&&m(t.parameters.feature_flag_variants[1].key)},[t]);let b=t.filters.aggregation_group_type_index!=null?p(t.filters.aggregation_group_type_index).plural:"users";return(0,e.jsx)(Q,{isOpen:r,onClose:i,width:600,title:"Ship a variant",footer:(0,e.jsxs)("div",{className:"flex items-center gap-2",children:[(0,e.jsx)(a,{type:"secondary",onClick:i,children:"Cancel"}),(0,e.jsx)(a,{onClick:()=>l({selectedVariantKey:d,shouldStopExperiment:!0}),type:"primary",children:"Ship variant"})]}),children:(0,e.jsxs)("div",{className:"space-y-6",children:[(0,e.jsxs)("div",{className:"text-sm",children:["This will roll out the selected variant to ",(0,e.jsxs)("b",{children:["100% of ",b]})," and stop the experiment."]}),(0,e.jsx)("div",{className:"flex items-center",children:(0,e.jsx)("div",{className:"w-1/2 pr-4",children:(0,e.jsx)(z,{className:"w-full","data-attr":"metrics-selector",value:d,onChange:c=>{m(c)},options:t.parameters?.feature_flag_variants?.map(({key:c})=>({value:c,label:(0,e.jsx)("div",{className:"space-x-2 inline-flex",children:(0,e.jsx)(G,{experimentId:n,variantKey:c})})}))||[]})})}),(0,e.jsxs)(F,{type:"info",className:"mb-4",children:["For more precise control over your release, adjust the rollout percentage and release conditions in the"," ",(0,e.jsx)(_,{target:"_blank",className:"font-semibold",to:t.feature_flag?v.featureFlag(t.feature_flag.id):void 0,children:t.feature_flag?.key})," ","feature flag."]})]})})}var Y=({experimentId:n})=>{let{experiment:t}=(0,s.useValues)(o({experimentId:n})),{resetRunningExperiment:r}=(0,s.useActions)(o);return(0,e.jsx)(a,{type:"secondary",onClick:()=>{g.open({title:"Reset this experiment?",content:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("div",{className:"text-sm text-secondary max-w-md",children:[(0,e.jsx)("p",{children:"The experiment start and end dates will be reset and the experiment will go back to draft mode."}),(0,e.jsx)("p",{children:"All events collected thus far will still exist, but won't be applied to the experiment unless you manually change the start date after launching the experiment again."})]}),t.archived&&(0,e.jsx)("div",{className:"text-sm text-secondary",children:"Resetting will also unarchive the experiment."})]}),primaryButton:{children:"Confirm",type:"primary",onClick:r,size:"small"},secondaryButton:{children:"Cancel",type:"tertiary",size:"small"}})},children:"Reset"})};function _e({experiment:n}){let t=M(n);return(0,e.jsx)(h,{type:X(t),children:(0,e.jsx)("b",{className:"uppercase",children:t})})}function Re(){return(0,e.jsxs)("div",{className:"space-y-4",children:[(0,e.jsx)(f,{className:"w-1/3 h-4"}),(0,e.jsx)(f,{}),(0,e.jsx)(f,{}),(0,e.jsx)(f,{className:"w-2/3 h-4"})]})}function Fe({query:n}){let t=n?.series?.[0];return t?(0,e.jsx)(e.Fragment,{children:(0,e.jsxs)("div",{className:"mb-2",children:[(0,e.jsx)("div",{className:"flex mb-1",children:(0,e.jsx)("b",{children:(0,e.jsx)(k,{action:t,showCountedByTag:!0,hideIcon:!0,showEventName:!0})})}),(0,e.jsx)("div",{className:"space-y-1",children:t.properties?.map(r=>(0,e.jsx)(E,{item:r},r.key))})]})}):(0,e.jsx)(e.Fragment,{})}function Qe({query:n}){return(0,e.jsx)(e.Fragment,{children:(n.series||[]).map((t,r)=>(0,e.jsxs)("div",{className:"mb-2",children:[(0,e.jsxs)("div",{className:"flex mb-1",children:[(0,e.jsx)("div",{className:"shrink-0 w-6 h-6 mr-2 font-bold text-center text-primary-alt border rounded",style:{backgroundColor:"var(--bg-table)"},children:r+1}),(0,e.jsx)("b",{children:(0,e.jsx)(k,{action:t,hideIcon:!0,showEventName:!0})})]}),(0,e.jsx)("div",{className:"space-y-1",children:t.properties?.map(i=>(0,e.jsx)(E,{item:i},i.key))})]},r))})}export{G as a,Le as b,Te as c,Ce as d,we as e,Be as f,_e as g,Re as h,Fe as i,Qe as j};
//# sourceMappingURL=/static/chunk-M7JKKBGY.js.map
