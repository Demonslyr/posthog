import{c as u}from"/static/chunk-442FMYLN.js";import{a as R}from"/static/chunk-ZH744EYW.js";import{a as E,b as se}from"/static/chunk-6BOQTIB6.js";import{c as ee,d as re}from"/static/chunk-YDKHEMDP.js";import{$e as D,Cd as q,Dc as W,Do as L,Io as v,Od as K,Sd as h,Tc as H,Wj as $,Xi as j,Yi as Z,Za as Te,a as b,ah as C,f as ye,ie as A,pg as Y,r as I}from"/static/chunk-TW5IU73S.js";import{Ja as V,a as z,na as B,yb as Q}from"/static/chunk-3UDJFOQH.js";import{d as l,e as f,g as y,j as T}from"/static/chunk-SJXEOBQC.js";f();T();y();var N=l(b()),S=l(z());f();T();y();var a=l(b());var G=l(I()),oe=(e,r)=>({id:e.id,displayName:e.name,icon:(0,G.jsx)(j,{name:e.name,index:r,rounded:!0})}),te=e=>({id:e.user.id,displayName:V(e.user),icon:(0,G.jsx)(Z,{size:"md",user:e.user})}),_={id:"unassigned",icon:(0,G.jsx)(W,{className:"rounded-full border border-dashed border-muted text-secondary p-0.5"})},ie=(0,a.kea)([(0,a.path)(["scenes","error-tracking","assigneeSelectLogic"]),(0,a.props)({}),(0,a.connect)(()=>({values:[D,["meFirstMembers","filteredMembers","membersLoading"],R,["userGroups","filteredGroups","userGroupsLoading"]],actions:[D,["setSearch as setMembersSearch","ensureAllMembersLoaded"],R,["setSearch as setGroupsSearch","ensureAllGroupsLoaded"]]})),(0,a.actions)({ensureAssigneeTypesLoaded:!0,setSearch:e=>({search:e})}),(0,a.reducers)({search:["",{setSearch:(e,{search:r})=>r}]}),(0,a.listeners)(({values:e,actions:r})=>({setSearch:()=>{r.setGroupsSearch(e.search),r.setMembersSearch(e.search)},ensureAssigneeTypesLoaded:()=>{r.ensureAllGroupsLoaded(),r.ensureAllMembersLoaded()}})),(0,a.selectors)({loading:[e=>[e.membersLoading,e.userGroupsLoading],(e,r)=>e||r],groupOptions:[e=>[e.filteredGroups],e=>e.map(oe)],memberOptions:[e=>[e.filteredMembers],e=>e.map(te)],computeAssignee:[e=>[e.userGroups,e.meFirstMembers],(e,r)=>s=>{if(s){if(s.type==="user_group"){let c=e.find(d=>d.id===s.id);return c?oe(c,0):_}let t=r.find(c=>c.user.id===s.id);return t?te(t):_}return _}]})]);var o=l(I()),Me=({assignee:e,onChange:r,showName:s=!1,showIcon:t=!0,unassignedLabel:c="Unassigned",...d})=>{let m=ie({assignee:e}),{computeAssignee:k,search:g,groupOptions:ue,memberOptions:pe,userGroupsLoading:me,membersLoading:de}=(0,N.useValues)(m),{setSearch:U,ensureAssigneeTypesLoaded:ge}=(0,N.useActions)(m),[fe,X]=(0,S.useState)(!1),x=w=>{U(""),X(!1),r(w)};(0,S.useEffect)(()=>{ge()},[]);let P=(0,S.useMemo)(()=>k(e),[e,k]);return(0,o.jsx)(K,{closeOnClickInside:!1,visible:fe,matchWidth:!1,onVisibilityChange:w=>X(w),overlay:(0,o.jsxs)("div",{className:"max-w-100 space-y-2 overflow-hidden",children:[(0,o.jsx)(A,{type:"search",placeholder:"Search",autoFocus:!0,value:g,onChange:U,fullWidth:!0}),(0,o.jsxs)("ul",{className:"space-y-2",children:[e&&(0,o.jsx)("li",{children:(0,o.jsx)(h,{fullWidth:!0,role:"menuitem",size:"small",icon:(0,o.jsx)(q,{}),onClick:()=>x(null),children:"Remove assignee"})}),(0,o.jsx)(ne,{title:"Groups",loading:me,search:!!g,type:"user_group",items:ue,onSelect:x,activeId:e?.id,emptyState:(0,o.jsx)(h,{fullWidth:!0,size:"small",icon:(0,o.jsx)(H,{}),to:L.settings("environment-error-tracking","user-groups"),children:(0,o.jsx)("div",{className:"text-secondary",children:"Create user group"})})}),(0,o.jsx)(ne,{title:"Users",loading:de,search:!!g,type:"user",items:pe,onSelect:x,activeId:e?.id})]})]}),children:(0,o.jsx)(h,{tooltip:P.displayName,icon:t?P.icon:null,...d,children:s?(0,o.jsx)("span",{className:"pl-1",children:P.displayName??c}):null})})},ne=({loading:e,search:r,type:s,items:t,onSelect:c,activeId:d,emptyState:m,title:k})=>(0,o.jsx)("li",{children:(0,o.jsxs)("section",{className:"space-y-px",children:[(0,o.jsx)("h5",{className:"mx-2 my-0.5",children:k}),t.map(g=>(0,o.jsx)("li",{children:(0,o.jsx)(h,{fullWidth:!0,role:"menuitem",size:"small",icon:g.icon,onClick:()=>c(d===g.id?null:{type:s,id:g.id}),active:d===g.id,children:(0,o.jsx)("span",{className:"flex items-center justify-between gap-2 flex-1",children:(0,o.jsx)("span",{children:g.displayName})})})},g.id)),e?(0,o.jsx)("div",{className:"p-2 text-secondary italic truncate border-t",children:"Loading..."}):t.length===0?r?(0,o.jsx)("div",{className:"p-2 text-secondary italic truncate border-t",children:(0,o.jsx)("span",{children:"No matches"})}):(0,o.jsx)("div",{className:"border-t pt-1",children:m}):null]})});f();T();y();var p=l(b());var F=l(z());var i=l(I()),ke=Q.filter(e=>e.key!="Yesterday"),Ze=()=>(0,i.jsxs)("div",{className:"space-y-1",children:[(0,i.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,i.jsx)(he,{}),(0,i.jsx)(Le,{})]}),(0,i.jsxs)("div",{className:"flex gap-2",children:[(0,i.jsx)(Se,{}),(0,i.jsx)(Ie,{})]})]}),Ie=()=>{let{filterGroup:e}=(0,p.useValues)(u),{setFilterGroup:r}=(0,p.useActions)(u);return(0,i.jsx)(E,{rootKey:"error-tracking",group:e,taxonomicGroupTypes:["event_properties","person_properties","cohorts"],onChange:r,children:(0,i.jsx)(ae,{})})},ae=()=>{let{filterGroup:e}=(0,p.useValues)(C),{replaceGroupValue:r,removeGroupValue:s}=(0,p.useActions)(C),[t,c]=(0,F.useState)(!1);return(0,F.useEffect)(()=>{c(!0)},[]),(0,i.jsx)(i.Fragment,{children:e.values.map((d,m)=>$(d)?(0,i.jsxs)(E.Group,{index:m,group:d,children:[(0,i.jsx)(ae,{}),(0,i.jsx)(E.AddFilterButton,{size:"small",type:"secondary"})]},m):(0,i.jsx)(E.Value,{index:m,filter:d,onRemove:()=>s(m),onChange:k=>r(m,k),initiallyOpen:t},m))})},Se=()=>{let{dateRange:e}=(0,p.useValues)(u),{setDateRange:r}=(0,p.useActions)(u);return(0,i.jsx)(Y,{size:"small",dateFrom:e.date_from,dateTo:e.date_to,dateOptions:ke,onChange:(s,t)=>r({date_from:s,date_to:t})})},he=()=>{let{searchQuery:e}=(0,p.useValues)(u),{setSearchQuery:r}=(0,p.useActions)(u);return(0,i.jsx)(A,{type:"search",placeholder:"Search...",value:e,onChange:r,className:"flex-grow max-w-none",size:"small"})},Le=()=>{let{filterTestAccounts:e}=(0,p.useValues)(u),{setFilterTestAccounts:r}=(0,p.useActions)(u);return(0,i.jsx)("div",{children:(0,i.jsx)(se,{size:"small",filters:{filter_test_accounts:e},onChange:({filter_test_accounts:s})=>r(s||!1)})})};f();T();y();var n=l(b()),ce=l(Te()),le=l(ye());var ur=(0,n.kea)([(0,n.path)(e=>["scenes","error-tracking","errorTrackingIssueSceneLogic",e]),(0,n.props)({}),(0,n.key)(e=>e.id),(0,n.connect)({values:[u,["dateRange","filterTestAccounts","filterGroup","customSparklineConfig"]],actions:[u,["setDateRange","setFilterTestAccounts","setFilterGroup"]]}),(0,n.actions)({initIssue:!0,setIssue:e=>({issue:e}),setEventsMode:e=>({mode:e}),updateIssue:e=>({issue:e}),assignIssue:e=>({assignee:e})}),(0,n.reducers)({eventsMode:["latest",{setEventsMode:(e,{mode:r})=>r}]}),(0,ce.loaders)(({props:e,values:r})=>({issue:[null,{loadRelationalIssue:async()=>{let s=await v.errorTracking.getIssue(e.id,e.fingerprint);return{...r.issue,...s}},loadClickHouseIssue:async s=>{let t={date_from:s,date_to:r.issue?.last_seen||(0,B.default)().toISOString()};return(await v.query(ee({issueId:e.id,dateRange:t,customVolume:r.customSparklineConfig}),{},void 0,!0)).results[0]},updateIssue:async({issue:s})=>{let t=await v.errorTracking.updateIssue(e.id,s);return{...r.issue,...t}},assignIssue:async({assignee:s})=>(await v.errorTracking.assignIssue(e.id,s),r.issue?{...r.issue,assignee:s}:r.issue),setIssue:({issue:s})=>s}]})),(0,n.selectors)({breadcrumbs:[e=>[e.issue],e=>{let r=e?.name||"Unknown Type";return[{key:"ErrorTracking",name:"Error tracking",path:L.errorTracking()},{key:["ErrorTrackingIssue",r],name:r}]}],eventsQuery:[e=>[e.issue,e.filterTestAccounts,e.filterGroup,e.dateRange],(e,r,s,t)=>re({issue:e,filterTestAccounts:r,filterGroup:s,dateRange:t})],issueProperties:[e=>[e.issue],e=>e&&e.earliest?JSON.parse(e.earliest):{}]}),(0,n.listeners)(({values:e,actions:r})=>{let s=()=>{if(!e.issueLoading){let t=e.issue;t?r.loadClickHouseIssue(t.first_seen):r.loadRelationalIssue()}};return{setIssueSuccess:s,initIssue:s,loadRelationalIssueSuccess:s,loadRelationalIssueFailure:({errorObject:{status:t,data:c}})=>{t==308&&"issue_id"in c&&le.router.actions.replace(L.errorTrackingIssue(c.issue_id))},setDateRange:s,setFilterTestAccounts:s,setFilterGroup:s}})]);export{Me as a,Ze as b,ur as c};
//# sourceMappingURL=/static/chunk-ETCXUTLK.js.map
