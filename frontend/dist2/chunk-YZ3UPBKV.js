import{a as $}from"/static/chunk-XXTLNI2H.js";import{o as xt}from"/static/chunk-CDTERFC5.js";import{a as yt,b as ht,c as St,e as ie,p as ae}from"/static/chunk-44P5EQSU.js";import{j as ft}from"/static/chunk-CBJ7RAUW.js";import{Bd as Ye,Cb as Ge,Cd as Ke,Ce as nt,Do as bt,Ek as ct,Eo as re,Fk as ut,Gm as pt,Go as Te,Io as F,Ko as vt,Lc as be,Nb as Ve,Nc as Ue,Np as le,Pc as je,Pd as ve,Pe as j,Qa as ze,Qd as Ze,Qe as ot,Sa as Oe,Sd as h,Uf as Ae,Vd as et,Wb as se,Wi as rt,Yi as lt,Za as xe,a as R,af as it,b as W,cf as ne,cp as At,dd as $e,df as at,dp as Tt,eb as Qe,eg as Vt,ep as Pt,f as Ht,g as Gt,ga as Be,gb as De,h as Ee,hb as He,hg as oe,hl as dt,i as Ne,ie as tt,m as te,nd as Xe,od as qe,p as G,pd as Je,qd as We,r as w,se as st,vo as gt,wm as mt}from"/static/chunk-RFJTZKD6.js";import{Da as Fe,F as U,Z as ke,a as Se,na as H,za as Y}from"/static/chunk-3UDJFOQH.js";import{d as l,e as p,f as L,g,j as f}from"/static/chunk-SJXEOBQC.js";p();f();g();var N=l(R());p();f();g();var Q=l(R());p();f();g();var x=l(R()),_t=l(xe()),Ct=l(Gt());p();f();g();var O=l(R()),Mt=l(Ht()),Lt=l(Vt());var Ut=e=>{if(e?.activityScope){let s=Ne(Mt.router.values.currentLocation.pathname).split("/")[2];return s&&(s.length===8||s.length===36||!isNaN(parseInt(s)))?{activity_scope:e.activityScope,activity_item_id:s}:{activity_scope:e.activityScope}}return null},ce=(0,O.kea)([(0,O.path)(["scenes","navigation","sidepanel","sidePanelContextLogic"]),(0,O.connect)({values:[le,["sceneConfig"]]}),(0,O.selectors)({sceneSidePanelContext:[e=>[e.sceneConfig,(t,s)=>{let o=le.selectors.activeSceneLogic(t,s);if(o&&Ae in o.selectors){let n=le.selectors.activeLoadedScene(t,s);return o.selectors[Ae](t,n?.paramsToProps?.(n?.sceneParams)||s)}return null}],(e,t)=>({...t??{},...t?.activity_scope?{}:Ut(e)}),{equalityCheck:Lt.objectsEqual}]})]);var Rt=l(w()),wt=5*60*1e3;var It=(0,x.kea)([(0,x.path)(["scenes","navigation","sidepanel","sidePanelActivityLogic"]),(0,x.connect)({values:[ce,["sceneSidePanelContext"],oe,["currentProjectId"]],actions:[G,["openSidePanel"]]}),(0,x.actions)({togglePolling:e=>({pageIsVisible:e}),incrementErrorCount:!0,clearErrorCount:!0,markAllAsRead:!0,setActiveTab:e=>({tab:e}),loadAllActivity:!0,loadOlderActivity:!0,maybeLoadOlderActivity:!0,loadImportantChanges:(e=!0)=>({onlyUnread:e}),setFilters:e=>({filters:e}),setFiltersForCurrentPage:e=>({filters:e}),toggleShowDetails:e=>({showing:e})}),(0,x.reducers)({activeTab:["unread",{persist:!0},{setActiveTab:(e,{tab:t})=>t}],errorCounter:[0,{incrementErrorCount:e=>e>=5?5:e+1,clearErrorCount:()=>0}],filters:[null,{setFilters:(e,{filters:t})=>t,setFiltersForCurrentPage:(e,{filters:t})=>t}],filtersForCurrentPage:[null,{setFiltersForCurrentPage:(e,{filters:t})=>t}],showDetails:[!1,{persist:!0},{toggleShowDetails:(e,{showing:t})=>t??!e}]}),(0,_t.loaders)(({actions:e,values:t,cache:s})=>({importantChanges:[null,{markAllAsRead:async()=>{let o=t.importantChanges;if(!o)return null;let n=t.notifications.reduce((a,r)=>a.created_at.isAfter(r.created_at)?a:r);return n.unread?(await F.create(`api/projects/${t.currentProjectId}/activity_log/bookmark_activity_notification`,{bookmark:n.created_at.toISOString()}),{last_read:n.created_at.toISOString(),next:o.next,results:o.results.map(a=>({...a,unread:!1}))}):o},loadImportantChanges:async({onlyUnread:o},n)=>{await n(1),clearTimeout(s.pollTimeout);try{let a=await F.get(`api/projects/${t.currentProjectId}/activity_log/important_changes?`+Fe({unread:o}));return e.clearErrorCount(),a}catch{return e.incrementErrorCount(),null}finally{let a=t.errorCounter?wt*t.errorCounter:wt;s.pollTimeout=window.setTimeout(e.loadImportantChanges,a)}}}],allActivityResponse:[null,{loadAllActivity:async(o,n)=>{let a=await F.activity.list(t.filters??{});return n(),a},loadOlderActivity:async(o,n)=>{if(await n(1),!t.allActivityResponse?.next)return t.allActivityResponse;let a=await F.get(t.allActivityResponse.next);return a.results=[...t.allActivityResponse.results,...a.results],a}}]})),(0,x.listeners)(({values:e,actions:t,cache:s})=>({setActiveTab:({tab:o})=>{o==="all"&&!e.allActivityResponseLoading&&t.loadAllActivity()},maybeLoadOlderActivity:()=>{!e.allActivityResponseLoading&&e.allActivityResponse?.next&&t.loadOlderActivity()},openSidePanel:({options:o})=>{o&&t.setActiveTab(o)},togglePolling:({pageIsVisible:o})=>{o?t.loadImportantChanges():clearTimeout(s.pollTimeout)}})),(0,x.selectors)({allActivity:[e=>[e.allActivityResponse],e=>ie(e?.results||[],ae,!0)],allActivityHasNext:[e=>[e.allActivityResponse],e=>!!e?.next],notifications:[e=>[e.importantChanges],e=>{try{let t=ie(e?.results||[],ae,!0),s=null,o=W.getFeatureFlagPayload("changelog-notification");if(o&&(s={markdown:o.markdown,notificationDate:(0,H.default)(o.notificationDate)}),s){let n=e?.last_read?(0,H.default)(e.last_read):null,a=!!n&&(n.isBefore(s.notificationDate)||n==s.notificationDate),c=[{email:"joe@posthog.com",name:"Joe",isSystem:!0,description:(0,Rt.jsx)(j,{children:s.markdown}),created_at:s.notificationDate,unread:a},...t];return c.sort((u,m)=>u.created_at.isBefore(m.created_at)?1:u.created_at.isAfter(m.created_at)?-1:0),c}return ie(e?.results||[],ae,!0)}catch{return[]}}],hasNotifications:[e=>[e.notifications],e=>!!e.length],unread:[e=>[e.notifications],e=>e.filter(t=>t.unread)],unreadCount:[e=>[e.unread],e=>(e||[]).length],hasUnread:[e=>[e.unreadCount],e=>e>0]}),(0,Ct.subscriptions)(({actions:e,values:t})=>({sceneSidePanelContext:s=>{e.setFiltersForCurrentPage(s?{...t.filters,scope:s.activity_scope,item_id:s.activity_item_id}:null)},filters:()=>{t.activeTab==="all"&&e.loadAllActivity()}})),(0,x.afterMount)(({actions:e,values:t})=>{e.loadImportantChanges();let s=t.sceneSidePanelContext;e.setFiltersForCurrentPage(s?{...t.filters,...s}:null)}),(0,x.beforeUnmount)(({cache:e})=>{clearTimeout(e.pollTimeout)})]);p();f();g();var T=l(R()),kt=l(xe());var jt="https://status.posthog.com",$t={"us.posthog.com":["41df083ftqt6","z0y6m9kyvy3j"],"eu.posthog.com":["c4d9jd1jcx3f","nfknrn2bf3yz"],localhost:["f58xx1143yvt","t3rdjq2z0x7p"]},Xt=60*1e3*5,Ft=(0,T.kea)([(0,T.path)(["scenes","navigation","sidepanel","sidePanelStatusLogic"]),(0,T.connect)({actions:[G,["openSidePanel","closeSidePanel"]]}),(0,T.actions)({loadStatusPage:!0}),(0,T.reducers)(()=>({status:["operational",{persist:!0},{loadStatusPageSuccess:(e,{statusPage:t})=>{let s=$t[window.location.hostname];return s&&t.components.find(({group_id:n,status:a})=>n&&s.includes(n)&&a!=="operational")?.status||"operational"},loadStatusPageFailure:()=>"operational"}]})),(0,kt.loaders)(()=>({statusPage:[null,{loadStatusPage:async()=>await(await fetch(`${jt}/api/v2/summary.json`)).json()}]})),(0,T.listeners)(({actions:e,cache:t})=>({loadStatusPageSuccess:()=>{clearTimeout(t.timeout),t.timeout=setTimeout(()=>e.loadStatusPage(),Xt)}})),(0,T.afterMount)(({actions:e})=>{e.loadStatusPage()}),(0,T.beforeUnmount)(({cache:e})=>{clearTimeout(e.timeout)})]);var Jt=["settings","feature-previews","activity","status","exports"],Pe=(0,Q.kea)([(0,Q.path)(["scenes","navigation","sidepanel","sidePanelLogic"]),(0,Q.connect)({values:[te,["featureFlags"],it,["isCloudOrDev"],at,["shouldShowActivationTab"],G,["selectedTab","sidePanelOpen"],It,["unreadCount"],Ft,["status"],re,["hasAvailableFeature"],ce,["sceneSidePanelContext"],vt,["currentTeam"]],actions:[G,["closeSidePanel","openSidePanel"]]}),(0,Q.selectors)({enabledTabs:[e=>[e.isCloudOrDev,e.featureFlags,e.sceneSidePanelContext,e.currentTeam],(e,t,s,o)=>{let n=[];if(t[U.ARTIFICIAL_HOG]&&n.push("max"),n.push("notebook"),n.push("docs"),e&&n.push("support"),o?.created_at){let a=(0,H.default)(o.created_at);(0,H.default)().diff(a,"day")<30&&a.isAfter((0,H.default)("2025-02-13"))&&n.push("activation")}return t[U.DISCUSSIONS]&&n.push("discussion"),t[U.ROLE_BASED_ACCESS_CONTROL]&&s.access_control_resource&&s.access_control_resource_id&&n.push("access-control"),n.push("exports"),n.push("feature-previews"),n.push("settings"),e&&n.push("status"),n}],visibleTabs:[e=>[e.enabledTabs,e.selectedTab,e.sidePanelOpen,e.unreadCount,e.status,e.hasAvailableFeature,e.shouldShowActivationTab],(e,t,s,o,n,a,r)=>e.filter(c=>c===t&&s||c==="activity"&&o&&a("audit_logs")||c==="status"&&n!=="operational"?!0:!(c==="activation"&&!r||Jt.includes(c)))],extraTabs:[e=>[e.enabledTabs,e.visibleTabs],(e,t)=>e.filter(s=>!t.includes(s))]})]);p();f();g();var Ce=l(R());var pe=l(Se());p();f();g();p();f();g();var Wt=Object.defineProperty,Yt=(e,t,s)=>t in e?Wt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,ue=(e,t,s)=>Yt(e,typeof t!="symbol"?t+"":t,s),de=class extends Error{constructor(t,s){super(t),ue(this,"type"),ue(this,"field"),ue(this,"value"),ue(this,"line"),this.name="ParseError",this.type=s.type,this.field=s.field,this.value=s.value,this.line=s.line}};function Me(e){}function Et(e){let{onEvent:t=Me,onError:s=Me,onRetry:o=Me,onComment:n}=e,a="",r=!0,c,u="",m="";function B(y){let A=r?y.replace(/^\xEF\xBB\xBF/,""):y,[V,ye]=Kt(`${a}${A}`);for(let he of V)M(he);a=ye,r=!1}function M(y){if(y===""){v();return}if(y.startsWith(":")){n&&n(y.slice(y.startsWith(": ")?2:1));return}let A=y.indexOf(":");if(A!==-1){let V=y.slice(0,A),ye=y[A+1]===" "?2:1,he=y.slice(A+ye);z(V,he,y);return}z(y,"",y)}function z(y,A,V){switch(y){case"event":m=A;break;case"data":u=`${u}${A}
`;break;case"id":c=A.includes("\0")?void 0:A;break;case"retry":/^\d+$/.test(A)?o(parseInt(A,10)):s(new de(`Invalid \`retry\` value: "${A}"`,{type:"invalid-retry",value:A,line:V}));break;default:s(new de(`Unknown field "${y.length>20?`${y.slice(0,20)}\u2026`:y}"`,{type:"unknown-field",field:y,value:A,line:V}));break}}function v(){u.length>0&&t({id:c,event:m||void 0,data:u.endsWith(`
`)?u.slice(0,-1):u}),c=void 0,u="",m=""}function Dt(y={}){a&&y.consume&&M(a),c=void 0,u="",m="",a=""}return{feed:B,reset:Dt}}function Kt(e){let t=[],s="",o=e.length;for(let n=0;n<o;n++){let a=e[n];a==="\r"&&e[n+1]===`
`?(t.push(s),s="",n++):a==="\r"||a===`
`?(t.push(s),s=""):s+=a}return[t,s]}var S=l(R()),Bt=l(xe());p();f();g();function me(e){return e?.type==="ai/reasoning"}function K(e){return e?.type==="ai/viz"}function X(e){return e?.type==="human"}function Z(e){return e?.type==="ai"}function Le(e){return e?.type==="ai/failure"}function Nt(e){if(At(e))return e;if(Tt(e))return e;if(Pt(e))return e;throw new Error("Unsupported query type")}var ts={type:"ai/failure",content:"Oops! It looks like I\u2019m having trouble generating this insight. Could you please try again?",status:"completed"},b=(0,S.kea)([(0,S.path)(["scenes","max","maxLogic"]),(0,S.props)({}),(0,S.key)(({conversationId:e})=>e||"new-conversation"),(0,S.connect)({values:[oe,["currentProject"],ct,["dataProcessingAccepted"],$,["coreMemory"]]}),(0,S.actions)({askMax:(e,t=0)=>({prompt:e,generationAttempt:t}),stopGeneration:!0,setThreadLoaded:(e=!1)=>({testOnlyOverride:e}),addMessage:e=>({message:e}),replaceMessage:(e,t)=>({index:e,message:t}),setMessageStatus:(e,t)=>({index:e,status:t}),setQuestion:e=>({question:e}),setVisibleSuggestions:e=>({suggestions:e}),shuffleVisibleSuggestions:!0,retryLastMessage:!0,scrollThreadToBottom:!0,setConversation:e=>({conversation:e}),setTraceId:e=>({traceId:e}),resetThread:!0}),(0,S.reducers)({question:["",{setQuestion:(e,{question:t})=>t,askMax:()=>""}],conversation:[(e,t)=>t.conversationId?{id:t.conversationId}:null,{setConversation:(e,{conversation:t})=>t}],threadRaw:[[],{addMessage:(e,{message:t})=>[...e,t],replaceMessage:(e,{message:t,index:s})=>[...e.slice(0,s),t,...e.slice(s+1)],setMessageStatus:(e,{index:t,status:s})=>[...e.slice(0,t),{...e[t],status:s},...e.slice(t+1)],resetThread:e=>e.filter(t=>!me(t))}],threadLoading:[!1,{askMax:()=>!0,setThreadLoaded:(e,{testOnlyOverride:t})=>t}],visibleSuggestions:[null,{setVisibleSuggestions:(e,{suggestions:t})=>t}],traceId:[null,{setTraceId:(e,{traceId:t})=>t}]}),(0,Bt.loaders)({allSuggestions:[null,{loadSuggestions:async({refresh:e})=>(await F.query({kind:"SuggestedQuestionsQuery"},void 0,void 0,e)).questions}]}),(0,S.listeners)(({actions:e,values:t,cache:s})=>({[$.actionTypes.updateCoreMemorySuccess]:()=>{e.loadSuggestions({refresh:"blocking"})},[$.actionTypes.loadCoreMemorySuccess]:()=>{e.loadSuggestions({refresh:"async_except_on_cache_miss"})},loadSuggestionsSuccess:()=>{e.shuffleVisibleSuggestions()},shuffleVisibleSuggestions:()=>{if(!t.allSuggestions)throw new Error("No question suggestions to shuffle");let o=t.allSuggestions.filter(n=>!t.visibleSuggestions?.includes(n));L.env.STORYBOOK||dt(o),e.setVisibleSuggestions(o.slice(0,3).sort((n,a)=>n.length-a.length))},askMax:async({prompt:o,generationAttempt:n},a)=>{n===0&&e.addMessage({type:"human",content:o,status:"completed"});try{let r=Y();e.setTraceId(r),s.generationController=new AbortController;let u=(await F.conversations.stream({content:o,conversation:t.conversation?.id,trace_id:r},{signal:s.generationController.signal})).body?.getReader();if(!u)return;let m=new TextDecoder,B=Et({onEvent:({data:M,event:z})=>{if(z==="message"){let v=we(M);if(!v)return;X(v)?e.replaceMessage(t.threadRaw.length-1,{...v,status:"completed"}):t.threadRaw[t.threadRaw.length-1].status==="completed"?e.addMessage({...v,status:v.id?"completed":"loading"}):v&&e.replaceMessage(t.threadRaw.length-1,{...v,status:v.id?"completed":"loading"})}else if(z==="status"){let v=we(M);if(!v)return;v.type==="generation_error"&&e.setMessageStatus(t.threadRaw.length-1,"error")}else if(z==="conversation"){let v=we(M);if(!v)return;e.setConversation(v)}}});for(;;){let{done:M,value:z}=await u.read();if(B.feed(m.decode(z)),M)break}}catch(r){if(!(r instanceof DOMException)||r.name!=="AbortError"){if(r instanceof Te&&r.status===409&&n<6){await a(1e3*(n+1)),e.askMax(o,n+1);return}let c={...ts,id:Y()};r instanceof Te&&r.status===429?c.content="You've reached my usage limit for now. Please try again later.":ke(r),t.threadRaw[t.threadRaw.length-1]?.status==="loading"?e.replaceMessage(t.threadRaw.length-1,c):t.threadRaw[t.threadRaw.length-1]?.status!=="error"&&e.addMessage(c)}}e.setThreadLoaded(),s.generationController=void 0},stopGeneration:async()=>{if(t.conversation?.id)try{await F.conversations.cancel(t.conversation.id),s.generationController?.abort(),e.resetThread()}catch(o){et.error(o?.data?.detail||"Failed to cancel the generation.")}},retryLastMessage:()=>{let o=t.threadRaw.filter(X).pop();o&&e.askMax(o.content)},addMessage:o=>{(X(o.message)||K(o.message))&&e.scrollThreadToBottom()},replaceMessage:o=>{K(o.message)&&e.scrollThreadToBottom()},scrollThreadToBottom:()=>{requestAnimationFrame(()=>{let o=document.getElementsByClassName("@container/thread")[0],n=o?.parentElement;n&&!n.classList.contains("SidePanel3000__content")&&(n=n.parentElement),n&&n.scrollTo({top:o.scrollHeight,behavior:"smooth"})})}})),(0,S.selectors)({threadGrouped:[e=>[e.threadRaw,e.threadLoading],(e,t)=>{let s=[];for(let o=0;o<e.length;o++){let n=e[o],a=e[o-1];if(n.type.split("/")[0]===a?.type.split("/")[0]){let r=s[s.length-1];n.id&&a.type==="ai/reasoning"?r[r.length-1]=n:r.push(n)}else s.push([n])}if(t){let o=s.at(-1)?.at(-1);if(o?.type==="human"||o?.id){let n={type:"ai/reasoning",content:"Thinking",status:"completed",id:"loader"};o.type==="human"?s.push([n]):s[s.length-1].push(n)}}return s}],formPending:[e=>[e.threadRaw],e=>{let t=e[e.length-1];return t&&Z(t)?!!t.meta?.form:!1}],inputDisabled:[e=>[e.formPending],e=>e],submissionDisabledReason:[e=>[e.formPending,e.dataProcessingAccepted,e.question,e.threadLoading],(e,t,s,o)=>{if(!o){if(!t)return"Please accept OpenAI processing data";if(e)return"Please choose one of the options above";if(!s)return"I need some input first"}}]}),(0,S.afterMount)(({actions:e,values:t})=>{t.coreMemory&&e.loadSuggestions({refresh:"async_except_on_cache_miss"})}),ot()]);function we(e){try{return JSON.parse(e)}catch{return null}}var I=l(w()),_e=["How can I help you build?","What are you curious about?","How can I help you understand users?","What do you want to know today?"];function zt(){let{hedgehogConfig:e}=(0,Ce.useValues)(rt),{conversation:t}=(0,Ce.useValues)(b),[s,o]=(0,pe.useState)("right"),n=(0,pe.useMemo)(()=>L.env.STORYBOOK?_e[0]:_e[parseInt((t?.id||Y()).split("-").at(-1),16)%_e.length],[t?.id]);return(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)("div",{className:"flex",children:(0,I.jsx)(ut,{placement:`${s}-end`,fallbackPlacements:[`${s==="right"?"left":"right"}-end`],middleware:[ze(-12)],showArrow:!0,children:(0,I.jsx)(mt,{static:!0,hedgehogConfig:{...e,walking_enabled:!1,controls_enabled:!1},onClick:a=>{Math.random()<.01?a.setOnFire():a.setRandomAnimation()},onActorLoaded:a=>setTimeout(()=>{a.setAnimation("wave"),a.direction="left"},100),onPositionChange:a=>o(a.direction)})})}),(0,I.jsxs)("div",{className:"text-center mb-3",children:[(0,I.jsx)("h2",{className:"text-xl @md/max-welcome:text-2xl font-bold mb-2 text-balance",children:n}),(0,I.jsx)("div",{className:"text-sm text-secondary text-balance",children:"I'm Max, here to help you build a successful\xA0product. Ask\xA0me about your product and your\xA0users."})]})]})}p();f();g();var ee=l(Ee()),ge=l(R()),fe=l(Se());var E=l(w());function Ie(){let{question:e,threadGrouped:t,threadLoading:s,inputDisabled:o,submissionDisabledReason:n}=(0,ge.useValues)(b),{askMax:a,setQuestion:r,stopGeneration:c}=(0,ge.useActions)(b),u=(0,fe.useRef)(null),m=t.length>0;return(0,fe.useEffect)(()=>{s&&u.current?.focus()},[s]),(0,E.jsx)("div",{className:(0,ee.default)("px-3",m?"sticky bottom-0 z-10 w-full max-w-[45rem] self-center":"relative w-[min(44rem,100%)]"),children:(0,E.jsxs)("div",{className:(0,ee.default)("flex flex-col items-center gap-2",m&&"p-1 mb-3 bottom-3 border border-[var(--border-primary)] rounded-lg backdrop-blur bg-[var(--glass-bg-3000)]"),children:[(0,E.jsx)(nt,{ref:u,value:e,onChange:B=>r(B),placeholder:s?"Thinking\u2026":m?"Ask follow-up":"Ask away",onPressEnter:()=>{e&&!n&&!s&&a(e)},autoFocus:!0,disabled:o,minRows:1,maxRows:10,className:(0,ee.default)("p-3 pr-12",m&&"border-border-bold")}),(0,E.jsx)("div",{className:(0,ee.default)("absolute flex items-center",m?"right-3 bottom-[11px]":"right-5 bottom-[7px]"),children:(0,E.jsx)(h,{type:m&&!e||s?"secondary":"primary",onClick:()=>{s?c():a(e)},tooltip:s?"Let's bail":"Let's go!",disabledReason:n,size:"small",icon:s?(0,E.jsx)(Ue,{}):(0,E.jsx)(De,{})})})]})})}p();f();g();var q=l(R());var P=l(w());function Ot(){let{visibleSuggestions:e,allSuggestionsLoading:t,dataProcessingAccepted:s}=(0,q.useValues)(b),{askMax:o,shuffleVisibleSuggestions:n}=(0,q.useActions)(b),{coreMemory:a,coreMemoryLoading:r}=(0,q.useValues)($),{openSettingsPanel:c}=(0,q.useActions)(ne);return!r&&!a?(0,P.jsx)(h,{size:"xsmall",type:"primary",onClick:()=>o("Ready, steady, go!"),disabledReason:s?void 0:"Please accept OpenAI processing data",center:!0,children:"Let's get started with me learning about your project!"}):(0,P.jsx)("div",{className:"flex items-center justify-center flex-wrap gap-x-2 gap-y-1.5 w-[min(48rem,100%)]",children:r||t?Array.from({length:3}).map((u,m)=>(0,P.jsx)(h,{size:"xsmall",type:"secondary",disabled:!0,style:{width:["35%","42.5%","50%"][m]},children:(0,P.jsx)(st,{className:"h-3 w-full"})},m)):e?(0,P.jsxs)(P.Fragment,{children:[e.map((u,m)=>(0,P.jsx)(h,{onClick:()=>o(u),size:"xsmall",type:"secondary",sideIcon:(0,P.jsx)(He,{}),center:!0,className:"shrink",disabledReason:s?void 0:"Please accept OpenAI processing data",children:u},m)),(0,P.jsxs)("div",{className:"flex gap-2",children:[(0,P.jsx)(h,{onClick:n,size:"xsmall",type:"secondary",icon:(0,P.jsx)(je,{}),tooltip:"Shuffle suggestions"}),(0,P.jsx)(h,{onClick:()=>c({sectionId:"environment-max",settingId:"core-memory"}),size:"xsmall",type:"secondary",icon:(0,P.jsx)(se,{}),tooltip:"Edit Max's memory"})]})]}):null})}p();f();g();var Re=l(Ee()),D=l(R());var k=l(Se());var i=l(w());function Qt(){let{threadGrouped:e}=(0,D.useValues)(b);return(0,i.jsx)("div",{className:"@container/thread flex flex-col items-stretch w-full max-w-200 self-center gap-2 grow p-3",children:e.map((t,s)=>(0,i.jsx)(ss,{messages:t,index:s,isFinal:s===e.length-1},s))})}function ss({messages:e,isFinal:t}){let{user:s}=(0,D.useValues)(re),o=e[0].type==="human"?"human":"ai";return(0,i.jsxs)("div",{className:(0,Re.default)("relative flex gap-2",o==="human"?"flex-row-reverse ml-4 @md/thread:ml-10 ":"mr-4 @md/thread:mr-10"),children:[(0,i.jsx)(Oe,{title:o==="human"?"You":"Max",children:(0,i.jsx)(lt,{user:o==="human"?{...s,hedgehog_config:void 0}:{hedgehog_config:{...s?.hedgehog_config,use_as_profile:!0}},size:"lg",className:"hidden @md/thread:flex mt-1 border"})}),(0,i.jsxs)("div",{className:(0,Re.default)("flex flex-col gap-2 min-w-0 w-full",o==="human"?"items-end":"items-start"),children:[e.map((n,a)=>{let r=n.id||a;return X(n)?(0,i.jsx)(J,{type:"human",boxClassName:n.status==="error"?"border-danger":void 0,children:(0,i.jsx)(j,{children:n.content||"*No text.*"})},r):Z(n)||Le(n)?(0,i.jsx)(ns,{message:n,interactable:a===e.length-1,isFinalGroup:t},r):K(n)?(0,i.jsx)(is,{message:n,status:n.status},a):me(n)?(0,i.jsxs)(J,{type:"ai",children:[(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsxs)("span",{children:[n.content,"\u2026"]}),(0,i.jsx)(Ze,{className:"text-xl"})]}),n.substeps?.map((c,u)=>(0,i.jsx)(j,{className:"mt-1.5 leading-6 px-1 text-[0.6875rem] font-semibold bg-surface-secondary rounded w-fit",children:c},u))]},r):null}),e.at(-1)?.status==="error"&&(0,i.jsx)(J,{type:"ai",boxClassName:"border-warning",children:(0,i.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,i.jsx)(Ye,{className:"text-xl text-warning"}),(0,i.jsx)("i",{children:"Max is generating this answer one more time because the previous attempt has failed."})]})})]})]})}var J=k.default.forwardRef(function({type:t,children:s,className:o,boxClassName:n,action:a},r){return(0,i.jsxs)("div",{className:ve("flex flex-col gap-px w-full break-words",t==="human"?"items-end":"items-start",o),ref:r,children:[(0,i.jsx)("div",{className:ve("border py-2 px-3 rounded-lg bg-surface-primary",t==="human"&&"font-medium",n),children:s}),a]})}),ns=k.default.forwardRef(function({message:t,interactable:s,isFinalGroup:o},n){let a=!!(s&&o),r=t.status!=="completed"?null:Le(t)&&!t.content?.includes("usage limit")&&a?(0,i.jsx)(as,{}):Z(t)&&s?t.meta?.form?.options&&o?(0,i.jsx)(os,{form:t.meta.form}):(0,i.jsx)(rs,{retriable:a}):null;return(0,i.jsx)(J,{type:"ai",boxClassName:t.status==="error"||t.type==="ai/failure"?"border-danger":void 0,ref:n,action:r,children:(0,i.jsx)(j,{children:t.content||"*Max has failed to generate an answer. Please try again.*"})})});function os({form:e}){let{askMax:t}=(0,D.useActions)(b);return(0,i.jsx)("div",{className:"flex flex-wrap gap-2 mt-1",children:e.options.map(s=>(0,i.jsx)(h,{onClick:()=>t(s.value),size:"small",type:s.variant&&["primary","secondary","tertiary"].includes(s.variant)?s.variant:"secondary",children:s.value},s.value))})}function is({message:e,status:t}){let[s,o]=(0,k.useState)(!1),n=(0,k.useMemo)(()=>e.answer?{kind:"InsightVizNode",source:Nt(e.answer),showHeader:!0}:null,[e]);return t!=="completed"?null:n&&(0,i.jsx)(i.Fragment,{children:(0,i.jsxs)(J,{type:"ai",className:"min-h-60 w-full",boxClassName:"w-full",children:[(0,i.jsx)(ft,{query:n,readOnly:!0,embedded:!0}),(0,i.jsxs)("div",{className:"flex items-center justify-between mt-2",children:[(0,i.jsx)(h,{sideIcon:s?(0,i.jsx)(Ge,{}):(0,i.jsx)(Ve,{}),onClick:()=>o(!s),size:"xsmall",className:"-m-1",tooltip:s?"Hide definition":"Show definition",children:(0,i.jsx)("h5",{className:"m-0 leading-none",children:(0,i.jsx)(xt,{query:n})})}),(0,i.jsx)(h,{to:bt.insightNew({query:n}),sideIcon:(0,i.jsx)(Be,{}),size:"xsmall",targetBlank:!0,children:"Open as new insight"})]}),s&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(yt,{query:n.source,heading:null}),(0,i.jsxs)("div",{className:"flex flex-wrap gap-4 mt-1 *:grow",children:[(0,i.jsx)(ht,{properties:n.source.properties}),(0,i.jsx)(St,{query:n.source})]})]})]})})}function as(){let{retryLastMessage:e}=(0,D.useActions)(b);return(0,i.jsx)(h,{icon:(0,i.jsx)(be,{}),type:"tertiary",size:"xsmall",tooltip:"Try again",onClick:()=>e(),className:"ml-1 -mb-1",children:"Try again"})}function rs({retriable:e}){let{traceId:t}=(0,D.useValues)(b),{retryLastMessage:s}=(0,D.useActions)(b),[o,n]=(0,k.useState)(null),[a,r]=(0,k.useState)(""),[c,u]=(0,k.useState)("hidden");function m(M){o||(n(M),W.capture("$ai_metric",{$ai_metric_name:"quality",$ai_metric_value:M,$ai_trace_id:t}),M==="bad"&&u("pending"))}function B(){a&&(W.capture("$ai_feedback",{$ai_feedback_text:a,$ai_trace_id:t}),u("submitted"))}return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("div",{className:"flex items-center ml-1 -mb-1",children:[o!=="bad"&&(0,i.jsx)(h,{icon:o==="good"?(0,i.jsx)(We,{}):(0,i.jsx)(Je,{}),type:"tertiary",size:"xsmall",tooltip:"Good answer",onClick:()=>m("good")}),o!=="good"&&(0,i.jsx)(h,{icon:o==="bad"?(0,i.jsx)(qe,{}):(0,i.jsx)(Xe,{}),type:"tertiary",size:"xsmall",tooltip:"Bad answer",onClick:()=>m("bad")}),e&&(0,i.jsx)(h,{icon:(0,i.jsx)(be,{}),type:"tertiary",size:"xsmall",tooltip:"Try again",onClick:()=>s()})]}),c!=="hidden"&&(0,i.jsxs)(J,{type:"ai",children:[(0,i.jsxs)("div",{className:"flex items-center gap-1",children:[(0,i.jsx)("h4",{className:"m-0 text-sm grow",children:c==="pending"?"What disappointed you about the answer?":"Thank you for your feedback!"}),(0,i.jsx)(h,{icon:(0,i.jsx)(Ke,{}),type:"tertiary",size:"xsmall",onClick:()=>u("hidden")})]}),c==="pending"&&(0,i.jsxs)("div",{className:"flex w-full gap-2 items-center mt-1.5",children:[(0,i.jsx)(tt,{placeholder:"Help us improve Max\u2026",fullWidth:!0,value:a,onChange:M=>r(M),onPressEnter:()=>B(),autoFocus:!0}),(0,i.jsx)(h,{type:"primary",onClick:()=>B(),disabledReason:a?void 0:"Please type a few words!",children:"Submit"})]})]})]})}var d=l(w()),ei={component:ls};function ls(){let{featureFlags:e}=(0,N.useValues)(te),{sidePanelOpen:t,selectedTab:s}=(0,N.useValues)(Pe),{closeSidePanel:o}=(0,N.useActions)(Pe);return e[U.ARTIFICIAL_HOG]?t&&s==="max"?(0,d.jsxs)("div",{className:"flex flex-col items-center justify-center w-full grow",children:[(0,d.jsx)($e,{className:"text-3xl text-muted mb-2"}),(0,d.jsx)("h3",{className:"text-xl font-bold mb-1",children:"Max is currently in the sidebar"}),(0,d.jsx)("p",{className:"text-sm text-muted mb-2",children:"You can navigate freely around the app, or\u2026"}),(0,d.jsx)(h,{type:"secondary",size:"xsmall",onClick:()=>o(),sideIcon:(0,d.jsx)(Qe,{}),children:"Get him in here"})]}):(0,d.jsx)(N.BindLogic,{logic:b,props:{conversationId:null},children:(0,d.jsx)(cs,{})}):(0,d.jsx)(pt,{object:"page",caption:"You don't have access to AI features yet."})}function cs(){let{threadGrouped:e}=(0,N.useValues)(b),{openSettingsPanel:t}=(0,N.useActions)(ne);return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(gt,{delimited:!0,buttons:(0,d.jsx)(h,{type:"secondary",size:"small",icon:(0,d.jsx)(se,{}),onClick:()=>{t({settingId:"core-memory"}),setTimeout(()=>document.getElementById("product-description-textarea")?.focus(),1)},children:"Settings"})}),e.length?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(Qt,{}),(0,d.jsx)(Ie,{})]}):(0,d.jsxs)("div",{className:"@container/max-welcome relative flex flex-col gap-3 px-4 pb-8 items-center grow justify-center",children:[(0,d.jsx)(zt,{}),(0,d.jsx)(Ie,{}),(0,d.jsx)(Ot,{})]})]})}export{ce as a,It as b,jt as c,Ft as d,Pe as e,ei as f,ls as g,cs as h};
//# sourceMappingURL=/static/chunk-YZ3UPBKV.js.map
