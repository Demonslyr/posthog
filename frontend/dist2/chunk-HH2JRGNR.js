import{a as oe}from"/static/chunk-ONXXPKL4.js";import{a as xo}from"/static/chunk-67FTXEWX.js";import{a as Do}from"/static/chunk-QUCOEN55.js";import{a as ko}from"/static/chunk-FZRQH23Q.js";import{a as fe}from"/static/chunk-EWYESSII.js";import{a as vo}from"/static/chunk-DJ5KSU5H.js";import{$a as Y,$d as me,$e as lo,$i as G,Bi as bo,Ce as no,Cg as Ae,Do as P,Eo as ye,Gn as go,Hg as uo,Io as w,Kn as To,Ln as So,Mb as Ze,Nn as Lo,Oi as ue,Pk as fo,Q as Ke,Qd as oo,Sd as l,Ta as ee,Td as to,Tf as L,Vd as V,Wd as le,Yl as be,Za as Pe,_i as z,a as O,af as mo,ce as T,cg as pe,ee as ce,ef as co,f as Oe,gc as eo,ie as Ne,je as ao,km as he,m as je,ng as po,nm as yo,pe as J,qe as ro,qk as ho,r as g,se as U,ua as de,ue as io,ve as so,vo as wo}from"/static/chunk-TW5IU73S.js";import{Ha as $e,Tb as Qe,a as ot,db as Xe,kb as Ye,na as Z,pb as ze,rb as Ge,wc as Fe,x as Je}from"/static/chunk-3UDJFOQH.js";import{d as n,e as c,g as p,j as u}from"/static/chunk-SJXEOBQC.js";c();u();p();var ge=n(O()),Co=n(Y());var W=n(g());function Mo(){let{hideDeleteDashboardModal:e}=(0,ge.useActions)(z),{isDeleteDashboardSubmitting:t,deleteDashboardModalVisible:a}=(0,ge.useValues)(z);return(0,W.jsx)(T,{title:"Delete dashboard",onClose:e,isOpen:a,footer:(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)(l,{form:"delete-dashboard-form",type:"secondary","data-attr":"dashboard-delete",disabled:t,onClick:e,children:"Cancel"}),(0,W.jsx)(l,{form:"delete-dashboard-form",htmlType:"submit",type:"secondary",status:"danger","data-attr":"dashboard-delete-submit",loading:t,disabled:t,children:"Delete dashboard"})]}),children:(0,W.jsx)(Co.Form,{logic:z,formKey:"deleteDashboard",id:"delete-dashboard-form",enableFormOnSubmit:!0,className:"space-y-2",children:(0,W.jsx)(L,{name:"deleteInsights",help:"This will only delete insights if they're not on any other dashboards.",children:({value:r,onChange:s})=>(0,W.jsx)(me,{"data-attr":"delete-dashboard-insights-checkbox",checked:r,label:"Delete this dashboard's insights",onChange:s})})})})}c();u();p();var Te=n(O()),Eo=n(Y());var N=n(g());function Io(){let{hideDuplicateDashboardModal:e,duplicateAndGoToDashboard:t}=(0,Te.useActions)(G),{isDuplicateDashboardSubmitting:a,duplicateDashboardModalVisible:r}=(0,Te.useValues)(G);return(0,N.jsx)(T,{title:"Duplicate dashboard",onClose:e,isOpen:r,footer:(0,N.jsxs)(N.Fragment,{children:[(0,N.jsx)(l,{form:"new-dashboard-form",type:"secondary","data-attr":"dashboard-cancel",disabled:a,onClick:e,children:"Cancel"}),(0,N.jsx)(l,{form:"new-dashboard-form",type:"secondary","data-attr":"dashboard-submit-and-go",disabled:a,onClick:t,children:"Duplicate and go to dashboard"}),(0,N.jsx)(l,{form:"duplicate-dashboard-form",htmlType:"submit",type:"primary","data-attr":"duplicate-dashboard-submit",loading:a,disabled:a,children:"Duplicate"})]}),children:(0,N.jsx)(Eo.Form,{logic:G,formKey:"duplicateDashboard",id:"duplicate-dashboard-form",enableFormOnSubmit:!0,className:"space-y-2",children:(0,N.jsx)(L,{name:"duplicateTiles",help:"Choose whether to duplicate this dashboard's insights and text or attach them to the new dashboard.",children:({value:s,onChange:d})=>(0,N.jsx)(me,{checked:s,label:"Duplicate this dashboard's tiles",onChange:d})})})})}c();u();p();var C=n(O()),Zo=n(Oe());c();u();p();var Se=n(O()),Le=n(Y());c();u();p();var A=n(O()),Bo=n(Y());var tt=(e,t)=>e.tiles?.find(s=>s.id===t)?.text?.body||"",Ve=(0,A.kea)([(0,A.path)(["scenes","dashboard","dashboardTextTileModal","logic"]),(0,A.props)({}),(0,A.key)(e=>`textCardModalLogic-${e.dashboard.id}-${e.textTileId}`),(0,A.connect)({actions:[he,["updateDashboard"]]}),(0,A.listeners)(({props:e,actions:t})=>({submitTextTileFailure:a=>{e.dashboard&&e.textTileId&&V.error(`Could not save text: ${a.error} (${JSON.stringify(a.errors)})`),t.resetTextTile(),e?.onClose?.()},submitTextTileSuccess:()=>{t.resetTextTile(),e?.onClose?.()}})),(0,Bo.forms)(({props:e,actions:t})=>({textTile:{defaults:{body:e.textTileId&&e.textTileId!=="new"?tt(e.dashboard,e.textTileId):""},errors:({body:a})=>({body:a?null:"This card would be empty! Type something first"}),submit:a=>{let r=(e.dashboard.tiles||[]).map(s=>({id:s.id,text:s.text}));if(e.textTileId==="new")t.updateDashboard({id:e.dashboard.id,tiles:[{text:a}]});else{let s=[...r].reduce((d,b)=>(b.id===e.textTileId&&b.text&&(b.text.body=a.body,d.push(b)),d),[]);t.updateDashboard({id:e.dashboard.id,tiles:s})}}}}))]);var R=n(g());function _o({isOpen:e,onClose:t,dashboard:a,textTileId:r}){let s=Ve({dashboard:a,textTileId:r??"new",onClose:t}),{isTextTileSubmitting:d,textTileValidationErrors:b}=(0,Se.useValues)(s),{submitTextTile:D,resetTextTile:h}=(0,Se.useActions)(s),x=()=>{h(),t()};return(0,R.jsx)(T,{closable:!0,isOpen:e,title:"",onClose:x,footer:(0,R.jsxs)(R.Fragment,{children:[(0,R.jsx)(l,{disabledReason:d?"Cannot cancel card creation in progress":null,type:"secondary",onClick:x,children:"Cancel"}),(0,R.jsx)(l,{disabledReason:b.body,loading:d,form:"text-tile-form",htmlType:"submit",type:"primary",onClick:D,"data-attr":r==="new"?"save-new-text-tile":"edit-text-tile-text",children:"Save"})]}),children:(0,R.jsx)(Le.Form,{logic:Ve,props:{dashboard:a,textTileId:r},formKey:"textTile",id:"text-tile-form",className:"",enableFormOnSubmit:!0,children:(0,R.jsx)(Le.Field,{name:"body",label:"",children:(0,R.jsx)(yo,{"data-attr":"text-card-edit-area"})})})})}c();u();p();var Oo=n(ot());function Fo({onExit:e}){let t=".layout-top-content";return(0,Oo.useEffect)(()=>{let a=window.document.querySelectorAll(t);for(let s=0;s<a.length;s++)a[s].style.display="none";let r=()=>{window.document.fullscreenElement===null&&e?.()};try{document.body.requestFullscreen().then(()=>{window.addEventListener("fullscreenchange",r,!1)})}catch{}try{window.dispatchEvent(new window.Event("scroll")),window.dispatchEvent(new window.Event("resize"))}catch{}return()=>{let s=window.document.querySelectorAll(t);for(let d=0;d<s.length;d++)s[d].style.display="block";try{window.removeEventListener("fullscreenchange",r,!1),document.fullscreenElement!==null&&document.exitFullscreen()}catch{}try{window.dispatchEvent(new window.Event("scroll")),window.dispatchEvent(new window.Event("resize"))}catch{}}},[]),null}c();u();p();var ae=n(O()),Ue=n(Oe());c();u();p();var We=n(g()),we=({dashboardId:e,insightShortId:t})=>t?P.insightSubcriptions(t):e?P.dashboardSubcriptions(e):"",te=(e,{dashboardId:t,insightShortId:a})=>a?P.insightSubcription(a,e.toString()):t?P.dashboardSubcription(t,e.toString()):"",Po=[{value:"email",label:"Email",icon:(0,We.jsx)(eo,{})},{value:"slack",label:"Slack",icon:(0,We.jsx)(de,{})}],No=Fe(1,13).map(e=>({value:e,label:e.toString()})),Ao=[{value:"daily",label:"day"},{value:"weekly",label:"week"},{value:"monthly",label:"month"}],Vo=[{value:"daily",label:"days"},{value:"weekly",label:"weeks"},{value:"monthly",label:"months"}],ve=[{value:"monday",label:"Monday"},{value:"tuesday",label:"Tuesday"},{value:"wednesday",label:"Wednesday"},{value:"thursday",label:"Thursday"},{value:"friday",label:"Friday"},{value:"saturday",label:"Saturday"},{value:"sunday",label:"Sunday"}],Wo=[...ve,{value:"day",label:"day"}],Ro=[{value:"1",label:"first"},{value:"2",label:"second"},{value:"3",label:"third"},{value:"4",label:"fourth"},{value:"-1",label:"last"}],Uo=Fe(0,24).map(e=>({value:String(e),label:`${String(e).padStart(2,"0")}:00`}));c();u();p();var X=n(O()),$o=n(Y());c();u();p();var H=n(O()),qo=n(Y()),Jo=n(Pe()),j=n(Oe());c();u();p();var v=n(O()),Ho=n(Pe());var Q=(0,v.kea)([(0,v.path)(["lib","components","Subscriptions","subscriptionsLogic"]),(0,v.props)({}),(0,v.key)(({insightShortId:e,dashboardId:t})=>e?`insight-${e}`:t?`dashboard-${t}`:"subscriptions"),(0,v.actions)({deleteSubscription:e=>({id:e})}),(0,Ho.loaders)(({props:e})=>({subscriptions:{__default:[],loadSubscriptions:async(t,a)=>{if(!e.dashboardId&&!e.insightShortId)return[];a?.();let r=e.insightShortId?await be(e.insightShortId):void 0,s=await w.subscriptions.list({dashboardId:e.dashboardId,insightId:r});return a?.(),s.results}}})),(0,v.reducers)({subscriptions:{deleteSubscription:(e,{id:t})=>e.filter(a=>a.id!==t)}}),(0,v.listeners)(({actions:e})=>({deleteSubscription:async({id:t})=>{await po({endpoint:w.subscriptions.determineDeleteEndpoint(),object:{name:"Subscription",id:t},callback:()=>e.loadSubscriptions()})}})),(0,v.afterMount)(({actions:e})=>e.loadSubscriptions())]);var De={frequency:"weekly",interval:1,start_date:(0,Z.default)().hour(9).minute(0).second(0).toISOString(),target_type:"email",byweekday:["monday"],bysetpos:1},Re=(0,H.kea)([(0,H.path)(["lib","components","Subscriptions","subscriptionLogic"]),(0,H.props)({}),(0,H.key)(({id:e,insightShortId:t,dashboardId:a})=>`${t||a}-${e??"new"}`),(0,Jo.loaders)(({props:e})=>({subscription:{__default:void 0,loadSubscription:async()=>e.id&&e.id!=="new"?await w.subscriptions.get(e.id):{...De}}})),(0,qo.forms)(({props:e,actions:t})=>({subscription:{defaults:{},errors:({frequency:a,interval:r,target_value:s,target_type:d,title:b,start_date:D})=>({frequency:a?void 0:"You need to set a schedule frequency",title:b?void 0:"You need to give your subscription a name",interval:r?void 0:"You need to set an interval",start_date:D?void 0:"You need to set a delivery time",target_type:["slack","email","webhook"].includes(d)?void 0:"Unsupported target type",target_value:s?d=="email"?s?s.split(",").every(h=>Ge(h))?void 0:"All emails must be valid":"At least one email is required":d=="slack"?s?void 0:"A channel is required":d=="webhook"?ze(s)?void 0:"Must be a valid URL":void 0:"This field is required."}),submit:async(a,r)=>{let s=e.insightShortId?await be(e.insightShortId):void 0,d={...a,insight:s,dashboard:e.dashboardId};r();let b=e.id==="new"?await w.subscriptions.create(d):await w.subscriptions.update(e.id,d);return t.resetSubscription(),b.id!==e.id&&j.router.actions.replace(te(b.id,e)),Q.findMounted(e)?.actions.loadSubscriptions(),t.loadSubscriptionSuccess(b),V.success("Subscription saved."),b}}})),(0,H.listeners)(({actions:e})=>({setSubscriptionValue:({name:t,value:a})=>{let r=Array.isArray(t)?t[0]:t;r==="frequency"&&(a==="daily"?e.setSubscriptionValues({bysetpos:null,byweekday:null}):e.setSubscriptionValues({bysetpos:De.bysetpos,byweekday:De.byweekday})),r==="target_type"&&e.setSubscriptionValues({target_value:""})}})),(0,j.beforeUnload)(({actions:e,values:t})=>({enabled:()=>t.subscriptionChanged,message:"Changes you made will be discarded.",onConfirm:()=>{e.resetSubscription()}})),(0,j.urlToAction)(({actions:e})=>({"/*/*/subscriptions/new":(t,a)=>{e.loadSubscriptionSuccess({...De}),a.target_type&&e.setSubscriptionValue("target_type",a.target_type)},"/*/*/subscriptions/:id":()=>{e.loadSubscription()}}))]);var o=n(g());function Xo({id:e,insightShortId:t,dashboardId:a,onCancel:r,onDelete:s}){let d={id:e,insightShortId:t,dashboardId:a},b=Re(d),D=Q({insightShortId:t,dashboardId:a}),{meFirstMembers:h,membersLoading:x}=(0,X.useValues)(lo),{subscription:y,subscriptionLoading:k,isSubscriptionSubmitting:Ce,subscriptionChanged:Me}=(0,X.useValues)(b),{preflight:se,siteUrlMisconfigured:Ee}=(0,X.useValues)(mo),{deleteSubscription:Ie}=(0,X.useActions)(D),{slackIntegrations:Be}=(0,X.useValues)(Do),ne=Be?.[0],K=!se?.email_service_available,_e=()=>{e!=="new"&&(Ie(e),s())},q=new Intl.DateTimeFormat("en-US",{timeZoneName:"shortGeneric"}).formatToParts(new Date)?.find(f=>f.type==="timeZoneName")?.value;return(0,o.jsxs)($o.Form,{logic:Re,props:d,formKey:"subscription",enableFormOnSubmit:!0,className:"LemonModal__layout",children:[(0,o.jsx)(T.Header,{children:(0,o.jsxs)("div",{className:"flex items-center gap-2",children:[(0,o.jsx)(l,{icon:(0,o.jsx)(Ke,{}),onClick:r,size:"xsmall"}),(0,o.jsxs)("h3",{children:[e==="new"?"New":"Edit "," Subscription"]})]})}),(0,o.jsx)(T.Content,{className:"space-y-2",children:y?(0,o.jsxs)(o.Fragment,{children:[y?.created_by?(0,o.jsx)(vo,{at:y.created_at,by:y.created_by,prefix:"Created",className:"mb-4"}):null,Ee&&(0,o.jsx)(le,{type:"warning",children:(0,o.jsxs)(o.Fragment,{children:["Your ",(0,o.jsx)("code",{children:"SITE_URL"})," environment variable seems misconfigured. Your"," ",(0,o.jsx)("code",{children:"SITE_URL"})," is set to"," ",(0,o.jsx)("b",{children:(0,o.jsx)("code",{children:se?.site_url})})," ","but you're currently browsing this page from"," ",(0,o.jsx)("b",{children:(0,o.jsx)("code",{children:window.location.origin})}),". ",(0,o.jsx)("br",{}),"If this value is not configured correctly PostHog may be unable to correctly send Subscriptions."," ",(0,o.jsx)(ee,{to:"https://posthog.com/docs/configuring-posthog/environment-variables?utm_medium=in-product&utm_campaign=subcriptions-system-status-site-url-misconfig",target:"_blank",targetBlankIcon:!0,children:"Learn more"})]})}),(0,o.jsx)(L,{name:"title",label:"Name",children:(0,o.jsx)(Ne,{placeholder:"e.g. Weekly team report"})}),(0,o.jsx)(L,{name:"target_type",label:"Destination",children:(0,o.jsx)(J,{options:Po})}),y.target_type==="email"?(0,o.jsxs)(o.Fragment,{children:[K&&(0,o.jsx)(le,{type:"error",children:(0,o.jsxs)(o.Fragment,{children:["Email subscriptions are not currently possible as this PostHog instance isn't"," ",(0,o.jsx)(ee,{to:"https://posthog.com/docs/self-host/configure/email",target:"_blank",targetBlankIcon:!0,children:"configured\xA0to\xA0send\xA0emails\xA0"}),"."]})}),(0,o.jsx)(L,{name:"target_value",label:"Who do you want to subscribe",help:"Enter the email addresses of the users you want to share with",children:({value:f,onChange:S})=>(0,o.jsx)(io,{onChange:M=>S(M.join(",")),value:f?.split(",").filter(Boolean),disabled:K,mode:"multiple",allowCustomValues:!0,"data-attr":"subscribed-emails",options:go(h.map(M=>M.user)),loading:x,placeholder:"Enter an email address"})}),(0,o.jsx)(L,{name:"invite_message",label:"Message",showOptional:!0,children:(0,o.jsx)(no,{placeholder:"Your message to new subscribers (optional)"})})]}):null,y.target_type==="slack"?(0,o.jsx)(o.Fragment,{children:ne?(0,o.jsx)(o.Fragment,{children:(0,o.jsx)(L,{name:"target_value",label:"Which Slack channel to send reports to",help:(0,o.jsxs)(o.Fragment,{children:["Private channels are only shown if you have"," ",(0,o.jsx)(ee,{to:"https://posthog.com/docs/webhooks/slack",target:"_blank",children:"added the PostHog Slack App"})," ","to them"]}),children:({value:f,onChange:S})=>(0,o.jsx)(xo,{value:f,onChange:S,integration:ne})})}):(0,o.jsx)(o.Fragment,{children:(0,o.jsx)(le,{type:"info",children:(0,o.jsxs)("div",{className:"flex justify-between gap-2",children:[(0,o.jsx)("span",{children:"Slack is not yet configured for this project. Add PostHog to your Slack workspace to continue."}),(0,o.jsx)(ee,{to:w.integrations.authorizeUrl({kind:"slack",next:window.location.pathname+"?target_type=slack"}),disableClientSideRouting:!0,children:(0,o.jsx)("img",{alt:"Add to Slack",height:"40",width:"139",src:"https://platform.slack-edge.com/img/add_to_slack.png",srcSet:"https://platform.slack-edge.com/img/add_to_slack.png 1x, https://platform.slack-edge.com/img/add_to_slack@2x.png 2x"})})]})})})}):null,y.target_type==="webhook"?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(L,{name:"target_value",label:"Webhook URL",children:(0,o.jsx)(Ne,{placeholder:"https://example.com/webhooks/1234"})}),(0,o.jsx)("div",{className:"text-xs text-secondary mt-2",children:"Webhooks will be called with a HTTP POST request. The webhook endpoint should respond with a healthy HTTP code (2xx)."})]}):null,(0,o.jsxs)("div",{children:[(0,o.jsxs)("div",{className:"flex items-baseline justify-between w-full",children:[(0,o.jsx)(ao,{className:"mb-2",children:"Recurrence"}),(0,o.jsx)("div",{className:"text-xs text-secondary text-right",children:q})]}),(0,o.jsxs)("div",{className:"flex gap-2 items-center rounded border p-2 flex-wrap",children:[(0,o.jsx)("span",{children:"Send every"}),(0,o.jsx)(L,{name:"interval",children:(0,o.jsx)(J,{options:No})}),(0,o.jsx)(L,{name:"frequency",children:(0,o.jsx)(J,{options:y.interval===1?Ao:Vo})}),y.frequency==="weekly"&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("span",{children:"on"}),(0,o.jsx)(L,{name:"byweekday",children:({value:f,onChange:S})=>(0,o.jsx)(J,{options:ve,value:f?f[0]:null,onChange:M=>S([M])})})]}),y.frequency==="monthly"&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("span",{children:"on the"}),(0,o.jsx)(L,{name:"bysetpos",children:({value:f,onChange:S})=>(0,o.jsx)(J,{options:Ro,value:f?String(f):null,onChange:M=>{S(typeof M=="string"?parseInt(M,10):null)}})}),(0,o.jsx)(L,{name:"byweekday",children:({value:f,onChange:S})=>(0,o.jsx)(J,{dropdownMatchSelectWidth:!1,options:Wo,value:f?f.length===1?f[0]:"day":null,onChange:M=>S(M==="day"?Object.values(ve).map(et=>et.value):[M])})})]}),(0,o.jsx)("span",{children:"by"}),(0,o.jsx)(L,{name:"start_date",children:({value:f,onChange:S})=>(0,o.jsx)(J,{options:Uo,value:(0,Z.default)(f).hour().toString(),onChange:M=>{S((0,Z.default)().hour(typeof M=="string"?parseInt(M,10):0).minute(0).second(0).toISOString())}})})]})]})]}):k?(0,o.jsxs)("div",{className:"space-y-4",children:[(0,o.jsx)(U,{className:"w-1/2 h-4"}),(0,o.jsx)(U.Row,{}),(0,o.jsx)(U,{className:"w-1/2 h-4"}),(0,o.jsx)(U.Row,{}),(0,o.jsx)(U,{className:"w-1/2 h-4"}),(0,o.jsx)(U.Row,{})]}):(0,o.jsxs)("div",{className:"p-4 text-center",children:[(0,o.jsx)("h2",{children:"Not found"}),(0,o.jsx)("p",{children:"This subscription could not be found. It may have been deleted."})]})}),(0,o.jsxs)(T.Footer,{children:[(0,o.jsx)("div",{className:"flex-1",children:y&&e!=="new"&&(0,o.jsx)(l,{type:"secondary",status:"danger",onClick:_e,disabled:k,children:"Delete subscription"})}),(0,o.jsx)(l,{type:"secondary",onClick:r,children:"Cancel"}),(0,o.jsx)(l,{type:"primary",htmlType:"submit",loading:Ce,disabled:!Me||k,children:e==="new"?"Create subscription":"Save"})]})]})}c();u();p();var xe=n(O());var m=n(g());function at({subscription:e,onClick:t,onDelete:a}){return(0,m.jsx)(l,{type:"secondary",onClick:t,"data-attr":"subscription-list-item",fullWidth:!0,sideAction:{icon:(0,m.jsx)(Ze,{}),dropdown:{overlay:(0,m.jsx)(m.Fragment,{children:a&&(0,m.jsx)(l,{onClick:a,"data-attr":"subscription-list-item-delete",status:"danger",fullWidth:!0,children:"Delete Subscription"})})}},children:(0,m.jsxs)("div",{className:"flex justify-between flex-auto items-center p-2",children:[(0,m.jsxs)("div",{children:[(0,m.jsx)("div",{className:"text-link font-medium",children:e.title}),(0,m.jsx)("div",{className:"text-sm text-text-3000",children:$e(e.summary)})]}),e.target_type==="email"?(0,m.jsx)(ue,{limit:4,people:e.target_value.split(",").map(r=>({email:r}))}):null,e.target_type==="slack"?(0,m.jsx)(de,{}):null]})})}function Yo({insightShortId:e,dashboardId:t,onCancel:a,onSelect:r}){let s=Q({insightShortId:e,dashboardId:t}),{subscriptions:d,subscriptionsLoading:b}=(0,xe.useValues)(s),{deleteSubscription:D}=(0,xe.useActions)(s);return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(T.Header,{children:(0,m.jsx)("h3",{children:" Manage Subscriptions"})}),(0,m.jsx)(T.Content,{children:b&&!d.length?(0,m.jsxs)("div",{className:"space-y-2",children:[(0,m.jsx)(U,{className:"w-1/2 h-4"}),(0,m.jsx)(U.Row,{repeat:2})]}):d.length?(0,m.jsxs)("div",{className:"space-y-2",children:[(0,m.jsxs)("div",{children:[(0,m.jsx)("strong",{children:d?.length})," active ",Qe(d.length||0,"subscription","subscriptions",!1)]}),d.map(h=>(0,m.jsx)(at,{subscription:h,onClick:()=>r(h.id),onDelete:()=>D(h.id)},h.id))]}):(0,m.jsxs)("div",{className:"flex flex-col p-4 items-center text-center",children:[(0,m.jsx)("h3",{children:"There are no subscriptions for this insight"}),(0,m.jsx)("p",{children:"Once subscriptions are created they will display here. "}),(0,m.jsx)(l,{type:"primary",onClick:()=>r("new"),children:"Add subscription"})]})}),(0,m.jsxs)(T.Footer,{children:[(0,m.jsx)("div",{className:"flex-1",children:d.length?(0,m.jsx)(l,{type:"secondary",onClick:()=>r("new"),children:"Add subscription"}):null}),(0,m.jsx)(l,{type:"secondary",onClick:a,children:"Close"})]})]})}var F=n(g());function zo(e){let{closeModal:t,dashboardId:a,insightShortId:r,subscriptionId:s,isOpen:d,inline:b}=e,{push:D}=(0,ae.useActions)(Ue.router),{userLoading:h}=(0,ae.useValues)(ye);return h?(0,F.jsx)(oo,{className:"text-2xl"}):(0,F.jsx)(T,{onClose:t,isOpen:d,width:600,simple:!0,title:"",inline:b,children:(0,F.jsx)(bo,{feature:"subscriptions",background:!1,className:"py-8",docsLink:"https://posthog.com/docs/user-guides/subscriptions",children:s?(0,F.jsx)(Xo,{id:s,insightShortId:r,dashboardId:a,onCancel:()=>D(we(e)),onDelete:()=>D(we(e))}):(0,F.jsx)(Yo,{insightShortId:r,dashboardId:a,onCancel:t,onSelect:x=>D(te(x,e))})})})}function Go(e){let{push:t}=(0,ae.useActions)(Ue.router);return(0,F.jsx)(to,{fullWidth:!0,dropdown:{actionable:!0,closeParentPopoverOnClickInside:!0,placement:"right-start",overlay:(0,F.jsxs)(F.Fragment,{children:[(0,F.jsx)(l,{onClick:()=>t(te("new",e)),fullWidth:!0,children:"New subscription"}),(0,F.jsx)(l,{onClick:()=>t(we(e)),fullWidth:!0,children:"Manage subscriptions"})]})},children:"Subscribe"})}c();u();p();var $=n(O()),Qo=(0,$.kea)([(0,$.path)(["scenes","dashboard","addInsightToDashboardLogic"]),(0,$.actions)({showAddInsightToDashboardModal:!0,hideAddInsightToDashboardModal:!0}),(0,$.reducers)({addInsightToDashboardModalVisible:[!1,{showAddInsightToDashboardModal:()=>!0,hideAddInsightToDashboardModal:()=>!1}]})]);c();u();p();var ke=n(O());c();u();p();var _=n(O()),jo=n(Pe());var re=(0,_.kea)([(0,_.path)(["scenes","dashboard","dashboardTemplateEditorLogic"]),(0,_.connect)({logic:[oe],values:[je,["featureFlags"]]}),(0,_.actions)({setEditorValue:e=>({value:e}),setDashboardTemplate:e=>({dashboardTemplate:e}),clear:!0,setDashboardTemplateId:e=>({id:e}),openDashboardTemplateEditor:!0,closeDashboardTemplateEditor:!0,updateValidationErrors:e=>({markers:e})}),(0,_.reducers)({editorValue:["",{setEditorValue:(e,{value:t})=>t,clear:()=>""}],dashboardTemplate:[null,{clear:()=>null,setDashboardTemplate:(e,{dashboardTemplate:t})=>t}],validationErrors:[[],{updateValidationErrors:(e,{markers:t})=>!t||t.length===0?[]:t.map(a=>a.message),clear:()=>[]}],id:[null,{setDashboardTemplateId:(e,{id:t})=>t,clear:()=>null}],isOpenNewDashboardTemplateModal:[!1,{openDashboardTemplateEditor:()=>!0,closeDashboardTemplateEditor:()=>!1}]}),(0,jo.loaders)(({values:e})=>({dashboardTemplate:[void 0,{createDashboardTemplate:async()=>{if(!e.dashboardTemplate){V.error("Unable to create dashboard template");return}let t=await w.dashboardTemplates.create(e.dashboardTemplate);return V.success("Dashboard template created"),t},getDashboardTemplate:async t=>await w.dashboardTemplates.get(t),updateDashboardTemplate:async({id:t,dashboardTemplateUpdates:a})=>{let r=null;if(a)r=await w.dashboardTemplates.update(t,a);else if(e.dashboardTemplate)r=await w.dashboardTemplates.update(t,e.dashboardTemplate);else{V.error("Unable to update dashboard template");return}return V.success("Dashboard template updated"),r},deleteDashboardTemplate:async t=>(await w.dashboardTemplates.delete(t),V.success("Dashboard template deleted"),null)}],templateSchema:[null,{getTemplateSchema:async()=>await w.dashboardTemplates.getSchema()}]})),(0,_.listeners)(({values:e,actions:t})=>({createDashboardTemplateSuccess:async()=>{t.closeDashboardTemplateEditor(),oe.actions.getAllTemplates()},updateDashboardTemplateSuccess:async()=>{t.closeDashboardTemplateEditor(),oe.actions.getAllTemplates()},deleteDashboardTemplateSuccess:async()=>{oe.actions.getAllTemplates()},closeDashboardTemplateEditor:()=>{t.clear()},setDashboardTemplateId:({id:a})=>{a&&t.getDashboardTemplate(a)},getDashboardTemplateSuccess:async({dashboardTemplate:a})=>{a&&t.setEditorValue(JSON.stringify(a))},setEditorValue:async({value:a},r)=>{if(await r(500),e.validationErrors.length==0&&a?.length)try{let s=JSON.parse(a);t.setDashboardTemplate(s)}catch(s){console.error("error",s),V.error("Unable to parse dashboard template")}},updateValidationErrors:async({markers:a})=>{a?.length||t.setEditorValue(e.editorValue)},setDashboardTemplate:async({dashboardTemplate:a})=>{a&&t.setEditorValue(JSON.stringify(a,null,4))}})),(0,_.afterMount)(({actions:e})=>{e.getTemplateSchema()})]);var ie=n(g());function Ko({inline:e=!1}){let{closeDashboardTemplateEditor:t,createDashboardTemplate:a,updateDashboardTemplate:r,setEditorValue:s,updateValidationErrors:d}=(0,ke.useActions)(re),{isOpenNewDashboardTemplateModal:b,editorValue:D,validationErrors:h,templateSchema:x,id:y}=(0,ke.useValues)(re);return(0,ie.jsx)(T,{title:y?"Edit dashboard template":"New dashboard template",isOpen:b,width:1e3,onClose:()=>{t()},inline:e,footer:y?(0,ie.jsx)(l,{type:"primary","data-attr":"update-dashboard-template-button",onClick:()=>{r({id:y})},disabledReason:h.length?`There are ${h.length} errors to resolve: ${h.map(k=>" "+k)}`:void 0,children:"Update template"}):(0,ie.jsx)(l,{type:"primary","data-attr":"create-dashboard-template-button",onClick:()=>{a()},disabledReason:h.length?`There are ${h.length} errors to resolve:${h.map(k=>" "+k)}`:void 0,children:"Create new template"}),children:(0,ie.jsx)(uo,{className:"border",language:"json",value:D,onChange:k=>{s(k??"")},onValidate:k=>{d(k)},path:y?`dashboard-templates/${y}.json`:"dashboard-templates/new.json",schema:x,height:600})})}var i=n(g()),Ti="You don't have edit permissions for this dashboard. Ask a dashboard collaborator with edit access to add you.";function Si(){let{dashboard:e,dashboardLoading:t,dashboardMode:a,canEditDashboard:r,showSubscriptions:s,subscriptionId:d,apiUrl:b,showTextTileModal:D,textTileId:h}=(0,C.useValues)(pe),{setDashboardMode:x,triggerDashboardUpdate:y}=(0,C.useActions)(pe),{asDashboardTemplate:k}=(0,C.useValues)(pe),{updateDashboard:Ce,pinDashboard:Me,unpinDashboard:se}=(0,C.useActions)(he),{createNotebookFromDashboard:Ee}=(0,C.useActions)(ho),{showAddInsightToDashboardModal:Ie}=(0,C.useActions)(Qo),{setDashboardTemplate:Be,openDashboardTemplateEditor:ne}=(0,C.useActions)(re),{user:K}=(0,C.useValues)(ye),{showDuplicateDashboardModal:_e}=(0,C.useActions)(G),{showDeleteDashboardModal:He}=(0,C.useActions)(z),{tags:qe}=(0,C.useValues)(co),{push:q}=(0,C.useActions)(Zo.router),f=[{export_format:"image/png",dashboard:e?.id,export_context:{path:b()}}];return K?.is_staff&&f.push({export_format:"application/json",export_context:{localData:JSON.stringify(k),filename:`dashboard-${Xe(e?.name||"nameless dashboard")}.json`,mediaType:"application/json"}}),e||t?(0,i.jsxs)(i.Fragment,{children:[a==="fullscreen"&&(0,i.jsx)(Fo,{onExit:()=>x(null,"browser")}),e&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(zo,{isOpen:s,closeModal:()=>q(P.dashboard(e.id)),dashboardId:e.id,subscriptionId:d}),(0,i.jsx)(Lo,{title:"Dashboard permissions & sharing",isOpen:a==="sharing",closeModal:()=>q(P.dashboard(e.id)),dashboardId:e.id}),r&&(0,i.jsx)(_o,{isOpen:D,onClose:()=>q(P.dashboard(e.id)),dashboard:e,textTileId:h}),r&&(0,i.jsx)(Mo,{}),r&&(0,i.jsx)(Io,{})]}),(0,i.jsx)(wo,{buttons:a==="edit"?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(l,{"data-attr":"dashboard-edit-mode-discard",type:"secondary",onClick:()=>x(null,"dashboard_header_discard_changes"),tabIndex:9,children:"Cancel"}),(0,i.jsx)(l,{"data-attr":"dashboard-edit-mode-save",type:"primary",onClick:()=>x(null,"dashboard_header_save_dashboard"),tabIndex:10,disabledReason:t?"Wait for dashboard to finish loading":r?void 0:"Not privileged to edit this dashboard",children:"Save"})]}):a==="fullscreen"?(0,i.jsx)(l,{type:"secondary",onClick:()=>x(null,"dashboard_header_exit_fullscreen"),"data-attr":"dashboard-exit-presentation-mode",disabled:t,children:"Exit full screen"}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(so,{"data-attr":"dashboard-three-dots-options-menu",overlay:e?(0,i.jsxs)(i.Fragment,{children:[e.created_by&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("div",{className:"flex p-2 text-secondary",children:["Created by"," ",e.created_by.first_name||e.created_by.email||"-"," ","on ",Ye(e.created_at)]}),(0,i.jsx)(ce,{})]}),r&&(0,i.jsx)(l,{onClick:()=>x("edit","more_dropdown"),fullWidth:!0,children:"Edit layout (E)"}),(0,i.jsx)(l,{onClick:()=>x("fullscreen","more_dropdown"),fullWidth:!0,children:"Go full screen (F)"}),r&&(e.pinned?(0,i.jsx)(l,{onClick:()=>se(e.id,"more_dropdown"),fullWidth:!0,children:"Unpin dashboard"}):(0,i.jsx)(l,{onClick:()=>Me(e.id,"more_dropdown"),fullWidth:!0,children:"Pin dashboard"})),(0,i.jsx)(Go,{dashboardId:e.id}),(0,i.jsx)(fo,{fullWidth:!0,items:f}),K?.is_staff&&(0,i.jsx)(l,{onClick:()=>{k&&(Be(k),ne())},fullWidth:!0,children:"Save as template"}),(0,i.jsx)(ce,{}),(0,i.jsx)(l,{onClick:()=>{_e(e.id,e.name)},fullWidth:!0,children:"Duplicate dashboard"}),(0,i.jsx)(l,{onClick:()=>Ee(e),fullWidth:!0,children:"Create notebook from dashboard"}),r&&(0,i.jsx)(fe,{userAccessLevel:e.user_access_level,minAccessLevel:"editor",resourceType:"dashboard",onClick:()=>{He(e.id)},status:"danger",fullWidth:!0,children:"Delete dashboard"})]}):void 0}),(0,i.jsx)(ce,{vertical:!0}),e&&(0,i.jsxs)(i.Fragment,{children:[e.access_control_version==="v1"&&(0,i.jsx)(rt,{dashboard:e,onClick:()=>q(P.dashboardSharing(e.id))}),(0,i.jsx)(l,{type:"secondary","data-attr":"dashboard-share-button",onClick:()=>q(P.dashboardSharing(e.id)),children:"Share"})]}),e?(0,i.jsx)(fe,{userAccessLevel:e.user_access_level,minAccessLevel:"editor",resourceType:"dashboard",onClick:Ie,type:"primary","data-attr":"dashboard-add-graph-header",sideAction:{dropdown:{placement:"bottom-end",overlay:(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(fe,{userAccessLevel:e.user_access_level,minAccessLevel:"editor",resourceType:"dashboard",fullWidth:!0,onClick:()=>{q(P.dashboardTextTile(e.id,"new"))},"data-attr":"add-text-tile-to-dashboard",children:"Add text card"})})},disabled:!1,"data-attr":"dashboard-add-dropdown"},children:"Add insight"}):null]}),caption:(0,i.jsxs)(i.Fragment,{children:[e&&!!(r||e.description)&&(0,i.jsx)(ko,{multiline:!0,name:"description",markdown:!0,value:e.description,placeholder:"Description (optional)",onSave:S=>Ce({id:e.id,description:S,allowUndo:!0}),saveOnBlur:!0,compactButtons:!0,mode:r?void 0:"view"}),e?.tags&&(0,i.jsx)(i.Fragment,{children:r?(0,i.jsx)(Ae,{tags:e.tags,onChange:S=>y({tags:S}),saving:t,tagsAvailable:qe.filter(S=>!e.tags?.includes(S)),className:"mt-2"}):e.tags.length?(0,i.jsx)(Ae,{tags:e.tags,saving:t,staticOnly:!0,className:"mt-2"}):null})]}),delimited:!0}),(0,i.jsx)(Ko,{})]}):null}function rt({dashboard:e,onClick:t}){let{allCollaborators:a}=(0,C.useValues)(To({dashboardId:e.id}));if(!e)return null;let r=So[e.effective_restriction_level],s=[];return ro(r)&&typeof r?.title=="string"&&s.push(r.title),e.is_shared&&s.push("Shared publicly"),(0,i.jsx)(ue,{people:a.map(d=>({email:d.user.email,name:d.user.first_name,title:`${d.user.first_name} <${d.user.email}> (${Je[d.level]})`})),tooltip:s.join(" \u2022 "),onClick:t})}export{zo as a,Go as b,Mo as c,Io as d,Qo as e,re as f,Ko as g,Ti as h,Si as i};
//# sourceMappingURL=/static/chunk-HH2JRGNR.js.map
