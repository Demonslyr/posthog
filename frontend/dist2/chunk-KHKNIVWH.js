import{$a as P,Do as p,Io as D,Ko as f,Vd as c,Vo as M,a as A,dm as v,f as I,fm as L,jm as m,km as b,m as g}from"/static/chunk-RFJTZKD6.js";import{d as u,e as T,g as w,j as N}from"/static/chunk-SJXEOBQC.js";T();N();w();var o=u(A()),F=u(P()),l=u(I());var V={name:"",description:"",show:!1,useTemplate:"",restrictionLevel:21};function y(e,a,s){if(typeof e=="string"&&e.startsWith("{")&&e.endsWith("}")){let t=e.substring(1,e.length-1),d=a.find(i=>i.id===t);if(d&&d.default){let i=d.type==="event";if(s&&i){let h=3;return s==="TrendsQuery"?h=0:s==="StickinessQuery"?h=1:s==="FunnelsQuery"&&(h=2),s==="RetentionQuery"?L(d.default):v(d.default,!0,h)}return d.default}return e}if(Array.isArray(e))return e.map(t=>y(t,a,s));if(typeof e=="object"&&e!==null){let t={};for(let[d,i]of Object.entries(e))t[d]=y(i,a,s);return t}return e}function S(e,a){return e.map(s=>{let d="query"in s&&s.query!=null?M(s.query)?s.query?.source.kind:s.query?.kind:null;return y(s,a,d)})}var Y=(0,o.kea)([(0,o.props)({}),(0,o.key)(({featureFlagId:e})=>e??"new"),(0,o.path)(["scenes","dashboard","newDashboardLogic"]),(0,o.connect)({logic:[b],values:[g,["featureFlags"]]}),(0,o.actions)({setIsLoading:e=>({isLoading:e}),showNewDashboardModal:!0,showVariableSelectModal:e=>({template:e}),hideNewDashboardModal:!0,addDashboard:e=>({form:e}),setActiveDashboardTemplate:e=>({template:e}),clearActiveDashboardTemplate:!0,createDashboardFromTemplate:(e,a,s,t=null)=>({template:e,variables:a,redirectAfterCreation:s,creationContext:t}),submitNewDashboardSuccessWithResult:(e,a)=>({result:e,variables:a})}),(0,o.reducers)({isLoading:[!1,{setIsLoading:(e,{isLoading:a})=>a,hideNewDashboardModal:()=>!1,submitNewDashboardSuccess:()=>!1,submitNewDashboardFailure:()=>!1,clearActiveDashboardTemplate:()=>!1}],newDashboardModalVisible:[!1,{showNewDashboardModal:()=>!0,showVariableSelectModal:()=>!0,hideNewDashboardModal:()=>!1}],variableSelectModalVisible:[!1,{showVariableSelectModal:()=>!0,hideNewDashboardModal:()=>!1}],activeDashboardTemplate:[null,{setActiveDashboardTemplate:(e,{template:a})=>a,clearActiveDashboardTemplate:()=>null}]}),(0,F.forms)(({actions:e})=>({newDashboard:{defaults:V,errors:({name:a,restrictionLevel:s})=>({name:a?null:"Please give your dashboard a name.",restrictionLevel:s?null:"Restriction level needs to be specified."}),submit:async({name:a,description:s,useTemplate:t,restrictionLevel:d,show:i},h)=>{e.setIsLoading(!0);try{let r=await D.create(`api/environments/${f.values.currentTeamId}/dashboards/`,{name:a,description:s,use_template:t,restriction_level:d});e.hideNewDashboardModal(),e.resetNewDashboard();let n=m(r);n&&b.actions.addDashboardSuccess(n),e.submitNewDashboardSuccessWithResult(r),i&&(h(),l.router.actions.push(p.dashboard(r.id)))}catch(r){if(!(0,o.isBreakpoint)(r)){let n=r.code&&r.detail?`${r.code}: ${r.detail}`:r;c.error(`Could not create dashboard: ${n}`)}}e.setIsLoading(!1)}}})),(0,o.selectors)(({props:e})=>({isFeatureFlagDashboard:[()=>[],()=>e.featureFlagId]})),(0,o.listeners)(({actions:e})=>({addDashboard:({form:a})=>{e.resetNewDashboard(),e.setNewDashboardValues({...V,...a}),e.submitNewDashboard()},showNewDashboardModal:()=>{e.resetNewDashboard()},hideNewDashboardModal:()=>{e.clearActiveDashboardTemplate(),e.resetNewDashboard()},createDashboardFromTemplate:async({template:a,variables:s,redirectAfterCreation:t=!0,creationContext:d=null})=>{e.setIsLoading(!0);let i=S(a.tiles,s),h={...a,tiles:i};try{let r=await D.create(`api/environments/${f.values.currentTeamId}/dashboards/create_from_template_json`,{template:h,creation_context:d});e.hideNewDashboardModal(),e.resetNewDashboard();let n=m(r);n&&b.actions.addDashboardSuccess(n),e.submitNewDashboardSuccessWithResult(r,s),t&&l.router.actions.push(p.dashboard(r.id))}catch(r){if(!(0,o.isBreakpoint)(r)){let n=r.code&&r.detail?`${r.code}: ${r.detail}`:r;c.error(`Could not create dashboard: ${n}`)}}e.setIsLoading(!1)},showVariableSelectModal:({template:a})=>{e.setActiveDashboardTemplate(a)}})),(0,l.urlToAction)(({actions:e})=>({"/dashboard":(a,s,t)=>{"newDashboard"in t&&e.showNewDashboardModal()}})),(0,l.actionToUrl)({hideNewDashboardModal:()=>{let e=l.router.values.hashParams;return delete e.newDashboard,[l.router.values.location.pathname,l.router.values.searchParams,e]},showNewDashboardModal:()=>{let e=l.router.values.hashParams;return e.newDashboard="modal",[l.router.values.location.pathname,l.router.values.searchParams,e]}})]);export{Y as a};
//# sourceMappingURL=/static/chunk-KHKNIVWH.js.map
