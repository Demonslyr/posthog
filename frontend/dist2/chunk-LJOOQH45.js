import{a as w}from"/static/chunk-YYWKS7VJ.js";import{$a as k,Io as i,Vd as l,Za as g,a as y,f as T}from"/static/chunk-TW5IU73S.js";import{Z as u}from"/static/chunk-3UDJFOQH.js";import{d,e as n,g as c,j as p}from"/static/chunk-SJXEOBQC.js";n();p();c();var r=d(y()),R=d(k()),m=d(g()),f=d(T());var V=(0,r.kea)([(0,r.path)(["scenes","authentication","passwordResetLogic"]),(0,m.loaders)(()=>({validatedResetToken:[null,{validateResetToken:async({uuid:e,token:t})=>{try{return await i.get(`api/reset/${e}/?token=${t}`),{success:!0,token:t,uuid:e}}catch(s){return{success:!1,errorCode:s.code,errorDetail:s.detail}}}}]})),(0,r.reducers)({requestPasswordResetSucceeded:[!1,{submitRequestPasswordResetSuccess:()=>!0}],passwordResetSucceeded:[!1,{submitPasswordResetSuccess:()=>!0}]}),(0,R.forms)(({values:e,actions:t})=>({requestPasswordReset:{defaults:{},errors:({email:s})=>({email:s?void 0:"Please enter your email to continue"}),submit:async({email:s},o)=>{o();try{await i.create("api/reset/",{email:s})}catch(a){throw t.setRequestPasswordResetManualErrors({email:a.detail??"An error occurred"}),u("Failed to reset password",{extra:{error:a}}),a}}},passwordReset:{defaults:{},errors:({password:s,passwordConfirm:o})=>({password:s?e.validatedPassword.feedback:"Please enter your password to continue",passwordConfirm:o?s!==o?"Passwords do not match":void 0:"Please confirm your password to continue"}),submit:async({password:s},o)=>{if(await o(150),!(!e.validatedResetToken?.token||!e.validatedResetToken.uuid))try{await i.create(`api/reset/${e.validatedResetToken.uuid}/`,{password:s,token:e.validatedResetToken.token}),l.success("Your password has been changed. Redirecting\u2026"),await o(3e3),window.location.href="/"}catch(a){throw t.setPasswordResetManualErrors({password:a.detail}),a}}}})),(0,r.selectors)({validatedPassword:[e=>[e.passwordReset],({password:e})=>w(e)]}),(0,f.urlToAction)(({actions:e})=>({"/reset/:uuid/:token":({uuid:t,token:s})=>{s&&t&&e.validateResetToken({uuid:t,token:s})}}))]);export{V as a};
//# sourceMappingURL=/static/chunk-LJOOQH45.js.map
