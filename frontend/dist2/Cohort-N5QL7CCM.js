import{j as de}from"/static/chunk-CBJ7RAUW.js";import"/static/chunk-XSEDUXPL.js";import"/static/chunk-NKVVAJQ7.js";import"/static/chunk-2HTNY362.js";import"/static/chunk-S27Q4QO6.js";import"/static/chunk-JUFFFVO5.js";import"/static/chunk-JZCOVRBI.js";import"/static/chunk-EIJECEWK.js";import{$a as O,Ag as te,Ce as oe,Db as A,Do as b,Gm as me,Hh as x,Ih as ae,Nh as ie,Oh as le,Ok as J,Qd as P,Sa as D,Sd as c,Ta as j,Tc as k,Tf as C,Wd as X,Xi as ce,_a as xe,a as B,ch as re,da as H,ee as f,f as We,ge as K,h as Ce,ie as q,je as I,pe as $,r as N,se as W,ta as U,td as _,tk as ne,ve as ee,vo as se,zg as S}from"/static/chunk-RFJTZKD6.js";import"/static/chunk-XPJ4MQJV.js";import"/static/chunk-KQJ3FYBQ.js";import{Tb as M,Xb as z}from"/static/chunk-3UDJFOQH.js";import"/static/chunk-HHT4SG7V.js";import"/static/chunk-K7LQKAJG.js";import"/static/chunk-QQTK3LZH.js";import"/static/chunk-IJQNM355.js";import"/static/chunk-4CN6THWS.js";import"/static/chunk-272RTCFX.js";import"/static/chunk-2ROB4QWU.js";import"/static/chunk-ALT2ZZSO.js";import"/static/chunk-UE6SLBBN.js";import"/static/chunk-GINZUAUY.js";import"/static/chunk-SQELCOUW.js";import"/static/chunk-IGYUTZ65.js";import"/static/chunk-YM6UBNGD.js";import"/static/chunk-C6TQ5FFZ.js";import"/static/chunk-GXGA523B.js";import"/static/chunk-N4MMWRNK.js";import"/static/chunk-NRLAI7OY.js";import"/static/chunk-LVVHNICT.js";import"/static/chunk-2AXSSSSX.js";import"/static/chunk-DGXQI7RB.js";import"/static/chunk-HUCRWDLX.js";import"/static/chunk-RFEQG3YN.js";import"/static/chunk-PUISI233.js";import{d as a,e as d,g as p,j as h}from"/static/chunk-SJXEOBQC.js";d();h();p();d();h();p();var R=a(B()),ye=a(O()),Ne=a(We());d();h();p();var pe=a(Ce()),G=a(B()),w=a(O()),he=a(xe());var t=a(N());function ue(r){let i=x(r),{cohort:u}=(0,G.useValues)(i),{setInnerGroupType:V,duplicateFilter:F,removeFilter:Z,addFilter:g}=(0,G.useActions)(i);return(0,t.jsxs)(t.Fragment,{children:[u.filters.properties.values.map((o,l)=>S(o)?(0,t.jsxs)(w.Group,{name:["filters","properties","values",l],children:[l!==0&&(0,t.jsx)("div",{className:"CohortCriteriaGroups__matching-group__logical-divider",children:u.filters.properties.type}),(0,t.jsx)(he.Field,{name:"id",template:({error:m,kids:s})=>(0,t.jsxs)("div",{className:(0,pe.default)("CohortCriteriaGroups__matching-group",m&&"CohortCriteriaGroups__matching-group--error"),children:[(0,t.jsxs)("div",{className:"flex flex-nowrap items-center px-4",children:[(0,t.jsx)(ce,{name:z[l],color:"gray"}),(0,t.jsx)(J,{prefix:"Match persons against",suffix:["criterion","criteria"],onChange:L=>V(L,l),value:o.type}),(0,t.jsx)("div",{className:"flex-1 min-w-[0.5rem]"}),(0,t.jsx)(c,{icon:(0,t.jsx)(A,{}),onClick:()=>F(l)}),u.filters.properties.values.length>1&&(0,t.jsx)(c,{icon:(0,t.jsx)(_,{}),onClick:()=>Z(l)})]}),(0,t.jsx)(f,{className:"my-4"}),m&&(0,t.jsx)(X,{className:"m-2",type:"error",children:m}),s]}),children:(0,t.jsx)(t.Fragment,{children:o.values.map((m,s)=>S(m)?null:(0,t.jsxs)(w.Group,{name:["values",s],children:[(0,t.jsx)(ae,{id:r.id,groupIndex:l,index:s,logicalOperator:o.type,criteria:m,type:te(m),hideDeleteIcon:o.values.length<=1}),s===o.values.length-1&&(0,t.jsx)("div",{className:"m-3",children:(0,t.jsx)(c,{"data-attr":"cohort-add-filter-group-criteria",type:"secondary",onClick:()=>g(l),icon:(0,t.jsx)(k,{color:"var(--accent-primary)"}),children:"Add criteria"})})]},s))})})]},l):null),(0,t.jsx)(c,{"data-attr":"cohort-add-filter-group",className:"mb-4 mt-4",type:"secondary",onClick:()=>g(),icon:(0,t.jsx)(k,{color:"var(--accent-primary)"}),fullWidth:!0,children:"Add criteria group"})]})}var e=a(N());function fe({id:r}){let i={id:r},u=x(i),{deleteCohort:V,setOuterGroupsType:F,setQuery:Z,duplicateCohort:g}=(0,R.useActions)(u),{cohort:o,cohortLoading:l,cohortMissing:m,query:s,duplicatedCohortLoading:L}=(0,R.useValues)(u),y=o.id==="new"||o.id===void 0;return m?(0,e.jsx)(me,{object:"cohort"}):l?(0,e.jsxs)("div",{className:"space-y-2",children:[(0,e.jsx)(W,{active:!0,className:"h-4 w-2/5"}),(0,e.jsx)(W,{active:!0,className:"h-4 w-full"}),(0,e.jsx)(W,{active:!0,className:"h-4 w-full"}),(0,e.jsx)(W,{active:!0,className:"h-4 w-3/5"})]}):(0,e.jsx)("div",{className:"cohort",children:(0,e.jsxs)(ye.Form,{id:"cohort",logic:x,props:i,formKey:"cohort",enableFormOnSubmit:!0,children:[(0,e.jsx)(se,{buttons:(0,e.jsxs)("div",{className:"flex items-center gap-2",children:[y?(0,e.jsx)(c,{"data-attr":"cancel-cohort",type:"secondary",onClick:()=>{Ne.router.actions.push(b.cohorts())},disabled:l,children:"Cancel"}):(0,e.jsx)(ee,{overlay:(0,e.jsxs)(e.Fragment,{children:[!o.is_static&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(c,{onClick:()=>g(!1),fullWidth:!0,disabledReason:o.is_calculating?"Cohort is still calculating":void 0,loading:L,children:"Duplicate as dynamic cohort"}),(0,e.jsx)(c,{onClick:()=>g(!0),fullWidth:!0,disabledReason:o.is_calculating?"Cohort is still calculating":void 0,loading:L,children:"Duplicate as static cohort"}),(0,e.jsx)(f,{})]}),(0,e.jsx)(c,{"data-attr":"delete-cohort",fullWidth:!0,status:"danger",onClick:V,children:"Delete cohort"})]})}),!y&&(0,e.jsx)(ne,{type:"secondary",resource:{type:"ph-cohort",attrs:{id:r}}}),(0,e.jsx)(c,{type:"primary","data-attr":"save-cohort",htmlType:"submit",loading:l||o.is_calculating,form:"cohort",children:"Save"})]})}),(0,e.jsxs)("div",{className:"space-y-2 max-w-200",children:[(0,e.jsxs)("div",{className:"flex gap-4 flex-wrap",children:[(0,e.jsx)("div",{className:"flex-1",children:(0,e.jsx)(C,{name:"name",label:"Name",children:(0,e.jsx)(q,{"data-attr":"cohort-name"})})}),(0,e.jsx)("div",{className:"flex-1",children:(0,e.jsx)(C,{name:"is_static",label:"Type",children:({value:v,onChange:Y})=>(0,e.jsx)($,{disabledReason:y?null:"Create a new cohort to use a different type of cohort.",options:ie,value:v?"static":"dynamic",onChange:ve=>{Y(ve==="static")},fullWidth:!0,"data-attr":"cohort-type"})})}),!y&&!o?.is_static&&(0,e.jsx)("div",{className:"max-w-70 w-fit",children:(0,e.jsxs)("div",{className:"flex gap-1 flex-col",children:[(0,e.jsx)(I,{children:"Last calculated"}),o.is_calculating?(0,e.jsx)("div",{className:"text-s",children:"In progress..."}):o.last_calculation?(0,e.jsxs)("div",{className:"flex flex-1 flex-row gap-1",children:[(0,e.jsx)(re,{time:o.last_calculation}),o.errors_calculating?(0,e.jsx)(D,{title:"The last attempted calculation failed. This means your current cohort data can be stale. This doesn't affect feature flag evaluation.",children:(0,e.jsx)("div",{className:"text-danger",children:(0,e.jsx)(H,{className:"text-danger text-xl shrink-0"})})}):null]}):(0,e.jsx)("div",{className:"text-s",children:"Not yet calculated"}),(0,e.jsx)("div",{className:"text-secondary text-xs",children:"Cohorts are recalculated every 24 hours"})]})})]}),(0,e.jsx)("div",{className:"ph-ignore-input",children:(0,e.jsx)(C,{name:"description",label:"Description","data-attr":"cohort-description",children:(0,e.jsx)(oe,{})})})]}),o.is_static?(0,e.jsx)("div",{className:"mt-4 ph-ignore-input",children:(0,e.jsx)(C,{name:"csv",label:y?"Upload users":"Add users","data-attr":"cohort-csv",children:({onChange:v})=>(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("span",{children:"Upload a CSV file to add users to your cohort. The CSV file only requires a single column with the user\u2019s distinct ID. The very first row (the header) will be skipped during import."}),(0,e.jsx)(K,{accept:".csv",multiple:!1,value:o.csv?[o.csv]:[],onChange:Y=>v(Y[0]),showUploadedFiles:!1,callToAction:(0,e.jsx)("div",{className:"flex flex-col items-center justify-center flex-1 cohort-csv-dragger text-text-3000 space-y-1",children:o.csv?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(U,{style:{fontSize:"3rem",color:"var(--text-secondary)"}}),(0,e.jsx)("div",{children:o.csv?.name??"File chosen"})]}):(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(U,{style:{fontSize:"3rem",color:"var(--text-secondary)"}}),(0,e.jsx)("div",{children:"Drag a file here or click to browse for a file"})]})})})]})})}):(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(f,{className:"my-6"}),!y&&o.experiment_set&&o.experiment_set.length>0&&(0,e.jsxs)(X,{type:"info",children:["This cohort manages exposure for an experiment. Editing this cohort may change experiment metrics. If unsure,"," ",(0,e.jsx)(j,{to:b.experiment(o.experiment_set[0]),children:"check the experiment details."})]}),(0,e.jsxs)("div",{className:"flex items-center justify-between my-4",children:[(0,e.jsxs)("div",{className:"flex flex-col",children:[(0,e.jsx)(I,{htmlFor:"groups",children:"Matching criteria"}),(0,e.jsx)("span",{children:"Actors who match the following criteria will be part of the cohort. Continuously updated automatically."})]}),(0,e.jsx)(J,{value:o.filters.properties.type,onChange:v=>{F(v)},topLevelFilter:!0,suffix:["criterion","criteria"]})]}),(0,e.jsx)(ue,{id:i.id})]}),typeof o.id=="number"&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(f,{className:"my-6"}),(0,e.jsxs)("div",{children:[(0,e.jsxs)("h3",{className:"l3 mb-4",children:["Persons in this cohort",(0,e.jsx)("span",{className:"text-secondary ml-2",children:!o.is_calculating&&`(${o.count} matching ${M(o.count??0,"person","persons",!1)})`})]}),o.is_calculating?(0,e.jsxs)("div",{className:"cohort-recalculating flex items-center",children:[(0,e.jsx)(P,{className:"mr-4"}),"We're recalculating who belongs to this cohort. This could take up to a couple of minutes."]}):(0,e.jsx)(de,{query:s,setQuery:Z,context:{alwaysRefresh:!0}})]})]})]})})}d();h();p();var n=a(B());var be=(0,n.kea)([(0,n.props)({}),(0,n.key)(r=>r.id||"new"),(0,n.path)(["scenes","cohorts","cohortLogic"]),(0,n.selectors)({breadcrumbs:[()=>[le.selectors.cohortsById,(r,i)=>i.id],(r,i)=>[{key:"PersonsManagement",name:"People",path:b.persons()},{key:"cohorts",name:"Cohorts",path:b.cohorts()},{key:["Cohort",i||"loading"],name:i&&i!=="new"&&r[i]?.name||"Untitled"}]]})]);var ge=a(N()),Zo={component:Le,logic:be,paramsToProps:({params:{id:r}})=>({id:r&&r!=="new"?parseInt(r):"new"})};function Le({id:r}={}){return(0,ge.jsx)(fe,{id:r})}export{Le as Cohort,Zo as scene};
//# sourceMappingURL=/static/Cohort-N5QL7CCM.js.map
