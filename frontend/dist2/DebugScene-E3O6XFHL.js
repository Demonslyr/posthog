import{a as ne,g as me,j as q}from"/static/chunk-CBJ7RAUW.js";import"/static/chunk-XSEDUXPL.js";import{a as re,e as ae,h as le,i as se}from"/static/chunk-NKVVAJQ7.js";import{a as ie,b as te}from"/static/chunk-2HTNY362.js";import"/static/chunk-S27Q4QO6.js";import"/static/chunk-JUFFFVO5.js";import"/static/chunk-JZCOVRBI.js";import"/static/chunk-EIJECEWK.js";import{Ae as Z,Do as D,Hg as x,Oe as A,Pl as ee,Sd as T,So as I,Vo as R,Wh as S,Wo as ue,Xo as de,a as P,ee as Y,f as Le,fe as B,fi as F,je as L,kp as ge,m as K,pe as h,r as Q,uf as f,vo as oe,ze as W}from"/static/chunk-RFJTZKD6.js";import"/static/chunk-XPJ4MQJV.js";import"/static/chunk-KQJ3FYBQ.js";import{F as U,a as Qe}from"/static/chunk-3UDJFOQH.js";import"/static/chunk-HHT4SG7V.js";import"/static/chunk-K7LQKAJG.js";import"/static/chunk-QQTK3LZH.js";import"/static/chunk-IJQNM355.js";import"/static/chunk-4CN6THWS.js";import"/static/chunk-272RTCFX.js";import"/static/chunk-2ROB4QWU.js";import"/static/chunk-ALT2ZZSO.js";import"/static/chunk-UE6SLBBN.js";import"/static/chunk-GINZUAUY.js";import"/static/chunk-SQELCOUW.js";import"/static/chunk-IGYUTZ65.js";import"/static/chunk-YM6UBNGD.js";import"/static/chunk-C6TQ5FFZ.js";import"/static/chunk-GXGA523B.js";import"/static/chunk-N4MMWRNK.js";import"/static/chunk-NRLAI7OY.js";import"/static/chunk-LVVHNICT.js";import"/static/chunk-2AXSSSSX.js";import"/static/chunk-DGXQI7RB.js";import"/static/chunk-HUCRWDLX.js";import"/static/chunk-RFEQG3YN.js";import"/static/chunk-PUISI233.js";import{d,e as g,g as p,j as c}from"/static/chunk-SJXEOBQC.js";g();c();p();var k=d(P());g();c();p();var be=d(P());g();c();p();var V=d(P());g();c();p();var s=d(Q());function w({setQuery:i,query:o,response:r=null}){if(o===null)return null;let e="flex flex-col gap-1 items-start";return(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsxs)(L,{className:e,children:[(0,s.jsx)("div",{children:"POE:"}),(0,s.jsx)(h,{options:[{value:"disabled",label:"Disabled"},{value:"person_id_no_override_properties_on_events",label:"Properties: Events, Person ID: Events"},{value:"person_id_override_properties_on_events",label:"Properties: Events, Person ID: Overrides (v2)"},{value:"person_id_override_properties_joined",label:"Properties: Person, Person ID: Overrides (v3)"}],onChange:n=>i({...o,modifiers:{...o.modifiers,personsOnEventsMode:n}}),value:o.modifiers?.personsOnEventsMode??r?.modifiers?.personsOnEventsMode})]}),(0,s.jsxs)(L,{className:e,children:[(0,s.jsx)("div",{children:"Persons ArgMax:"}),(0,s.jsx)(h,{options:[{value:"v1",label:"V1"},{value:"v2",label:"V2"}],onChange:n=>i({...o,modifiers:{...o.modifiers,personsArgMaxVersion:n}}),value:o.modifiers?.personsArgMaxVersion??r?.modifiers?.personsArgMaxVersion})]}),(0,s.jsxs)(L,{className:e,children:[(0,s.jsx)("div",{children:"In Cohort Via:"}),(0,s.jsx)(h,{options:[{value:"auto",label:"auto"},{value:"leftjoin",label:"leftjoin"},{value:"subquery",label:"subquery"},{value:"leftjoin_conjoined",label:"leftjoin conjoined"}],onChange:n=>i({...o,modifiers:{...o.modifiers,inCohortVia:n}}),value:o.modifiers?.inCohortVia??r?.modifiers?.inCohortVia})]}),(0,s.jsxs)(L,{className:e,children:[(0,s.jsx)("div",{children:"Materialization Mode:"}),(0,s.jsx)(h,{options:[{value:"auto",label:"auto"},{value:"legacy_null_as_string",label:"legacy_null_as_string"},{value:"legacy_null_as_null",label:"legacy_null_as_null"},{value:"disabled",label:"disabled"}],onChange:n=>i({...o,modifiers:{...o.modifiers,materializationMode:n}}),value:o.modifiers?.materializationMode??r?.modifiers?.materializationMode})]}),(0,s.jsxs)(L,{className:e,children:[(0,s.jsx)("div",{children:"Optimize joined filters:"}),(0,s.jsx)(h,{options:[{value:!0,label:"true"},{value:!1,label:"false"}],onChange:n=>i({...o,modifiers:{...o.modifiers,optimizeJoinedFilters:n}}),value:o.modifiers?.optimizeJoinedFilters??r?.modifiers?.optimizeJoinedFilters})]}),(0,s.jsxs)(L,{className:e,children:[(0,s.jsx)("div",{children:"Property Groups:"}),(0,s.jsx)(h,{options:[{value:"enabled",label:"Enabled"},{value:"disabled",label:"Disabled"},{value:"optimized",label:"Enabled, with Optimizations"}],onChange:n=>i({...o,modifiers:{...o.modifiers,propertyGroupsMode:n}}),value:o.modifiers?.propertyGroupsMode??r?.modifiers?.propertyGroupsMode})]})]})}g();c();p();var pe=d(Qe());var a=d(Q());function ce(i,o){let r=i.split(`
`),e=0,n=0;for(let l=0;l<r.length;l++){if(o<r[l].length){e=l+1,n=o+1;break}o-=r[l].length+1}return{line:e,column:n}}function j(i,o){return ce(i,o).line}function $(i,o){return ce(i,o).column}function O({query:i,queryKey:o,setQuery:r,response:e}){let[n,l]=(0,pe.useState)(null),v=e?.timings?.find(({k:t})=>t==="./clickhouse_execute")?.t??0,M=e?.timings?.find(({k:t})=>t==="./explain")?.t??0,X=(e?.timings?.find(({k:t})=>t===".")?.t??0)-M-v,C=i?[e?.error&&{key:"error",label:"Error",content:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("h2",{className:"text-danger",children:"Error Running Query!"}),(0,a.jsx)(A,{language:"text",wrap:!0,children:e.error})]})},R(i)&&{key:"viz",label:"Visualization",content:(0,a.jsx)(q,{uniqueKey:o,query:i,setQuery:t=>r(t),context:{insightProps:{dashboardItemId:o,query:i,setQuery:t=>r(t),dataNodeCollectionId:o}}})},ge(i)&&{key:"insight",label:"Insight",content:(0,a.jsx)(q,{uniqueKey:o,query:{kind:"InsightVizNode",source:i,full:!0},setQuery:t=>r(t)})},I(i)&&{key:"table",label:"Data Table",content:(0,a.jsx)(q,{uniqueKey:o,query:i,setQuery:t=>r(t)})},(e?.result||e?.results)&&{key:"result",label:"Result JSON",content:(0,a.jsx)(x,{className:"border",language:"json",value:JSON.stringify(e?.result||e?.results,null,2),height:500,path:`debug/${o}/result.json`})},e?.hogql&&{key:"hogql",label:(0,a.jsxs)(a.Fragment,{children:["HogQL",X&&(0,a.jsxs)(B,{className:"ml-2",children:[Math.floor(X*10)/10,"s"]})]}),content:(0,a.jsx)(x,{className:"border",language:"sql",value:String(e.hogql),height:500,path:`debug/${o}/hogql.sql`})},e?.clickhouse&&{key:"clickhouse",label:(0,a.jsxs)(a.Fragment,{children:["Clickhouse",v&&(0,a.jsxs)(B,{className:"ml-2",children:[Math.floor(v*10)/10,"s"]})]}),content:(0,a.jsx)(x,{className:"border",language:"sql",value:String(e.clickhouse),height:500,path:`debug/${o}/hogql.sql`})},e?.explain&&{key:"explain",label:"Explain",content:(0,a.jsx)(A,{wrap:!0,children:e.explain.join(`
`)})},e?.timings&&{key:"timings",label:"Timings",content:(0,a.jsx)(ie,{timings:e?.timings,elapsedTime:e?.elapsedTime})},e&&{key:"response",label:"Full response",content:(0,a.jsx)(x,{className:"border",language:"json",value:JSON.stringify(e,null,2),height:500,path:`debug/${o}/response.json`})},e?.metadata&&{key:"metadata",label:"Metadata",content:(0,a.jsx)(W,{dataSource:[...e.metadata.errors.map(t=>({type:"error",line:j(e.hogql??"",t.start??0),column:$(e.hogql??"",t.start??0),...t})),...e.metadata.warnings.map(t=>({type:"warning",line:j(e.hogql??"",t.start??0),column:$(e.hogql??"",t.start??0),...t})),...e.metadata.notices.map(t=>({type:"notice",line:j(e.hogql??"",t.start??0),column:$(e.hogql??"",t.start??0),...t}))].sort((t,ve)=>(t.start??0)-(ve.start??0)),columns:[{title:"Line",dataIndex:"line",key:"line",width:"40px"},{title:"Column",dataIndex:"column",key:"column",width:"40px"},{title:"Type",dataIndex:"type",key:"type",width:"80px"},{title:"Message",dataIndex:"message",key:"message"}]})}].filter(Boolean).map(t=>({...t,content:(0,a.jsx)(F,{children:t.content})})):[];return(0,a.jsx)(F,{children:(0,a.jsx)(Z,{activeKey:n&&C.find(t=>t&&t.key===n)?n:C[0]&&C[0].key||"response",onChange:t=>l(t),tabs:C})})}var m=d(Q());function fe({query:i,setQuery:o,queryKey:r}){let e={query:i,key:r,dataNodeCollectionId:r},{dataLoading:n,response:l}=(0,V.useValues)(S(e)),v=l;return(0,m.jsx)(V.BindLogic,{logic:S,props:e,children:(0,m.jsxs)("div",{className:"space-y-2",children:[(0,m.jsx)(se,{query:i,setQuery:o}),(0,m.jsx)(w,{setQuery:o,query:i,response:v}),(0,m.jsx)(Y,{className:"my-4"}),(0,m.jsxs)("div",{className:"flex flex-wrap gap-2 ",children:[(0,m.jsx)(re,{}),(0,m.jsx)(ae,{query:i,setQuery:o},"date-range"),(0,m.jsx)(le,{query:i,setQuery:o},"event-property")]}),n?(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)("h2",{children:"Running query..."}),(0,m.jsxs)("div",{className:"flex",children:["Time elapsed:\xA0",(0,m.jsx)(te,{})]})]}):(0,m.jsx)(m.Fragment,{children:(0,m.jsx)(O,{query:i,response:v,setQuery:o,queryKey:r})})]})})}var y=d(Q());function G({query:i,setQuery:o,queryKey:r}){let e=null;try{e=JSON.parse(i)}catch{}let n=e&&(R(e)||I(e))?e.source:e,l=ee({dashboardItemId:r}),v={query:n,key:l,dataNodeCollectionId:r,modifiers:{debug:!0}},{response:M}=(0,be.useValues)(S(v));return(0,y.jsx)(y.Fragment,{children:ue(e)?(0,y.jsx)(ne,{queryKey:r,query:e,setQuery:b=>o(JSON.stringify(b,null,2)),debug:!0}):de(e)?(0,y.jsx)(fe,{queryKey:r,query:e,setQuery:b=>o(JSON.stringify(b,null,2))}):(0,y.jsxs)("div",{className:"space-y-4",children:[(0,y.jsx)(me,{query:i,setQuery:o,aboveButton:(0,y.jsx)(w,{setQuery:e&&"source"in e&&e?.source?b=>o(JSON.stringify({...e,source:b},null,2)):b=>o(JSON.stringify(b,null,2)),query:e?.source??e,response:M})}),e?(0,y.jsx)(O,{query:e,queryKey:r,response:M,setQuery:b=>o(JSON.stringify(b,null,2))}):null]})})}g();c();p();var N=d(P()),z=d(Le());var ye=f.HogQLRaw,J=(0,N.kea)([(0,N.path)(["scenes","query","debugSceneLogic"]),(0,N.actions)({setQuery1:i=>({query:i}),setQuery2:i=>({query:i})}),(0,N.reducers)({query1:[ye,{setQuery1:(i,{query:o})=>o}],query2:[ye,{setQuery2:(i,{query:o})=>o}]}),(0,z.actionToUrl)(({values:i})=>({setQuery1:({query:o})=>[D.debugQuery(),{},{q:o,...i.query2?{q2:i.query2}:{}},{replace:!0}],setQuery2:()=>[D.debugQuery(),{},{q:i.query1,q2:i.query2},{replace:!0}]})),(0,z.urlToAction)(({actions:i,values:o})=>({[D.debugQuery()]:(r,e,{q:n,q2:l})=>{n&&n!==o.query1&&i.setQuery1(n),(l??"")!==(o.query2??"")&&i.setQuery2(l??"")}}))]);var u=d(Q());function he(){let{query1:i,query2:o}=(0,k.useValues)(J),{setQuery1:r,setQuery2:e}=(0,k.useActions)(J),{featureFlags:n}=(0,k.useValues)(K);return(0,u.jsxs)("div",{className:"QueryScene",children:[(0,u.jsx)(oe,{buttons:(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(T,{active:!!o,onClick:()=>e(o?"":i),children:"Split"}),(0,u.jsx)(T,{active:i===f.HogQLRaw,onClick:()=>r(f.HogQLRaw),children:"HogQL Debug"}),n[U.HOG]?(0,u.jsx)(T,{active:i===f.Hoggonacci,onClick:()=>r(f.Hoggonacci),children:"Hog"}):null,(0,u.jsx)(T,{active:i===f.HogQLTable,onClick:()=>r(f.HogQLTable),children:"HogQL Table"}),(0,u.jsx)(T,{active:i===f.Events,onClick:()=>r(f.Events),children:"Any Query"}),(0,u.jsx)(L,{children:(0,u.jsx)(h,{placeholder:"More sample queries",options:Object.entries(f).filter(([l])=>l!=="HogQLTable"&&l!=="HogQLRaw").map(([l,v])=>({label:l,value:v})),onChange:l=>{l&&r(l)}})})]})}),(0,u.jsxs)("div",{className:"flex gap-2",children:[(0,u.jsx)("div",{className:"flex-1 w-1/2",children:(0,u.jsx)(G,{query:i,setQuery:r,queryKey:"new-hogql-debug-1"})}),o?(0,u.jsx)("div",{className:"flex-1 w-1/2",children:(0,u.jsx)(G,{query:o,setQuery:e,queryKey:"new-hogql-debug-2"})}):null]})]})}var Oo={component:he,logic:J};export{he as DebugScene,Oo as scene};
//# sourceMappingURL=/static/DebugScene-E3O6XFHL.js.map
