import{a as Be,e as fo}from"/static/chunk-U2E536M4.js";import"/static/chunk-T4JH5FGK.js";import"/static/chunk-E5EBD4YF.js";import"/static/chunk-COOXGJAW.js";import"/static/chunk-TKAGNC63.js";import"/static/chunk-YYWKS7VJ.js";import"/static/chunk-DKBGYLEK.js";import"/static/chunk-ZH744EYW.js";import"/static/chunk-ERJU6QDI.js";import"/static/chunk-ZXSHFYOF.js";import"/static/chunk-V3PKUTU3.js";import"/static/chunk-EHZHZ2BZ.js";import"/static/chunk-2FBI7JAD.js";import"/static/chunk-M7JKKBGY.js";import"/static/chunk-QWUPOSXD.js";import"/static/chunk-NEPY3GOZ.js";import"/static/chunk-NDVJEFKZ.js";import{a as Pe}from"/static/chunk-BKGCJ5HZ.js";import"/static/chunk-WLM24SYZ.js";import"/static/chunk-I3JBH3PJ.js";import"/static/chunk-TUL3J7MM.js";import"/static/chunk-NXYRANZE.js";import"/static/chunk-R6LTNABA.js";import"/static/chunk-4ZIAUDQ2.js";import"/static/chunk-CIEHRPUV.js";import"/static/chunk-EPKEVOQ3.js";import"/static/chunk-RKCB37WE.js";import"/static/chunk-7Q4UL5YB.js";import"/static/chunk-DT27PZCF.js";import"/static/chunk-YCSVRBIX.js";import"/static/chunk-O3CE2WEF.js";import"/static/chunk-YQMOJ6SF.js";import"/static/chunk-KBW4LJ4R.js";import"/static/chunk-2BLYB5CU.js";import"/static/chunk-6BOQTIB6.js";import"/static/chunk-DWEVWBHF.js";import{a as Ne}from"/static/chunk-DT53MXPZ.js";import"/static/chunk-5QZ3UKWA.js";import{a as Ae,b as _e}from"/static/chunk-HH2JRGNR.js";import"/static/chunk-ONXXPKL4.js";import"/static/chunk-67FTXEWX.js";import"/static/chunk-QUCOEN55.js";import"/static/chunk-G6Q3YRDS.js";import{a as Ce}from"/static/chunk-FZRQH23Q.js";import"/static/chunk-FL4TLK7Q.js";import"/static/chunk-YHRI2AZY.js";import"/static/chunk-VB6FMIJU.js";import"/static/chunk-K6PZB6NF.js";import"/static/chunk-TIKFJXRT.js";import"/static/chunk-KYJ4OXJI.js";import"/static/chunk-KYV72GAC.js";import"/static/chunk-OXUIEO32.js";import{a as pe}from"/static/chunk-SEJ4C6TB.js";import"/static/chunk-AZNOCCXL.js";import"/static/chunk-KRWBS22W.js";import"/static/chunk-OFFTP67N.js";import"/static/chunk-Q2TQBXTL.js";import"/static/chunk-WTEAZEML.js";import"/static/chunk-TBYU2GKH.js";import"/static/chunk-WNE4BY7V.js";import{b as ue,c as be,g as ye,i as Bo}from"/static/chunk-QYIJYWV3.js";import{a as No}from"/static/chunk-EWYESSII.js";import{a as fe}from"/static/chunk-DJ5KSU5H.js";import"/static/chunk-QNYERZG7.js";import"/static/chunk-MOVKLCV5.js";import"/static/chunk-FT4MFWRB.js";import{j as ge}from"/static/chunk-YDKHEMDP.js";import"/static/chunk-7SO55T25.js";import"/static/chunk-HRNZBUVG.js";import"/static/chunk-Y35PDO57.js";import"/static/chunk-KBNOIM2W.js";import"/static/chunk-BB32DDTD.js";import"/static/chunk-QB3AUFV2.js";import"/static/chunk-PWG7LMNW.js";import"/static/chunk-CEZSENEJ.js";import"/static/chunk-GOBPXP3Z.js";import{$h as M,Ae as Yo,Cg as _o,Do as I,Eo as Ie,Gm as me,Hb as Jo,Ig as te,Ip as Te,Kl as ae,Ko as Le,Ll as K,Nn as he,No as ve,Pk as ne,Rh as Y,Sa as co,Sd as g,Sl as de,So as Se,Ta as po,Tf as Zo,Tl as $,To as xo,Vd as Co,Vo as Z,Wd as q,Wl as k,Xd as Ao,Xl as L,Xo as uo,_l as le,a as P,ac as Uo,af as Ko,b as mo,bp as De,ce as Xo,cj as ie,cp as Eo,de as qo,dp as we,ee as z,ef as $o,f as wo,gh as se,h as at,hg as jo,ie as go,kb as Ho,km as J,m as so,mg as oe,og as ee,r as p,re as zo,se as G,tk as re,vd as To,ve as Go,vo as ce,xl as Po,y as ho}from"/static/chunk-TW5IU73S.js";import"/static/chunk-XPJ4MQJV.js";import"/static/chunk-KQJ3FYBQ.js";import{F as to,Tb as Wo,Wa as H,a as nt,yb as Vo}from"/static/chunk-3UDJFOQH.js";import"/static/chunk-HHT4SG7V.js";import"/static/chunk-K7LQKAJG.js";import"/static/chunk-QQTK3LZH.js";import"/static/chunk-IJQNM355.js";import"/static/chunk-4CN6THWS.js";import"/static/chunk-272RTCFX.js";import"/static/chunk-2ROB4QWU.js";import"/static/chunk-ALT2ZZSO.js";import"/static/chunk-UE6SLBBN.js";import"/static/chunk-GINZUAUY.js";import"/static/chunk-SQELCOUW.js";import"/static/chunk-IGYUTZ65.js";import"/static/chunk-YM6UBNGD.js";import"/static/chunk-C6TQ5FFZ.js";import"/static/chunk-GXGA523B.js";import"/static/chunk-N4MMWRNK.js";import"/static/chunk-NRLAI7OY.js";import"/static/chunk-LVVHNICT.js";import"/static/chunk-2AXSSSSX.js";import"/static/chunk-DGXQI7RB.js";import"/static/chunk-HUCRWDLX.js";import"/static/chunk-RFEQG3YN.js";import"/static/chunk-PUISI233.js";import{d as n,e as a,g as d,j as l}from"/static/chunk-SJXEOBQC.js";a();l();d();var Ye=n(P());a();l();d();var E=n(P());a();l();d();var y=n(P()),Fo=n(wo());a();l();d();var xe=n(P());var io=n(p());function Ee({insight:o,setOpenModal:e}){let{rawDashboards:t}=(0,xe.useValues)(J),r=o.dashboard_tiles?.map(m=>t[m.dashboard_id]).filter(m=>!!m)||[];return(0,io.jsx)("span",{className:"save-to-dashboard","data-attr":"save-to-dashboard-button",children:(0,io.jsx)(g,{onClick:()=>e(!0),type:"secondary",icon:(0,io.jsx)(ho,{count:r.length,showZero:!1,children:(0,io.jsx)(Jo,{})}),tooltip:r.length===0?"Add to dashboard":"Manage dashboards",children:"Dashboards"})})}a();l();d();var Me=n(at()),U=n(P());a();l();d();var b=n(P()),Fe=n(wo());var bo=(0,b.kea)([(0,b.props)({}),(0,b.key)(Y("new")),(0,b.path)(o=>["lib","components","AddToDashboard","saveToDashboardModalLogic",o]),(0,b.connect)(o=>({values:[L(o),["insight"]],actions:[L(o),["updateInsight","updateInsightSuccess","updateInsightFailure"],Te,["reportSavedInsightToDashboard","reportRemovedInsightFromDashboard","reportCreatedDashboardFromModal"],pe,["showNewDashboardModal"]]})),(0,b.actions)({addNewDashboard:!0,setSearchQuery:o=>({query:o}),setScrollIndex:o=>({index:o}),addToDashboard:o=>({dashboardId:o}),removeFromDashboard:o=>({dashboardId:o})}),(0,b.reducers)({searchQuery:["",{setSearchQuery:(o,{query:e})=>e}],scrollIndex:[-1,{setScrollIndex:(o,{index:e})=>e}],dashboardWithActiveAPICall:[null,{addToDashboard:(o,{dashboardId:e})=>e,removeFromDashboard:(o,{dashboardId:e})=>e,updateInsightSuccess:()=>null,updateInsightFailure:()=>null}]}),(0,b.selectors)({dashboardsFuse:[()=>[J.selectors.nameSortedDashboards],o=>new zo(o||[],{keys:["name","description","tags"],threshold:.3})],filteredDashboards:[o=>[o.searchQuery,o.dashboardsFuse,J.selectors.nameSortedDashboards],(o,e,t)=>o.length?e.search(o).map(r=>r.item):t],currentDashboards:[o=>[o.filteredDashboards,o.insight],(o,e)=>o.filter(t=>e.dashboard_tiles?.map(r=>r.dashboard_id)?.includes(t.id))],availableDashboards:[o=>[o.filteredDashboards,o.currentDashboards],(o,e)=>o.filter(t=>!e?.map(r=>r.id).includes(t.id))],orderedDashboards:[o=>[o.currentDashboards,o.availableDashboards],(o,e)=>[...o,...e]]}),(0,b.listeners)(({actions:o,values:e})=>({addNewDashboard:async()=>{o.showNewDashboardModal()},[J.actionTypes.addDashboardSuccess]:async({dashboard:t})=>{o.reportCreatedDashboardFromModal(),o.addToDashboard(t.id),o.setScrollIndex(e.orderedDashboards.findIndex(r=>r.id===t.id))},addToDashboard:async({dashboardId:t})=>{o.updateInsight({dashboards:[...e.insight.dashboards||[],t]},()=>{o.reportSavedInsightToDashboard(),J.actions.tileAddedToDashboard(t),Co.success("Insight added to dashboard",{button:{label:"View dashboard",action:()=>Fe.router.actions.push(I.dashboard(t))}})})},removeFromDashboard:async({dashboardId:t})=>{o.updateInsight({dashboards:(e.insight.dashboards||[]).filter(r=>r!==t),dashboard_tiles:(e.insight.dashboard_tiles||[]).filter(r=>r.dashboard_id!==t)},()=>{o.reportRemovedInsightFromDashboard(),Co.success("Insight removed from dashboard")})}}))]);var c=n(p()),dt=({style:o,isHighlighted:e,isAlreadyOnDashboard:t,dashboard:r,insightProps:m,canEditInsight:u})=>{let{addToDashboard:h,removeFromDashboard:i}=(0,U.useActions)(bo(m)),{dashboardWithActiveAPICall:B}=(0,U.useValues)(bo(m)),{currentTeam:w}=(0,U.useValues)(Le),D=r.id===w?.primary_dashboard;return(0,c.jsxs)("div",{"data-attr":"dashboard-list-item",style:o,className:(0,Me.default)("flex items-center space-x-2",e&&"highlighted"),children:[(0,c.jsx)(po,{to:I.dashboard(r.id),className:"overflow-hidden text-ellipsis whitespace-nowrap",title:r.name,children:r.name||"Untitled"}),D&&(0,c.jsx)(co,{title:"Primary dashboards are shown on the project home page",children:(0,c.jsx)("span",{className:"flex items-center",children:(0,c.jsx)(Uo,{className:"text-warning text-base"})})}),(0,c.jsx)("span",{className:"grow"}),(0,c.jsx)(g,{type:"secondary",status:t?"danger":"default",loading:B===r.id,disabledReason:u?B?"Loading...":"":"You don't have permission to edit this dashboard",size:"small",onClick:F=>{F.preventDefault(),t?i(r.id):h(r.id)},children:t?"Remove from dashboard":"Add to dashboard"})]})};function ke({isOpen:o,closeModal:e,insightProps:t,canEditInsight:r}){let m=bo(t),{searchQuery:u,currentDashboards:h,orderedDashboards:i,scrollIndex:B}=(0,U.useValues)(m),{setSearchQuery:w,addNewDashboard:D}=(0,U.useActions)(m),F=({index:_,style:Q})=>(0,c.jsx)(dt,{dashboard:i[_],insightProps:t,canEditInsight:r,isHighlighted:_===B,isAlreadyOnDashboard:h.some(j=>j.id===i[_].id),style:Q},_);return(0,c.jsx)(Xo,{onClose:()=>{e(),w("")},isOpen:o,title:"Add to dashboard",footer:(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)("div",{className:"flex-1",children:(0,c.jsx)(g,{type:"secondary",onClick:D,disabledReason:r?void 0:"You do not have permission to add this insight to dashboards",children:"Add to a new dashboard"})}),(0,c.jsx)(g,{type:"secondary",onClick:e,children:"Close"})]}),children:(0,c.jsxs)("div",{className:"space-y-2 w-192 max-w-full",children:[(0,c.jsx)(go,{"data-attr":"dashboard-searchfield",type:"search",fullWidth:!0,placeholder:"Search for dashboards...",value:u,onChange:_=>w(_)}),(0,c.jsxs)("div",{className:"text-secondary",children:["This insight is referenced on ",(0,c.jsx)("strong",{className:"text-text-3000",children:h.length})," ",Wo(h.length,"dashboard","dashboards",!1)]}),(0,c.jsx)("div",{className:"min-h-[420px]",children:(0,c.jsx)(te,{children:({height:_,width:Q})=>(0,c.jsx)(se,{width:Q,height:_,rowCount:i.length,overscanRowCount:100,rowHeight:40,rowRenderer:F,scrollToIndex:B})})})]})})}a();l();d();var ro=n(P()),Oe=n(wo());var X=n(p());function Qe({insight:o,insightLogicProps:e,text:t,...r}){let{push:m}=(0,ro.useActions)(Oe.router),{featureFlags:u}=(0,ro.useValues)(so),h=u[to.ALERTS],i=K({insightId:o.id,insightLogicProps:e}),{alerts:B}=(0,ro.useValues)(i);return h?(0,X.jsx)(g,{"data-attr":"manage-alerts-button",onClick:()=>m(I.insightAlerts(o.short_id)),disabledReason:ae(o.query)?void 0:"Alerts are only available for trends. Change the insight representation to add alerts.",...r,icon:(0,X.jsx)(ho,{count:B?.length,showZero:!1,children:(0,X.jsx)(Ho,{})}),children:t}):(0,X.jsx)(X.Fragment,{})}var Mo=n(nt());a();l();d();var N=n(P());var Re="insights",yo=(0,N.kea)([(0,N.props)({}),(0,N.key)(Y("new")),(0,N.path)(o=>["scenes","insights","insightCommandLogic",o]),(0,N.connect)(o=>[fo,M(o)]),(0,N.events)(({props:o})=>({afterMount:()=>{let e=[{key:"insight-graph",resolver:[{icon:To,display:'Toggle "Compare Previous" on Graph',executor:()=>{let t=M(o).values.compareFilter;M(o).actions.updateCompareFilter({compare:!t?.compare,compare_to:t?.compare_to})}},...Vo.map(({key:t,values:r})=>({icon:To,display:`Set Time Range to ${t}`,executor:()=>{M(o).actions.updateDateRange({date_from:r[0],date_to:r[1]})}}))],scope:Re}];for(let t of e)fo.actions.registerCommand(t)},beforeUnmount:()=>{fo.actions.deregisterScope(Re)}}))]);a();l();d();var O=n(p());function Ve({saveAs:o,saveInsight:e,isSaved:t,insightSaving:r,insightChanged:m,addingToDashboard:u}){let h=t&&!m,i=t&&!u;return(0,O.jsx)(g,{type:"primary",onClick:()=>e(!0),"data-attr":"insight-save-button",disabled:h,loading:!h&&r,sideAction:{dropdown:{placement:"bottom-end",overlay:(0,O.jsxs)(O.Fragment,{children:[!h&&(0,O.jsxs)(g,{onClick:()=>e(!1),"data-attr":"insight-save-and-continue",fullWidth:!0,children:[u?"Save, add to dashboard":"Save"," & continue editing"]}),i&&(0,O.jsx)(g,{onClick:()=>o(),"data-attr":"insight-save-as-new-insight",fullWidth:!0,children:"Save as\u2026"})]})},disabled:h&&!i,"data-attr":"insight-save-dropdown"},children:h?"No changes to be saved":u?"Save & add to dashboard":"Save"})}var s=n(p());function We({insightLogicProps:o}){let{insightMode:e,itemId:t,alertId:r}=(0,y.useValues)(k),{setInsightMode:m}=(0,y.useActions)(k),{insightProps:u,canEditInsight:h,insight:i,insightChanged:B,insightSaving:w,hasDashboardItemId:D}=(0,y.useValues)(L(o)),{setInsightMetadata:F,saveAs:_,saveInsight:Q}=(0,y.useActions)(L(o)),{loadAlerts:j}=(0,y.useActions)(K({insightLogicProps:o,insightId:i.id})),{duplicateInsight:lo,loadInsights:Lo}=(0,y.useActions)(ie),{query:R,queryChanged:Ke,showQueryEditor:vo,showDebugPanel:$e,hogQL:oo,exportContext:So}=(0,y.useValues)($(u)),{toggleQueryEditorPanel:Ze,toggleDebugPanel:je}=(0,y.useActions)($(u)),{createStaticCohort:ot}=(0,y.useActions)(oe);(0,y.useMountedLogic)(yo(u));let{tags:et}=(0,y.useValues)($o),{user:Qo}=(0,y.useValues)(Ie),{preflight:tt}=(0,y.useValues)(Ko),{currentProjectId:st}=(0,y.useValues)(jo),{push:V}=(0,y.useActions)(Fo.router),[eo,it]=(0,Mo.useState)(i.tags),[rt,Do]=(0,Mo.useState)(!1),Ro=Se(R)||xo(R)||uo(R)||ve(R);return(0,s.jsxs)(s.Fragment,{children:[D&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(Ae,{isOpen:e==="subscriptions",closeModal:()=>V(I.insightView(i.short_id)),insightShortId:i.short_id,subscriptionId:typeof t=="number"||t==="new"?t:null}),(0,s.jsx)(he,{title:"Insight sharing",isOpen:e==="sharing",closeModal:()=>V(I.insightView(i.short_id)),insightShortId:i.short_id,insight:i,previewIframe:!0}),(0,s.jsx)(ke,{isOpen:rt,closeModal:()=>Do(!1),insightProps:u,canEditInsight:h}),e==="alerts"&&(0,s.jsx)(ue,{onClose:()=>V(I.insightView(i.short_id)),isOpen:e==="alerts",insightLogicProps:o,insightId:i.id,insightShortId:i.short_id}),!!r&&(0,s.jsx)(be,{onClose:()=>V(I.insightAlerts(i.short_id)),isOpen:!!r,alertId:r===null||r==="new"?void 0:r,insightShortId:i.short_id,insightId:i.id,onEditSuccess:()=>{j(),V(I.insightAlerts(i.short_id))},insightLogicProps:o}),(0,s.jsx)(Pe,{})]}),(0,s.jsx)(ce,{buttons:(0,s.jsxs)("div",{className:"flex justify-between items-center gap-2",children:[(0,s.jsx)(Go,{overlay:(0,s.jsxs)(s.Fragment,{children:[D&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(g,{onClick:()=>lo(i,!0),fullWidth:!0,"data-attr":"duplicate-insight-from-insight-view",children:"Duplicate"}),(0,s.jsx)(g,{onClick:()=>F({favorited:!i.favorited}),fullWidth:!0,children:i.favorited?"Remove from favorites":"Add to favorites"}),(0,s.jsx)(g,{onClick:()=>Do(!0),fullWidth:!0,children:"Add to dashboard"}),(0,s.jsx)(z,{}),(0,s.jsx)(g,{onClick:()=>i.short_id?V(I.insightSharing(i.short_id)):null,fullWidth:!0,children:"Share or embed"}),(0,s.jsx)(_e,{insightShortId:i.short_id}),So?(0,s.jsx)(ne,{fullWidth:!0,items:[{export_format:"image/png",insight:i.id},{export_format:"text/csv",export_context:So},{export_format:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",export_context:So}]}):null,(0,s.jsx)(z,{})]}),(0,s.jsx)(Ao,{"data-attr":`${vo?"hide":"show"}-insight-source`,className:"px-2 py-1",checked:vo,onChange:()=>{D&&e!=="edit"&&(m("edit",null),vo)||Ze()},fullWidth:!0,label:"View source"}),D&&(Qo?.is_staff||Qo?.is_impersonated||!tt?.cloud)?(0,s.jsx)(Ao,{"data-attr":"toggle-debug-panel",className:"px-2 py-1",checked:$e,onChange:()=>{je()},fullWidth:!0,label:"Debug panel"}):null,(oo||Ro)&&(0,s.jsx)(z,{}),oo&&!uo(R)&&!(xo(R)&&uo(R.source))&&(0,s.jsx)(g,{"data-attr":"edit-insight-sql",onClick:()=>{Fo.router.actions.push(I.insightNew({query:{kind:"DataTableNode",source:{kind:"HogQLQuery",query:oo},full:!0}}))},fullWidth:!0,children:"Edit SQL directly"}),oo&&Ro&&(0,s.jsx)(g,{"data-attr":"edit-insight-sql",onClick:()=>{qo.openForm({title:"Save as static cohort",description:(0,s.jsxs)("div",{className:"mt-2",children:["Your query must export a ",(0,s.jsx)("code",{children:"person_id"}),","," ",(0,s.jsx)("code",{children:"actor_id"})," or ",(0,s.jsx)("code",{children:"id"})," column, which must match the ",(0,s.jsx)("code",{children:"id"})," of the ",(0,s.jsx)("code",{children:"persons"})," table"]}),initialValues:{name:""},content:(0,s.jsx)(Zo,{name:"name",children:(0,s.jsx)(go,{"data-attr":"insight-name",placeholder:"Name of the new cohort",autoFocus:!0})}),errors:{name:W=>W?void 0:"You must enter a name"},onSubmit:async({name:W})=>{ot(W,{kind:"HogQLQuery",query:oo})}})},fullWidth:!0,children:"Save as static cohort"}),D&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(z,{}),(0,s.jsx)(No,{userAccessLevel:i.user_access_level,minAccessLevel:"editor",resourceType:"insight",status:"danger",onClick:()=>void ee({object:i,endpoint:`projects/${st}/insights`,callback:()=>{Lo(),V(I.savedInsights())}}),fullWidth:!0,children:"Delete insight"})]})]})}),(0,s.jsx)(z,{vertical:!0}),e==="edit"&&D&&(0,s.jsx)(g,{type:"secondary",onClick:()=>m("view",null),"data-attr":"insight-cancel-edit-button",children:"Cancel"}),e!=="edit"&&D&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(Qe,{insight:i,insightLogicProps:o,type:"secondary",text:"Alerts"}),(0,s.jsx)(re,{resource:{type:"ph-query",attrs:{query:{kind:"SavedInsightNode",shortId:i.short_id}}},type:"secondary"}),(0,s.jsx)(Ee,{insight:i,setOpenModal:Do})]}),e!=="edit"?h&&(0,s.jsx)(No,{userAccessLevel:i.user_access_level,minAccessLevel:"editor",resourceType:"insight",type:"primary",onClick:()=>m("edit",null),"data-attr":"insight-edit-button",children:"Edit"}):(0,s.jsx)(Ve,{saveAs:_,saveInsight:Q,isSaved:D,addingToDashboard:!!i.dashboards?.length&&!i.id,insightSaving:w,insightChanged:B||Ke})]}),caption:(0,s.jsxs)(s.Fragment,{children:[!!(h||i.description)&&(0,s.jsx)(Ce,{multiline:!0,markdown:!0,name:"description",value:i.description||"",placeholder:"Description (optional)",onSave:W=>F({description:W}),saveOnBlur:!0,maxLength:400,mode:h?void 0:"view","data-attr":"insight-description",compactButtons:!0}),h?(0,s.jsx)(_o,{tags:eo??[],saving:w,onChange:W=>it(W),onBlur:()=>{eo!==i.tags&&F({tags:eo??[]})},tagsAvailable:et,className:"mt-2","data-attr":"insight-tags"}):eo?.length?(0,s.jsx)(_o,{tags:eo,saving:w,className:"mt-2","data-attr":"insight-tags",staticOnly:!0}):null,(0,s.jsx)(fe,{at:i.last_modified_at,by:i.last_modified_by,className:"mt-2"})]}),tabbedPage:e==="edit"})]})}a();l();d();var ao=n(P());a();l();d();var ko=n(P());var Je=n(p());function He(){let{insightProps:o,insight:e}=(0,ko.useValues)(L);if(!e?.short_id)return null;let{shouldShowAlertDeletionWarning:t}=(0,ko.useValues)(K({insightId:e.id,insightLogicProps:o}));return!t||!e.short_id?null:(0,Je.jsx)(q,{type:"warning",className:"mb-4",children:"There are alerts set up for the insight. The selected chart type of the insight doesn't support alerts, so the existing alerts will be deleted when you save."})}a();l();d();var no=n(P());a();l();d();var f=n(P());var Oo=(0,f.kea)([(0,f.props)({}),(0,f.key)(Y("new")),(0,f.path)(o=>["scenes","insights","InsightTabs","TrendTab","FunnelsCue",o]),(0,f.connect)(o=>({values:[de(o),["isFirstLoad"],M(o),["query"],so,["featureFlags"]],actions:[M(o),["setQuery"],so,["setFeatureFlags"]]})),(0,f.actions)({optOut:o=>({userOptedOut:o}),setShouldShow:o=>({show:o}),setPermanentOptOut:!0,displayAsFunnel:!0}),(0,f.reducers)({_shouldShow:[!1,{setShouldShow:(o,{show:e})=>e}],permanentOptOut:[!1,{setPermanentOptOut:()=>!0}]}),(0,f.listeners)(({actions:o,values:e})=>({optOut:async({userOptedOut:t})=>{mo.capture("funnel cue 7301 - terminated",{user_opted_out:t}),mo.people.set({funnels_cue_3701_opt_out:!0}),o.setPermanentOptOut()},setQuery:({query:t})=>{Z(t)&&(!e.isFirstLoad&&Eo(t?.source)&&(t.source.series||[]).length>=3?(o.setShouldShow(!0),!e.permanentOptOut&&mo.capture("funnel cue 7301 - shown",{step_count:t.source.series.length})):e.shown&&we(t?.source)?o.optOut(!1):o.setShouldShow(!1))},setFeatureFlags:async({flags:t})=>{t[to.FUNNELS_CUE_OPT_OUT]&&o.setPermanentOptOut()},displayAsFunnel:()=>{if(!Z(e.query)||!Eo(e.query?.source))return;let t=JSON.parse(JSON.stringify(e.query));t.source.kind="FunnelsQuery",o.setQuery(t)}})),(0,f.selectors)({shown:[o=>[o._shouldShow,o.permanentOptOut],(o,e)=>o&&!e]}),(0,f.events)(({actions:o,values:e})=>({afterMount:()=>{e.featureFlags[to.FUNNELS_CUE_OPT_OUT]&&o.setPermanentOptOut()}}))]);var Xe=n(p());function Ue(){let{insightProps:o}=(0,no.useValues)(L),{shown:e}=(0,no.useValues)(Oo(o)),{optOut:t,displayAsFunnel:r}=(0,no.useActions)(Oo(o));return e?(0,Xe.jsx)(q,{type:"info",action:{onClick:r,children:"Try this insight as a funnel"},onClose:()=>t(!0),className:"mb-4",children:"Looks like you have multiple events. A funnel can help better visualize your user\u2019s progression across each event."}):null}var x=n(p());function qe(){let{insightProps:o,insight:e}=(0,ao.useValues)(L),{activeView:t,tabs:r}=(0,ao.useValues)(Po(o)),{setActiveView:m}=(0,ao.useActions)(Po(o));return(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(Ue,{}),e.short_id&&(0,x.jsx)(He,{}),(0,x.jsx)(Yo,{activeKey:t,onChange:u=>m(u),tabs:r.map(({label:u,type:h,dataAttr:i})=>({key:h,label:(0,x.jsx)(po,{to:le[h],preventClick:!0,"data-attr":i,children:(0,x.jsx)(co,{placement:"top",title:Bo[h].tooltipDescription||Bo[h].description,children:(0,x.jsx)("span",{children:u})})})}))})]})}var v=n(p());function ze({insightId:o}){let{insightMode:e,insight:t,filtersOverride:r,variablesOverride:m,freshQuery:u}=(0,E.useValues)(k),h=L({dashboardItemId:o||"new",cachedInsight:(H(r)||H(m))&&t?.short_id===o?t:null,filtersOverride:r,variablesOverride:m}),{insightProps:i,accessDeniedToInsight:B}=(0,E.useValues)(h),{query:w,showQueryEditor:D,showDebugPanel:F}=(0,E.useValues)($(i)),{setQuery:_}=(0,E.useActions)($(i));(0,E.useMountedLogic)(yo(i));let Q=e==="edit"&&D,j=(lo,Lo)=>{(!Z(lo)||Lo)&&_(lo)};return B?(0,v.jsx)(Ne,{object:"insight"}):(0,v.jsx)(E.BindLogic,{logic:L,props:i,children:(0,v.jsxs)("div",{className:"Insight",children:[(0,v.jsx)(We,{insightLogicProps:i}),(H(r)||H(m))&&(0,v.jsx)(q,{type:"warning",className:"mb-4",children:(0,v.jsxs)("div",{className:"flex flex-row items-center justify-between gap-2",children:[(0,v.jsxs)("span",{children:["You are viewing this insight with"," ",H(m)?"variables":"filters"," from a dashboard"]}),(0,v.jsxs)(g,{type:"secondary",to:I.insightView(o),children:["Discard dashboard ",H(m)?"variables":"filters"]})]})}),e==="edit"&&(0,v.jsx)(qe,{}),F&&(0,v.jsx)("div",{className:"mb-4",children:(0,v.jsx)(Be,{insightId:i.cachedInsight?.id})}),u?(0,v.jsx)(ye,{}):null,(0,v.jsx)(ge,{query:Z(w)?{...w,full:!0}:w,setQuery:j,readOnly:e!=="edit",context:{showOpenEditorButton:!1,showQueryEditor:Q,showQueryHelp:e==="edit"&&!De(w),insightProps:i},filtersOverride:r,variablesOverride:m})]})})}a();l();d();var S=n(p());function Ge(){return(0,S.jsx)(S.Fragment,{children:(0,S.jsxs)("div",{className:"my-6 space-y-4",children:[(0,S.jsx)(G,{className:"w-1/4 h-4"}),(0,S.jsx)(G,{className:"w-1/2 h-4",repeat:3}),(0,S.jsx)(G,{}),(0,S.jsxs)("div",{className:"border rounded p-6 flex items-center gap-4",children:[(0,S.jsx)("div",{className:"flex-1 space-y-2",children:(0,S.jsx)(G.Row,{repeat:3})}),(0,S.jsx)("div",{className:"flex-1 space-y-2",children:(0,S.jsx)(G.Row,{repeat:3})})]}),(0,S.jsx)("div",{className:"border rounded p-6 min-h-100"})]})})}var Io=n(p());function ht(){let{insightId:o,insight:e,insightLogicRef:t}=(0,Ye.useValues)(k);return o==="new"||o&&e?.id&&e?.short_id?(0,Io.jsx)(ze,{insightId:o}):t?.logic?.values?.insightLoading?(0,Io.jsx)(Ge,{}):(0,Io.jsx)(me,{object:"insight"})}var Fr={component:ht,logic:k};export{ht as InsightScene,Fr as scene};
//# sourceMappingURL=/static/InsightScene-UUGX5TBR.js.map
