import{c as ke}from"/static/chunk-B45QJOJV.js";import"/static/chunk-ZXSHFYOF.js";import"/static/chunk-YMADXPYD.js";import"/static/chunk-IPCVEVZF.js";import"/static/chunk-ZTROLN7N.js";import"/static/chunk-36DSVTR6.js";import"/static/chunk-DXU2OWVA.js";import"/static/chunk-L75XFVXE.js";import"/static/chunk-7IEEMZ6G.js";import"/static/chunk-IVGZ2YI3.js";import"/static/chunk-CIEHRPUV.js";import"/static/chunk-HXWIHI4I.js";import"/static/chunk-XY7F5WGW.js";import"/static/chunk-FQ666B2X.js";import"/static/chunk-LYVLXNIU.js";import"/static/chunk-ZRP64K7H.js";import"/static/chunk-F4VW2WHG.js";import{b as Ie,c as Ne}from"/static/chunk-RMMNJQZ5.js";import{a as J,b as De,c as Ce}from"/static/chunk-IF5PCV5K.js";import{d as ve}from"/static/chunk-NUJQT2B6.js";import"/static/chunk-336DAFEI.js";import"/static/chunk-LZ4U35M5.js";import{d as Te}from"/static/chunk-Y4WAEGNO.js";import"/static/chunk-5QZ3UKWA.js";import"/static/chunk-L6OS4YDC.js";import"/static/chunk-N2KORDXB.js";import"/static/chunk-A5MOAJQD.js";import"/static/chunk-SSCAQKOK.js";import"/static/chunk-G6Q3YRDS.js";import"/static/chunk-XW2JOKCQ.js";import"/static/chunk-AUQGOGK2.js";import"/static/chunk-Z3ZSBYIV.js";import"/static/chunk-VVSLW35Y.js";import"/static/chunk-KYJ4OXJI.js";import"/static/chunk-GVAK35JD.js";import"/static/chunk-HOCRDURT.js";import"/static/chunk-KHKNIVWH.js";import"/static/chunk-OYAHDROG.js";import"/static/chunk-MEAB657I.js";import"/static/chunk-4HIBDE5Y.js";import"/static/chunk-TNG4S7TR.js";import"/static/chunk-LYMEBJGW.js";import"/static/chunk-QIBQKJHN.js";import"/static/chunk-34UVU7UN.js";import"/static/chunk-CDTERFC5.js";import"/static/chunk-LZWHW4MC.js";import"/static/chunk-RSTRTBMR.js";import"/static/chunk-DYVMG6MY.js";import{s as he}from"/static/chunk-44P5EQSU.js";import"/static/chunk-GH3IWF3M.js";import{j as ge}from"/static/chunk-CBJ7RAUW.js";import"/static/chunk-XSEDUXPL.js";import"/static/chunk-HRNZBUVG.js";import"/static/chunk-OKGJSIGC.js";import{d as fe}from"/static/chunk-NKVVAJQ7.js";import{c as Q}from"/static/chunk-2HTNY362.js";import"/static/chunk-S27Q4QO6.js";import"/static/chunk-JUFFFVO5.js";import"/static/chunk-JZCOVRBI.js";import"/static/chunk-EIJECEWK.js";import{Ae as re,Db as z,Do as A,Eo as ye,Fe as ne,Gh as h,Gm as me,Io as be,Ip as Se,Ko as Pe,Mi as le,Ni as ce,Rd as Y,Sa as M,Sd as P,Ta as I,Vd as j,Wd as _,Za as je,a as v,af as ie,cc as R,ce as Z,cg as U,ch as pe,ee,f as Ye,fe as oe,gg as ae,ke as te,m as $,pe as F,r as g,tk as de,ub as q,up as Le,vo as ue,ze as se}from"/static/chunk-RFJTZKD6.js";import"/static/chunk-XPJ4MQJV.js";import"/static/chunk-KQJ3FYBQ.js";import{F as G,Tb as K,a as W,za as E}from"/static/chunk-3UDJFOQH.js";import"/static/chunk-HHT4SG7V.js";import"/static/chunk-K7LQKAJG.js";import"/static/chunk-QQTK3LZH.js";import"/static/chunk-IJQNM355.js";import"/static/chunk-4CN6THWS.js";import"/static/chunk-272RTCFX.js";import"/static/chunk-2ROB4QWU.js";import"/static/chunk-ALT2ZZSO.js";import"/static/chunk-UE6SLBBN.js";import"/static/chunk-GINZUAUY.js";import"/static/chunk-SQELCOUW.js";import"/static/chunk-IGYUTZ65.js";import"/static/chunk-YM6UBNGD.js";import"/static/chunk-C6TQ5FFZ.js";import"/static/chunk-GXGA523B.js";import"/static/chunk-N4MMWRNK.js";import"/static/chunk-NRLAI7OY.js";import"/static/chunk-LVVHNICT.js";import"/static/chunk-2AXSSSSX.js";import"/static/chunk-DGXQI7RB.js";import"/static/chunk-HUCRWDLX.js";import"/static/chunk-RFEQG3YN.js";import"/static/chunk-PUISI233.js";import{d as r,e as l,g as c,j as d}from"/static/chunk-SJXEOBQC.js";l();d();c();var b=r(v());l();d();c();var L=r(v());l();d();c();var n=r(v()),we=r(je()),xe=r(Ye());var x=(0,n.kea)([(0,n.props)({}),(0,n.key)(o=>o.person.id??"new"),(0,n.path)(o=>["scenes","persons","mergeSplitPersonLogic",o]),(0,n.connect)(()=>({actions:[h({syncWithUrl:!0}),["setListFilters","loadPersons","setPerson","setSplitMergeModalShown"]],values:[h({syncWithUrl:!0}),["persons"]]})),(0,n.actions)({setSelectedPersonToAssignSplit:o=>({id:o}),cancel:!0}),(0,we.loaders)(({values:o,actions:s})=>({executed:[!1,{execute:async()=>(await be.create("api/person/"+o.person.id+"/split/",{...o.selectedPersonToAssignSplit?{main_distinct_id:o.selectedPersonToAssignSplit}:{}})).success?(j.success("Person succesfully split. This may take up to a couple of minutes to complete."),Se.actions.reportPersonSplit(o.person.distinct_ids.length),s.setSplitMergeModalShown(!1),xe.router.actions.push("/persons"),!0):!1}]})),(0,n.reducers)(({props:o})=>({person:[o.person,{}],selectedPersonToAssignSplit:[null,{setSelectedPersonToAssignSplit:(s,{id:t})=>t}]})),(0,n.listeners)(({actions:o,values:s})=>({setListFilters:()=>{o.loadPersons()},cancel:()=>{s.executedLoading||o.setSplitMergeModalShown(!1)}})),(0,n.events)(({actions:o})=>({afterMount:[o.loadPersons]}))]);var a=r(g());function Ee({person:o}){let s={person:o},{executedLoading:t}=(0,L.useValues)(x(s)),{execute:i,cancel:f}=(0,L.useActions)(x(s));return(0,a.jsx)(Z,{isOpen:!0,width:"40rem",title:"Split persons",footer:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(P,{onClick:f,disabledReason:t&&"Splitting the user",children:"Cancel"}),(0,a.jsx)(P,{type:"primary",onClick:i,loading:t,children:"Split persons"})]}),onClose:f,children:o.distinct_ids.length<2?"Only persons with more than two distinct IDs can be split.":(0,a.jsx)(L.BindLogic,{logic:x,props:s,children:(0,a.jsx)(Ze,{})})})}function Ze(){let{person:o,selectedPersonToAssignSplit:s,executedLoading:t}=(0,L.useValues)(x),{setSelectedPersonToAssignSplit:i}=(0,L.useActions)(x);if(!o)return null;let f=o.distinct_ids.map(p=>({label:p,value:p}));return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("p",{children:"This will split all Distinct IDs for this person into unique persons."}),(0,a.jsxs)("p",{children:["You can select a distinct ID for which all the current properties will be assigned (",(0,a.jsx)("i",{children:"optional"}),"). All other new users will start without any properties."]}),(0,a.jsx)(F,{fullWidth:!0,options:f,placeholder:"Select a distinct ID to which to assign all properties (optional)",disabledReason:t&&"Splitting user",value:s,onChange:p=>i(p)}),(0,a.jsxs)(_,{type:"warning",className:"mt-4",children:["This will create ",(0,a.jsx)("strong",{children:o.distinct_ids.length-1})," ",K(o.distinct_ids.length-1,"new\xA0person",void 0,!1),". This might change the numbers in your charts, even historically. Please be certain."]})]})}l();d();c();var O=r(v());var _e=r(W());var B=r(g());function Ae(){let{cohorts:o,cohortsLoading:s,person:t}=(0,O.useValues)(h),{loadCohorts:i}=(0,O.useActions)(h);return(0,_e.useEffect)(()=>{i()},[t]),(0,B.jsx)(se,{dataSource:o||[],loading:s,columns:[{title:"Name",dataIndex:"name",key:"name",className:"ph-no-capture",render:function(u,C){return(0,B.jsx)(I,{to:A.cohort(C.id),children:(0,B.jsx)("strong",{children:C.name})})},sorter:(p,u)=>(p.name||"").localeCompare(u.name||"")},{title:"Users in cohort",render:function(u){return u?.toLocaleString()},dataIndex:"count",sorter:(p,u)=>(p.count||0)-(u.count||0)}],rowKey:"id",pagination:{pageSize:30,hideOnSinglePage:!0},emptyState:"This person doesn't belong to any cohort"})}l();d();c();var D=r(v());var Re=r(W());l();d();c();var S=r(v());var Me=(0,S.kea)([(0,S.path)(["scenes","persons","personDashboardLogic"]),(0,S.connect)({values:[ye,["user"]]}),(0,S.selectors)(()=>({personDashboardId:[o=>[o.user],o=>{let s=o?.scene_personalisation?.find(t=>t.scene==="Person")?.dashboard;return typeof s=="number"?s:s?.id}],dashboardLogicProps:[o=>[o.personDashboardId],o=>o?{id:o,placement:"person"}:null]}))]);var m=r(g());function Fe({person:o}){let{showSceneDashboardChoiceModal:s}=(0,D.useActions)(J({scene:"Person"})),{dashboardLogicProps:t}=(0,D.useValues)(Me);return(0,m.jsxs)(m.Fragment,{children:[t?.id!==void 0?(0,m.jsx)(oo,{person:o,dashboardLogicProps:t}):(0,m.jsx)(Ce,{open:()=>{s()},scene:"Person"}),(0,m.jsx)(De,{scene:"Person"})]})}function oo({person:o,dashboardLogicProps:s}){let{showSceneDashboardChoiceModal:t}=(0,D.useActions)(J({scene:"Person"})),{dashboard:i}=(0,D.useValues)(U(s)),{setProperties:f}=(0,D.useActions)(U(s));return(0,Re.useEffect)(()=>{if(i&&o){let p=Array.isArray(i?.filters.properties)?i?.filters.properties:[],u=`person.properties.email = '${o.properties.email}'`,C={type:"hogql",key:u};p.some(T=>T.type==="hogql"&&T.key===u)||f([...p.filter(T=>T.type==="hogql"&&!T.key.startsWith("person.properties.email")),C])}},[i,o]),(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)("div",{className:"flex items-center justify-end mb-2",children:(0,m.jsx)(P,{type:"secondary",size:"small","data-attr":"person-dashboard-change-dashboard",onClick:t,children:"Change dashboard"})}),(0,m.jsx)(Te,{id:s.id.toString(),placement:s.placement})]})}l();d();c();var Be=r(v());var He=r(g()),to=({person:o})=>{let{isCloudOrDev:s}=(0,Be.useValues)(ie),t=o.id,i=o.distinct_ids[0];return(0,He.jsx)(ke,{editable:!1,shortId:`canvas-${t}`,mode:"canvas",initialContent:{type:"doc",content:[{type:"ph-person-feed",attrs:{height:null,title:null,nodeId:E(),id:i,__init:null,children:[{type:"ph-person",attrs:{id:i,nodeId:E(),title:"Info"}},...s?[{type:"ph-map",attrs:{id:i,nodeId:E()}}]:[],{type:"ph-properties",attrs:{id:i,nodeId:E()}}]}}]}})},Oe=to;var e=r(g()),qt={component:ro,logic:h,paramsToProps:({params:{_:o}})=>({syncWithUrl:!0,urlId:decodeURIComponent(o)})};function so({person:o}){return(0,e.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,e.jsxs)("div",{className:"flex space-x-1",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("span",{className:"text-secondary",children:"IDs:"})," ",(0,e.jsx)(le,{tooltipMessage:null,description:"person distinct ID",style:{justifyContent:"flex-end"},children:o.distinct_ids[0]})]}),o.distinct_ids.length>1&&(0,e.jsx)(te,{items:o.distinct_ids.slice(1).map(s=>({label:s,sideIcon:(0,e.jsx)(z,{className:"text-primary-3000"}),onClick:()=>ne(s,"distinct id")})),children:(0,e.jsxs)(oe,{type:"primary",className:"inline-flex",children:[(0,e.jsxs)("span",{children:["+",o.distinct_ids.length-1]}),(0,e.jsx)(q,{className:"w-4 h-4"})]})})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)("span",{className:"text-secondary",children:"First seen:"})," ",o.created_at?(0,e.jsx)(pe,{time:o.created_at}):"unknown"]}),(0,e.jsxs)("div",{children:[(0,e.jsx)("span",{className:"text-secondary",children:"Merge restrictions:"})," ",o.is_identified?"applied":"none",(0,e.jsx)(I,{to:"https://posthog.com/docs/data/identify#alias-assigning-multiple-distinct-ids-to-the-same-user",children:(0,e.jsx)(M,{title:(0,e.jsxs)(e.Fragment,{children:[o.is_identified?(0,e.jsx)("strong",{children:"Cannot"}):"Can"," be used as `alias_id` - click for more info."]}),children:(0,e.jsx)(R,{className:"ml-1 text-base shrink-0"})})})]})]})}function ro(){let{showCustomerSuccessDashboards:o,feedEnabled:s,person:t,personLoading:i,personError:f,currentTab:p,splitMergeModalShown:u,urlId:C,distinctId:H,primaryDistinctId:T}=(0,b.useValues)(h),{loadPersons:Ue,editProperty:Qe,deleteProperty:Je,navigateToTab:Xe,setSplitMergeModalShown:Ve,setDistinctId:We}=(0,b.useActions)(h),{showPersonDeleteModal:Ge}=(0,b.useActions)(Q),{deletedPersonLoading:X}=(0,b.useValues)(Q),{groupsEnabled:Ke}=(0,b.useValues)(ae),{currentTeam:$e}=(0,b.useValues)(Pe),{featureFlags:qe}=(0,b.useValues)($);if(f)throw new Error(f);if(!t)return i?(0,e.jsx)(Y,{sceneLevel:!0}):(0,e.jsx)(me,{object:"Person"});let V=A.personByDistinctId(C||t.distinct_ids[0]||String(t.id)),ze=qe[G.ENVIRONMENTS]?"environment":"project";return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(ue,{caption:(0,e.jsx)(so,{person:t}),notebookProps:V?{href:V}:void 0,buttons:(0,e.jsxs)("div",{className:"flex gap-2",children:[(0,e.jsx)(de,{resource:{type:"ph-person",attrs:{id:t?.distinct_ids[0]}},type:"secondary"}),(0,e.jsx)(P,{onClick:()=>Ge(t,()=>Ue()),disabled:X,loading:X,type:"secondary",status:"danger","data-attr":"delete-person",children:"Delete person"}),t.distinct_ids.length>1&&(0,e.jsx)(P,{onClick:()=>Ve(!0),"data-attr":"merge-person-button",type:"secondary",children:"Split IDs"})]})}),(0,e.jsx)(fe,{}),(0,e.jsx)(re,{activeKey:p,onChange:y=>{Xe(y)},"data-attr":"persons-tabs",tabs:[s?{key:"feed",label:(0,e.jsx)("span",{"data-attr":"persons-feed-tab",children:"Feed"}),content:(0,e.jsx)(Oe,{person:t})}:!1,{key:"properties",label:(0,e.jsx)("span",{"data-attr":"persons-properties-tab",children:"Properties"}),content:(0,e.jsx)(ce,{type:"person",properties:t.properties||{},searchable:!0,onEdit:Qe,sortProperties:!0,embedded:!1,onDelete:y=>Je(y),filterable:!0})},{key:"events",label:(0,e.jsx)("span",{"data-attr":"persons-events-tab",children:"Events"}),content:(0,e.jsx)(ge,{query:{kind:"DataTableNode",full:!0,hiddenColumns:["person"],source:{kind:"EventsQuery",select:Le("EventsQuery"),personId:t.id,after:"-24h"}}})},{key:"sessionRecordings",label:(0,e.jsx)("span",{"data-attr":"person-session-recordings-tab",children:"Recordings"}),content:(0,e.jsxs)(e.Fragment,{children:[$e?.session_recording_opt_in?null:(0,e.jsx)("div",{className:"mb-4",children:(0,e.jsxs)(_,{type:"info",children:["Session recordings are currently disabled for this ",ze,". To use this feature, please go to your"," ",(0,e.jsx)(I,{to:`${A.settings("project")}#recordings`,children:"project settings"})," ","and enable it."]})}),(0,e.jsx)("div",{className:"SessionRecordingPlaylistHeightWrapper",children:(0,e.jsx)(ve,{logicKey:`person-scene-${t.uuid}`,personUUID:t.uuid,updateSearchParams:!0})})]})},{key:"cohorts",label:(0,e.jsx)("span",{"data-attr":"persons-cohorts-tab",children:"Cohorts"}),content:(0,e.jsx)(Ae,{})},Ke&&t.uuid?{key:"related",label:(0,e.jsxs)("span",{className:"flex items-center","data-attr":"persons-related-tab",children:["Related groups",(0,e.jsx)(M,{title:"People and groups that have shared events with this person in the last 90 days.",children:(0,e.jsx)(R,{className:"ml-1 text-base shrink-0"})})]}),content:(0,e.jsx)(Ie,{id:t.uuid,groupTypeIndex:null})}:!1,t.uuid?{key:"featureFlags",tooltip:"Only shows feature flags with targeting conditions based on person properties.",label:(0,e.jsx)("span",{"data-attr":"persons-related-flags-tab",children:"Feature flags"}),content:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("div",{className:"flex space-x-2 items-center mb-2",children:[(0,e.jsxs)("div",{className:"flex items-center",children:["Choose ID:",(0,e.jsx)(M,{title:(0,e.jsxs)("div",{className:"space-y-2",children:[(0,e.jsx)("div",{children:"Feature flags values can depend on a person's distinct ID."}),(0,e.jsx)("div",{children:"If you want your flag values to stay consistent for each user, you can enable flag persistence in the feature flag settings."}),(0,e.jsxs)("div",{children:["This option may depend on your specific setup and isn't always suitable. Read more in the"," ",(0,e.jsx)(I,{to:"https://posthog.com/docs/feature-flags/creating-feature-flags#persisting-feature-flags-across-authentication-steps",children:"documentation."})]})]}),children:(0,e.jsx)(R,{className:"ml-1 text-base"})})]}),(0,e.jsx)(F,{value:H||T,onChange:y=>y&&We(y),options:t.distinct_ids.map(y=>({label:y,value:y})),"data-attr":"person-feature-flags-select"})]}),(0,e.jsx)(ee,{className:"mb-4"}),(0,e.jsx)(Ne,{distinctId:H||t.distinct_ids[0]})]})}:!1,{key:"history",label:"History",content:(0,e.jsx)(he,{scope:"Person",id:t.id,caption:(0,e.jsx)(_,{type:"info",children:"This page only shows changes made by users in the PostHog site. Automatic changes from the API aren't shown here."})})},o?{key:"dashboard",label:"Dashboard",content:(0,e.jsx)(Fe,{person:t})}:!1]}),u&&t&&(0,e.jsx)(Ee,{person:t})]})}export{ro as PersonScene,qt as scene};
//# sourceMappingURL=/static/PersonScene-2HO3NRHX.js.map
